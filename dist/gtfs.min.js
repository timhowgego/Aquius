var gtfsToAquius=gtfsToAquius||{
init:function(e){"use strict";function t(e,t,i){var n,r,o,s=document.createElement(e);if(void 0!==t)for(n=Object.keys(t),o=0;o<n.length;o+=1)s[n[o]]=t[n[o]];if(void 0!==i)for(r=Object.keys(i),o=0;o<r.length;o+=1)s.style[r[o]]=i[r[o]];return s}function i(e,i,n,r){var o,s,a,f,u,p=t("table");if(void 0!==r&&p.appendChild(t("caption",{textContent:r})),i.length>0){for(a=t("tr"),f=0;f<i.length;f+=1)"object"==typeof i[f]?((s=t("th")).appendChild(i[f]),a.appendChild(s)):a.appendChild(t("th",{textContent:i[f].toString()}));p.appendChild(a)}for(f=0;f<e.length;f+=1){for(a=t("tr"),u=0;u<e[f].length;u+=1)"object"==typeof e[f][u]?(o=t("td")).appendChild(e[f][u]):o=t("td",{textContent:e[f][u].toString()}),void 0!==n&&n.length>u&&(o.className=n[u]),a.appendChild(o);p.appendChild(a)}return p}function n(e,n,o){var s,a,f,u,p=o._vars,d=document.getElementById(p.configId+"ImportFiles"),c=document.getElementById(p.configId+"Output"),g=document.getElementById(p.configId+"Progress");if(void 0!==e)return r(e,p),!1;if(!c||!g)return!1;for(;c.firstChild;)c.removeChild(c.firstChild);for(;g.firstChild;)g.removeChild(g.firstChild);for(null!==d&&(d.disabled=!1),c.className="",f=["aquius","config"],u=0;u<f.length;u+=1)f[u]in n&&Object.keys(n[f[u]]).length>0&&(a="config"===f[u]?JSON.stringify(n[f[u]],null,1):JSON.stringify(n[f[u]]),g.appendChild(t("a",{className:p.configId+"Download",href:window.URL.createObjectURL(new Blob([a],{type:"application/json;charset=utf-8"})),download:f[u]+".json",textContent:"Save "+f[u]+".json",role:"button"})));if(s="aquius"in n&&"translation"in n.aquius&&"en-US"in n.aquius.translation&&"link"in n.aquius.translation["en-US"]?n.aquius.translation["en-US"].link:"Services","undefined"!=typeof aquius&&"aquius"in n&&(c.appendChild(t("div",{id:p.configId+"Map"},{height:document.documentElement.clientHeight/2+"px"})),aquius.init(p.configId+"Map",{dataObject:n.aquius,uiStore:!1})),"warning"in n)for(u=0;u<n.warning.length;u+=1)c.appendChild(t("p",{textContent:n.warning[u]}));"networkTable"in n&&c.appendChild(i(n.networkTable.data,n.networkTable.header,n.networkTable.format,s+" by Network")),"summaryTable"in n&&c.appendChild(i(n.summaryTable.data,n.summaryTable.header,n.summaryTable.format,s+" % by Hour (scheduled only)"))}function r(e,i){var n,r=document.getElementById(i.configId+"ImportFiles"),o=document.getElementById(i.configId+"Output"),s=document.getElementById(i.configId+"Progress");if(void 0!==e&&null!==o){for(;o.firstChild;)o.removeChild(o.firstChild);if(o.className=i.configId+"OutputError",n="message"in e?e.message:JSON.stringify(e),o.appendChild(t("p",{textContent:"Error: "+n})),null!==s){for(;s.firstChild;)s.removeChild(s.firstChild);s.textContent="Failed"}null!==r&&(r.disabled=!1)}}return function(e,i,n){var r,o,s,a=document.getElementById(e.configId);if(!a)return!1;for(;a.firstChild;)a.removeChild(a.firstChild);return Object.keys&&[].indexOf&&"object"==typeof JSON&&window.File&&window.FileReader&&window.Blob?(document.head.appendChild(t("script",{src:"https://timhowgego.github.io/Aquius/dist/aquius.min.js",type:"text/javascript"})),o=t("form",{className:e.configId+"Input"}),s=t("label",{textContent:n}),(r=t("input",{id:e.configId+"ImportFiles",multiple:"multiple",name:e.configId+"ImportFiles[]",type:"file"})).addEventListener("change",(function(){i(e)}),!1),s.appendChild(r),o.appendChild(s),o.appendChild(t("span",{id:e.configId+"Progress"})),a.appendChild(o),a.appendChild(t("div",{id:e.configId+"Output"})),!0):(a.appendChild(document.createTextNode("Browser not supported: Try a modern browser")),!1)}({configId:e,process:this.process},(function(e){var t,i={},o={},s=document.getElementById(e.configId+"ImportFiles"),a={_vars:e,callback:n},f=0,u=document.getElementById(e.configId+"Progress"),p=0;function d(t,n,s){var u,d,c,g,l;if((u=t.toLowerCase().split(".")).length>1&&"txt"===u[u.length-1]?((c=u.slice(0,u.length-1).join("."))in i==!1&&(i[c]=[]),i[c][n]=s):((c=u.join("."))in o==!1&&(o[c]=[]),o[c][n]=s),(f+=1)===p){for(g=Object.keys(o),l=0;l<g.length;l+=1)try{"type"in(d=JSON.parse(o[g[l]].join("")))&&"FeatureCollection"===d.type?a.geojson=d:a.config=d}catch(t){t instanceof SyntaxError==!1&&r(t,e)}e.process(i,a)}}if(null!==s&&s.files.length>0){if(s.disabled=!0,null!==u){for(;u.firstChild;)u.removeChild(u.firstChild);u.textContent="Working..."}!function(i){var n,o,s,a=1e8,f=[];for(s=0;s<i.length;s+=1)for(o=0;i[s].size>=o;)f.push([i[s],parseInt(o/a,10)]),o+=a;for(p=f.length,s=0;s<p;s+=1)(t=new FileReader).onerror=function(i,n){r(new Error("Could not read "+n[0].name),e),t.abort()},t.onload=function(t){return function(){try{d(t[0].name,t[1],this.result)}catch(t){r(t,e)}}}(f[s]),n=f[s][0].slice(f[s][1]*a,f[s][1]*a+a),t.readAsText(n)}(s.files)}}),"GTFS as .txt, optional config, and optional GeoJSON to process:")},process:function(e,t){"use strict";var i={_:{},aquius:{},config:{},summary:{}};function n(e){var t=new Date(e),i=t.getFullYear().toString();return t.getMonth()<9&&(i+="0"),i+=(t.getMonth()+1).toString(),t.getDate()<10&&(i+="0"),i+=t.getDate().toString()}function r(e){return e.length<8?0:Date.UTC(e.slice(0,4),e.slice(4,6)-1,e.slice(6,8))}function o(e,t,i,n){var r=Math.PI/180,o=Math.sin((i-e)*r/2),s=Math.sin((n-t)*r/2),a=o*o+Math.cos(e*r)*Math.cos(i*r)*s*s;return 6371e3*(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)))}function s(e,t,i){var n,r,o,s,a,f,u,p=-1,d=new RegExp('(\\,|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^\\,\\r\\n]*))',"gi"),c=-1,g=[];function l(e,t,i,n,r){return t.length===n&&(-1!==r?(t[r]in e.gtfs[i]==!1&&(e.gtfs[i][t[r]]=[]),e.gtfs[i][t[r]].push(t)):e.gtfs[i].push(t)),e}for(Array.isArray(i)||(i=[i]),f=0;f<i.length;f+=1)for(s=d.exec(i[f]),r=g.length-1,n=!0;null!==s;){if(s[1].length&&","!==s[1]){if(f>0&&!0===n&&(g.length>p&&r<g.length-1&&((a=g.slice(0,r)).push(g[r]+g[r+1]),g=a.concat(g.slice(r+2))),n=!1),-1===p){for(p=g.length,u=0;u<g.length;u+=1)g[u]in e.gtfsHead[t]&&(e.gtfsHead[t][g[u]]=u);if(t in e.gtfsRequired)for(u=0;u<e.gtfsRequired[t].length;u+=1)if(-1===e.gtfsHead[t][e.gtfsRequired[t][u]])return"error"in e==!1&&(e.error=[]),e.error.push("Missing value "+e.gtfsRequired[t][u]+" in GTFS "+t+".txt"),e;if(t in e.gtfsIndex){if(-1===(c=e.gtfsHead[t][e.gtfsIndex[t]]))return"error"in e==!1&&(e.error=[]),e.error.push("Missing index value "+e.gtfsIndex[t]+" in GTFS "+t+".txt"),e;e.gtfs[t]={}}else e.gtfs[t]=[]}else e=l(e,g,t,p,c);g=[]}void 0===(o=s[2]?s[2].replace(new RegExp('""',"g"),'"'):s[3])&&(o=""),g.push(o.trim()),s=d.exec(i[f])}return e=l(e,g,t,p,c)}function a(e,t,i){return"reference"in e.aquius==!1&&(e.aquius.reference={}),t in e.aquius.reference==!1&&(e.aquius.reference[t]=[],e._[t]={}),i in e._[t]==!1&&(e.aquius.reference[t].push(i),e._[t][i]=e.aquius.reference[t].length-1),e}function f(e,t,i){var n,r,o,s,f={};function u(e,t){var i,n,r,o=Object.keys(e);for(n=0;n<t.length;n+=1){for(i=!0,r=0;r<o.length;r+=1)if(o[r]in t[n]==!1||t[n][o[r]]!==e[o[r]]){i=!1;break}if(!0===i)return!0}return!1}return!0===e.config.allowName&&(r="",t[e.gtfsHead.stops.stop_id]in e.config.stopOverride&&"stop_name"in e.config.stopOverride[t[e.gtfsHead.stops.stop_id]]?r=e.config.stopOverride[t[e.gtfsHead.stops.stop_id]].stop_name:-1!==e.gtfsHead.stops.stop_name&&(r=t[e.gtfsHead.stops.stop_name].trim()),""!==r&&(f.n=r)),!0===e.config.allowStopUrl&&(r="",t[e.gtfsHead.stops.stop_id]in e.config.stopOverride&&"stop_url"in e.config.stopOverride[t[e.gtfsHead.stops.stop_id]]?r=e.config.stopOverride[t[e.gtfsHead.stops.stop_id]].stop_url:-1!==e.gtfsHead.stops.stop_url&&(r=t[e.gtfsHead.stops.stop_url].trim()),""!==r&&(s="[*]",-1===(o=r.lastIndexOf(s))&&-1!==e.gtfsHead.stops.stop_code&&(n=t[e.gtfsHead.stops.stop_code].trim(),-1!==(o=r.lastIndexOf(n))&&(r=r.substring(0,o)+s+r.substring(o+n.length),f.i=n)),-1===o&&-1!==e.gtfsHead.stops.stop_id&&(n=t[e.gtfsHead.stops.stop_id].trim(),-1!==(o=r.lastIndexOf(n))&&(r=r.substring(0,o)+s+r.substring(o+n.length),f.i=n)),e=a(e,"url",r),f.u=e._.url[r])),Object.keys(f).length>0&&("r"in e.aquius.node[i][2]?!1===u(f,e.aquius.node[i][2].r)&&e.aquius.node[i][2].r.push(f):e.aquius.node[i][2].r=[f]),e.config.allowCode&&(f={},e.config.codeAsStopId?f.n=t[e.gtfsHead.stops.stop_id].trim():t[e.gtfsHead.stops.stop_id]in e.config.stopOverride&&"stop_code"in e.config.stopOverride[t[e.gtfsHead.stops.stop_id]]?f.n=e.config.stopOverride[t[e.gtfsHead.stops.stop_id]].stop_code:-1!==e.gtfsHead.stops.stop_code&&(f.n=t[e.gtfsHead.stops.stop_code].trim()),"n"in f&&""!==f.n&&("r"in e.aquius.node[i][2]?!1===u(f,e.aquius.node[i][2].r)&&e.aquius.node[i][2].r.push(f):e.aquius.node[i][2].r=[f])),e}function u(e,t){var i=Math.pow(10,e.config.coordinatePrecision);function n(e,t){var i=parseFloat(e);return Number.isNaN(i)?0:Math.round(i*t)/t}return-1!==e.gtfsHead.stops.stop_id&&t[e.gtfsHead.stops.stop_id]in e.config.stopOverride&&"x"in e.config.stopOverride[t[e.gtfsHead.stops.stop_id]]&&"y"in e.config.stopOverride[t[e.gtfsHead.stops.stop_id]]?[n(e.config.stopOverride[t[e.gtfsHead.stops.stop_id]].x,i),n(e.config.stopOverride[t[e.gtfsHead.stops.stop_id]].y,i)]:-1!==e.gtfsHead.stops.stop_lat&&-1!==e.gtfsHead.stops.stop_lon?[n(t[e.gtfsHead.stops.stop_lon],i),n(t[e.gtfsHead.stops.stop_lat],i)]:[0,0]}function p(e,t,i){return 0===t[0]&&0===t[1]&&(i in e.config.stopOverride==!1&&(e.config.stopOverride[i]={}),e.config.stopOverride[i].x=0,e.config.stopOverride[i].y=0),e}function d(e){var t,i,n=e.split(":");if(3!==n.length)return 0;for(i=0;i<n.length;i+=1){if(t=parseInt(n[i],10),Number.isNaN(t))return 0;n[i]=t}return 3600*n[0]+60*n[1]+n[2]}function c(e,t,i){var n;function r(e,t,i){var n,r,o,s,a,f,u,p;if(Array.isArray(i))for(f=0;f<i.length;f+=1)if(Array.isArray(i[f])){for(n=!1,u=0,p=i[f].length-1;u<i[f].length;p=u++)r=i[f][u][0],s=i[f][u][1],o=i[f][p][0],s>t!=(a=i[f][p][1])>t&&e<(o-r)*(t-s)/(a-s)+r&&(n=!n);if(n&&0===f&&1===i.length)return!0;if(!1===n&&0===f)return!1;if(n&&f>0)return!1;if(f===i.length-1)return!0}return!1}if("geometry"in i==!1||"type"in i.geometry==!1||"coordinates"in i.geometry==!1||!Array.isArray(i.geometry.coordinates))return!1;if("MultiPolygon"===i.geometry.type)for(n=0;n<i.geometry.coordinates.length;n+=1)if(r(e,t,i.geometry.coordinates[n]))return!0;return"Polygon"===i.geometry.type&&r(e,t,i.geometry.coordinates)}function g(e){var t,i={};function n(e,t){var i,n;if(Array.isArray(e))for(i=0;i<e.length;i+=1)if(Array.isArray(e[i]))for(n=0;n<e[i].length;n+=1)Array.isArray(e[i][n])&&2===e[i][n].length&&("maxX"in t==!1?(t.maxX=e[i][n][0],t.minX=e[i][n][0],t.maxY=e[i][n][1],t.minY=e[i][n][1]):(e[i][n][0]>t.maxX?t.maxX=e[i][n][0]:e[i][n][0]<t.minX&&(t.minX=e[i][n][0]),e[i][n][1]>t.maxY?t.maxY=e[i][n][1]:e[i][n][1]<t.minY&&(t.minY=e[i][n][1])));return t}if("geometry"in e&&"type"in e.geometry&&"coordinates"in e.geometry&&Array.isArray(e.geometry.coordinates)){if("MultiPolygon"===e.geometry.type)for(t=0;t<e.geometry.coordinates.length;t+=1)i=n(e.geometry.coordinates[t],i);"Polygon"===e.geometry.type&&(i=n(e.geometry.coordinates,i))}return"maxX"in i?[(i.maxX+i.minX)/2,(i.maxY+i.minY)/2]:null}function l(e,t){var i;return delete e._,delete e.gtfs,delete e.gtfsHead,"object"==typeof t&&"callback"in t?("error"in e&&(i=new Error(e.error.join(". "))),t.callback(i,e,t),!0):e}return i=function(e,t){var i,r={allowBlock:!1,allowDuration:!1,allowDwell:!1,allowCabotage:!1,allowCode:!0,allowColor:!0,allowDuplication:!1,allowHeadsign:!1,allowName:!0,allowNoc:!1,allowRoute:!0,allowRouteLong:!1,allowRouteUrl:!0,allowSplit:!1,allowStopUrl:!0,allowWaypoint:!0,allowZeroCoordinate:!0,codeAsStopId:!1,coordinatePrecision:5,duplicationRouteOnly:!0,fromDate:n(Date.now()),inGeojson:!0,isCircular:[],meta:{schema:"0"},mirrorLink:!0,modeInclude:[],networkFilter:{type:"agency"},nodeGeojson:{},option:{},populationProperty:"population",placeNameProperty:"name",productOverride:{},routeExclude:[],routeInclude:[],routeOverride:{},serviceFilter:{},servicePer:1,splitMinimumJoin:2,stopExclude:[],stopInclude:[],stopOverride:{},stopPlace:!1,toDate:n(Date.now()+5184e5),translation:{}},o=Object.keys(r);for("object"!=typeof t&&(t={}),i=0;i<o.length;i+=1)"config"in t&&o[i]in t.config&&typeof t.config[o[i]]==typeof r[o[i]]?e.config[o[i]]=t.config[o[i]]:e.config[o[i]]=r[o[i]];for(e._.circular={},i=0;i<e.config.isCircular.length;i+=1)e._.circular[e.config.isCircular[i]]=e.config.isCircular[i];return e}(i,t),i=function(e,t){var i,n;e.gtfsIndex={stop_times:"trip_id"},e.gtfsHead={agency:{agency_id:-1,agency_name:-1,agency_noc:-1},calendar:{service_id:-1,monday:-1,tuesday:-1,wednesday:-1,thursday:-1,friday:-1,saturday:-1,sunday:-1,start_date:-1,end_date:-1},calendar_dates:{service_id:-1,date:-1,exception_type:-1},frequencies:{trip_id:-1,start_time:-1,end_time:-1,headway_secs:-1},routes:{agency_id:-1,route_color:-1,route_id:-1,route_long_name:-1,route_short_name:-1,route_text_color:-1,route_url:-1},stop_times:{arrival_time:-1,departure_time:-1,trip_id:-1,stop_id:-1,stop_sequence:-1,pickup_type:-1,drop_off_type:-1},stops:{stop_code:-1,stop_id:-1,stop_lat:-1,stop_lon:-1,stop_name:-1,stop_url:-1,location_type:-1,parent_station:-1},transfers:{from_stop_id:-1,to_stop_id:-1,transfer_type:-1},trips:{block_id:-1,direction_id:-1,route_id:-1,service_id:-1,trip_headsign:-1,trip_id:-1,trip_short_name:-1}},e.gtfsRequired={routes:["route_id"],stops:["stop_id","stop_lat","stop_lon"],trips:["route_id","service_id","trip_id"],stop_times:["trip_id","stop_id","stop_sequence"]},("type"in e.config.networkFilter&&"mode"===e.config.networkFilter.type||e.config.modeInclude.length>0)&&(e.gtfsHead.routes.route_type=-1),"name"in e.config.meta!=!1&&"en-US"in e.config.meta.name!=!1||("feed_info"in e.gtfsHead==!1&&(e.gtfsHead.feed_info={}),e.gtfsHead.feed_info.feed_publisher_name=-1),"url"in e.config.meta==!1&&("feed_info"in e.gtfsHead==!1&&(e.gtfsHead.feed_info={}),e.gtfsHead.feed_info.feed_publisher_url=-1),i=Object.keys(e.gtfsRequired);for(n=0;n<i.length;n+=1)if(i[n]in t==!1)return"error"in e==!1&&(e.error=[]),e.error.push("Missing GTFS "+i[n]+".txt"),e;for(e.gtfs={},i=Object.keys(e.gtfsHead),n=0;n<i.length;n+=1)i[n]in t&&(e=s(e,i[n],t[i[n]]));return e}(i,e),e=null,"error"in i||(i=function(e,t){var i,n,r,s,a,f,u,p,d,l,_,h,m,y,k={},v={},w=[],H=[],q=-1,b=Math.pow(10,e.config.coordinatePrecision),S=0,O={},x={},j=0,I={};if(e.aquius.place=[],"object"==typeof t&&"geojson"in t&&"type"in t.geojson&&"FeatureCollection"===t.geojson.type&&"features"in t.geojson&&Array.isArray(t.geojson.features)&&t.geojson.features.length>0){for(m=0;m<t.geojson.features.length;m+=1)null!==(i=g(t.geojson.features[m]))&&(w.push(m),v[m]={x:Math.round(i[0]*b)/b,y:Math.round(i[1]*b)/b},k[v[m].x+":"+v[m].y]=m);for(m=0;m<e.aquius.node.length;m+=1)H.push([e.aquius.node[m][0]+e.aquius.node[m][1],m]);for(H.sort(),m=0;m<H.length;m+=1){if(q=-1,(f=(l=e.aquius.node[H[m][1]])[0]+":"+l[1])in e.config.nodeGeojson&&e.config.nodeGeojson[f]in k&&(q=k[e.config.nodeGeojson[f]]),-1===q&&c(l[0],l[1],t.geojson.features[S])&&(q=S),-1===q){for((n={})[S]=S,y=0;y<w.length;y+=1)if(h=Math.abs(l[0]+l[1]-(v[w[y]].x+v[w[y]].y)),0===y&&(p=h),p>=h&&w[y]in n==!1){if(c(l[0],l[1],t.geojson.features[w[y]])){q=w[y];break}n[w[y]]=w[y],Object.keys(n).length<5&&(p=h)}if(-1===q)for(y=0;y<t.geojson.features.length;y+=1)if(y in n==!1&&c(l[0],l[1],t.geojson.features[y])){q=y;break}if(-1===q&&!1===e.config.inGeojson)for(d=-1,y=0;y<w.length;y+=1)s=o(l[1],l[0],v[w[y]].y,v[w[y]].x),(-1===d||s<d)&&(d=s,q=y)}-1!==q?(S=q,q in x?e.aquius.node[H[m][1]][2].p=x[q]:q in v&&((f=[v[q].x,v[q].y].join(":"))in O?a=O[f]:(e.aquius.place.push([v[q].x,v[q].y,{}]),a=e.aquius.place.length-1,O[f]=a),e.aquius.node[H[m][1]][2].p=a,x[q]=a,"properties"in t.geojson.features[q]&&e.config.populationProperty in t.geojson.features[q].properties&&(_=parseFloat(t.geojson.features[q].properties[e.config.populationProperty]),Number.isNaN(_)||("p"in e.aquius.place[a][2]==!1&&(e.aquius.place[a][2].p=0),e.aquius.place[a][2].p+=_,e.aquius.place[a][2].p>j&&(j=e.aquius.place[a][2].p))),"properties"in t.geojson.features[q]&&e.config.placeNameProperty in t.geojson.features[q].properties&&null!==t.geojson.features[q].properties[e.config.placeNameProperty]&&((r={}).n=t.geojson.features[q].properties[e.config.placeNameProperty].trim(),""!==r.n&&("r"in e.aquius.place[a][2]==!1&&(e.aquius.place[a][2].r=[]),e.aquius.place[a][2].r.push(r)))),q in v&&(e.config.nodeGeojson[l[0]+":"+l[1]]=v[q].x+":"+v[q].y)):!0===e.config.inGeojson&&(I[H[m][1]]="")}if(j>0&&"placeScale"in e.config.option==!1&&(e.config.option.placeScale=Math.round(1/(j/2e6)*1e5)/1e5,"option"in e.aquius==!1&&(e.aquius.option={}),e.aquius.option.placeScale=e.config.option.placeScale),Object.keys(I).length>0)for(u=Object.keys(e._.nodeLookup),m=0;m<u.length;m+=1)e._.nodeLookup[u[m]]in I&&delete e._.nodeLookup[u[m]]}return e}(i=function(e){var t,i,n,r;"nodeLookup"in e._==!1&&(e._.nodeLookup={}),"nodeCoord"in e._==!1&&(e._.nodeCoord={}),"node"in e.aquius==!1&&(e.aquius.node=[]);for(r=0;r<e.gtfs.stops.length;r+=1)e.gtfs.stops[r].stop_id in e._.nodeLookup!=!1||""===e.gtfs.stops[r][e.gtfsHead.stops.stop_id]||"stopExclude"in e._!=!1&&e.gtfs.stops[r][e.gtfsHead.stops.stop_id]in e._.stopExclude!=!1||"stopInclude"in e._!=!1&&!(e.gtfs.stops[r][e.gtfsHead.stops.stop_id]in e._.stopInclude)||(t=u(e,e.gtfs.stops[r]),(e.config.allowZeroCoordinate||0!==t[0]||0!==t[1])&&(e=p(e,t,e.gtfs.stops[r][e.gtfsHead.stops.stop_id]),(n=t[0].toString()+","+t[1].toString())in e._.nodeCoord?i=e._.nodeCoord[n]:(i=e.aquius.node.length,e.aquius.node.push([t[0],t[1],{}]),e._.nodeCoord[n]=i),e._.nodeLookup[e.gtfs.stops[r][e.gtfsHead.stops.stop_id]]=i,e=f(e,e.gtfs.stops[r],i)));return delete e._.nodeCoord,e}(i=function(e){var t,i,n,r,o,s,a;if("transfers"in e.gtfs&&-1!==e.gtfsHead.transfers.from_stop_id&&-1!==e.gtfsHead.transfers.to_stop_id&&1!==e.gtfsHead.transfers.transfer_type){"nodeLookup"in e._==!1&&(e._.nodeLookup={}),"nodeCoord"in e._==!1&&(e._.nodeCoord={}),"node"in e.aquius==!1&&(e.aquius.node=[]);for(s=0;s<e.gtfs.transfers.length;s+=1)if(""!==e.gtfs.transfers[s][e.gtfsHead.transfers.from_stop_id]&&("stopExclude"in e._==!1||e.gtfs.transfers[s][e.gtfsHead.transfers.from_stop_id]in e._.stopExclude==!1&&e.gtfs.transfers[s][e.gtfsHead.transfers.to_stop_id]in e._.stopExclude==!1)&&("stopInclude"in e._==!1||e.gtfs.transfers[s][e.gtfsHead.transfers.from_stop_id]in e._.stopInclude&&e.gtfs.transfers[s][e.gtfsHead.transfers.to_stop_id]in e._.stopInclude)&&(r=e._.nodeLookup[e.gtfs.transfers[s][e.gtfsHead.transfers.from_stop_id]])!==(o=e._.nodeLookup[e.gtfs.transfers[s][e.gtfsHead.transfers.to_stop_id]]))if(void 0!==r&&void 0!==o);else if(void 0!==r)e._.nodeLookup[o]=r;else if(void 0!==o)e._.nodeLookup[r]=o;else if(void 0===r&&void 0===o)for(a=0;a<e.gtfs.stops.length;a+=1)if(e.gtfs.stops[a][e.gtfsHead.stops.stop_id]===r&&(t=u(e,e.gtfs.stops[a]),e.config.allowZeroCoordinate||0!==t[0]||0!==t[1])){e=p(e,t,e.gtfs.stops[a][e.gtfsHead.stops.stop_id]),(n=t[0].toString()+","+t[1].toString())in e._.nodeCoord?i=e._.nodeCoord[n]:(i=e.aquius.node.length,e.aquius.node.push([t[0],t[1],{}]),e._.nodeCoord[n]=i),e._.nodeLookup[r]=i,e._.nodeLookup[o]=i,e=f(e,e.gtfs.stops[a],i);break}}return e}(i=function(e){var t,i,n,r,o=[];if(-1!==e.gtfsHead.stops.location_type&&-1!==e.gtfsHead.stops.parent_station){"nodeLookup"in e._==!1&&(e._.nodeLookup={}),"nodeCoord"in e._==!1&&(e._.nodeCoord={}),"node"in e.aquius==!1&&(e.aquius.node=[]);for(r=0;r<e.gtfs.stops.length;r+=1)"stopExclude"in e._!=!1&&e.gtfs.stops[r][e.gtfsHead.stops.stop_id]in e._.stopExclude!=!1||"stopInclude"in e._!=!1&&!(e.gtfs.stops[r][e.gtfsHead.stops.stop_id]in e._.stopInclude)||("1"===e.gtfs.stops[r][e.gtfsHead.stops.location_type]?(t=u(e,e.gtfs.stops[r]),(e.config.allowZeroCoordinate||0!==t[0]||0!==t[1])&&(e=p(e,t,e.gtfs.stops[r][e.gtfsHead.stops.stop_id]),(n=t[0].toString()+","+t[1].toString())in e._.nodeCoord?i=e._.nodeCoord[n]:(i=e.aquius.node.length,e.aquius.node.push([t[0],t[1],{}]),e._.nodeCoord[n]=i),e._.nodeLookup[e.gtfs.stops[r][e.gtfsHead.stops.stop_id]]=i,e=f(e,e.gtfs.stops[r],i))):""!==e.gtfs.stops[r][e.gtfsHead.stops.parent_station]&&o.push([e.gtfs.stops[r][e.gtfsHead.stops.stop_id],e.gtfs.stops[r][e.gtfsHead.stops.parent_station]]));for(r=0;r<o.length;r+=1)o[r][1]in e._.nodeLookup&&(e._.nodeLookup[o[r][0]]=e._.nodeLookup[o[r][1]])}return e}(i=function(e){var t;if(e.config.stopExclude.length>0)for(e._.stopExclude={},t=0;t<e.config.stopExclude.length;t+=1)e._.stopExclude[e.config.stopExclude[t]]="";if(e.config.stopInclude.length>0)for(e._.stopInclude={},t=0;t<e.config.stopInclude.length;t+=1)e._.stopInclude[e.config.stopInclude[t]]="";return e}(i=function(e){var t,i;if("serviceFilter"in e.config&&"type"in e.config.serviceFilter&&"period"===e.config.serviceFilter.type){"period"in e.config.serviceFilter!=!1&&Array.isArray(e.config.serviceFilter.period)&&0!==e.config.serviceFilter.period.length||(t=["monday","tuesday","wednesday","thursday","friday"],e.config.serviceFilter.period=[{name:{"en-US":"Typical day"}},{day:t,name:{"en-US":"Typical weekday"}},{day:t,name:{"en-US":"Weekday early"},time:[{end:"10:00:00"}]},{day:t,name:{"en-US":"Weekday 10:00-17:00"},time:[{start:"10:00:00",end:"17:00:00"}]},{day:t,name:{"en-US":"Weekday evening"},time:[{start:"17:00:00"}]},{day:["saturday"],name:{"en-US":"Saturday"}},{day:["sunday"],name:{"en-US":"Sunday"}}]),e.aquius.service=[];for(i=0;i<e.config.serviceFilter.period.length;i+=1)"name"in e.config.serviceFilter.period[i]==!1&&(e.config.serviceFilter.period[i].name={"en-US":"Period "+i}),e.aquius.service.push([[i],e.config.serviceFilter.period[i].name,{}])}return e}(i=function(e){var t,i,n,r,o,s,a,f={0:{"en-US":"Tram"},1:{"en-US":"Metro"},2:{"en-US":"Rail"},3:{"en-US":"Bus"},4:{"en-US":"Ferry"},5:{"en-US":"Cable car"},6:{"en-US":"Cable car"},7:{"en-US":"Funicular"},100:{"en-US":"Rail"},101:{"en-US":"High speed rail"},102:{"en-US":"Long distance rail"},103:{"en-US":"Inter-regional rail"},105:{"en-US":"Sleeper rail"},106:{"en-US":"Regional rail"},107:{"en-US":"Tourist rail"},108:{"en-US":"Rail shuttle"},109:{"en-US":"Suburban rail"},200:{"en-US":"Coach"},201:{"en-US":"International coach"},202:{"en-US":"National coach"},204:{"en-US":"Regional coach"},208:{"en-US":"Commuter coach"},400:{"en-US":"Urban rail"},401:{"en-US":"Metro"},402:{"en-US":"Underground"},405:{"en-US":"Monorail"},700:{"en-US":"Bus"},701:{"en-US":"Regional bus"},702:{"en-US":"Express bus"},704:{"en-US":"Local bus"},800:{"en-US":"Trolleybus"},900:{"en-US":"Tram"},1e3:{"en-US":"Water"},1300:{"en-US":"Telecabin"},1400:{"en-US":"Funicular"},1501:{"en-US":"Shared taxi"},1700:{"en-US":"Other"},1701:{"en-US":"Cable car"},1702:{"en-US":"Horse-drawn"}};if("type"in e.config.networkFilter==!1&&(e.config.networkFilter.type="agency"),"reference"in e.config.networkFilter==!1&&(e.config.networkFilter.reference={}),e._.productIndex={},"reference"in e.aquius==!1&&(e.aquius.reference={}),e.aquius.reference.product=[],"mode"===e.config.networkFilter.type){if("route_type"in e.gtfsHead.routes&&-1!==e.gtfsHead.routes.route_type&&e.gtfs.routes.length>0)for(i=0,s=0;s<e.gtfs.routes.length;s+=1)e.gtfs.routes[s][e.gtfsHead.routes.route_type]in e._.productIndex==!1&&(e._.productIndex[e.gtfs.routes[s][e.gtfsHead.routes.route_type]]=i,e.gtfs.routes[s][e.gtfsHead.routes.route_type]in e.config.networkFilter.reference==!1&&(e.gtfs.routes[s][e.gtfsHead.routes.route_type]in f?e.config.networkFilter.reference[e.gtfs.routes[s][e.gtfsHead.routes.route_type]]=f[e.gtfs.routes[s][e.gtfsHead.routes.route_type]]:e.config.networkFilter.reference[e.gtfs.routes[s][e.gtfsHead.routes.route_type]]={}),e.aquius.reference.product[i]=e.config.networkFilter.reference[e.gtfs.routes[s][e.gtfsHead.routes.route_type]],i+=1)}else{if(e.config.networkFilter.type="agency","agency"in e.gtfs&&("agency_id"in e.gtfsHead.agency&&-1!==e.gtfsHead.agency.agency_id||"agency_name"in e.gtfsHead.agency&&-1!==e.gtfsHead.agency.agency_name)&&e.gtfs.agency.length>0){i=0,t="agency_id"in e.gtfsHead.agency&&-1!==e.gtfsHead.agency.agency_id?e.gtfsHead.agency.agency_id:e.gtfsHead.agency.agency_name;for(s=0;s<e.gtfs.agency.length;s+=1)void 0!==e.gtfs.agency[s][t]&&""!==e.gtfs.agency[s][t]&&e.gtfs.agency[s][t]in e._.productIndex==!1&&(e._.productIndex[e.gtfs.agency[s][t]]=i,e.gtfs.agency[s][t]in e.config.networkFilter.reference==!1&&(r=!0===e.config.allowNoc&&-1!==e.gtfsHead.agency.agency_noc?" ["+e.gtfs.agency[s][e.gtfsHead.agency.agency_noc]+"]":"",-1!==e.gtfsHead.agency.agency_name?e.config.networkFilter.reference[e.gtfs.agency[s][t]]={"en-US":e.gtfs.agency[s][e.gtfsHead.agency.agency_name]+r}:e.config.networkFilter.reference[e.gtfs.agency[s][t]]={"en-US":e.gtfs.agency[s][e.gtfsHead.agency.agency_id]+r}),e.aquius.reference.product[i]=e.config.networkFilter.reference[e.gtfs.agency[s][t]],i+=1)}0===Object.keys(e._.productIndex).length&&(e._.productIndex.agency=0,e.config.networkFilter.reference.agency={},e.aquius.reference.product[0]={})}if("network"in e.config.networkFilter==!1||!Array.isArray(e.config.networkFilter.network))switch(e.config.networkFilter.network=[],n=Object.keys(e._.productIndex),e.config.networkFilter.type){case"mode":if(e.config.networkFilter.network.push([n,{"en-US":"All modes"}]),n.length>1)for(s=0;s<n.length;s+=1)n[s]in f?e.config.networkFilter.network.push([[n[s]],f[n[s]]]):e.config.networkFilter.network.push([[n[s]],{"en-US":"Mode #"+n[s]}]);break;case"agency":if(e.config.networkFilter.network.push([n,{"en-US":"All operators"}]),n.length>1)for(s=0;s<n.length;s+=1)if("agency"in e.gtfs&&-1!==e.gtfsHead.agency.agency_id&&-1!==e.gtfsHead.agency.agency_name){for(a=0;a<e.gtfs.agency.length;a+=1)if(e.gtfs.agency[a][e.gtfsHead.agency.agency_id]===n[s]){r=!0===e.config.allowNoc&&-1!==e.gtfsHead.agency.agency_noc?" ["+e.gtfs.agency[a][e.gtfsHead.agency.agency_noc]+"]":"",e.config.networkFilter.network.push([[n[s]],{"en-US":e.gtfs.agency[a][e.gtfsHead.agency.agency_name]+r}]);break}}else e.config.networkFilter.network.push([[n[s]],{"en-US":n[s]}]);break;default:e.config.networkFilter.network.push([n,{"en-US":"All"}])}for(e.aquius.network=[],s=0;s<e.config.networkFilter.network.length;s+=1)if(e.config.networkFilter.network[s].length>1&&Array.isArray(e.config.networkFilter.network[s][0])&&"object"==typeof e.config.networkFilter.network[s][1]){for(o=[],a=0;a<e.config.networkFilter.network[s][0].length;a+=1)e.config.networkFilter.network[s][0][a]in e._.productIndex&&o.push(e._.productIndex[e.config.networkFilter.network[s][0][a]]);e.aquius.network.push([o,e.config.networkFilter.network[s][1],{}])}return e}(i=function(e){if("schema"in e.config.meta!=!1&&"0"===e.config.meta.schema||(e.config.meta.schema="0"),"name"in e.config.meta==!1&&(e.config.meta.name={}),"en-US"in e.config.meta.name==!1&&("feed_info"in e.gtfs&&-1!==e.gtfsHead.feed_info.feed_publisher_name&&e.gtfs.feed_info.length>0?e.config.meta.name["en-US"]=e.gtfs.feed_info[0][e.gtfsHead.feed_info.feed_publisher_name]+" ":e.config.meta.name["en-US"]="",e.config.meta.name["en-US"]+="("+e.config.fromDate,e.config.fromDate!==e.config.toDate&&(e.config.meta.name["en-US"]+="-"+e.config.toDate),e.config.meta.name["en-US"]+=")"),"url"in e.config.meta==!1&&"feed_info"in e.gtfs&&-1!==e.gtfsHead.feed_info.feed_publisher_url&&e.gtfs.feed_info.length>0&&(e.config.meta.url=e.gtfs.feed_info[0][e.gtfsHead.feed_info.feed_publisher_url]),e.aquius.meta=e.config.meta,"en-US"in e.config.translation==!1&&(e.config.translation["en-US"]={}),"link"in e.config.translation["en-US"]==!1)switch(e.config.servicePer){case 1:e.config.translation["en-US"].link="Daily Services";break;case 7:e.config.translation["en-US"].link="Weekly Services";break;default:e.config.translation["en-US"].link="Services per "+e.config.servicePer+" Days"}return e.aquius.translation=e.config.translation,"c"in e.config.option!=!1&&"k"in e.config.option!=!1||(e.config.option.c=parseFloat(e.gtfs.stops[0][e.gtfsHead.stops.stop_lon]),e.config.option.k=parseFloat(e.gtfs.stops[0][e.gtfsHead.stops.stop_lat]),e.config.option.m=12),"x"in e.config.option!=!1&&"y"in e.config.option!=!1||(e.config.option.x=parseFloat(e.gtfs.stops[0][e.gtfsHead.stops.stop_lon]),e.config.option.y=parseFloat(e.gtfs.stops[0][e.gtfsHead.stops.stop_lat]),e.config.option.z=10),e.aquius.option=e.config.option,e}(i))))))),t),i=function(e,t){if("summary"in e&&"service"in e.summary&&e.summary.service.length>0){let i,n,r,o,s,a,f;if(s="_vars"in t&&"configId"in t._vars?t._vars.configId:"",r=["Hour"],n=[s+"Number"],"service"in e.aquius==!1||0===e.aquius.service.length)r.push("All"),n.push(s+"Number");else for(a=0;a<e.aquius.service.length;a+=1)"en-US"in e.aquius.service[a][1]?r.push(e.aquius.service[a][1]["en-US"]):r.push(JSON.stringify(e.aquius.service[a][1])),n.push(s+"Number");for(i=[],a=0;a<e.summary.service.length;a+=1){if(o=[a],void 0===e.summary.service[a])if("service"in e.aquius==!1||0===e.aquius.service.length)o.push("-");else for(f=0;f<e.aquius.service.length;f+=1)o.push("-");else for(f=0;f<e.summary.service[a].length;f+=1)e.summary.service[a][f]>0?o.push((100*e.summary.service[a][f]).toFixed(2)):o.push("-");i.push(o)}e.summaryTable={data:i,format:n,header:r}}return e}(i=function(e){let t,i,n;if("stopOverride"in e.config){for(t=Object.keys(e.config.stopOverride),i=[],n=0;n<t.length;n+=1)"x"in e.config.stopOverride[t[n]]&&0===e.config.stopOverride[t[n]].x&&"y"in e.config.stopOverride[t[n]]&&0===e.config.stopOverride[t[n]].y&&i.push(t[n]);i.length>0&&("warning"in e==!1&&(e.warning=[]),e.warning.push("Caution: Contains "+i.length.toString()+" stop_id with coordinates 0,0, which can be corrected in config.stopOverride, or ignored by setting config.allowZeroCoordinate to false."))}return e}(i=function(e){var t,i,n,r,o,s,a={};for(o=0;o<e.aquius.link.length;o+=1){r=e.aquius.link[o][2],"u"in e.aquius.link[o][3]&&(r=r.concat(e.aquius.link[o][3].u)),"s"in e.aquius.link[o][3]&&(r=r.concat(e.aquius.link[o][3].s)),"t"in e.aquius.link[o][3]&&(r=r.concat(e.aquius.link[o][3].t));for(s=0;s<r.length;s+=1)r[s]in a==!1?a[r[s]]=1:a[r[s]]+=1}for(r=[],t=Object.keys(a),o=0;o<t.length;o+=1)r.push([a[t[o]],t[o]]);for(r.sort((function(e,t){return e[0]-t[0]})),r.reverse(),i=[],n={},o=0;o<r.length;o+=1)i.push(e.aquius.node[r[o][1]]),n[r[o][1]]=o;for(e.aquius.node=i,o=0;o<e.aquius.link.length;o+=1){for(s=0;s<e.aquius.link[o][2].length;s+=1)e.aquius.link[o][2][s]=n[e.aquius.link[o][2][s]];if("u"in e.aquius.link[o][3])for(s=0;s<e.aquius.link[o][3].u.length;s+=1)e.aquius.link[o][3].u[s]=n[e.aquius.link[o][3].u[s]];if("s"in e.aquius.link[o][3])for(s=0;s<e.aquius.link[o][3].s.length;s+=1)e.aquius.link[o][3].s[s]=n[e.aquius.link[o][3].s[s]];if("t"in e.aquius.link[o][3])for(s=0;s<e.aquius.link[o][3].t.length;s+=1)e.aquius.link[o][3].t[s]=n[e.aquius.link[o][3].t[s]]}return e}(i=function(e){var t,i,n,r,s,a,f,u,p,d,c,g,l,_,h,m,y,k,v,w,H,q,b,S={},O={};function x(e,t,i,n){var r,s,a,f,u;if(e.config.isCircular.length>0)return t in e._.circular;if(n.length<3||n[0]!==n[n.length-1])return!1;if("block"in i&&i.block.trips.length>1){for(a=n.join(":"),r=null,f=0;f<i.block.trips.length;f+=1)if(i.block.trips[f]in e._.trip){for(s=e._.trip[i.block.trips[f]].stops.slice().sort((function(e,t){return e[0]-t[0]})),r=[],u=0;u<s.length;u+=1)r.push(s[u][1]);if(r.join(":")!==a){r=null;break}}if(null!==r)return!0}return!(n.length<5)&&o(e.aquius.node[n[1]][1],e.aquius.node[n[1]][0],e.aquius.node[n[n.length-2]][1],e.aquius.node[n[n.length-2]][0])>200}function j(e,t){var i,n;if(1===e.length&&e.length===t.length)return[e[0]+t[0]];for(i=[],n=0;n<e.length;n+=1)n<t.length&&i.push(e[n]+t[n]);return i}function I(e,t){var i,n;if(e===t)return e;for(i=[],n=0;n<e.length&&!(n>t.length);n+=1)0===t[n]?i.push(e[n]):0===e[n]?i.push(t[n]):i.push(Math.round((e[n]+t[n])/2));return i}for(v=Object.keys(e._.trip),w=0;w<v.length;w+=1)if(m=e._.trip[v[w]].route_id,v[w]in O==!1&&m in e._.routes&&"product"in e._.routes[m]){if(u=!1,l=[],g={},a=[],e._.trip[v[w]].stops.sort((function(e,t){return e[0]-t[0]})),h={},"reference"in e._.routes[m]&&e._.routes[m].reference.slug in h==!1&&(h[e._.routes[m].reference.slug]=e._.routes[m].reference),"reference"in e._.trip[v[w]]&&e._.trip[v[w]].reference.slug in h==!1&&(h[e._.trip[v[w]].reference.slug]=e._.trip[v[w]].reference),"block"in e._.trip[v[w]]&&e._.trip[v[w]].block.trips.length>1&&(0===e.config.isCircular.length||m in e._.circular==0)){for(c=[],H=0;H<e._.trip[v[w]].block.trips.length;H+=1)if(e._.trip[v[w]].block.trips[H]in O==!1&&e._.trip[v[w]].block.trips[H]in e._.trip&&e._.trip[e._.trip[v[w]].block.trips[H]].service.join(":")===e._.trip[v[w]].service.join(":")&&e._.trip[e._.trip[v[w]].block.trips[H]].route_id in e._.routes&&e._.routes[e._.trip[e._.trip[v[w]].block.trips[H]].route_id].product===e._.routes[m].product&&"start"in e._.trip[e._.trip[v[w]].block.trips[H]]&&"end"in e._.trip[e._.trip[v[w]].block.trips[H]]){for(y=e._.trip[e._.trip[v[w]].block.trips[H]].stops.sort((function(e,t){return e[0]-t[0]})),r=[],n=[],q=0;q<y.length;q+=1)r.push(y[q][1]),n.push(y[q][2]);c.push([(e._.trip[e._.trip[v[w]].block.trips[H]].start+e._.trip[e._.trip[v[w]].block.trips[H]].end)/2,r,e._.trip[v[w]].block.trips[H],n])}if(c.length>1)for(c.sort((function(e,t){return e[0]-t[0]})),H=0;H<c.length;H+=1)if(c[H][1].length>0&&(l.length>0&&c[H][1][0]===l[l.length-1]&&(c[H][1]=c[H][1].slice(1),c[H][3]=c[H][3].slice(1)),l=l.concat(c[H][1]),a=a.concat(c[H][3]),c[H][2]!==v[w])){for(O[c[H][2]]="",s=["t","setdown","pickup"],q=0;q<s.length;q+=1)if(s[q]in e._.trip[c[H][2]]){s[q]in e._.trip[v[w]]==!1&&(e._.trip[v[w]][s[q]]=[]);for(b=0;b<e._.trip[c[H][2]][s[q]].length;b+=1)-1===e._.trip[v[w]][s[q]].indexOf(e._.trip[c[H][2]][s[q]][b])&&e._.trip[v[w]][s[q]].push(e._.trip[c[H][2]][s[q]][b])}e._.trip[c[H][2]].route_id in e._.routes&&"reference"in e._.routes[e._.trip[c[H][2]].route_id]&&e._.routes[e._.trip[c[H][2]].route_id].reference.slug in h==!1&&(h[e._.routes[e._.trip[c[H][2]].route_id].reference.slug]=e._.routes[e._.trip[c[H][2]].route_id].reference),"reference"in e._.trip[c[H][2]]&&e._.trip[c[H][2]].reference.slug in h==!1&&(h[e._.trip[c[H][2]].reference.slug]=e._.trip[c[H][2]].reference)}}f="f"+e._.routes[m].product,e.config.mirrorLink&&(i="f"+e._.routes[m].product),"setdown"in e._.trip[v[w]]&&e._.trip[v[w]].setdown.length>0&&(e._.trip[v[w]].setdown.sort(),f+="s"+e._.trip[v[w]].setdown.join(":")),"pickup"in e._.trip[v[w]]&&e._.trip[v[w]].pickup.length>0&&(e._.trip[v[w]].pickup.sort(),f+="u"+e._.trip[v[w]].pickup.join(":"),e.config.mirrorLink&&(i+="s"+e._.trip[v[w]].pickup.join(":"))),e.config.mirrorLink&&"setdown"in e._.trip[v[w]]&&e._.trip[v[w]].setdown.length>0&&(i+="u"+e._.trip[v[w]].setdown.join(":")),"t"in e._.trip[v[w]]&&(f+="t"+e._.trip[v[w]].t.join(":"),e.config.mirrorLink&&(i+="t"+e._.trip[v[w]].t.join(":"))),t=0===l.length;for(H=0;H<e._.trip[v[w]].stops.length;H+=1)t&&(l.push(e._.trip[v[w]].stops[H][1]),a.push(e._.trip[v[w]].stops[H][2])),e._.trip[v[w]].stops[H][1]in g?g[e._.trip[v[w]].stops[H][1]]+=1:g[e._.trip[v[w]].stops[H][1]]=1;if(e.config.mirrorLink&&(i=l.slice().reverse().join(":")+i),(f=l.join(":")+f)in S&&"b"in e._.trip[v[w]]==!1)S[f].service=j(S[f].service,e._.trip[v[w]].service),"minutes"in S[f]&&"minutes"in e._.trip[v[w]]&&(S[f].minutes=I(S[f].minutes,e._.trip[v[w]].minutes)),"dwells"in S[f]&&(S[f].dwells=I(S[f].dwells,a));else if(e.config.mirrorLink&&i in S&&"b"in e._.trip[v[w]]==!1)u=!0,S[i].service=j(S[i].service,e._.trip[v[w]].service),"minutes"in S[i]&&"minutes"in e._.trip[v[w]]&&(S[i].minutes=I(S[i].minutes,e._.trip[v[w]].minutes)),"dwells"in S[i]&&(S[i].dwells=I(S[i].dwells,a)),"direction"in S[i]&&delete S[i].direction;else{if(S[f]={direction:1,product:e._.routes[m].product,route:l,service:e._.trip[v[w]].service,dwells:a},"minutes"in e._.trip[v[w]]&&(S[f].minutes=e._.trip[v[w]].minutes),"setdown"in e._.trip[v[w]]){for(_=[],H=0;H<e._.trip[v[w]].setdown.length;H+=1)e._.trip[v[w]].setdown[H]in g&&1===g[e._.trip[v[w]].setdown[H]]&&_.push(e._.trip[v[w]].setdown[H]);_.length>0&&(S[f].setdown=_)}if("pickup"in e._.trip[v[w]]){for(_=[],H=0;H<e._.trip[v[w]].pickup.length;H+=1)e._.trip[v[w]].pickup[H]in g&&1===g[e._.trip[v[w]].pickup[H]]&&_.push(e._.trip[v[w]].pickup[H]);_.length>0&&(S[f].pickup=_)}if(x(e,m,e._.trip[v[w]],l)&&(S[f].circular=1),"b"in e._.trip[v[w]]&&(S[f].b=e._.trip[v[w]].b),"t"in e._.trip[v[w]]){for(_=[],H=0;H<e._.trip[v[w]].t.length;H+=1)e._.trip[v[w]].t[H]in g&&1===g[e._.trip[v[w]].t[H]]&&_.push(e._.trip[v[w]].t[H]);_.length>0&&(S[f].t=_)}}if((p=Object.keys(h)).length>0){u&&"reference"in S[i]==!1&&(S[i].reference=[],S[i].referenceLookup={}),0==u&&"reference"in S[f]==!1&&(S[f].reference=[],S[f].referenceLookup={});for(H=0;H<p.length;H+=1)u&&p[H]in S[i].referenceLookup==!1&&(S[i].reference.push(h[p[H]]),S[i].referenceLookup[p[H]]=""),!1===u&&p[H]in S[f].referenceLookup==!1&&(S[f].reference.push(h[p[H]]),S[f].referenceLookup[p[H]]="")}}for(delete e._.nodeLookup,delete e._.routes,delete e._.trip,e.aquius.link=[],e.summary.network=[],w=0;w<e.aquius.network.length;w+=1)if("service"in e.aquius)for(e.summary.network.push([]),H=0;H<e.aquius.service.length;H+=1)e.summary.network[w].push(0);else e.summary.network.push([0]);for(p=Object.keys(S),w=0;w<p.length;w+=1){for(k=S[p[w]],H=0;H<k.service.length;H+=1){for(q=0;q<e.aquius.network.length;q+=1)-1!==e.aquius.network[q][0].indexOf(k.product)&&(e.summary.network[q][H]+=k.service[H]);k.service[H]<10?k.service[H]=parseFloat(k.service[H].toPrecision(1)):k.service[H]=parseInt(k.service[H],10)}if(!1===e.config.allowWaypoint&&"pickup"in k&&"setdown"in k)for(H=k.pickup.length-1;H>=0;H--)if(-1!==(s=k.setdown.indexOf(k.pickup[H]))){for(q=k.route.length-1;q>=0;q--)k.route[q]===k.pickup[H]&&k.route.splice(q,1);k.pickup.splice(H,1),k.setdown.splice(s,1)}if(d=[[k.product],k.service,k.route,{}],"reference"in k){for(H=0;H<k.reference.length;H+=1)delete k.reference[H].slug;d[3].r=k.reference}"color"in k&&(d[3].o=k.color),"circular"in k&&(d[3].c=1),"direction"in k&&(d[3].d=1),"pickup"in k&&(d[3].u=k.pickup),"setdown"in k&&(d[3].s=k.setdown),"t"in k&&(d[3].t=k.t),"b"in k&&(d[3].b=k.b),"minutes"in k&&(d[3].m=k.minutes),e.config.allowDwell&&"dwells"in k&&(d[3].w=k.dwells),e.aquius.link.push(d)}for(e.aquius.link.sort((function(e,t){return t[1].reduce((function(e,t){return e+t}),0)-e[1].reduce((function(e,t){return e+t}),0)})),w=0;w<e.summary.network.length;w+=1)for(H=0;H<e.summary.network[w].length;H+=1)e.summary.network[w][H]=Math.round(e.summary.network[w][H]);return delete e._.dayFactor,e}(i=function(e){var t,i,n,r,o,s,f,u,p,d;for(p=0;p<e.gtfs.routes.length;p+=1)if((f=(s=e.gtfs.routes[p])[e.gtfsHead.routes.route_id])in e._.routes&&(0===e.config.modeInclude.length||-1!==e.gtfsHead.routes.route_type&&e.config.modeInclude.indexOf(s[e.gtfsHead.routes.route_type])>=0)){if(o={slug:""},r="agency"===e.config.networkFilter.type&&-1!==e.gtfsHead.routes.agency_id&&s[e.gtfsHead.routes.agency_id]in e.config.productOverride?e.config.productOverride[s[e.gtfsHead.routes.agency_id]]:"mode"===e.config.networkFilter.type&&-1!==e.gtfsHead.routes.route_type&&s[e.gtfsHead.routes.route_type]in e.config.productOverride?e.config.productOverride[s[e.gtfsHead.routes.route_type]]:{},(e.config.allowRoute||e.config.allowRouteLong)&&(t="",e.config.allowRoute&&f in e.config.routeOverride&&"route_short_name"in e.config.routeOverride[f]?t=e.config.routeOverride[f].route_short_name:e.config.allowRoute&&-1!==e.gtfsHead.routes.route_short_name&&(t=s[e.gtfsHead.routes.route_short_name].trim()),e.config.allowRouteLong&&f in e.config.routeOverride&&"route_long_name"in e.config.routeOverride[f]?(""!==t&&(t+=": "),t+=e.config.routeOverride[f].route_long_name):e.config.allowRouteLong&&-1!==e.gtfsHead.routes.route_long_name&&(""!==t&&(t+=": "),t+=s[e.gtfsHead.routes.route_long_name].trim()),""!==t&&(o.n=t,o.slug+=t)),e.config.allowColor)for(i=[["route_color","c"],["route_text_color","t"]],d=0;d<i.length;d+=1)t="",f in e.config.routeOverride&&i[d][0]in e.config.routeOverride[f]?t=e.config.routeOverride[f][i[d][0]]:i[d][0]in r?t=r[i[d][0]]:-1!==e.gtfsHead.routes[i[d][0]]&&(t=s[e.gtfsHead.routes[i[d][0]]].trim()),6===t.length&&(e=a(e,"color",t="#"+t),"t"===i[d][1]&&"c"in o&&o.c===e._.color[t]&&(e=a(e,"color",t="#ffffff"===t.toLowerCase()?"#000000":"#ffffff")),o[i[d][1]]=e._.color[t],o.slug+=t);e.config.allowRouteUrl&&(t="",f in e.config.routeOverride&&"route_url"in e.config.routeOverride[f]?t=e.config.routeOverride[f].route_url:-1!==e.gtfsHead.routes.route_url&&(t=s[e.gtfsHead.routes.route_url].trim()),""!==t&&(u="[*]",-1===(n=t.lastIndexOf(u))&&"n"in o&&-1!==(n=t.lastIndexOf(o.n))&&(t=t.substring(0,n)+u+t.substring(n+o.n.length)),-1===n&&-1!==(n=t.lastIndexOf(f))&&(t=t.substring(0,n)+u+t.substring(n+f.length),o.i=f),e=a(e,"url",t),o.u=e._.url[t],o.slug+=t)),"agency"===e.config.networkFilter.type?"agency_id"in e.gtfsHead.routes&&-1!==e.gtfsHead.routes.agency_id?e._.routes[f].product=e._.productIndex[s[e.gtfsHead.routes.agency_id]]:e._.routes[f].product=0:"mode"===e.config.networkFilter.type&&"route_type"in e.gtfsHead.routes&&-1!==e.gtfsHead.routes.route_type?e._.routes[f].product=e._.productIndex[s[e.gtfsHead.routes.route_type]]:e._.routes[f].product=e._.productIndex[Object.keys(e._.productIndex)[0]],Object.keys(o).length>1&&(e._.routes[f].reference=o)}return delete e._.productIndex,e}(i=function(e){var t,i,n,r,o,s,a,f,u,p=function(e){var t,i,n,r,o=Object.keys(e._.calendarDay);if("serviceFilter"in e.config&&"period"in e.config.serviceFilter){for(t=[],i=0;i<e.config.serviceFilter.period.length;i+=1)if("day"in e.config.serviceFilter.period[i])for(t.push([]),n=0;n<e.config.serviceFilter.period[i].day.length;n+=1)for(r=0;r<o.length;r+=1)e._.calendarDay[o[r]]===e.config.serviceFilter.period[i].day[n]&&t[i].push(o[r]);else t.push(o);return t}return[o]}(e),c=function(e){var t,i,n;if("serviceFilter"in e.config&&"period"in e.config.serviceFilter){for(t=[],i=0;i<e.config.serviceFilter.period.length;i+=1)if("time"in e.config.serviceFilter.period[i])for(t.push([]),n=0;n<e.config.serviceFilter.period[i].time.length;n+=1)"start"in e.config.serviceFilter.period[i].time[n]?t[i].push([d(e.config.serviceFilter.period[i].time[n].start)]):t[i].push([0]),"end"in e.config.serviceFilter.period[i].time[n]&&t[i][n].push(d(e.config.serviceFilter.period[i].time[n].end));else t.push([[0]]);return t}return[[[0]]]}(e),g=Object.keys(e._.trip),l=[];for(a=0;a<c.length;a+=1)l.push(0);for(e.summary.service=[],a=0;a<g.length;a+=1)if(e._.trip[g[a]].stops.length<2||0===Object.keys(e._.trip[g[a]].calendar).length)delete e._.trip[g[a]];else{if(e.config.allowDuration)for(r=[],e._.trip[g[a]].minutes=[],f=0;f<l.length;f+=1)e._.trip[g[a]].minutes.push(0),r.push([]);else r=null;for(f=0;f<p.length;f+=1){for(t=0,u=0;u<p[f].length;u+=1)p[f][u]in e._.trip[g[a]].calendar&&(t+=1);e._.trip[g[a]].service.push(t/p[f].length*e.config.servicePer)}if("frequent"in e._.trip[g[a]]==!1){o="start"in e._.trip[g[a]]&&"end"in e._.trip[g[a]]?(e._.trip[g[a]].end-e._.trip[g[a]].start)/2+e._.trip[g[a]].start:null;for(f=0;f<c.length;f+=1)if(f<e._.trip[g[a]].service.length&&0!==e._.trip[g[a]].service[f]){if(c[f].length>1||c[f][0].length>1||0!==c[f][0][0]){if(n=!1,null!==o)for(u=0;u<c[f].length;u+=1)if(o>c[f][u][0]&&(1===c[f][u].length||o<c[f][u][1])){n=!0;break}0==n&&(e._.trip[g[a]].service[f]=0,e.config.allowDuration&&(e._.trip[g[a]].minutes[f]=0))}else n=!0;if(n){if(l[f]=l[f]+1,i=Math.floor(o/3600),void 0===e.summary.service[i])for(e.summary.service[i]=[],u=0;u<c.length;u+=1)e.summary.service[i].push(0);e.summary.service[i][f]=e.summary.service[i][f]+1,e.config.allowDuration&&(e._.trip[g[a]].start>e._.trip[g[a]].end?r[f].push((e._.trip[g[a]].end+86400-e._.trip[g[a]].start)/60):r[f].push((e._.trip[g[a]].end-e._.trip[g[a]].start)/60))}}}if(null!==r)for(f=0;f<r.length;f+=1)if(r[f].length>0){for(s=0,u=0;u<r[f].length;u+=1)s+=r[f][u];e._.trip[g[a]].minutes[f]=Math.round(s/u)}else e._.trip[g[a]].minutes[f]=0}for(a=0;a<e.summary.service.length;a+=1)if(void 0!==e.summary.service[a])for(f=0;f<e.summary.service[a].length;f+=1)l[f]>0&&(e.summary.service[a][f]=e.summary.service[a][f]/l[f]);return e=function(e,t){var i,n,r,o,s,a,f,u,p,c,g;if("frequencies"in e.gtfs&&-1!==e.gtfsHead.frequencies.trip_id&&-1!==e.gtfsHead.frequencies.start_time&&-1!==e.gtfsHead.frequencies.end_time&&-1!==e.gtfsHead.frequencies.headway_secs){for(n={},f={},p=0;p<e.gtfs.frequencies.length;p+=1)if((u=(r=e.gtfs.frequencies[p])[e.gtfsHead.frequencies.trip_id])in e._.trip&&"frequent"in e._.trip[u]){if(u in n==0)for(n[u]=[],c=0;c<t.length;c+=1)n[u].push(0);r[e.gtfsHead.frequencies.start_time]in f==0&&(f[r[e.gtfsHead.frequencies.start_time]]=d(r[e.gtfsHead.frequencies.start_time])),a=f[r[e.gtfsHead.frequencies.start_time]],r[e.gtfsHead.frequencies.end_time]in f==0&&(f[r[e.gtfsHead.frequencies.end_time]]=d(r[e.gtfsHead.frequencies.end_time])),(i=f[r[e.gtfsHead.frequencies.end_time]])<a&&(i+=86400);for(c=0;c<t.length;c+=1)if(c<e._.trip[u].service.length&&0!==e._.trip[u].service[c])if(1===t[c].length&&1===t[c][0].length&&0===t[c][0][0])n[u][c]+=(i-a)/parseInt(r[e.gtfsHead.frequencies.headway_secs],10);else for(g=0;g<t[c].length;g+=1)t[c][g][0]<i&&(1===t[c][g].length||a<t[c][g][1])&&(s=1,t[c][g][0]>a&&(s-=(t[c][g][0]-a)/(i-a)),t[c][g][1]<i&&(s-=(i-t[c][g][1])/(i-a)),n[u][c]+=(i-a)*s/parseInt(r[e.gtfsHead.frequencies.headway_secs],10))}for(o=Object.keys(n),p=0;p<o.length;p+=1)for(c=0;c<n[o[p]].length;c+=1)e._.trip[o[p]].service[c]=e._.trip[o[p]].service[c]*n[o[p]][c]}return e}(e,c),e}(i=function(e){var t,i,n,r,o,s,a,f,u,p=0,d=Object.keys(e._.trip);function c(e,t){var i;if(e.length!==t.length)return!1;for(i=0;i<e.length;i+=1)if(e[i]!==t[i])return!1;return!0}for(f=0;f<d.length;f+=1)if("dup"in e._.trip[d[f]]&&(a=e._.trip[d[f]].dup.trip_id,e._.trip[d[f]].dup.stops.length>1&&a in e._.trip)){for(s=[],r=Object.keys(e._.trip[a].calendar),u=0;u<r.length;u+=1)r[u]in e._.trip[d[f]].calendar==!1&&s.push(r[u]);for(i=[],r=Object.keys(e._.trip[d[f]].calendar),u=0;u<r.length;u+=1)r[u]in e._.trip[a].calendar==!1&&i.push(r[u]);if(e.config.allowCabotage&&0===s.length&&0===i.length&&(-1!==e.gtfsHead.stop_times.pickup_type||-1!==e.gtfsHead.drop_off_type)&&("setdown"in e._.trip[d[f]]&&e._.trip[d[f]].setdown.length>0&&"setdown"in e._.trip[a]&&!1===c(e._.trip[a].setdown,e._.trip[d[f]].setdown)||"pickup"in e._.trip[d[f]]&&e._.trip[d[f]].pickup.length>0&&"pickup"in e._.trip[a]&&!1===c(e._.trip[a].pickup,e._.trip[d[f]].pickup)))"b"in e._.trip[a]?e._.trip[d[f]].b=e._.trip[a].b:(e._.trip[a].b=p,e._.trip[d[f]].b=p,p+=1);else if(e.config.allowSplit&&e._.trip[d[f]].dup.stops.length>=e.config.splitMinimumJoin&&e._.trip[d[f]].dup.stops.length<e._.trip[d[f]].stops.length){if(0===i.length){for(e._.trip[d[f]].t=[],o=-1,t=0,n=!1,u=0;u<e._.trip[d[f]].stops.length;u+=1)-1===e._.trip[d[f]].dup.stops.indexOf(e._.trip[d[f]].stops[u][1])?e._.trip[d[f]].t.push(e._.trip[d[f]].stops[u][1]):(u-1===o?(t+=1)===e.config.splitMinimumJoin&&(n=!0):t=0,o=u);!1===n&&delete e._.trip[d[f]].t}else if(0===s.length){for(e._.trip[a].t=[],o=-1,t=0,n=!1,r={},u=0;u<e._.trip[d[f]].stops.length;u+=1)r[e._.trip[d[f]].stops[u][1]]="";for(u=0;u<e._.trip[a].stops.length;u+=1)e._.trip[a].stops[u][1]in r==!1?e._.trip[a].t.push(e._.trip[a].stops[u][1]):(u-1===o?(t+=1)===e.config.splitMinimumJoin&&(n=!0):t=0,o=u);!1===n&&delete e._.trip[d[f]].t}}else if(!1===e.config.allowDuplication)if(0===i.length)delete e._.trip[d[f]];else for(e._.trip[d[f]].calendar={},u=0;u<i.length;u+=1)e._.trip[d[f]].calendar[i[u]]=""}return e}(i=function(e){var t,i,n,r,o,s,a,f,u,p,c,g,l,_,h,m,y={},k=Object.keys(e.gtfs.stop_times);for((!1===e.config.allowDuplicate||e.config.allowSplit||e.config.allowCabotage)&&(r={}),l=0;l<k.length;l+=1)if(k[l]in e._.trip){for(i=Object.keys(e._.trip[k[l]].calendar),f=null,p={},_=0;_<e.gtfs.stop_times[k[l]].length;_+=1)if((c=e.gtfs.stop_times[k[l]][_])[e.gtfsHead.stop_times.stop_id]in e._.nodeLookup&&((u=e._.nodeLookup[c[e.gtfsHead.stop_times.stop_id]])in p==!1&&(p[u]={}),-1!==e.gtfsHead.stop_times.pickup_type&&"1"===c[e.gtfsHead.stop_times.pickup_type]&&-1!==e.gtfsHead.stop_times.drop_off_type&&"1"===c[e.gtfsHead.stop_times.drop_off_type]?p[u].route=!0:-1!==e.gtfsHead.stop_times.pickup_type&&"1"===c[e.gtfsHead.stop_times.pickup_type]?p[u].setdown=!0:-1!==e.gtfsHead.stop_times.drop_off_type&&"1"===c[e.gtfsHead.stop_times.drop_off_type]?p[u].pickup=!0:p[u].both=!0,(0===e._.trip[k[l]].stops.length||e._.trip[k[l]].stops[e._.trip[k[l]].stops.length-1][1]!==e._.nodeLookup[c[e.gtfsHead.stop_times.stop_id]])&&(t=0,n=0,o=0,-1!==e.gtfsHead.stop_times.departure_time&&""!==c[e.gtfsHead.stop_times.departure_time]&&(c[e.gtfsHead.stop_times.departure_time]in y==!1&&(y[c[e.gtfsHead.stop_times.departure_time]]=d(c[e.gtfsHead.stop_times.departure_time])),n=y[c[e.gtfsHead.stop_times.departure_time]],("start"in e._.trip[k[l]]==!1||n<e._.trip[k[l]].start)&&(e._.trip[k[l]].start=n)),-1!==e.gtfsHead.stop_times.arrival_time&&""!==c[e.gtfsHead.stop_times.arrival_time]&&(c[e.gtfsHead.stop_times.arrival_time]in y==!1&&(y[c[e.gtfsHead.stop_times.arrival_time]]=d(c[e.gtfsHead.stop_times.arrival_time])),t=y[c[e.gtfsHead.stop_times.arrival_time]],("end"in e._.trip[k[l]]==!1||t>e._.trip[k[l]].end)&&(e._.trip[k[l]].end=t)),e.config.allowDwell&&0!==t&&n>t&&(o=(n-t)/60),e._.trip[k[l]].stops.push([c[e.gtfsHead.stop_times.stop_sequence],u,o]),"frequent"in e._.trip[k[l]]==!1&&void 0!==r))){for(g=[],0===t&&0===n||g.push({key:[u,t,n].join(":"),node:u}),!0===e.config.allowSplit&&0!==t&&e._.trip[k[l]].stops.length>1&&g.push({key:[u,t,e._.trip[k[l]].stops[e._.trip[k[l]].stops.length-1]].join(":"),node:u}),null!==f&&g.push({key:[u,f.key].join(":"),node:f.node}),h=0;h<g.length;h+=1)for(s=[g[h].key,e._.trip[k[l]].direction_id],e.config.duplicationRouteOnly&&s.push(e._.trip[k[l]].route_id),s=s.join(":"),m=0;m<i.length;m+=1)i[m]in r==!1&&(r[i[m]]={}),s in r[i[m]]?("dup"in e._.trip[k[l]]==!1&&(e._.trip[k[l]].dup={stops:[],trip_id:r[i[m]][s]}),0!==e._.trip[k[l]].dup.stops.length&&-1!==e._.trip[k[l]].dup.stops.indexOf(g[h].node)||e._.trip[k[l]].dup.stops.push(g[h].node)):r[i[m]][s]=k[l];!0===e.config.allowSplit&&(f=0!==n?{key:[n,u].join(":"),node:u}:null)}for(a=Object.keys(p),_=0;_<a.length;_+=1)"both"in p[a[_]]==!1&&("setdown"in p[a[_]]&&"pickup"in p[a[_]]==!1?e._.trip[k[l]].setdown.push(parseInt(a[_],10)):"pickup"in p[a[_]]&&"setdown"in p[a[_]]==!1?e._.trip[k[l]].pickup.push(parseInt(a[_],10)):"route"in p[a[_]]&&(e._.trip[k[l]].setdown.push(parseInt(a[_],10)),e._.trip[k[l]].pickup.push(parseInt(a[_],10))))}return e}(i=function(e){var t,i,n,o,s={},a=function(e){var t,i,n,o,s,a,f={};if("calendar"in e.gtfs)for(t=Object.keys(e._.calendarDay),s=0;s<e.gtfs.calendar.length;s+=1)for(n=e.gtfs.calendar[s][e.gtfsHead.calendar.service_id],o=r(e.gtfs.calendar[s][e.gtfsHead.calendar.start_date]),i=r(e.gtfs.calendar[s][e.gtfsHead.calendar.end_date]),a=0;a<t.length;a+=1)t[a]>=o&&t[a]<=i&&"1"===e.gtfs.calendar[s][e.gtfsHead.calendar[e._.calendarDay[t[a]]]]&&(n in f==0&&(f[n]={}),f[n][t[a]]="");if("calendar_dates"in e.gtfs&&-1!==e.gtfsHead.calendar_dates.service_id&&-1!==e.gtfsHead.calendar_dates.date&&-1!==e.gtfsHead.calendar_dates.exception_type)for(s=0;s<e.gtfs.calendar_dates.length;s+=1)e.gtfs.calendar_dates[s][e.gtfsHead.calendar_dates.date]in e._.calendarGtfs&&((n=e.gtfs.calendar_dates[s][e.gtfsHead.calendar_dates.service_id])in f==0&&(f[n]={}),"1"===e.gtfs.calendar_dates[s][e.gtfsHead.calendar_dates.exception_type]&&(f[n][e._.calendarGtfs[e.gtfs.calendar_dates[s][e.gtfsHead.calendar_dates.date]]]=""),"2"===e.gtfs.calendar_dates[s][e.gtfsHead.calendar_dates.exception_type]&&e._.calendarGtfs[e.gtfs.calendar_dates[s][e.gtfsHead.calendar_dates.date]]in f[n]&&(delete f[n][e._.calendarGtfs[e.gtfs.calendar_dates[s][e.gtfsHead.calendar_dates.date]]],0===Object.keys(f[n]).length&&delete f[n]));return f}(e),f=function(e){var t,i={};if("frequencies"in e.gtfs&&-1!==e.gtfsHead.frequencies.trip_id)for(t=0;t<e.gtfs.frequencies.length;t+=1)i[e.gtfs.frequencies[t][e.gtfsHead.frequencies.trip_id]]="";return i}(e),u=[],p={},d={};if(e.config.routeExclude.length>0)for(o=0;o<e.config.routeExclude.length;o+=1)p[e.config.routeExclude[o]]="";if(e.config.routeInclude.length>0)for(o=0;o<e.config.routeInclude.length;o+=1)d[e.config.routeInclude[o]]="";for(e._.trip={},e._.routes={},o=0;o<e.gtfs.trips.length;o+=1)!((n=e.gtfs.trips[o])[e.gtfsHead.trips.service_id]in a)||0!==e.config.routeExclude.length&&n[e.gtfsHead.trips.route_id]in p!=!1||0!==e.config.routeInclude.length&&n[e.gtfsHead.trips.route_id]in d!=!0||(i=n[e.gtfsHead.trips.trip_id],n[e.gtfsHead.trips.route_id]in e._.routes==!1&&(e._.routes[n[e.gtfsHead.trips.route_id]]={}),e._.trip[i]={calendar:a[n[e.gtfsHead.trips.service_id]],route_id:n[e.gtfsHead.trips.route_id],service:[],stops:[]},-1!==e.gtfsHead.trips.direction_id?e._.trip[i].direction_id=n[e.gtfsHead.trips.direction_id]:e._.trip[i].direction_id="",i in f&&(e._.trip[i].frequent=""),-1!==e.gtfsHead.stop_times.pickup_type&&(e._.trip[i].setdown=[]),-1!==e.gtfsHead.stop_times.drop_off_type&&(e._.trip[i].pickup=[]),e.config.allowBlock&&-1!==e.gtfsHead.trips.block_id&&""!==n[e.gtfsHead.trips.block_id]&&(e._.trip[i].block={id:n[e.gtfsHead.trips.block_id]},u.push(i),n[e.gtfsHead.trips.block_id]in s?s[n[e.gtfsHead.trips.block_id]].push(i):s[n[e.gtfsHead.trips.block_id]]=[i]),!0===e.config.allowHeadsign&&-1!==e.gtfsHead.trips.trip_headsign&&(""===(t=n[e.gtfsHead.trips.trip_headsign].trim())&&-1!==e.gtfsHead.trips.trip_short_name&&(t=n[e.gtfsHead.trips.trip_short_name].trim()),""!==t&&(e._.trip[i].reference={n:t,slug:t})));for(o=0;o<u.length;o+=1)e._.trip[u[o]].block.trips=s[e._.trip[u[o]].block.id];return e}(i=function(e){var t=r(e.config.fromDate),i=r(e.config.toDate);for(e._.calendar={},e._.calendarDay={},e._.calendarGtfs={};i>=t;)e._.calendar[t]=n(t),e._.calendarDay[t]=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"][new Date(t).getDay()],e._.calendarGtfs[n(t)]=t,t+=864e5;return e}(i=function(e){var t,i,n,r,o,s;if(!0===e.config.stopPlace&&"place"in e.aquius){for(n={},t=Object.keys(e._.nodeLookup),r=0;r<t.length;r+=1)e._.nodeLookup[t[r]]in n==!1&&(n[e._.nodeLookup[t[r]]]=[]),n[e._.nodeLookup[t[r]]].push(t[r]);for(r=0;r<e.aquius.place.length;r+=1)for(i=-1,o=0;o<e.aquius.node.length;o+=1)if("p"in e.aquius.node[o][2]&&e.aquius.node[o][2].p===r)if(-1===i)e.aquius.node[o][0]=e.aquius.place[r][0],e.aquius.node[o][1]=e.aquius.place[r][1],"r"in e.aquius.place[r][2]?e.aquius.node[o][2].r=e.aquius.place[r][2].r:"r"in e.aquius.node[o][2]&&delete e.aquius.node[o][2].r,i=o;else if(o in n)for(s=0;s<n[o].length;s+=1)e._.nodeLookup[n[o][s]]=i}return e}(i)))))))))),t),i=function(e,t){if("aquius"in e&&"network"in e.aquius&&"summary"in e&&"network"in e.summary){let i,n,r,o,s;if(o="_vars"in t&&"configId"in t._vars?t._vars.configId:"",r=["Network"],n=[o+"Text"],"service"in e.aquius==!1||0===e.aquius.service.length)r.push("Service"),n.push(o+"Number");else for(s=0;s<e.aquius.service.length;s+=1)"en-US"in e.aquius.service[s][1]?r.push(e.aquius.service[s][1]["en-US"]):r.push(JSON.stringify(e.aquius.service[s][1])),n.push(o+"Number");for(i=[],s=0;s<e.summary.network.length;s+=1)"en-US"in e.aquius.network[s][1]?i.push([e.aquius.network[s][1]["en-US"]].concat(e.summary.network[s])):i.push([JSON.stringify(e.aquius.network[s][1])].concat(e.summary.network[s]));e.networkTable={data:i,format:n,header:r}}return e}(i,t)),l(i,t)}};try{module.exports={gtfsToAquius:gtfsToAquius}}catch{}