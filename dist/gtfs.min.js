var gtfsToAquius=gtfsToAquius||{init:function(e){"use strict";function t(e,t,r){var s,i,n,o=document.createElement(e);if(void 0!==t)for(s=Object.keys(t),n=0;n<s.length;n+=1)o[s[n]]=t[s[n]];if(void 0!==r)for(i=Object.keys(r),n=0;n<i.length;n+=1)o.style[i[n]]=r[i[n]];return o}function r(e,r,s,i){var n,o,a,f,d,g=t("table");if(void 0!==i&&g.appendChild(t("caption",{textContent:i})),r.length>0){for(a=t("tr"),f=0;f<r.length;f+=1)"object"==typeof r[f]?((o=t("th")).appendChild(r[f]),a.appendChild(o)):a.appendChild(t("th",{textContent:r[f].toString()}));g.appendChild(a)}for(f=0;f<e.length;f+=1){for(a=t("tr"),d=0;d<e[f].length;d+=1)"object"==typeof e[f][d]?(n=t("td")).appendChild(e[f][d]):n=t("td",{textContent:e[f][d].toString()}),void 0!==s&&s.length>d&&(n.className=s[d]),a.appendChild(n);g.appendChild(a)}return g}function s(e,s,n){var o,a,f,d,g,c,p,u,l=n._vars,_=document.getElementById(l.configId+"ImportFiles"),m=document.getElementById(l.configId+"Output"),h=document.getElementById(l.configId+"Progress");if(void 0!==e)return i(e,l),!1;if(!m||!h)return!1;for(;m.firstChild;)m.removeChild(m.firstChild);for(;h.firstChild;)h.removeChild(h.firstChild);for(null!==_&&(_.disabled=!1),m.className="",a=["aquius","config"],u=0;u<a.length;u+=1)a[u]in s&&Object.keys(s[a[u]]).length>0&&h.appendChild(t("a",{className:l.configId+"Download",href:window.URL.createObjectURL(new Blob([JSON.stringify(s[a[u]])],{type:"application/json;charset=utf-8"})),download:a[u]+".json",textContent:"Save "+a[u]+".json",role:"button"}));if(o="translation"in s.aquius&&"en-US"in s.aquius.translation&&"link"in s.aquius.translation["en-US"]?s.aquius.translation["en-US"].link:"Services","undefined"!=typeof aquius&&(m.appendChild(t("div",{id:l.configId+"Map"},{height:document.documentElement.clientHeight/2+"px"})),aquius.init(l.configId+"Map",{dataObject:s.aquius,uiStore:!1})),"stopOverride"in s.config){for(a=Object.keys(s.config.stopOverride),p=[],u=0;u<a.length;u+=1)"x"in s.config.stopOverride[a[u]]&&0===s.config.stopOverride[a[u]].x&&"y"in s.config.stopOverride[a[u]]&&0===s.config.stopOverride[a[u]].y&&p.push(a[u]);p.length>0&&m.appendChild(t("p",{textContent:"Caution: Contains "+p.length.toString()+" stop_id with coordinates 0,0, which can be corrected in config.stopOverride."}))}if("aquius"in s&&"network"in s.aquius&&"summary"in s&&"network"in s.summary){if(c=["Network"],g=[l.configId+"Text"],"service"in s.aquius==!1||0===s.aquius.service.length)c.push("Service"),g.push(l.configId+"Number");else for(u=0;u<s.aquius.service.length;u+=1)"en-US"in s.aquius.service[u][1]?c.push(s.aquius.service[u][1]["en-US"]):c.push(JSON.stringify(s.aquius.service[u][1])),g.push(l.configId+"Number");for(d=[],u=0;u<s.summary.network.length;u+=1)"en-US"in s.aquius.network[u][1]?d.push([s.aquius.network[u][1]["en-US"]].concat(s.summary.network[u])):d.push([JSON.stringify(s.aquius.network[u][1])].concat(s.summary.network[u]));m.appendChild(r(d,c,g,o+" by Network"))}if("summary"in s&&"service"in s.summary){for(f=0,u=0;u<s.summary.service.length;u+=1)void 0!==s.summary.service[u]&&s.summary.service[u]>f&&(f=s.summary.service[u]);if(f>0){for(d=[],u=0;u<s.summary.service.length;u+=1)void 0===s.summary.service[u]?d.push([u,"-",""]):d.push([u,(100*s.summary.service[u]).toFixed(1),t("span",{},{"background-color":"#000",display:"inline-block",height:"7px",width:Math.round(s.summary.service[u]/f*100)+"%"})]);m.appendChild(r(d,["Hour","% Service","Histogram"],[l.configId+"Number",l.configId+"Number",l.configId+"Histogram"],o+" by Hour (scheduled only)"))}}}function i(e,r){var s,i=document.getElementById(r.configId+"ImportFiles"),n=document.getElementById(r.configId+"Output"),o=document.getElementById(r.configId+"Progress");if(void 0!==e&&null!==n){for(;n.firstChild;)n.removeChild(n.firstChild);if(n.className=r.configId+"OutputError",s="message"in e?e.message:JSON.stringify(e),n.appendChild(t("p",{textContent:"Error: "+s})),null!==o){for(;o.firstChild;)o.removeChild(o.firstChild);o.textContent="Failed"}null!==i&&(i.disabled=!1)}}return function(e){var r,n,o,a=document.getElementById(e.configId);if(!a)return!1;for(;a.firstChild;)a.removeChild(a.firstChild);return Object.keys&&[].indexOf&&"object"==typeof JSON&&window.File&&window.FileReader&&window.Blob?(document.head.appendChild(t("script",{src:"https://timhowgego.github.io/Aquius/dist/aquius.min.js",type:"text/javascript"})),n=t("form",{className:e.configId+"Input"}),o=t("label",{textContent:"GTFS as .txt, optional config, and optional GeoJSON to process:"}),(r=t("input",{id:e.configId+"ImportFiles",multiple:"multiple",name:e.configId+"ImportFiles[]",type:"file"})).addEventListener("change",function(){!function(e){var t,r={},n={},o=document.getElementById(e.configId+"ImportFiles"),a={_vars:e,callback:s},f=0,d=document.getElementById(e.configId+"Progress"),g=0;function c(t,s,o){var d,c,p,u,l;if((d=t.toLowerCase().split(".")).length>1&&"txt"===d[d.length-1]?((p=d.slice(0,d.length-1).join("."))in r==0&&(r[p]=[]),r[p][s]=o):((p=d.join("."))in n==0&&(n[p]=[]),n[p][s]=o),(f+=1)===g){for(u=Object.keys(n),l=0;l<u.length;l+=1)try{"type"in(c=JSON.parse(n[u[l]].join("")))&&"FeatureCollection"===c.type?a.geojson=c:a.config=c}catch(t){t instanceof SyntaxError==0&&i(t,e)}e.process(r,a)}}if(null!==o&&o.files.length>0){if(o.disabled=!0,null!==d){for(;d.firstChild;)d.removeChild(d.firstChild);d.textContent="Working..."}!function(r){var s,n,o,a=1e8,f=[];for(o=0;o<r.length;o+=1)for(n=0;r[o].size>=n;)f.push([r[o],parseInt(n/a,10)]),n+=a;for(g=f.length,o=0;o<g;o+=1)(t=new FileReader).onerror=function(r,s){i(new Error("Could not read "+s[0].name),e),t.abort()},t.onload=function(t){return function(){try{c(t[0].name,t[1],this.result)}catch(t){i(t,e)}}}(f[o]),s=f[o][0].slice(f[o][1]*a,f[o][1]*a+a),t.readAsText(s)}(o.files)}}(e)},!1),o.appendChild(r),n.appendChild(o),n.appendChild(t("span",{id:e.configId+"Progress"})),a.appendChild(n),a.appendChild(t("div",{id:e.configId+"Output"})),!0):(a.appendChild(document.createTextNode("Browser not supported: Try a modern browser")),!1)}({configId:e,process:this.process})},process:function(e,t){"use strict";var r={_:{},aquius:{},config:{},summary:{}};function s(e){var t=new Date(e),r=t.getFullYear().toString();return t.getMonth()<9&&(r+="0"),r+=(t.getMonth()+1).toString(),t.getDate()<10&&(r+="0"),r+=t.getDate().toString()}function i(e){return e.length<8?0:Date.UTC(e.slice(0,4),e.slice(4,6)-1,e.slice(6,8))}function n(e){var t,r,s,i,n,o,a=new RegExp('(\\,|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^\\,\\r\\n]*))',"gi"),f=[[]];for(Array.isArray(e)||(e=[e]),o=0;o<e.length;o+=1)for(i=a.exec(e[o]),r=f[f.length-1].length-1,t=!0;null!==i;)i[1].length&&","!==i[1]&&(o>0&&!0===t&&(f[f.length-1].length>f[0].length&&r<f[f.length-1].length-1&&((n=f[f.length-1].slice(0,r)).push(f[f.length-1][r]+f[f.length-1][r+1]),f[f.length-1]=n.concat(f[f.length-1].slice(r+2))),t=!1),f.push([])),void 0===(s=i[2]?i[2].replace(new RegExp('""',"g"),'"'):i[3])&&(s=""),f[f.length-1].push(s),i=a.exec(e[o]);return 1===f[f.length-1].length&&""===f[f.length-1][0].trim()&&f.pop(),f}function o(e,t,r){return"reference"in e.aquius==!1&&(e.aquius.reference={}),t in e.aquius.reference==!1&&(e.aquius.reference[t]=[],e._[t]={}),r in e._[t]==!1&&(e.aquius.reference[t].push(r),e._[t][r]=e.aquius.reference[t].length-1),e}function a(e,t,r){var s,i,n,a,f={};function d(e,t){var r,s,i,n=Object.keys(e);for(s=0;s<t.length;s+=1){for(r=!0,i=0;i<n.length;i+=1)if(n[i]in t[s]==!1||t[s][n[i]]!==e[n[i]]){r=!1;break}if(!0===r)return!0}return!1}return!0===e.config.allowName&&-1!==e.gtfsHead.stops.stop_name&&""!==(i=t[e.gtfsHead.stops.stop_name].trim())&&(f.n=i),!0===e.config.allowURL&&-1!==e.gtfsHead.stops.stop_url&&""!==(i=t[e.gtfsHead.stops.stop_url].trim())&&(a="[*]",-1===(n=i.lastIndexOf(a))&&-1!==e.gtfsHead.stops.stop_code&&(s=t[e.gtfsHead.stops.stop_code].trim(),-1!==(n=i.lastIndexOf(s))&&(i=i.substring(0,n)+a+i.substring(n+s.length),f.i=s)),-1===n&&-1!==e.gtfsHead.stops.stop_id&&(s=t[e.gtfsHead.stops.stop_id].trim(),-1!==(n=i.lastIndexOf(s))&&(i=i.substring(0,n)+a+i.substring(n+s.length),f.i=s)),e=o(e,"url",i),f.u=e._.url[i]),Object.keys(f).length>0&&("r"in e.aquius.node[r][2]?!1===d(f,e.aquius.node[r][2].r)&&e.aquius.node[r][2].r.push(f):e.aquius.node[r][2].r=[f]),-1!==e.gtfsHead.stops.stop_code&&((f={}).n=t[e.gtfsHead.stops.stop_code].trim(),""!==f.n&&("r"in e.aquius.node[r][2]?!1===d(f,e.aquius.node[r][2].r)&&e.aquius.node[r][2].r.push(f):e.aquius.node[r][2].r=[f])),e}function f(e,t){var r=Math.pow(10,e.config.coordinatePrecision);function s(e,t){var r=parseFloat(e);return Number.isNaN(r)?0:Math.round(r*t)/t}return-1!==e.gtfsHead.stops.stop_id&&t[e.gtfsHead.stops.stop_id]in e.config.stopOverride&&"x"in e.config.stopOverride[t[e.gtfsHead.stops.stop_id]]&&"y"in e.config.stopOverride[t[e.gtfsHead.stops.stop_id]]?[s(e.config.stopOverride[t[e.gtfsHead.stops.stop_id]].x,r),s(e.config.stopOverride[t[e.gtfsHead.stops.stop_id]].y,r)]:-1!==e.gtfsHead.stops.stop_lat&&-1!==e.gtfsHead.stops.stop_lon?[s(t[e.gtfsHead.stops.stop_lon],r),s(t[e.gtfsHead.stops.stop_lat],r)]:[0,0]}function d(e,t,r){return 0===t[0]&&0===t[1]&&(r in e.config.stopOverride==!1&&(e.config.stopOverride[r]={}),e.config.stopOverride[r].x=0,e.config.stopOverride[r].y=0),e}function g(e){var t,r,s=e.split(":");if(3!==s.length)return 0;for(r=0;r<s.length;r+=1){if(t=parseInt(s[r],10),Number.isNaN(t))return 0;s[r]=t}return 3600*s[0]+60*s[1]+s[2]}function c(e,t,r){var s;function i(e,t,r){var s,i,n,o,a,f,d,g;if(Array.isArray(r))for(f=0;f<r.length;f+=1)if(Array.isArray(r[f])){for(s=!1,d=0,g=r[f].length-1;d<r[f].length;g=d++)i=r[f][d][0],o=r[f][d][1],n=r[f][g][0],o>t!=(a=r[f][g][1])>t&&e<(n-i)*(t-o)/(a-o)+i&&(s=!s);if(s)return!0}return!1}if("geometry"in r==!1||"type"in r.geometry==!1||"coordinates"in r.geometry==!1||!Array.isArray(r.geometry.coordinates))return!1;if("MultiPolygon"===r.geometry.type)for(s=0;s<r.geometry.coordinates.length;s+=1)if(i(e,t,r.geometry.coordinates[s]))return!0;return"Polygon"===r.geometry.type&&i(e,t,r.geometry.coordinates)}function p(e){var t,r={};function s(e){var t,r,s={};if(Array.isArray(e))for(t=0;t<e.length;t+=1)if(Array.isArray(e[t]))for(r=0;r<e[t].length;r+=1)Array.isArray(e[t][r])&&2===e[t][r].length&&("maxX"in s==!1?(s.maxX=e[t][r][0],s.minX=e[t][r][0],s.maxY=e[t][r][1],s.minY=e[t][r][1]):(e[t][r][0]>s.maxX?s.maxX=e[t][r][0]:e[t][r][0]<s.minX&&(s.minX=e[t][r][0]),e[t][r][1]>s.maxY?s.maxY=e[t][r][1]:e[t][r][1]<s.minY&&(s.minY=e[t][r][1])));return s}if("geometry"in e&&"type"in e.geometry&&"coordinates"in e.geometry&&Array.isArray(e.geometry.coordinates)){if("MultiPolygon"===e.geometry.type)for(t=0;t<e.geometry.coordinates.length;t+=1)r=s(e.geometry.coordinates[t]);"Polygon"===e.geometry.type&&(r=s(e.geometry.coordinates))}return"maxX"in r?[(r.maxX+r.minX)/2,(r.maxY+r.minY)/2]:null}function u(e,t){var r;return"_"in e&&delete e._,"object"==typeof t&&"callback"in t?("error"in e&&(r=new Error(e.error.join(". "))),t.callback(r,e,t),!0):e}return r=function(e,t){var r,s,i,o,a;e.gtfsHead={calendar:{service_id:-1,monday:-1,tuesday:-1,wednesday:-1,thursday:-1,friday:-1,saturday:-1,sunday:-1,start_date:-1,end_date:-1},calendar_dates:{service_id:-1,date:-1,exception_type:-1},frequencies:{trip_id:-1,start_time:-1,end_time:-1,headway_secs:-1},routes:{route_color:-1,route_id:-1,route_long_name:-1,route_short_name:-1,route_text_color:-1,route_url:-1},stop_times:{arrival_time:-1,departure_time:-1,trip_id:-1,stop_id:-1,stop_sequence:-1,pickup_type:-1,drop_off_type:-1},stops:{stop_code:-1,stop_id:-1,stop_lat:-1,stop_lon:-1,stop_name:-1,stop_url:-1,location_type:-1,parent_station:-1},transfers:{from_stop_id:-1,to_stop_id:-1,transfer_type:-1},trips:{block_id:-1,route_id:-1,service_id:-1,trip_headsign:-1,trip_id:-1}},i={routes:["route_id"],stops:["stop_id","stop_lat","stop_lon"],trips:["route_id","service_id","trip_id"],stop_times:["trip_id","stop_id","stop_sequence"]},"type"in e.config.networkFilter&&"agency"===e.config.networkFilter.type&&(e.gtfsHead.agency={agency_id:-1,agency_name:-1},e.gtfsHead.routes.agency_id=-1),"type"in e.config.networkFilter&&"mode"===e.config.networkFilter.type&&(e.gtfsHead.routes.route_type=-1),"name"in e.config.meta!=0&&"en-US"in e.config.meta.name!=0||("feed_info"in e.gtfsHead==0&&(e.gtfsHead.feed_info={}),e.gtfsHead.feed_info.feed_publisher_name=-1),"url"in e.config.meta==0&&("feed_info"in e.gtfsHead==0&&(e.gtfsHead.feed_info={}),e.gtfsHead.feed_info.feed_publisher_url=-1),s=Object.keys(i);for(o=0;o<s.length;o+=1)if(s[o]in t==0)return"error"in e==0&&(e.error=[]),e.error.push("Missing GTFS "+s[o]+".txt"),e;for(e.gtfs={},s=Object.keys(e.gtfsHead),o=0;o<s.length;o+=1)if(s[o]in t&&(r=n(t[s[o]])).length>1){for(a=0;a<r[0].length;a+=1)r[0][a]in e.gtfsHead[s[o]]&&(e.gtfsHead[s[o]][r[0][a]]=a);e.gtfs[s[o]]=r.splice(1)}for(s=Object.keys(i),o=0;o<s.length;o+=1)if(s[o]in e.gtfs==0)"error"in e==0&&(e.error=[]),e.error.push("Missing GTFS "+s[o]+".txt");else if(s[o]in e.gtfsHead)for(a=0;a<i[s[o]].length;a+=1)i[s[o]][a]in e.gtfsHead[s[o]]!=0&&-1!==e.gtfsHead[s[o]][i[s[o]][a]]||("error"in e==0&&(e.error=[]),e.error.push("Missing value "+i[s[o]][a]+" in GTFS "+s[o]+".txt"));return e}(r=function(e,t){var r,i={allowColor:!0,allowHeadsign:!1,allowName:!0,allowRoute:!0,allowURL:!0,coordinatePrecision:4,fromDate:s(Date.now()),isCircular:[],meta:{schema:"0"},networkFilter:{type:"agency"},option:{},populationProperty:"population",productOverride:{},serviceFilter:{},servicePer:1,stopOverride:{},toDate:s(Date.now()+5184e5),translation:{}},n=Object.keys(i);for("object"!=typeof t&&(t={}),r=0;r<n.length;r+=1)"config"in t&&n[r]in t.config&&typeof t.config[n[r]]==typeof i[n[r]]?e.config[n[r]]=t.config[n[r]]:e.config[n[r]]=i[n[r]];for(e._.circular={},r=0;r<e.config.isCircular.length;r+=1)e._.circular[e.config.isCircular[r]]=e.config.isCircular[r];return e}(r,t),e),e=null,u("error"in r?r:r=function(e,t){var r,s,i,n,o,a,f,d={},g=[],u=[],l=-1,_=Math.pow(10,e.config.coordinatePrecision),m=0,h={},y=0;if(e.aquius.place=[],"object"==typeof t&&"geojson"in t&&"type"in t.geojson&&"FeatureCollection"===t.geojson.type&&"features"in t.geojson&&Array.isArray(t.geojson.features)&&t.geojson.features.length>0){for(a=0;a<t.geojson.features.length;a+=1)null!==(r=p(t.geojson.features[a]))&&(g.push(a),d[a]={x:Math.round(r[0]*_)/_,y:Math.round(r[1]*_)/_});for(a=0;a<e.aquius.node.length;a+=1)u.push([e.aquius.node[a][0]+e.aquius.node[a][1],a]);for(u.sort(),a=0;a<u.length;a+=1){if(l=-1,c(e.aquius.node[u[a][1]][0],e.aquius.node[u[a][1]][1],t.geojson.features[m]))l=m;else{for((s={})[m]=m,f=0;f<g.length;f+=1)if(o=Math.abs(e.aquius.node[u[a][1]][0]+e.aquius.node[u[a][1]][1]-(d[g[f]].x+d[g[f]].y)),0===f&&(i=o),i>=o&&g[f]in s==0){if(c(e.aquius.node[u[a][1]][0],e.aquius.node[u[a][1]][1],t.geojson.features[g[f]])){l=g[f];break}s[g[f]]=g[f],Object.keys(s).length<5&&(i=o)}if(-1===l)for(f=0;f<t.geojson.features.length;f+=1)if(f in s==0&&c(e.aquius.node[u[a][1]][0],e.aquius.node[u[a][1]][1],t.geojson.features[f])){l=f;break}}-1!==l&&(m=l,l in h?e.aquius.node[u[a][1]][2].p=h[l]:l in d&&(e.aquius.place.push([d[l].x,d[l].y,{}]),e.aquius.node[u[a][1]][2].p=e.aquius.place.length-1,h[l]=e.aquius.place.length-1,"properties"in t.geojson.features[l]&&e.config.populationProperty in t.geojson.features[l].properties&&(n=parseFloat(t.geojson.features[l].properties[e.config.populationProperty]),Number.isNaN(n)||(e.aquius.place[e.aquius.place.length-1][2].p=n,n>y&&(y=n)))))}y>0&&"placeScale"in e.config.option==0&&(e.config.option.placeScale=Math.round(1/(y/2e6)*1e5)/1e5,e.aquius.option.placeScale=e.config.option.placeScale)}return e}(r=function(e){var t,r,s,i,n,o,a,f,d={};function g(e,t,r,s){return e.config.isCircular.length>0?t in e._.circular:!(s.length<3||s[0]!==s[s.length-1])&&("block"in r&&e._.block[r.block]>1||!(s.length<5)&&(i=e.aquius.node[s[1]][1],n=e.aquius.node[s[1]][0],o=e.aquius.node[s[s.length-2]][1],a=e.aquius.node[s.length-2][0],f=Math.PI/180,d=Math.sin((o-i)*f/2),g=Math.sin((a-n)*f/2),c=d*d+Math.cos(i*f)*Math.cos(o*f)*g*g,2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c))*6371e3>200));var i,n,o,a,f,d,g,c}function c(e,t){var r,s;if(1===e.length&&e.length===t.length)return[e[0]+t[0]];for(r=[],s=0;s<e.length;s+=1)s<t.length&&r.push(e[s]+t[s]);return r}for(o=0;o<e.gtfs.trips.length;o+=1)if(e.gtfs.trips[o][e.gtfsHead.trips.trip_id]in e._.trip){for(n=[],e._.trip[e.gtfs.trips[o][e.gtfsHead.trips.trip_id]].stops.sort(function(e,t){return e[0]-t[0]}),a=0;a<e._.trip[e.gtfs.trips[o][e.gtfsHead.trips.trip_id]].stops.length;a+=1)n.push(e._.trip[e.gtfs.trips[o][e.gtfsHead.trips.trip_id]].stops[a][1]);r="f"+e._.routes[e.gtfs.trips[o][e.gtfsHead.trips.route_id]].product,-1!==e.gtfsHead.stop_times.pickup_type&&e._.trip[e.gtfs.trips[o][e.gtfsHead.trips.trip_id]].setdown.length>0&&(e._.trip[e.gtfs.trips[o][e.gtfsHead.trips.trip_id]].setdown.sort(),r+="s"+e._.trip[e.gtfs.trips[o][e.gtfsHead.trips.trip_id]].setdown.join(":")),-1!==e.gtfsHead.stop_times.drop_off_type&&e._.trip[e.gtfs.trips[o][e.gtfsHead.trips.trip_id]].pickup.length>0&&(e._.trip[e.gtfs.trips[o][e.gtfsHead.trips.trip_id]].pickup.sort(),r+="p"+e._.trip[e.gtfs.trips[o][e.gtfsHead.trips.trip_id]].pickup.join(":")),t=n.slice().reverse().join(":")+r,(r=n.join(":")+r)in d?(d[r].service=c(d[r].service,e._.trip[e.gtfs.trips[o][e.gtfsHead.trips.trip_id]].service),"reference"in e._.routes[e.gtfs.trips[o][e.gtfsHead.trips.route_id]]&&"referenceLookup"in d[r]&&e._.routes[e.gtfs.trips[o][e.gtfsHead.trips.route_id]].reference.slug in d[r].referenceLookup==0&&(d[r].reference.push(e._.routes[e.gtfs.trips[o][e.gtfsHead.trips.route_id]].reference),d[r].referenceLookup[e._.routes[e.gtfs.trips[o][e.gtfsHead.trips.route_id]].reference.slug]="")):t in d?(d[t].service=c(d[t].service,e._.trip[e.gtfs.trips[o][e.gtfsHead.trips.trip_id]].service),"reference"in e._.routes[e.gtfs.trips[o][e.gtfsHead.trips.route_id]]&&"referenceLookup"in d[t]&&e._.routes[e.gtfs.trips[o][e.gtfsHead.trips.route_id]].reference.slug in d[t].referenceLookup==0&&(d[t].reference.push(e._.routes[e.gtfs.trips[o][e.gtfsHead.trips.route_id]].reference),d[t].referenceLookup[e._.routes[e.gtfs.trips[o][e.gtfsHead.trips.route_id]].reference.slug]=""),"direction"in d[t]&&delete d[t].direction):(d[r]={direction:1,product:e._.routes[e.gtfs.trips[o][e.gtfsHead.trips.route_id]].product,route:n,service:e._.trip[e.gtfs.trips[o][e.gtfsHead.trips.trip_id]].service},("reference"in e._.routes[e.gtfs.trips[o][e.gtfsHead.trips.route_id]]||"reference"in e._.trip[e.gtfs.trips[o][e.gtfsHead.trips.trip_id]])&&(d[r].reference=[],d[r].referenceLookup={}),"reference"in e._.routes[e.gtfs.trips[o][e.gtfsHead.trips.route_id]]&&"slug"in e._.routes[e.gtfs.trips[o][e.gtfsHead.trips.route_id]].reference&&(d[r].reference.push(e._.routes[e.gtfs.trips[o][e.gtfsHead.trips.route_id]].reference),d[r].referenceLookup[e._.routes[e.gtfs.trips[o][e.gtfsHead.trips.route_id]].reference.slug]=""),"reference"in e._.trip[e.gtfs.trips[o][e.gtfsHead.trips.trip_id]]&&"slug"in e._.trip[e.gtfs.trips[o][e.gtfsHead.trips.trip_id]].reference&&(d[r].reference.push(e._.trip[e.gtfs.trips[o][e.gtfsHead.trips.trip_id]].reference),d[r].referenceLookup[e._.trip[e.gtfs.trips[o][e.gtfsHead.trips.trip_id]].reference.slug]=""),-1!==e.gtfsHead.stop_times.pickup_type&&e._.trip[e.gtfs.trips[o][e.gtfsHead.trips.trip_id]].setdown.length>0&&(d[r].setdown=e._.trip[e.gtfs.trips[o][e.gtfsHead.trips.trip_id]].setdown),-1!==e.gtfsHead.stop_times.drop_off_type&&e._.trip[e.gtfs.trips[o][e.gtfsHead.trips.trip_id]].pickup.length>0&&(d[r].pickup=e._.trip[e.gtfs.trips[o][e.gtfsHead.trips.trip_id]].pickup),g(e,e.gtfs.trips[o][e.gtfsHead.trips.route_id],e._.trip[e.gtfs.trips[o][e.gtfsHead.trips.trip_id]],n)&&(d[r].circular=1))}for(delete e._.nodeLookup,delete e._.routes,delete e._.trip,e.aquius.link=[],e.summary.network=[],o=0;o<e.aquius.network.length;o+=1)if("service"in e.aquius)for(e.summary.network.push([]),a=0;a<e.aquius.service.length;a+=1)e.summary.network[o].push(0);else e.summary.network.push([0]);for(s=Object.keys(d),o=0;o<s.length;o+=1){for(a=0;a<d[s[o]].service.length;a+=1){for(d[s[o]].service[a]=d[s[o]].service[a]/e._.dayFactor[a]*e.config.servicePer,f=0;f<e.aquius.network.length;f+=1)-1!==e.aquius.network[f][0].indexOf(d[s[o]].product)&&(e.summary.network[f][a]+=d[s[o]].service[a]);d[s[o]].service[a]<10?d[s[o]].service[a]=parseFloat(d[s[o]].service[a].toPrecision(1)):d[s[o]].service[a]=parseInt(d[s[o]].service[a],10)}if(i=[[d[s[o]].product],d[s[o]].service,d[s[o]].route,{}],"reference"in d[s[o]]){for(a=0;a<d[s[o]].reference.length;a+=1)delete d[s[o]].reference[a].slug;Object.keys(d[s[o]].reference).length>0&&(i[3].r=d[s[o]].reference)}"color"in d[s[o]]&&(i[3].o=d[s[o]].color),"circular"in d[s[o]]&&(i[3].c=1),"direction"in d[s[o]]&&(i[3].d=1),"pickup"in d[s[o]]&&(i[3].u=d[s[o]].pickup),"setdown"in d[s[o]]&&(i[3].s=d[s[o]].setdown),e.aquius.link.push(i)}for(e.aquius.link.sort(function(e,t){return t[1].reduce(function(e,t){return e+t},0)-e[1].reduce(function(e,t){return e+t},0)}),o=0;o<e.summary.network.length;o+=1)for(a=0;a<e.summary.network[o].length;a+=1)e.summary.network[o][a]=Math.round(e.summary.network[o][a]);return delete e._.dayFactor,e}(r=function(e){var t,r,s,i,n,a;for(e._.routes={},a=0;a<e.gtfs.routes.length;a+=1)e._.routes[e.gtfs.routes[a][e.gtfsHead.routes.route_id]]={},i={slug:""},s="agency"===e.config.networkFilter.type&&-1!==e.gtfsHead.routes.agency_id&&e.gtfs.routes[a][e.gtfsHead.routes.agency_id]in e.config.productOverride?e.config.productOverride[e.gtfs.routes[a][e.gtfsHead.routes.agency_id]]:"mode"===e.config.networkFilter.type&&-1!==e.gtfsHead.routes.route_type&&e.gtfs.routes[a][e.gtfsHead.routes.route_type]in e.config.productOverride?e.config.productOverride[e.gtfs.routes[a][e.gtfsHead.routes.route_type]]:{},!0===e.config.allowRoute&&(t="",-1!==e.gtfsHead.routes.route_short_name&&""===(t=e.gtfs.routes[a][e.gtfsHead.routes.route_short_name].trim())&&!0===e.config.allowName&&-1!==e.gtfsHead.routes.route_long_name&&(t=e.gtfs.routes[a][e.gtfsHead.routes.route_long_name].trim()),""!==t&&(i.n=t,i.slug+=t)),!0===e.config.allowColor&&(-1!==e.gtfsHead.routes.route_color||"route_color"in s)&&6===(t="route_color"in s?s.route_color:e.gtfs.routes[a][e.gtfsHead.routes.route_color].trim()).length&&(e=o(e,"color",t="#"+t),i.c=e._.color[t],i.slug+=t),!0===e.config.allowColor&&(-1!==e.gtfsHead.routes.route_text_color||"route_text_color"in s)&&6===(t="route_text_color"in s?s.route_text_color:e.gtfs.routes[a][e.gtfsHead.routes.route_text_color].trim()).length&&(e=o(e,"color",t="#"+t),i.t=e._.color[t],i.slug+=t),!0===e.config.allowURL&&-1!==e.gtfsHead.routes.route_url&&""!==(t=e.gtfs.routes[a][e.gtfsHead.routes.route_url].trim())&&(n="[*]",-1===(r=t.lastIndexOf(n))&&"n"in i&&-1!==(r=t.lastIndexOf(i.n))&&(t=t.substring(0,r)+n+t.substring(r+i.n.length)),-1===r&&-1!==(r=t.lastIndexOf(e.gtfs.routes[a][e.gtfsHead.routes.route_id]))&&(t=t.substring(0,r)+n+t.substring(r+e.gtfs.routes[a][e.gtfsHead.routes.route_id].length),i.i=e.gtfs.routes[a][e.gtfsHead.routes.route_id]),e=o(e,"url",t),i.u=e._.url[t],i.slug+=t),"agency"===e.config.networkFilter.type?"agency_id"in e.gtfsHead.routes&&-1!==e.gtfsHead.routes.agency_id?e._.routes[e.gtfs.routes[a][e.gtfsHead.routes.route_id]].product=e._.productIndex[e.gtfs.routes[a][e.gtfsHead.routes.agency_id]]:e._.routes[e.gtfs.routes[a][e.gtfsHead.routes.route_id]].product=0:"mode"===e.config.networkFilter.type&&"route_type"in e.gtfsHead.routes&&-1!==e.gtfsHead.routes.route_type?e._.routes[e.gtfs.routes[a][e.gtfsHead.routes.route_id]].product=e._.productIndex[e.gtfs.routes[a][e.gtfsHead.routes.route_type]]:e._.routes[e.gtfs.routes[a][e.gtfsHead.routes.route_id]].product=e._.productIndex[Object.keys(e._.productIndex)[0]],Object.keys(i).length>1&&(e._.routes[e.gtfs.routes[a][e.gtfsHead.routes.route_id]].reference=i);return delete e._.productIndex,e}(r=function(e){var t,r,s,i,n,o,a,f,d,c,p,u;for(t=function(e){var t,r,s,i,n,o,a={},f={};if("frequencies"in e.gtfs&&-1!==e.gtfsHead.frequencies.trip_id&&-1!==e.gtfsHead.frequencies.start_time&&-1!==e.gtfsHead.frequencies.end_time&&-1!==e.gtfsHead.frequencies.headway_secs)for(i=0;i<e.gtfs.frequencies.length;i+=1){if(e.gtfs.frequencies[i][e.gtfsHead.frequencies.trip_id]in a==0)for(a[e.gtfs.frequencies[i][e.gtfsHead.frequencies.trip_id]]=[],n=0;n<e._.timeFactor.length;n+=1)a[e.gtfs.frequencies[i][e.gtfsHead.frequencies.trip_id]].push(0);e.gtfs.frequencies[i][e.gtfsHead.frequencies.start_time]in f==0&&(f[e.gtfs.frequencies[i][e.gtfsHead.frequencies.start_time]]=g(e.gtfs.frequencies[i][e.gtfsHead.frequencies.start_time])),s=f[e.gtfs.frequencies[i][e.gtfsHead.frequencies.start_time]],e.gtfs.frequencies[i][e.gtfsHead.frequencies.end_time]in f==0&&(f[e.gtfs.frequencies[i][e.gtfsHead.frequencies.end_time]]=g(e.gtfs.frequencies[i][e.gtfsHead.frequencies.end_time])),(t=f[e.gtfs.frequencies[i][e.gtfsHead.frequencies.end_time]])<s&&(t+=86400);for(n=0;n<e._.timeFactor.length;n+=1)if(1===e._.timeFactor[n].length&&1===e._.timeFactor[n][0].length&&0===e._.timeFactor[n][0][0])a[e.gtfs.frequencies[i][e.gtfsHead.frequencies.trip_id]][n]+=(t-s)/parseInt(e.gtfs.frequencies[i][e.gtfsHead.frequencies.headway_secs],10);else for(o=0;o<e._.timeFactor[n].length;o+=1)e._.timeFactor[n][o][0]<t&&(1===e._.timeFactor[n][o].length||s<e._.timeFactor[n][o][1])&&(r=1,e._.timeFactor[n][o][0]>s&&(r-=(e._.timeFactor[n][o][0]-s)/(t-s)),e._.timeFactor[n][o][1]<t&&(r-=(t-e._.timeFactor[n][o][1])/(t-s)),a[e.gtfs.frequencies[i][e.gtfsHead.frequencies.trip_id]][n]+=(t-s)*r/parseInt(e.gtfs.frequencies[i][e.gtfsHead.frequencies.headway_secs],10))}return a}(e),e._.trip={},e._.block={},f={},e.summary.service=[],c=0;c<e.gtfs.trips.length;c+=1)if(e.gtfs.trips[c][e.gtfsHead.trips.service_id]in e._.serviceDays){for(e._.trip[e.gtfs.trips[c][e.gtfsHead.trips.trip_id]]={service:[],stops:[]},p=0;p<e._.serviceDays[e.gtfs.trips[c][e.gtfsHead.trips.service_id]].length;p+=1)e.gtfs.trips[c][e.gtfsHead.trips.trip_id]in t?e._.trip[e.gtfs.trips[c][e.gtfsHead.trips.trip_id]].service.push(e._.serviceDays[e.gtfs.trips[c][e.gtfsHead.trips.service_id]][p]*t[e.gtfs.trips[c][e.gtfsHead.trips.trip_id]][p]):e._.trip[e.gtfs.trips[c][e.gtfsHead.trips.trip_id]].service.push(e._.serviceDays[e.gtfs.trips[c][e.gtfsHead.trips.service_id]][p]);-1!==e.gtfsHead.stop_times.pickup_type&&(e._.trip[e.gtfs.trips[c][e.gtfsHead.trips.trip_id]].setdown=[]),-1!==e.gtfsHead.stop_times.drop_off_type&&(e._.trip[e.gtfs.trips[c][e.gtfsHead.trips.trip_id]].pickup=[]),-1!==e.gtfsHead.trips.block_id&&""!==e.gtfs.trips[c][e.gtfsHead.trips.block_id]&&(e._.trip[e.gtfs.trips[c][e.gtfsHead.trips.trip_id]].block=e.gtfs.trips[c][e.gtfsHead.trips.block_id],e.gtfs.trips[c][e.gtfsHead.trips.block_id]in e._.block?e._.block[e.gtfs.trips[c][e.gtfsHead.trips.block_id]]+=1:e._.block[e.gtfs.trips[c][e.gtfsHead.trips.block_id]]=1),!0===e.config.allowHeadsign&&-1!==e.gtfsHead.trips.trip_headsign&&""!==(s=e.gtfs.trips[c][e.gtfsHead.trips.trip_headsign].trim())&&(e._.trip[e.gtfs.trips[c][e.gtfsHead.trips.trip_id]].reference={n:s,slug:s})}for(c=0;c<e.gtfs.stop_times.length;c+=1)d=e.gtfs.stop_times[c][e.gtfsHead.stop_times.trip_id],void 0!==e._.trip[d]&&e.gtfs.stop_times[c][e.gtfsHead.stop_times.stop_id]in e._.nodeLookup&&(0===e._.trip[d].stops.length||e._.trip[d].stops[e._.trip[d].stops.length-1][1]!==e._.nodeLookup[e.gtfs.stop_times[c][e.gtfsHead.stop_times.stop_id]])&&(e._.trip[d].stops.push([e.gtfs.stop_times[c][e.gtfsHead.stop_times.stop_sequence],e._.nodeLookup[e.gtfs.stop_times[c][e.gtfsHead.stop_times.stop_id]]]),-1!==e.gtfsHead.stop_times.departure_time&&""!==e.gtfs.stop_times[c][e.gtfsHead.stop_times.departure_time]&&(e.gtfs.stop_times[c][e.gtfsHead.stop_times.departure_time]in f==0&&(f[e.gtfs.stop_times[c][e.gtfsHead.stop_times.departure_time]]=g(e.gtfs.stop_times[c][e.gtfsHead.stop_times.departure_time])),a=f[e.gtfs.stop_times[c][e.gtfsHead.stop_times.departure_time]],("start"in e._.trip[d]==0||a<e._.trip[d].start)&&(e._.trip[d].start=a)),-1!==e.gtfsHead.stop_times.arrival_time&&""!==e.gtfs.stop_times[c][e.gtfsHead.stop_times.arrival_time]&&(e.gtfs.stop_times[c][e.gtfsHead.stop_times.arrival_time]in f==0&&(f[e.gtfs.stop_times[c][e.gtfsHead.stop_times.arrival_time]]=g(e.gtfs.stop_times[c][e.gtfsHead.stop_times.arrival_time])),a=f[e.gtfs.stop_times[c][e.gtfsHead.stop_times.arrival_time]],("end"in e._.trip[d]==0||a>e._.trip[d].end)&&(e._.trip[d].end=a)),-1!==e.gtfsHead.stop_times.pickup_type&&"1"===e.gtfs.stop_times[c][e.gtfsHead.stop_times.pickup_type]&&e._.trip[d].setdown.push(e._.nodeLookup[e.gtfs.stop_times[c][e.gtfsHead.stop_times.stop_id]]),-1!==e.gtfsHead.stop_times.drop_off_type&&"1"===e.gtfs.stop_times[c][e.gtfsHead.stop_times.drop_off_type]&&e._.trip[d].pickup.push(e._.nodeLookup[e.gtfs.stop_times[c][e.gtfsHead.stop_times.stop_id]]));for(o=(r=Object.keys(e._.trip)).length-Object.keys(t).length,c=0;c<r.length;c+=1)if(r[c]in t==0){"start"in e._.trip[r[c]]&&"end"in e._.trip[r[c]]?(a=(e._.trip[r[c]].end-e._.trip[r[c]].start)/2+e._.trip[r[c]].start,i=Math.floor(a/3600),void 0===e.summary.service[i]?e.summary.service[i]=1/o:e.summary.service[i]+=1/o):a=null;for(p=0;p<e._.timeFactor.length;p+=1)if(e._.timeFactor[p].length>1||e._.timeFactor[p][0].length>1||0!==e._.timeFactor[p][0][0]){if(n=!1,null!==a)for(u=0;u<e._.timeFactor[p].length;u+=1)if(a>e._.timeFactor[p][u][0]&&(1===e._.timeFactor[p][u].length||a<e._.timeFactor[p][u][1])){n=!0;break}!1===n&&(e._.trip[r[c]].service[p]=0)}}return delete e._.serviceDays,delete e._.timeFactor,e}(r=function(e){var t,r,n,o,a,f,d,c,p,u,l={},_={},m={},h=i(e.config.fromDate),y=i(e.config.toDate);function H(e){return["sunday","monday","tuesday","wednesday","thursday","friday","saturday"][new Date(e).getDay()]}function v(e){var t,r=0,s=Object.keys(e);for(t=0;t<s.length;t+=1)r+=e[s[t]];return r}for(e._.serviceDays={},e._.dayFactor=[],e._.timeFactor=[],r=0;y>=h;)_[s(h)]=h,r+=1,"serviceFilter"in e.config&&"period"in e.config.serviceFilter&&((d=H(h))in m?m[d]+=1:m[d]=1),h+=864e5;if("serviceFilter"in e.config&&"period"in e.config.serviceFilter)for(c=0;c<e.config.serviceFilter.period.length;c+=1){if("day"in e.config.serviceFilter.period[c])for(e._.dayFactor.push(0),p=0;p<e.config.serviceFilter.period[c].day.length;p+=1)e.config.serviceFilter.period[c].day[p]in m&&(e._.dayFactor[c]+=m[e.config.serviceFilter.period[c].day[p]]);else e._.dayFactor.push(r);if("time"in e.config.serviceFilter.period[c])for(e._.timeFactor.push([]),p=0;p<e.config.serviceFilter.period[c].time.length;p+=1)"start"in e.config.serviceFilter.period[c].time[p]?e._.timeFactor[c].push([g(e.config.serviceFilter.period[c].time[p].start)]):e._.timeFactor[c].push([0]),"end"in e.config.serviceFilter.period[c].time[p]&&e._.timeFactor[c][p].push(g(e.config.serviceFilter.period[c].time[p].end));else e._.timeFactor.push([[0]])}else e._.dayFactor.push(r),e._.timeFactor.push([[0]]);if("calendar"in e.gtfs)for(c=0;c<e.gtfs.calendar.length;c+=1)for(f=i(e.gtfs.calendar[c][e.gtfsHead.calendar.start_date]),n=i(e.gtfs.calendar[c][e.gtfsHead.calendar.end_date]),t=Object.keys(_),p=0;p<t.length;p+=1)_[t[p]]>=f&&_[t[p]]<=n&&(d=H(_[t[p]]),"1"===e.gtfs.calendar[c][e.gtfsHead.calendar[H(_[t[p]])]]&&(e.gtfs.calendar[c][e.gtfsHead.calendar.service_id]in l==0&&(l[e.gtfs.calendar[c][e.gtfsHead.calendar.service_id]]={}),d in l[e.gtfs.calendar[c][e.gtfsHead.calendar.service_id]]==0?l[e.gtfs.calendar[c][e.gtfsHead.calendar.service_id]][d]=1:l[e.gtfs.calendar[c][e.gtfsHead.calendar.service_id]][d]+=1));if("calendar_dates"in e.gtfs&&-1!==e.gtfsHead.calendar_dates.service_id&&-1!==e.gtfsHead.calendar_dates.date&&-1!==e.gtfsHead.calendar_dates.exception_type)for(c=0;c<e.gtfs.calendar_dates.length;c+=1)e.gtfs.calendar_dates[c][e.gtfsHead.calendar_dates.date]in _&&(d=H(_[e.gtfs.calendar_dates[c][e.gtfsHead.calendar_dates.date]]),e.gtfs.calendar_dates[c][e.gtfsHead.calendar_dates.service_id]in l==0?"1"===e.gtfs.calendar_dates[c][e.gtfsHead.calendar_dates.exception_type]&&(l[e.gtfs.calendar_dates[c][e.gtfsHead.calendar_dates.service_id]]={},l[e.gtfs.calendar_dates[c][e.gtfsHead.calendar_dates.service_id]][d]=1):("1"===e.gtfs.calendar_dates[c][e.gtfsHead.calendar_dates.exception_type]&&(d in l[e.gtfs.calendar_dates[c][e.gtfsHead.calendar_dates.service_id]]?l[e.gtfs.calendar_dates[c][e.gtfsHead.calendar_dates.service_id]][d]+=1:l[e.gtfs.calendar_dates[c][e.gtfsHead.calendar_dates.service_id]][d]=1),"2"===e.gtfs.calendar_dates[c][e.gtfsHead.calendar_dates.exception_type]&&(d in l[e.gtfs.calendar_dates[c][e.gtfsHead.calendar_dates.service_id]]==0||l[e.gtfs.calendar_dates[c][e.gtfsHead.calendar_dates.service_id]][d]<=1?(delete l[e.gtfs.calendar_dates[c][e.gtfsHead.calendar_dates.service_id]][d],0===Object.keys(l[e.gtfs.calendar_dates[c][e.gtfsHead.calendar_dates.service_id]]).length&&delete l[e.gtfs.calendar_dates[c][e.gtfsHead.calendar_dates.service_id]]):l[e.gtfs.calendar_dates[c][e.gtfsHead.calendar_dates.service_id]][d]=l[e.gtfs.calendar_dates[c][e.gtfsHead.calendar_dates.service_id]][d]-1)));for(o=Object.keys(l),c=0;c<o.length;c+=1)if("serviceFilter"in e.config&&"period"in e.config.serviceFilter){for(e._.serviceDays[o[c]]=[],a=0,p=0;p<e.config.serviceFilter.period.length;p+=1){if("day"in e.config.serviceFilter.period[p])for(r=0,u=0;u<e.config.serviceFilter.period[p].day.length;u+=1)e.config.serviceFilter.period[p].day[u]in l[o[c]]&&(r+=l[o[c]][e.config.serviceFilter.period[p].day[u]]);else r=v(l[o[c]]);e._.serviceDays[o[c]].push(r),a+=r}0===a&&delete e._.serviceDays[o[c]]}else(r=v(l[o[c]]))>0&&(e._.serviceDays[o[c]]=[r]);return e}(r=function(e){var t,r,s,i;"nodeLookup"in e._==0&&(e._.nodeLookup={}),"nodeCoord"in e._==0&&(e._.nodeCoord={}),"node"in e.aquius==0&&(e.aquius.node=[]);for(i=0;i<e.gtfs.stops.length;i+=1)e.gtfs.stops[i].stop_id in e._.nodeLookup==0&&""!==e.gtfs.stops[i][e.gtfsHead.stops.stop_id]&&(e=d(e,t=f(e,e.gtfs.stops[i]),e.gtfs.stops[i][e.gtfsHead.stops.stop_id]),(s=t[0].toString()+","+t[1].toString())in e._.nodeCoord?r=e._.nodeCoord[s]:(r=e.aquius.node.length,e.aquius.node.push([t[0],t[1],{}]),e._.nodeCoord[s]=r),e._.nodeLookup[e.gtfs.stops[i][e.gtfsHead.stops.stop_id]]=r,e=a(e,e.gtfs.stops[i],r));return delete e._.nodeCoord,e}(r=function(e){var t,r,s,i,n,o,g;if("transfers"in e.gtfs&&-1!==e.gtfsHead.transfers.from_stop_id&&-1!==e.gtfsHead.transfers.to_stop_id&&1!==e.gtfsHead.transfers.transfer_type){"nodeLookup"in e._==0&&(e._.nodeLookup={}),"nodeCoord"in e._==0&&(e._.nodeCoord={}),"node"in e.aquius==0&&(e.aquius.node=[]);for(o=0;o<e.gtfs.transfers.length;o+=1)if(""!==e.gtfs.transfers[o][e.gtfsHead.transfers.from_stop_id]&&(i=e._.nodeLookup[e.gtfs.transfers[o][e.gtfsHead.transfers.from_stop_id]])!==(n=e._.nodeLookup[e.gtfs.transfers[o][e.gtfsHead.transfers.to_stop_id]]))if(void 0!==i&&void 0!==n);else if(void 0!==i)e._.nodeLookup[n]=i;else if(void 0!==n)e._.nodeLookup[i]=n;else if(void 0===i&&void 0===n)for(g=0;g<e.gtfs.stops.length;g+=1)if(e.gtfs.stops[g][e.gtfsHead.stops.stop_id]===i){e=d(e,t=f(e,e.gtfs.stops[g]),e.gtfs.stops[g][e.gtfsHead.stops.stop_id]),(s=t[0].toString()+","+t[1].toString())in e._.nodeCoord?r=e._.nodeCoord[s]:(r=e.aquius.node.length,e.aquius.node.push([t[0],t[1],{}]),e._.nodeCoord[s]=r),e._.nodeLookup[i]=r,e._.nodeLookup[n]=r,e=a(e,e.gtfs.stops[g],r);break}}return e}(r=function(e){var t,r,s,i,n=[];if(-1!==e.gtfsHead.stops.location_type&&-1!==e.gtfsHead.stops.parent_station){"nodeLookup"in e._==0&&(e._.nodeLookup={}),"nodeCoord"in e._==0&&(e._.nodeCoord={}),"node"in e.aquius==0&&(e.aquius.node=[]);for(i=0;i<e.gtfs.stops.length;i+=1)"1"===e.gtfs.stops[i][e.gtfsHead.stops.location_type]?(e=d(e,t=f(e,e.gtfs.stops[i]),e.gtfs.stops[i][e.gtfsHead.stops.stop_id]),(s=t[0].toString()+","+t[1].toString())in e._.nodeCoord?r=e._.nodeCoord[s]:(r=e.aquius.node.length,e.aquius.node.push([t[0],t[1],{}]),e._.nodeCoord[s]=r),e._.nodeLookup[e.gtfs.stops[i][e.gtfsHead.stops.stop_id]]=r,e=a(e,e.gtfs.stops[i],r)):""!==e.gtfs.stops[i][e.gtfsHead.stops.parent_station]&&n.push([e.gtfs.stops[i][e.gtfsHead.stops.stop_id],e.gtfs.stops[i][e.gtfsHead.stops.parent_station]]);for(i=0;i<n.length;i+=1)n[i][1]in e._.nodeLookup&&(e._.nodeLookup[n[i][0]]=e._.nodeLookup[n[i][1]])}return e}(r=function(e){var t,r;if("serviceFilter"in e.config&&"type"in e.config.serviceFilter&&"period"===e.config.serviceFilter.type){"period"in e.config.serviceFilter!=0&&Array.isArray(e.config.serviceFilter.period)&&0!==e.config.serviceFilter.period.length||(t=["monday","tuesday","wednesday","thursday","friday"],e.config.serviceFilter.period=[{name:{"en-US":"Typical day"}},{day:t,name:{"en-US":"Typical weekday"}},{day:t,name:{"en-US":"Weekday early"},time:[{end:"10:00:00"}]},{day:t,name:{"en-US":"Weekday 10:00-17:00"},time:[{start:"10:00:00",end:"17:00:00"}]},{day:t,name:{"en-US":"Weekday evening"},time:[{start:"17:00:00"}]},{day:["saturday"],name:{"en-US":"Saturday"}},{day:["sunday"],name:{"en-US":"Sunday"}}]),e.aquius.service=[];for(r=0;r<e.config.serviceFilter.period.length;r+=1)"name"in e.config.serviceFilter.period[r]==0&&(e.config.serviceFilter.period[r].name={"en-US":"Period "+r}),e.aquius.service.push([[r],e.config.serviceFilter.period[r].name,{}])}return e}(r=function(e){var t,r,s,i,n,o={0:{"en-US":"Tram"},1:{"en-US":"Metro"},2:{"en-US":"Rail"},3:{"en-US":"Bus"},4:{"en-US":"Ferry"},5:{"en-US":"Cable car"},6:{"en-US":"Cable car"},7:{"en-US":"Funicular"},100:{"en-US":"Rail"},101:{"en-US":"High speed rail"},102:{"en-US":"Long distance rail"},103:{"en-US":"Inter-regional rail"},105:{"en-US":"Sleeper rail"},106:{"en-US":"Regional rail"},107:{"en-US":"Tourist rail"},108:{"en-US":"Rail shuttle"},109:{"en-US":"Suburban rail"},200:{"en-US":"Coach"},201:{"en-US":"International coach"},202:{"en-US":"National coach"},204:{"en-US":"Regional coach"},208:{"en-US":"Commuter coach"},400:{"en-US":"Urban rail"},401:{"en-US":"Metro"},402:{"en-US":"Underground"},405:{"en-US":"Monorail"},700:{"en-US":"Bus"},701:{"en-US":"Regional bus"},702:{"en-US":"Express bus"},704:{"en-US":"Local bus"},800:{"en-US":"Trolleybus"},900:{"en-US":"Tram"},1000:{"en-US":"Water"},1300:{"en-US":"Telecabin"},1400:{"en-US":"Funicular"},1501:{"en-US":"Shared taxi"},1700:{"en-US":"Other"},1701:{"en-US":"Cable car"},1702:{"en-US":"Horse-drawn"}};switch("type"in e.config.networkFilter==0&&(e.config.networkFilter.type="agency"),"reference"in e.config.networkFilter==0&&(e.config.networkFilter.reference=[]),e._.productIndex={},"reference"in e.aquius==0&&(e.aquius.reference={}),e.config.networkFilter.type){case"mode":if("route_type"in e.gtfsHead.routes&&-1!==e.gtfsHead.routes.route_type)for(t=0,i=0;i<e.gtfs.routes.length;i+=1)e.gtfs.routes[i][e.gtfsHead.routes.route_type]in e._.productIndex==0&&(e._.productIndex[e.gtfs.routes[i][e.gtfsHead.routes.route_type]]=t,t>=e.config.networkFilter.reference.length&&(e.gtfs.routes[i][e.gtfsHead.routes.route_type]in o?e.config.networkFilter.reference[t]=o[e.gtfs.routes[i][e.gtfsHead.routes.route_type]]:e.config.networkFilter.reference[t]={}),t+=1);break;case"agency":default:if(e.config.networkFilter.type="agency","agency"in e.gtfs&&"agency_id"in e.gtfsHead.agency&&1!==e.gtfsHead.agency.agency_id)for(t=0,i=0;i<e.gtfs.agency.length;i+=1)e.gtfs.agency[i][e.gtfsHead.agency.agency_id]in e._.productIndex==0&&(e._.productIndex[e.gtfs.agency[i][e.gtfsHead.agency.agency_id]]=t,t>=e.config.networkFilter.reference.length&&(-1!==e.gtfsHead.agency.agency_name?e.config.networkFilter.reference[t]={"en-US":e.gtfs.agency[i][e.gtfsHead.agency.agency_name]}:e.config.networkFilter.reference[t]={"en-US":e.gtfs.agency[i][e.gtfsHead.agency.agency_id]}),t+=1);else e._.productIndex.agency=0,e.aquius.reference.product.push({})}if(e.aquius.reference.product=e.config.networkFilter.reference,"network"in e.config.networkFilter==0||!Array.isArray(e.config.networkFilter.network))switch(e.config.networkFilter.network=[],r=Object.keys(e._.productIndex),e.config.networkFilter.type){case"mode":if(e.config.networkFilter.network.push([r,{"en-US":"All modes"}]),r.length>1)for(i=0;i<r.length;i+=1)r[i]in o?e.config.networkFilter.network.push([[r[i]],o[r[i]]]):e.config.networkFilter.network.push([[r[i]],{"en-US":"Mode #"+r[i]}]);break;case"agency":if(e.config.networkFilter.network.push([r,{"en-US":"All operators"}]),r.length>1)for(i=0;i<r.length;i+=1)if("agency"in e.gtfs&&-1!==e.gtfsHead.agency.agency_id&&-1!==e.gtfsHead.agency.agency_name){for(n=0;n<e.gtfs.agency.length;n+=1)if(e.gtfs.agency[n][e.gtfsHead.agency.agency_id]===r[i]){e.config.networkFilter.network.push([[r[i]],{"en-US":e.gtfs.agency[n][e.gtfsHead.agency.agency_name]}]);break}}else e.config.networkFilter.network.push([[r[i]],{"en-US":r[i]}]);break;default:e.config.networkFilter.network.push([r,{"en-US":"All"}])}for(e.aquius.network=[],i=0;i<e.config.networkFilter.network.length;i+=1)if(e.config.networkFilter.network[i].length>1&&Array.isArray(e.config.networkFilter.network[i][0])&&"object"==typeof e.config.networkFilter.network[i][1]){for(s=[],n=0;n<e.config.networkFilter.network[i][0].length;n+=1)s.push(e._.productIndex[e.config.networkFilter.network[i][0][n]]);e.aquius.network.push([s,e.config.networkFilter.network[i][1],{}])}return e}(r=function(e){if("schema"in e.config.meta!=0&&"0"===e.config.meta.schema||(e.config.meta.schema="0"),"name"in e.config.meta==0&&(e.config.meta.name={}),"en-US"in e.config.meta.name==0&&("feed_info"in e.gtfs&&-1!==e.gtfsHead.feed_info.feed_publisher_name?e.config.meta.name["en-US"]=e.gtfs.feed_info[0][e.gtfsHead.feed_info.feed_publisher_name]+" ":e.config.meta.name["en-US"]="",e.config.meta.name["en-US"]+="("+e.config.fromDate,e.config.fromDate!==e.config.toDate&&(e.config.meta.name["en-US"]+="-"+e.config.toDate),e.config.meta.name["en-US"]+=")"),"url"in e.config.meta==0&&"feed_info"in e.gtfs&&-1!==e.gtfsHead.feed_info.feed_publisher_url&&(e.config.meta.url=e.gtfs.feed_info[0][e.gtfsHead.feed_info.feed_publisher_url]),e.aquius.meta=e.config.meta,"en-US"in e.config.translation==0&&(e.config.translation["en-US"]={}),"link"in e.config.translation["en-US"]==0)switch(e.config.servicePer){case 1:e.config.translation["en-US"].link="Daily Services";break;case 7:e.config.translation["en-US"].link="Weekly Services";break;default:e.config.translation["en-US"].link="Services per "+e.config.servicePer+" Days"}return e.aquius.translation=e.config.translation,"c"in e.config.option!=0&&"k"in e.config.option!=0||(e.config.option.c=parseFloat(e.gtfs.stops[0][e.gtfsHead.stops.stop_lon]),e.config.option.k=parseFloat(e.gtfs.stops[0][e.gtfsHead.stops.stop_lat]),e.config.option.m=12),"x"in e.config.option!=0&&"y"in e.config.option!=0||(e.config.option.x=parseFloat(e.gtfs.stops[0][e.gtfsHead.stops.stop_lon]),e.config.option.y=parseFloat(e.gtfs.stops[0][e.gtfsHead.stops.stop_lat]),e.config.option.z=10),e.aquius.option=e.config.option,e}(r)))))))))),t),t)}};