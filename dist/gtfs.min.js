var gtfsToAquius=gtfsToAquius||{init:function(e){"use strict";function t(e,t,s){var r,o,n,a=document.createElement(e);if("undefined"!=typeof t)for(r=Object.keys(t),n=0;n<r.length;n+=1)a[r[n]]=t[r[n]];if("undefined"!=typeof s)for(o=Object.keys(s),n=0;n<o.length;n+=1)a.style[o[n]]=s[o[n]];return a}function s(e,s,r,o){var n,a,d,p,g,u=t("table");if("undefined"!=typeof o&&u.appendChild(t("caption",{textContent:o})),0<s.length){for(d=t("tr"),p=0;p<s.length;p+=1)"object"==typeof s[p]?(a=t("th"),a.appendChild(s[p]),d.appendChild(a)):d.appendChild(t("th",{textContent:s[p].toString()}));u.appendChild(d)}for(p=0;p<e.length;p+=1){for(d=t("tr"),g=0;g<e[p].length;g+=1)"object"==typeof e[p][g]?(n=t("td"),n.appendChild(e[p][g])):n=t("td",{textContent:e[p][g].toString()}),"undefined"!=typeof r&&r.length>g&&(n.className=r[g]),d.appendChild(n);u.appendChild(d)}return u}function r(e,r,n){var a,d,p,g,u=n._vars,c=document.getElementById(u.configId+"ImportFiles"),l=document.getElementById(u.configId+"Output"),f=document.getElementById(u.configId+"Progress");if(void 0!==e)return o(e,u),!1;if(!l||!f)return!1;for(;l.firstChild;)l.removeChild(l.firstChild);for(;f.firstChild;)f.removeChild(f.firstChild);for(null!==c&&(c.disabled=!1),l.className="",p=["aquius","config"],g=0;g<p.length;g+=1)p[g]in r&&0<Object.keys(r[p[g]]).length&&(d="config"===p[g]?JSON.stringify(r[p[g]],null,1):JSON.stringify(r[p[g]]),f.appendChild(t("a",{className:u.configId+"Download",href:window.URL.createObjectURL(new Blob([d],{type:"application/json;charset=utf-8"})),download:p[g]+".json",textContent:"Save "+p[g]+".json",role:"button"})));if(a="aquius"in r&&"translation"in r.aquius&&"en-US"in r.aquius.translation&&"link"in r.aquius.translation["en-US"]?r.aquius.translation["en-US"].link:"Services","undefined"!=typeof aquius&&"aquius"in r&&(l.appendChild(t("div",{id:u.configId+"Map"},{height:document.documentElement.clientHeight/2+"px"})),aquius.init(u.configId+"Map",{dataObject:r.aquius,uiStore:!1})),"warning"in r)for(g=0;g<r.warning.length;g+=1)l.appendChild(t("p",{textContent:r.warning[g]}));"networkTable"in r&&l.appendChild(s(r.networkTable.data,r.networkTable.header,r.networkTable.format,a+" by Network")),"summaryTable"in r&&l.appendChild(s(r.summaryTable.data,r.summaryTable.header,r.summaryTable.format,a+" % by Hour (scheduled only)"))}function o(e,i){var s,r=document.getElementById(i.configId+"ImportFiles"),o=document.getElementById(i.configId+"Output"),n=document.getElementById(i.configId+"Progress");if(void 0!==e&&null!==o){for(;o.firstChild;)o.removeChild(o.firstChild);if(o.className=i.configId+"OutputError",s="message"in e?e.message:JSON.stringify(e),o.appendChild(t("p",{textContent:"Error: "+s})),null!==n){for(;n.firstChild;)n.removeChild(n.firstChild);n.textContent="Failed"}null!==r&&(r.disabled=!1)}}return function(e,i,s){var r,o,n,a=document.getElementById(e.configId);if(!a)return!1;for(;a.firstChild;)a.removeChild(a.firstChild);return Object.keys&&[].indexOf&&"object"==typeof JSON&&window.File&&window.FileReader&&window.Blob?(document.head.appendChild(t("script",{src:"https://timhowgego.github.io/Aquius/dist/aquius.min.js",type:"text/javascript"})),o=t("form",{className:e.configId+"Input"}),n=t("label",{textContent:s}),r=t("input",{id:e.configId+"ImportFiles",multiple:"multiple",name:e.configId+"ImportFiles[]",type:"file"}),r.addEventListener("change",function(){i(e)},!1),n.appendChild(r),o.appendChild(n),o.appendChild(t("span",{id:e.configId+"Progress"})),a.appendChild(o),a.appendChild(t("div",{id:e.configId+"Output"})),!0):(a.appendChild(document.createTextNode("Browser not supported: Try a modern browser")),!1)}({configId:e,process:this.process},function(e){function t(t){var r,n,a,d=[];for(a=0;a<t.length;a+=1)for(n=0;t[a].size>=n;)d.push([t[a],parseInt(n/100000000,10)]),n+=100000000;for(c=d.length,a=0;a<c;a+=1)s=new FileReader,s.onerror=function(t,i){o(new Error("Could not read "+i[0].name),e),s.abort()},s.onload=function(t){return function(){try{i(t[0].name,t[1],this.result)}catch(t){o(t,e)}}}(d[a]),r=d[a][0].slice(d[a][1]*100000000,d[a][1]*100000000+100000000),s.readAsText(r)}function i(t,s,r){var d,u,l,f,_;if(d=t.toLowerCase().split("."),1<d.length&&"txt"===d[d.length-1]?(l=d.slice(0,d.length-1).join("."),!1==l in n&&(n[l]=[]),n[l][s]=r):(l=d.join("."),!1==l in a&&(a[l]=[]),a[l][s]=r),g+=1,g===c){for(f=Object.keys(a),_=0;_<f.length;_+=1)try{u=JSON.parse(a[f[_]].join("")),"type"in u&&"FeatureCollection"===u.type?p.geojson=u:p.config=u}catch(t){!1==t instanceof SyntaxError&&o(t,e)}e.process(n,p)}}var s,n={},a={},d=document.getElementById(e.configId+"ImportFiles"),p={_vars:e,callback:r},g=0,u=document.getElementById(e.configId+"Progress"),c=0;if(null!==d&&0<d.files.length){if(d.disabled=!0,null!==u){for(;u.firstChild;)u.removeChild(u.firstChild);u.textContent="Working..."}t(d.files)}},"GTFS as .txt, optional config, and optional GeoJSON to process:")},process:function(e,t){"use strict";function s(e){var t=new Date(e),i=t.getFullYear().toString();return 9>t.getMonth()&&(i+="0"),i+=(t.getMonth()+1).toString(),10>t.getDate()&&(i+="0"),i+=t.getDate().toString(),i}function r(e){return 8>e.length?0:Date.UTC(e.slice(0,4),e.slice(4,6)-1,e.slice(6,8))}function o(e,t,i,s){var r=Math.PI/180,o=Math.sin((i-e)*r/2),n=Math.sin((s-t)*r/2),d=o*o+Math.cos(e*r)*Math.cos(i*r)*n*n,a=2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d));return 6371e3*a}function n(e,t){var r,o={allowBlock:!1,allowDuration:!1,allowDwell:!1,allowCabotage:!1,allowCode:!0,allowColor:!0,allowDuplication:!1,allowHeadsign:!1,allowName:!0,allowNoc:!1,allowRoute:!0,allowRouteLong:!1,allowRouteUrl:!0,allowSplit:!1,allowStopUrl:!0,allowWaypoint:!0,allowZeroCoordinate:!0,codeAsStopId:!1,coordinatePrecision:5,duplicationRouteOnly:!0,fromDate:s(Date.now()),inGeojson:!0,isCircular:[],meta:{schema:"0"},mirrorLink:!0,networkFilter:{type:"agency"},nodeGeojson:{},option:{},populationProperty:"population",placeNameProperty:"name",productOverride:{},routeExclude:[],routeInclude:[],routeOverride:{},serviceFilter:{},servicePer:1,splitMinimumJoin:2,stopExclude:[],stopInclude:[],stopOverride:{},stopPlace:!1,toDate:s(Date.now()+5184e5),translation:{}},n=Object.keys(o);for("object"!=typeof t&&(t={}),r=0;r<n.length;r+=1)e.config[n[r]]="config"in t&&n[r]in t.config&&typeof t.config[n[r]]==typeof o[n[r]]?t.config[n[r]]:o[n[r]];for(e._.circular={},r=0;r<e.config.isCircular.length;r+=1)e._.circular[e.config.isCircular[r]]=e.config.isCircular[r];return e}function a(e,t,s){function r(e,t,i,s,r){return t.length===s&&(-1===r?e.gtfs[i].push(t):(!1==t[r]in e.gtfs[i]&&(e.gtfs[i][t[r]]=[]),e.gtfs[i][t[r]].push(t))),e}var o,n,a,d,p,g,u,c=-1,l=/(\,|\r?\n|\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^\,\r\n]*))/gi,f=-1,_=[];for(Array.isArray(s)||(s=[s]),g=0;g<s.length;g+=1)for(d=l.exec(s[g]),n=_.length-1,o=!0;null!==d;){if(d[1].length&&","!==d[1]){if(0<g&&!0===o&&(_.length>c&&n<_.length-1&&(p=_.slice(0,n),p.push(_[n]+_[n+1]),_=p.concat(_.slice(n+2))),o=!1),-1===c){for(c=_.length,u=0;u<_.length;u+=1)_[u]in e.gtfsHead[t]&&(e.gtfsHead[t][_[u]]=u);if(t in e.gtfsRequired)for(u=0;u<e.gtfsRequired[t].length;u+=1)if(-1===e.gtfsHead[t][e.gtfsRequired[t][u]])return!1=="error"in e&&(e.error=[]),e.error.push("Missing value "+e.gtfsRequired[t][u]+" in GTFS "+t+".txt"),e;if(t in e.gtfsIndex){if(f=e.gtfsHead[t][e.gtfsIndex[t]],-1===f)return!1=="error"in e&&(e.error=[]),e.error.push("Missing index value "+e.gtfsIndex[t]+" in GTFS "+t+".txt"),e;e.gtfs[t]={}}else e.gtfs[t]=[]}else e=r(e,_,t,c,f);_=[]}a=d[2]?d[2].replace(/""/g,"\""):d[3],void 0===a&&(a=""),_.push(a.trim()),d=l.exec(s[g])}return e=r(e,_,t,c,f),e}function d(e,t){var s,r;for(e.gtfsIndex={stop_times:"trip_id"},e.gtfsHead={agency:{agency_id:-1,agency_name:-1,agency_noc:-1},calendar:{service_id:-1,monday:-1,tuesday:-1,wednesday:-1,thursday:-1,friday:-1,saturday:-1,sunday:-1,start_date:-1,end_date:-1},calendar_dates:{service_id:-1,date:-1,exception_type:-1},frequencies:{trip_id:-1,start_time:-1,end_time:-1,headway_secs:-1},routes:{agency_id:-1,route_color:-1,route_id:-1,route_long_name:-1,route_short_name:-1,route_text_color:-1,route_url:-1},stop_times:{arrival_time:-1,departure_time:-1,trip_id:-1,stop_id:-1,stop_sequence:-1,pickup_type:-1,drop_off_type:-1},stops:{stop_code:-1,stop_id:-1,stop_lat:-1,stop_lon:-1,stop_name:-1,stop_url:-1,location_type:-1,parent_station:-1},transfers:{from_stop_id:-1,to_stop_id:-1,transfer_type:-1},trips:{block_id:-1,direction_id:-1,route_id:-1,service_id:-1,trip_headsign:-1,trip_id:-1,trip_short_name:-1}},e.gtfsRequired={routes:["route_id"],stops:["stop_id","stop_lat","stop_lon"],trips:["route_id","service_id","trip_id"],stop_times:["trip_id","stop_id","stop_sequence"]},("type"in e.config.networkFilter)&&"mode"===e.config.networkFilter.type&&(e.gtfsHead.routes.route_type=-1),(!1==("name"in e.config.meta)||!1==("en-US"in e.config.meta.name))&&(!1==("feed_info"in e.gtfsHead)&&(e.gtfsHead.feed_info={}),e.gtfsHead.feed_info.feed_publisher_name=-1),!1==("url"in e.config.meta)&&(!1==("feed_info"in e.gtfsHead)&&(e.gtfsHead.feed_info={}),e.gtfsHead.feed_info.feed_publisher_url=-1),s=Object.keys(e.gtfsRequired),r=0;r<s.length;r+=1)if(!1==s[r]in t)return!1=="error"in e&&(e.error=[]),e.error.push("Missing GTFS "+s[r]+".txt"),e;for(e.gtfs={},s=Object.keys(e.gtfsHead),r=0;r<s.length;r+=1)s[r]in t&&(e=a(e,s[r],t[s[r]]));return e}function p(e){if((!1=="schema"in e.config.meta||"0"!==e.config.meta.schema)&&(e.config.meta.schema="0"),!1=="name"in e.config.meta&&(e.config.meta.name={}),!1=="en-US"in e.config.meta.name&&(e.config.meta.name["en-US"]="feed_info"in e.gtfs&&-1!==e.gtfsHead.feed_info.feed_publisher_name&&0<e.gtfs.feed_info.length?e.gtfs.feed_info[0][e.gtfsHead.feed_info.feed_publisher_name]+" ":"",e.config.meta.name["en-US"]+="("+e.config.fromDate,e.config.fromDate!==e.config.toDate&&(e.config.meta.name["en-US"]+="-"+e.config.toDate),e.config.meta.name["en-US"]+=")"),!1=="url"in e.config.meta&&"feed_info"in e.gtfs&&-1!==e.gtfsHead.feed_info.feed_publisher_url&&0<e.gtfs.feed_info.length&&(e.config.meta.url=e.gtfs.feed_info[0][e.gtfsHead.feed_info.feed_publisher_url]),e.aquius.meta=e.config.meta,!1=="en-US"in e.config.translation&&(e.config.translation["en-US"]={}),!1=="link"in e.config.translation["en-US"])switch(e.config.servicePer){case 1:e.config.translation["en-US"].link="Daily Services";break;case 7:e.config.translation["en-US"].link="Weekly Services";break;default:e.config.translation["en-US"].link="Services per "+e.config.servicePer+" Days";}return e.aquius.translation=e.config.translation,(!1=="c"in e.config.option||!1=="k"in e.config.option)&&(e.config.option.c=parseFloat(e.gtfs.stops[0][e.gtfsHead.stops.stop_lon]),e.config.option.k=parseFloat(e.gtfs.stops[0][e.gtfsHead.stops.stop_lat]),e.config.option.m=12),(!1=="x"in e.config.option||!1=="y"in e.config.option)&&(e.config.option.x=parseFloat(e.gtfs.stops[0][e.gtfsHead.stops.stop_lon]),e.config.option.y=parseFloat(e.gtfs.stops[0][e.gtfsHead.stops.stop_lat]),e.config.option.z=10),e.aquius.option=e.config.option,e}function g(e){var t,s,r,o,n,a,d,p={0:{"en-US":"Tram"},1:{"en-US":"Metro"},2:{"en-US":"Rail"},3:{"en-US":"Bus"},4:{"en-US":"Ferry"},5:{"en-US":"Cable car"},6:{"en-US":"Cable car"},7:{"en-US":"Funicular"},100:{"en-US":"Rail"},101:{"en-US":"High speed rail"},102:{"en-US":"Long distance rail"},103:{"en-US":"Inter-regional rail"},105:{"en-US":"Sleeper rail"},106:{"en-US":"Regional rail"},107:{"en-US":"Tourist rail"},108:{"en-US":"Rail shuttle"},109:{"en-US":"Suburban rail"},200:{"en-US":"Coach"},201:{"en-US":"International coach"},202:{"en-US":"National coach"},204:{"en-US":"Regional coach"},208:{"en-US":"Commuter coach"},400:{"en-US":"Urban rail"},401:{"en-US":"Metro"},402:{"en-US":"Underground"},405:{"en-US":"Monorail"},700:{"en-US":"Bus"},701:{"en-US":"Regional bus"},702:{"en-US":"Express bus"},704:{"en-US":"Local bus"},800:{"en-US":"Trolleybus"},900:{"en-US":"Tram"},1000:{"en-US":"Water"},1300:{"en-US":"Telecabin"},1400:{"en-US":"Funicular"},1501:{"en-US":"Shared taxi"},1700:{"en-US":"Other"},1701:{"en-US":"Cable car"},1702:{"en-US":"Horse-drawn"}};switch(!1=="type"in e.config.networkFilter&&(e.config.networkFilter.type="agency"),!1=="reference"in e.config.networkFilter&&(e.config.networkFilter.reference={}),e._.productIndex={},!1=="reference"in e.aquius&&(e.aquius.reference={}),e.aquius.reference.product=[],e.config.networkFilter.type){case"mode":if("route_type"in e.gtfsHead.routes&&-1!==e.gtfsHead.routes.route_type&&0<e.gtfs.routes.length)for(s=0,a=0;a<e.gtfs.routes.length;a+=1)!1==e.gtfs.routes[a][e.gtfsHead.routes.route_type]in e._.productIndex&&(e._.productIndex[e.gtfs.routes[a][e.gtfsHead.routes.route_type]]=s,!1==e.gtfs.routes[a][e.gtfsHead.routes.route_type]in e.config.networkFilter.reference&&(e.gtfs.routes[a][e.gtfsHead.routes.route_type]in p?e.config.networkFilter.reference[e.gtfs.routes[a][e.gtfsHead.routes.route_type]]=p[e.gtfs.routes[a][e.gtfsHead.routes.route_type]]:e.config.networkFilter.reference[e.gtfs.routes[a][e.gtfsHead.routes.route_type]]={}),e.aquius.reference.product[s]=e.config.networkFilter.reference[e.gtfs.routes[a][e.gtfsHead.routes.route_type]],s+=1);break;case"agency":default:if(e.config.networkFilter.type="agency","agency"in e.gtfs&&("agency_id"in e.gtfsHead.agency&&-1!==e.gtfsHead.agency.agency_id||"agency_name"in e.gtfsHead.agency&&-1!==e.gtfsHead.agency.agency_name)&&0<e.gtfs.agency.length)for(s=0,t=("agency_id"in e.gtfsHead.agency)&&-1!==e.gtfsHead.agency.agency_id?e.gtfsHead.agency.agency_id:e.gtfsHead.agency.agency_name,a=0;a<e.gtfs.agency.length;a+=1)void 0!==e.gtfs.agency[a][t]&&""!==e.gtfs.agency[a][t]&&!1==e.gtfs.agency[a][t]in e._.productIndex&&(e._.productIndex[e.gtfs.agency[a][t]]=s,!1==e.gtfs.agency[a][t]in e.config.networkFilter.reference&&(o=!0===e.config.allowNoc&&-1!==e.gtfsHead.agency.agency_noc?" ["+e.gtfs.agency[a][e.gtfsHead.agency.agency_noc]+"]":"",e.config.networkFilter.reference[e.gtfs.agency[a][t]]=-1===e.gtfsHead.agency.agency_name?{"en-US":e.gtfs.agency[a][e.gtfsHead.agency.agency_id]+o}:{"en-US":e.gtfs.agency[a][e.gtfsHead.agency.agency_name]+o}),e.aquius.reference.product[s]=e.config.networkFilter.reference[e.gtfs.agency[a][t]],s+=1);0===Object.keys(e._.productIndex).length&&(e._.productIndex.agency=0,e.config.networkFilter.reference.agency={},e.aquius.reference.product[0]={});}if(!1=="network"in e.config.networkFilter||!Array.isArray(e.config.networkFilter.network))switch(e.config.networkFilter.network=[],r=Object.keys(e._.productIndex),e.config.networkFilter.type){case"mode":if(e.config.networkFilter.network.push([r,{"en-US":"All modes"}]),1<r.length)for(a=0;a<r.length;a+=1)r[a]in p?e.config.networkFilter.network.push([[r[a]],p[r[a]]]):e.config.networkFilter.network.push([[r[a]],{"en-US":"Mode #"+r[a]}]);break;case"agency":if(e.config.networkFilter.network.push([r,{"en-US":"All operators"}]),1<r.length)for(a=0;a<r.length;a+=1)if("agency"in e.gtfs&&-1!==e.gtfsHead.agency.agency_id&&-1!==e.gtfsHead.agency.agency_name){for(d=0;d<e.gtfs.agency.length;d+=1)if(e.gtfs.agency[d][e.gtfsHead.agency.agency_id]===r[a]){o=!0===e.config.allowNoc&&-1!==e.gtfsHead.agency.agency_noc?" ["+e.gtfs.agency[d][e.gtfsHead.agency.agency_noc]+"]":"",e.config.networkFilter.network.push([[r[a]],{"en-US":e.gtfs.agency[d][e.gtfsHead.agency.agency_name]+o}]);break}}else e.config.networkFilter.network.push([[r[a]],{"en-US":r[a]}]);break;default:e.config.networkFilter.network.push([r,{"en-US":"All"}]);}for(e.aquius.network=[],a=0;a<e.config.networkFilter.network.length;a+=1)if(1<e.config.networkFilter.network[a].length&&Array.isArray(e.config.networkFilter.network[a][0])&&"object"==typeof e.config.networkFilter.network[a][1]){for(n=[],d=0;d<e.config.networkFilter.network[a][0].length;d+=1)e.config.networkFilter.network[a][0][d]in e._.productIndex&&n.push(e._.productIndex[e.config.networkFilter.network[a][0][d]]);e.aquius.network.push([n,e.config.networkFilter.network[a][1],{}])}return e}function u(e){var t,s;if("serviceFilter"in e.config&&"type"in e.config.serviceFilter&&"period"===e.config.serviceFilter.type)for(!1!=("period"in e.config.serviceFilter)&&Array.isArray(e.config.serviceFilter.period)&&0!==e.config.serviceFilter.period.length||(t=["monday","tuesday","wednesday","thursday","friday"],e.config.serviceFilter.period=[{name:{"en-US":"Typical day"}},{day:t,name:{"en-US":"Typical weekday"}},{day:t,name:{"en-US":"Weekday early"},time:[{end:"10:00:00"}]},{day:t,name:{"en-US":"Weekday 10:00-17:00"},time:[{start:"10:00:00",end:"17:00:00"}]},{day:t,name:{"en-US":"Weekday evening"},time:[{start:"17:00:00"}]},{day:["saturday"],name:{"en-US":"Saturday"}},{day:["sunday"],name:{"en-US":"Sunday"}}]),e.aquius.service=[],s=0;s<e.config.serviceFilter.period.length;s+=1)!1=="name"in e.config.serviceFilter.period[s]&&(e.config.serviceFilter.period[s].name={"en-US":"Period "+s}),e.aquius.service.push([[s],e.config.serviceFilter.period[s].name,{}]);return e}function c(e,t,i){return!1=="reference"in e.aquius&&(e.aquius.reference={}),!1==t in e.aquius.reference&&(e.aquius.reference[t]=[],e._[t]={}),!1==i in e._[t]&&(e.aquius.reference[t].push(i),e._[t][i]=e.aquius.reference[t].length-1),e}function l(e,t,i){function s(e,t){var s,r,o,n=Object.keys(e);for(r=0;r<t.length;r+=1){for(s=!0,o=0;o<n.length;o+=1)if(!1==n[o]in t[r]||t[r][n[o]]!==e[n[o]]){s=!1;break}if(!0===s)return!0}return!1}var r,o,n,a,d={};return!0===e.config.allowName&&(o="",t[e.gtfsHead.stops.stop_id]in e.config.stopOverride&&"stop_name"in e.config.stopOverride[t[e.gtfsHead.stops.stop_id]]?o=e.config.stopOverride[t[e.gtfsHead.stops.stop_id]].stop_name:-1!==e.gtfsHead.stops.stop_name&&(o=t[e.gtfsHead.stops.stop_name].trim()),""!==o&&(d.n=o)),!0===e.config.allowStopUrl&&(o="",t[e.gtfsHead.stops.stop_id]in e.config.stopOverride&&"stop_url"in e.config.stopOverride[t[e.gtfsHead.stops.stop_id]]?o=e.config.stopOverride[t[e.gtfsHead.stops.stop_id]].stop_url:-1!==e.gtfsHead.stops.stop_url&&(o=t[e.gtfsHead.stops.stop_url].trim()),""!==o&&(a="[*]",n=o.lastIndexOf(a),-1===n&&-1!==e.gtfsHead.stops.stop_code&&(r=t[e.gtfsHead.stops.stop_code].trim(),n=o.lastIndexOf(r),-1!==n&&(o=o.substring(0,n)+a+o.substring(n+r.length),d.i=r)),-1===n&&-1!==e.gtfsHead.stops.stop_id&&(r=t[e.gtfsHead.stops.stop_id].trim(),n=o.lastIndexOf(r),-1!==n&&(o=o.substring(0,n)+a+o.substring(n+r.length),d.i=r)),e=c(e,"url",o),d.u=e._.url[o])),0<Object.keys(d).length&&("r"in e.aquius.node[i][2]?!1===s(d,e.aquius.node[i][2].r)&&e.aquius.node[i][2].r.push(d):e.aquius.node[i][2].r=[d]),e.config.allowCode&&(d={},e.config.codeAsStopId?d.n=t[e.gtfsHead.stops.stop_id].trim():t[e.gtfsHead.stops.stop_id]in e.config.stopOverride&&"stop_code"in e.config.stopOverride[t[e.gtfsHead.stops.stop_id]]?d.n=e.config.stopOverride[t[e.gtfsHead.stops.stop_id]].stop_code:-1!==e.gtfsHead.stops.stop_code&&(d.n=t[e.gtfsHead.stops.stop_code].trim()),"n"in d&&""!==d.n&&("r"in e.aquius.node[i][2]?!1===s(d,e.aquius.node[i][2].r)&&e.aquius.node[i][2].r.push(d):e.aquius.node[i][2].r=[d])),e}function f(e,t){function i(e,t){var i=parseFloat(e);return Number.isNaN(i)?0:Math.round(i*t)/t}var s=Math.pow(10,e.config.coordinatePrecision);return-1!==e.gtfsHead.stops.stop_id&&t[e.gtfsHead.stops.stop_id]in e.config.stopOverride&&"x"in e.config.stopOverride[t[e.gtfsHead.stops.stop_id]]&&"y"in e.config.stopOverride[t[e.gtfsHead.stops.stop_id]]?[i(e.config.stopOverride[t[e.gtfsHead.stops.stop_id]].x,s),i(e.config.stopOverride[t[e.gtfsHead.stops.stop_id]].y,s)]:-1!==e.gtfsHead.stops.stop_lat&&-1!==e.gtfsHead.stops.stop_lon?[i(t[e.gtfsHead.stops.stop_lon],s),i(t[e.gtfsHead.stops.stop_lat],s)]:[0,0]}function _(e,t,i){return 0===t[0]&&0===t[1]&&(!1==i in e.config.stopOverride&&(e.config.stopOverride[i]={}),e.config.stopOverride[i].x=0,e.config.stopOverride[i].y=0),e}function h(e){var t;if(0<e.config.stopExclude.length)for(e._.stopExclude={},t=0;t<e.config.stopExclude.length;t+=1)e._.stopExclude[e.config.stopExclude[t]]="";if(0<e.config.stopInclude.length)for(e._.stopInclude={},t=0;t<e.config.stopInclude.length;t+=1)e._.stopInclude[e.config.stopInclude[t]]="";return e}function m(e){var t,s,r,o,n=[];if(-1!==e.gtfsHead.stops.location_type&&-1!==e.gtfsHead.stops.parent_station){for(!1==("nodeLookup"in e._)&&(e._.nodeLookup={}),!1==("nodeCoord"in e._)&&(e._.nodeCoord={}),!1==("node"in e.aquius)&&(e.aquius.node=[]),o=0;o<e.gtfs.stops.length;o+=1)(!1=="stopExclude"in e._||!1==e.gtfs.stops[o][e.gtfsHead.stops.stop_id]in e._.stopExclude)&&(!1=="stopInclude"in e._||e.gtfs.stops[o][e.gtfsHead.stops.stop_id]in e._.stopInclude)&&("1"===e.gtfs.stops[o][e.gtfsHead.stops.location_type]?(t=f(e,e.gtfs.stops[o]),(e.config.allowZeroCoordinate||0!==t[0]||0!==t[1])&&(e=_(e,t,e.gtfs.stops[o][e.gtfsHead.stops.stop_id]),r=t[0].toString()+","+t[1].toString(),r in e._.nodeCoord?s=e._.nodeCoord[r]:(s=e.aquius.node.length,e.aquius.node.push([t[0],t[1],{}]),e._.nodeCoord[r]=s),e._.nodeLookup[e.gtfs.stops[o][e.gtfsHead.stops.stop_id]]=s,e=l(e,e.gtfs.stops[o],s))):""!==e.gtfs.stops[o][e.gtfsHead.stops.parent_station]&&n.push([e.gtfs.stops[o][e.gtfsHead.stops.stop_id],e.gtfs.stops[o][e.gtfsHead.stops.parent_station]]));for(o=0;o<n.length;o+=1)n[o][1]in e._.nodeLookup&&(e._.nodeLookup[n[o][0]]=e._.nodeLookup[n[o][1]])}return e}function y(e){var t,s,r,o,n,a,d;if("transfers"in e.gtfs&&-1!==e.gtfsHead.transfers.from_stop_id&&-1!==e.gtfsHead.transfers.to_stop_id&&1!==e.gtfsHead.transfers.transfer_type)for(!1==("nodeLookup"in e._)&&(e._.nodeLookup={}),!1==("nodeCoord"in e._)&&(e._.nodeCoord={}),!1==("node"in e.aquius)&&(e.aquius.node=[]),a=0;a<e.gtfs.transfers.length;a+=1)if(""!==e.gtfs.transfers[a][e.gtfsHead.transfers.from_stop_id]&&(!1=="stopExclude"in e._||!1==e.gtfs.transfers[a][e.gtfsHead.transfers.from_stop_id]in e._.stopExclude&&!1==e.gtfs.transfers[a][e.gtfsHead.transfers.to_stop_id]in e._.stopExclude)&&(!1=="stopInclude"in e._||e.gtfs.transfers[a][e.gtfsHead.transfers.from_stop_id]in e._.stopInclude&&e.gtfs.transfers[a][e.gtfsHead.transfers.to_stop_id]in e._.stopInclude)&&(o=e._.nodeLookup[e.gtfs.transfers[a][e.gtfsHead.transfers.from_stop_id]],n=e._.nodeLookup[e.gtfs.transfers[a][e.gtfsHead.transfers.to_stop_id]],o!==n))if(void 0!==o&&void 0!==n);else if(void 0!==o)e._.nodeLookup[n]=o;else if(void 0!==n)e._.nodeLookup[o]=n;else if(void 0===o&&void 0===n)for(d=0;d<e.gtfs.stops.length;d+=1)if(e.gtfs.stops[d][e.gtfsHead.stops.stop_id]===o&&(t=f(e,e.gtfs.stops[d]),e.config.allowZeroCoordinate||0!==t[0]||0!==t[1])){e=_(e,t,e.gtfs.stops[d][e.gtfsHead.stops.stop_id]),r=t[0].toString()+","+t[1].toString(),r in e._.nodeCoord?s=e._.nodeCoord[r]:(s=e.aquius.node.length,e.aquius.node.push([t[0],t[1],{}]),e._.nodeCoord[r]=s),e._.nodeLookup[o]=s,e._.nodeLookup[n]=s,e=l(e,e.gtfs.stops[d],s);break}return e}function k(e){var t,s,r,o;for(!1==("nodeLookup"in e._)&&(e._.nodeLookup={}),!1==("nodeCoord"in e._)&&(e._.nodeCoord={}),!1==("node"in e.aquius)&&(e.aquius.node=[]),o=0;o<e.gtfs.stops.length;o+=1)!1==e.gtfs.stops[o].stop_id in e._.nodeLookup&&""!==e.gtfs.stops[o][e.gtfsHead.stops.stop_id]&&(!1=="stopExclude"in e._||!1==e.gtfs.stops[o][e.gtfsHead.stops.stop_id]in e._.stopExclude)&&(!1=="stopInclude"in e._||e.gtfs.stops[o][e.gtfsHead.stops.stop_id]in e._.stopInclude)&&(t=f(e,e.gtfs.stops[o]),(e.config.allowZeroCoordinate||0!==t[0]||0!==t[1])&&(e=_(e,t,e.gtfs.stops[o][e.gtfsHead.stops.stop_id]),r=t[0].toString()+","+t[1].toString(),r in e._.nodeCoord?s=e._.nodeCoord[r]:(s=e.aquius.node.length,e.aquius.node.push([t[0],t[1],{}]),e._.nodeCoord[r]=s),e._.nodeLookup[e.gtfs.stops[o][e.gtfsHead.stops.stop_id]]=s,e=l(e,e.gtfs.stops[o],s)));return delete e._.nodeCoord,e}function w(e){var t,s,r=e.split(":");if(3!==r.length)return 0;for(s=0;s<r.length;s+=1){if(t=parseInt(r[s],10),Number.isNaN(t))return 0;r[s]=t}return 3600*r[0]+60*r[1]+r[2]}function H(e){var t=new Date(e);return["sunday","monday","tuesday","wednesday","thursday","friday","saturday"][t.getDay()]}function v(e){var t=r(e.config.fromDate),i=r(e.config.toDate);for(e._.calendar={},e._.calendarDay={},e._.calendarGtfs={};i>=t;)e._.calendar[t]=s(t),e._.calendarDay[t]=H(t),e._.calendarGtfs[s(t)]=t,t+=864e5;return e}function q(e){var t,s,o,n,a,d,p={};if("calendar"in e.gtfs)for(t=Object.keys(e._.calendarDay),a=0;a<e.gtfs.calendar.length;a+=1)for(o=e.gtfs.calendar[a][e.gtfsHead.calendar.service_id],n=r(e.gtfs.calendar[a][e.gtfsHead.calendar.start_date]),s=r(e.gtfs.calendar[a][e.gtfsHead.calendar.end_date]),d=0;d<t.length;d+=1)t[d]>=n&&t[d]<=s&&"1"===e.gtfs.calendar[a][e.gtfsHead.calendar[e._.calendarDay[t[d]]]]&&(!1==o in p&&(p[o]={}),p[o][t[d]]="");if("calendar_dates"in e.gtfs&&-1!==e.gtfsHead.calendar_dates.service_id&&-1!==e.gtfsHead.calendar_dates.date&&-1!==e.gtfsHead.calendar_dates.exception_type)for(a=0;a<e.gtfs.calendar_dates.length;a+=1)e.gtfs.calendar_dates[a][e.gtfsHead.calendar_dates.date]in e._.calendarGtfs&&(o=e.gtfs.calendar_dates[a][e.gtfsHead.calendar_dates.service_id],!1==o in p&&(p[o]={}),"1"===e.gtfs.calendar_dates[a][e.gtfsHead.calendar_dates.exception_type]&&(p[o][e._.calendarGtfs[e.gtfs.calendar_dates[a][e.gtfsHead.calendar_dates.date]]]=""),"2"===e.gtfs.calendar_dates[a][e.gtfsHead.calendar_dates.exception_type]&&e._.calendarGtfs[e.gtfs.calendar_dates[a][e.gtfsHead.calendar_dates.date]]in p[o]&&(delete p[o][e._.calendarGtfs[e.gtfs.calendar_dates[a][e.gtfsHead.calendar_dates.date]]],0===Object.keys(p[o]).length&&delete p[o]));return p}function I(e){var t,s={};if("frequencies"in e.gtfs&&-1!==e.gtfsHead.frequencies.trip_id)for(t=0;t<e.gtfs.frequencies.length;t+=1)s[e.gtfs.frequencies[t][e.gtfsHead.frequencies.trip_id]]="";return s}function b(e){var t,s,r,o,n={},a=q(e),d=I(e),p=[],g={},u={};if(0<e.config.routeExclude.length)for(o=0;o<e.config.routeExclude.length;o+=1)g[e.config.routeExclude[o]]="";if(0<e.config.routeInclude.length)for(o=0;o<e.config.routeInclude.length;o+=1)u[e.config.routeInclude[o]]="";for(e._.trip={},e._.routes={},o=0;o<e.gtfs.trips.length;o+=1)r=e.gtfs.trips[o],r[e.gtfsHead.trips.service_id]in a&&(0===e.config.routeExclude.length||!1==r[e.gtfsHead.trips.route_id]in g)&&(0===e.config.routeInclude.length||!0==r[e.gtfsHead.trips.route_id]in u)&&(s=r[e.gtfsHead.trips.trip_id],!1==r[e.gtfsHead.trips.route_id]in e._.routes&&(e._.routes[r[e.gtfsHead.trips.route_id]]={}),e._.trip[s]={calendar:a[r[e.gtfsHead.trips.service_id]],route_id:r[e.gtfsHead.trips.route_id],service:[],stops:[]},e._.trip[s].direction_id=-1===e.gtfsHead.trips.direction_id?"":r[e.gtfsHead.trips.direction_id],s in d&&(e._.trip[s].frequent=""),-1!==e.gtfsHead.stop_times.pickup_type&&(e._.trip[s].setdown=[]),-1!==e.gtfsHead.stop_times.drop_off_type&&(e._.trip[s].pickup=[]),e.config.allowBlock&&-1!==e.gtfsHead.trips.block_id&&""!==r[e.gtfsHead.trips.block_id]&&(e._.trip[s].block={id:r[e.gtfsHead.trips.block_id]},p.push(s),r[e.gtfsHead.trips.block_id]in n?n[r[e.gtfsHead.trips.block_id]].push(s):n[r[e.gtfsHead.trips.block_id]]=[s]),!0===e.config.allowHeadsign&&-1!==e.gtfsHead.trips.trip_headsign&&(t=r[e.gtfsHead.trips.trip_headsign].trim(),""===t&&-1!==e.gtfsHead.trips.trip_short_name&&(t=r[e.gtfsHead.trips.trip_short_name].trim()),""!==t&&(e._.trip[s].reference={n:t,slug:t})));for(o=0;o<p.length;o+=1)e._.trip[p[o]].block.trips=n[e._.trip[p[o]].block.id];return e}function S(e){var t,s,r,o,n,a,d,p,g,u,c,f,_,h,m,y,H={},v=Object.keys(e.gtfs.stop_times);for((!1===e.config.allowDuplicate||e.config.allowSplit||e.config.allowCabotage)&&(o={}),_=0;_<v.length;_+=1)if(v[_]in e._.trip){for(s=Object.keys(e._.trip[v[_]].calendar),p=null,u={},h=0;h<e.gtfs.stop_times[v[_]].length;h+=1)if(c=e.gtfs.stop_times[v[_]][h],c[e.gtfsHead.stop_times.stop_id]in e._.nodeLookup&&(g=e._.nodeLookup[c[e.gtfsHead.stop_times.stop_id]],!1==g in u&&(u[g]={}),-1!==e.gtfsHead.stop_times.pickup_type&&"1"===c[e.gtfsHead.stop_times.pickup_type]&&-1!==e.gtfsHead.stop_times.drop_off_type&&"1"===c[e.gtfsHead.stop_times.drop_off_type]?u[g].route=!0:-1!==e.gtfsHead.stop_times.pickup_type&&"1"===c[e.gtfsHead.stop_times.pickup_type]?u[g].setdown=!0:-1!==e.gtfsHead.stop_times.drop_off_type&&"1"===c[e.gtfsHead.stop_times.drop_off_type]?u[g].pickup=!0:u[g].both=!0,(0===e._.trip[v[_]].stops.length||e._.trip[v[_]].stops[e._.trip[v[_]].stops.length-1][1]!==e._.nodeLookup[c[e.gtfsHead.stop_times.stop_id]])&&(t=0,r=0,n=0,-1!==e.gtfsHead.stop_times.departure_time&&""!==c[e.gtfsHead.stop_times.departure_time]&&(!1==c[e.gtfsHead.stop_times.departure_time]in H&&(H[c[e.gtfsHead.stop_times.departure_time]]=w(c[e.gtfsHead.stop_times.departure_time])),r=H[c[e.gtfsHead.stop_times.departure_time]],(!1=="start"in e._.trip[v[_]]||r<e._.trip[v[_]].start)&&(e._.trip[v[_]].start=r)),-1!==e.gtfsHead.stop_times.arrival_time&&""!==c[e.gtfsHead.stop_times.arrival_time]&&(!1==c[e.gtfsHead.stop_times.arrival_time]in H&&(H[c[e.gtfsHead.stop_times.arrival_time]]=w(c[e.gtfsHead.stop_times.arrival_time])),t=H[c[e.gtfsHead.stop_times.arrival_time]],(!1=="end"in e._.trip[v[_]]||t>e._.trip[v[_]].end)&&(e._.trip[v[_]].end=t)),e.config.allowDwell&&0!==t&&r>t&&(n=(r-t)/60),e._.trip[v[_]].stops.push([c[e.gtfsHead.stop_times.stop_sequence],g,n]),!1=="frequent"in e._.trip[v[_]]&&"undefined"!=typeof o))){for(f=[],(0!==t||0!==r)&&f.push({key:[g,t,r].join(":"),node:g}),!0===e.config.allowSplit&&0!==t&&1<e._.trip[v[_]].stops.length&&f.push({key:[g,t,e._.trip[v[_]].stops[e._.trip[v[_]].stops.length-1]].join(":"),node:g}),null!==p&&f.push({key:[g,p.key].join(":"),node:p.node}),m=0;m<f.length;m+=1)for(a=[f[m].key,e._.trip[v[_]].direction_id],e.config.duplicationRouteOnly&&a.push(e._.trip[v[_]].route_id),a=a.join(":"),y=0;y<s.length;y+=1)!1==s[y]in o&&(o[s[y]]={}),a in o[s[y]]?(!1=="dup"in e._.trip[v[_]]&&(e._.trip[v[_]].dup={stops:[],trip_id:o[s[y]][a]}),(0===e._.trip[v[_]].dup.stops.length||-1===e._.trip[v[_]].dup.stops.indexOf(f[m].node))&&e._.trip[v[_]].dup.stops.push(f[m].node)):o[s[y]][a]=v[_];!0===e.config.allowSplit&&(0===r?p=null:p={key:[r,g].join(":"),node:g})}for(d=Object.keys(u),h=0;h<d.length;h+=1)!1=="both"in u[d[h]]&&("setdown"in u[d[h]]&&!1=="pickup"in u[d[h]]?e._.trip[v[_]].setdown.push(parseInt(d[h],10)):"pickup"in u[d[h]]&&!1=="setdown"in u[d[h]]?e._.trip[v[_]].pickup.push(parseInt(d[h],10)):"route"in u[d[h]]&&(e._.trip[v[_]].setdown.push(parseInt(d[h],10)),e._.trip[v[_]].pickup.push(parseInt(d[h],10))))}return e}function x(e){function t(e,t){var s;if(e.length!==t.length)return!1;for(s=0;s<e.length;s+=1)if(e[s]!==t[s])return!1;return!0}var s,r,o,n,a,d,p,g,u,c=0,l=Object.keys(e._.trip);for(g=0;g<l.length;g+=1)if("dup"in e._.trip[l[g]]&&(p=e._.trip[l[g]].dup.trip_id,1<e._.trip[l[g]].dup.stops.length&&p in e._.trip)){for(d=[],n=Object.keys(e._.trip[p].calendar),u=0;u<n.length;u+=1)!1==n[u]in e._.trip[l[g]].calendar&&d.push(n[u]);for(r=[],n=Object.keys(e._.trip[l[g]].calendar),u=0;u<n.length;u+=1)!1==n[u]in e._.trip[p].calendar&&r.push(n[u]);if(e.config.allowCabotage&&0===d.length&&0===r.length&&(-1!==e.gtfsHead.stop_times.pickup_type||-1!==e.gtfsHead.drop_off_type)&&("setdown"in e._.trip[l[g]]&&0<e._.trip[l[g]].setdown.length&&"setdown"in e._.trip[p]&&!1===t(e._.trip[p].setdown,e._.trip[l[g]].setdown)||"pickup"in e._.trip[l[g]]&&0<e._.trip[l[g]].pickup.length&&"pickup"in e._.trip[p]&&!1===t(e._.trip[p].pickup,e._.trip[l[g]].pickup)))"b"in e._.trip[p]?e._.trip[l[g]].b=e._.trip[p].b:(e._.trip[p].b=c,e._.trip[l[g]].b=c,c+=1);else if(e.config.allowSplit&&e._.trip[l[g]].dup.stops.length>=e.config.splitMinimumJoin&&e._.trip[l[g]].dup.stops.length<e._.trip[l[g]].stops.length){if(0===r.length){for(e._.trip[l[g]].t=[],a=-1,s=0,o=!1,u=0;u<e._.trip[l[g]].stops.length;u+=1)-1===e._.trip[l[g]].dup.stops.indexOf(e._.trip[l[g]].stops[u][1])?e._.trip[l[g]].t.push(e._.trip[l[g]].stops[u][1]):(u-1===a?(s+=1,s===e.config.splitMinimumJoin&&(o=!0)):s=0,a=u);!1===o&&delete e._.trip[l[g]].t}else if(0===d.length){for(e._.trip[p].t=[],a=-1,s=0,o=!1,n={},u=0;u<e._.trip[l[g]].stops.length;u+=1)n[e._.trip[l[g]].stops[u][1]]="";for(u=0;u<e._.trip[p].stops.length;u+=1)!1==e._.trip[p].stops[u][1]in n?e._.trip[p].t.push(e._.trip[p].stops[u][1]):(u-1===a?(s+=1,s===e.config.splitMinimumJoin&&(o=!0)):s=0,a=u);!1===o&&delete e._.trip[l[g]].t}}else if(!1===e.config.allowDuplication)if(0===r.length)delete e._.trip[l[g]];else for(e._.trip[l[g]].calendar={},u=0;u<r.length;u+=1)e._.trip[l[g]].calendar[r[u]]=""}return e}function C(e){var t,s,r,o,n=Object.keys(e._.calendarDay);if("serviceFilter"in e.config&&"period"in e.config.serviceFilter){for(t=[],s=0;s<e.config.serviceFilter.period.length;s+=1)if("day"in e.config.serviceFilter.period[s])for(t.push([]),r=0;r<e.config.serviceFilter.period[s].day.length;r+=1)for(o=0;o<n.length;o+=1)e._.calendarDay[n[o]]===e.config.serviceFilter.period[s].day[r]&&t[s].push(n[o]);else t.push(n);return t}return[n]}function F(e){var t,s,r;if("serviceFilter"in e.config&&"period"in e.config.serviceFilter){for(t=[],s=0;s<e.config.serviceFilter.period.length;s+=1)if("time"in e.config.serviceFilter.period[s])for(t.push([]),r=0;r<e.config.serviceFilter.period[s].time.length;r+=1)"start"in e.config.serviceFilter.period[s].time[r]?t[s].push([w(e.config.serviceFilter.period[s].time[r].start)]):t[s].push([0]),"end"in e.config.serviceFilter.period[s].time[r]&&t[s][r].push(w(e.config.serviceFilter.period[s].time[r].end));else t.push([[0]]);return t}return[[[0]]]}function U(e,t){var s,r,o,n,a,d,p,g,u,c,l;if("frequencies"in e.gtfs&&-1!==e.gtfsHead.frequencies.trip_id&&-1!==e.gtfsHead.frequencies.start_time&&-1!==e.gtfsHead.frequencies.end_time&&-1!==e.gtfsHead.frequencies.headway_secs){for(r={},p={},u=0;u<e.gtfs.frequencies.length;u+=1)if(o=e.gtfs.frequencies[u],g=o[e.gtfsHead.frequencies.trip_id],g in e._.trip&&"frequent"in e._.trip[g]){if(!1==g in r)for(r[g]=[],c=0;c<t.length;c+=1)r[g].push(0);for(!1==(o[e.gtfsHead.frequencies.start_time]in p)&&(p[o[e.gtfsHead.frequencies.start_time]]=w(o[e.gtfsHead.frequencies.start_time])),d=p[o[e.gtfsHead.frequencies.start_time]],!1==(o[e.gtfsHead.frequencies.end_time]in p)&&(p[o[e.gtfsHead.frequencies.end_time]]=w(o[e.gtfsHead.frequencies.end_time])),s=p[o[e.gtfsHead.frequencies.end_time]],s<d&&(s+=86400),c=0;c<t.length;c+=1)if(c<e._.trip[g].service.length&&0!==e._.trip[g].service[c])if(1===t[c].length&&1===t[c][0].length&&0===t[c][0][0])r[g][c]+=(s-d)/parseInt(o[e.gtfsHead.frequencies.headway_secs],10);else for(l=0;l<t[c].length;l+=1)t[c][l][0]<s&&(1===t[c][l].length||d<t[c][l][1])&&(a=1,t[c][l][0]>d&&(a-=(t[c][l][0]-d)/(s-d)),t[c][l][1]<s&&(a-=(s-t[c][l][1])/(s-d)),r[g][c]+=(s-d)*a/parseInt(o[e.gtfsHead.frequencies.headway_secs],10))}for(n=Object.keys(r),u=0;u<n.length;u+=1)for(c=0;c<r[n[u]].length;c+=1)e._.trip[n[u]].service[c]=e._.trip[n[u]].service[c]*r[n[u]][c]}return e}function O(e){var t,s,r,o,n,a,d,p,g,u=C(e),c=F(e),l=Object.keys(e._.trip),f=[];for(d=0;d<c.length;d+=1)f.push(0);for(e.summary.service=[],d=0;d<l.length;d+=1)if(2>e._.trip[l[d]].stops.length||0===Object.keys(e._.trip[l[d]].calendar).length)delete e._.trip[l[d]];else{if(e.config.allowDuration)for(o=[],e._.trip[l[d]].minutes=[],p=0;p<f.length;p+=1)e._.trip[l[d]].minutes.push(0),o.push([]);else o=null;for(p=0;p<u.length;p+=1){for(t=0,g=0;g<u[p].length;g+=1)u[p][g]in e._.trip[l[d]].calendar&&(t+=1);e._.trip[l[d]].service.push(t/u[p].length*e.config.servicePer)}if(!1=="frequent"in e._.trip[l[d]])for(n=("start"in e._.trip[l[d]])&&("end"in e._.trip[l[d]])?(e._.trip[l[d]].end-e._.trip[l[d]].start)/2+e._.trip[l[d]].start:null,p=0;p<c.length;p+=1)if(p<e._.trip[l[d]].service.length&&0!==e._.trip[l[d]].service[p]){if(1<c[p].length||1<c[p][0].length||0!==c[p][0][0]){if(r=!1,null!==n)for(g=0;g<c[p].length;g+=1)if(n>c[p][g][0]&&(1===c[p][g].length||n<c[p][g][1])){r=!0;break}!1==r&&(e._.trip[l[d]].service[p]=0,e.config.allowDuration&&(e._.trip[l[d]].minutes[p]=0))}else r=!0;if(r){if(++f[p],s=Math.floor(n/3600),void 0===e.summary.service[s])for(e.summary.service[s]=[],g=0;g<c.length;g+=1)e.summary.service[s].push(0);++e.summary.service[s][p],e.config.allowDuration&&(e._.trip[l[d]].start>e._.trip[l[d]].end?o[p].push((e._.trip[l[d]].end+86400-e._.trip[l[d]].start)/60):o[p].push((e._.trip[l[d]].end-e._.trip[l[d]].start)/60))}}if(null!==o)for(p=0;p<o.length;p+=1)if(0<o[p].length){for(a=0,g=0;g<o[p].length;g+=1)a+=o[p][g];e._.trip[l[d]].minutes[p]=Math.round(a/g)}else e._.trip[l[d]].minutes[p]=0}for(d=0;d<e.summary.service.length;d+=1)if(void 0!==e.summary.service[d])for(p=0;p<e.summary.service[d].length;p+=1)0<f[p]&&(e.summary.service[d][p]/=f[p]);return e=U(e,c),e}function L(e){var t,s,r,o,n,a,d,p,g,u;for(g=0;g<e.gtfs.routes.length;g+=1)if(a=e.gtfs.routes[g],d=a[e.gtfsHead.routes.route_id],d in e._.routes){if(n={slug:""},o="agency"===e.config.networkFilter.type&&-1!==e.gtfsHead.routes.agency_id&&a[e.gtfsHead.routes.agency_id]in e.config.productOverride?e.config.productOverride[a[e.gtfsHead.routes.agency_id]]:"mode"===e.config.networkFilter.type&&-1!==e.gtfsHead.routes.route_type&&a[e.gtfsHead.routes.route_type]in e.config.productOverride?e.config.productOverride[a[e.gtfsHead.routes.route_type]]:{},(e.config.allowRoute||e.config.allowRouteLong)&&(t="",e.config.allowRoute&&d in e.config.routeOverride&&"route_short_name"in e.config.routeOverride[d]?t=e.config.routeOverride[d].route_short_name:e.config.allowRoute&&-1!==e.gtfsHead.routes.route_short_name&&(t=a[e.gtfsHead.routes.route_short_name].trim()),e.config.allowRouteLong&&d in e.config.routeOverride&&"route_long_name"in e.config.routeOverride[d]?(""!==t&&(t+=": "),t+=e.config.routeOverride[d].route_long_name):e.config.allowRouteLong&&-1!==e.gtfsHead.routes.route_long_name&&(""!==t&&(t+=": "),t+=a[e.gtfsHead.routes.route_long_name].trim()),""!==t&&(n.n=t,n.slug+=t)),e.config.allowColor)for(s=[["route_color","c"],["route_text_color","t"]],u=0;u<s.length;u+=1)t="",d in e.config.routeOverride&&s[u][0]in e.config.routeOverride[d]?t=e.config.routeOverride[d][s[u][0]]:s[u][0]in o?t=o[s[u][0]]:-1!==e.gtfsHead.routes[s[u][0]]&&(t=a[e.gtfsHead.routes[s[u][0]]].trim()),6===t.length&&(t="#"+t,e=c(e,"color",t),"t"===s[u][1]&&"c"in n&&n.c===e._.color[t]&&(t="#ffffff"===t.toLowerCase()?"#000000":"#ffffff",e=c(e,"color",t)),n[s[u][1]]=e._.color[t],n.slug+=t);e.config.allowRouteUrl&&(t="",d in e.config.routeOverride&&"route_url"in e.config.routeOverride[d]?t=e.config.routeOverride[d].route_url:-1!==e.gtfsHead.routes.route_url&&(t=a[e.gtfsHead.routes.route_url].trim()),""!==t&&(p="[*]",r=t.lastIndexOf(p),-1===r&&"n"in n&&(r=t.lastIndexOf(n.n),-1!==r&&(t=t.substring(0,r)+p+t.substring(r+n.n.length))),-1===r&&(r=t.lastIndexOf(d),-1!==r&&(t=t.substring(0,r)+p+t.substring(r+d.length),n.i=d)),e=c(e,"url",t),n.u=e._.url[t],n.slug+=t)),e._.routes[d].product="agency"===e.config.networkFilter.type?"agency_id"in e.gtfsHead.routes&&-1!==e.gtfsHead.routes.agency_id?e._.productIndex[a[e.gtfsHead.routes.agency_id]]:0:"mode"===e.config.networkFilter.type&&"route_type"in e.gtfsHead.routes&&-1!==e.gtfsHead.routes.route_type?e._.productIndex[a[e.gtfsHead.routes.route_type]]:e._.productIndex[Object.keys(e._.productIndex)[0]],1<Object.keys(n).length&&(e._.routes[d].reference=n)}return delete e._.productIndex,e}function P(e){function t(e,t,s,r){var n,a,d,p,g;if(0<e.config.isCircular.length)return!!(t in e._.circular);if(3>r.length||r[0]!==r[r.length-1])return!1;if("block"in s&&1<s.block.trips.length){for(d=r.join(":"),n=null,p=0;p<s.block.trips.length;p+=1)if(s.block.trips[p]in e._.trip){for(a=e._.trip[s.block.trips[p]].stops.slice().sort(function(e,t){return e[0]-t[0]}),n=[],g=0;g<a.length;g+=1)n.push(a[g][1]);if(n.join(":")!==d){n=null;break}}if(null!==n)return!0}return!(5>r.length)&&!!(200<o(e.aquius.node[r[1]][1],e.aquius.node[r[1]][0],e.aquius.node[r[r.length-2]][1],e.aquius.node[r[r.length-2]][0]))}function s(e,t){var s,r;if(1===e.length&&e.length===t.length)return[e[0]+t[0]];for(s=[],r=0;r<e.length;r+=1)r<t.length&&s.push(e[r]+t[r]);return s}function r(e,t){var s,r;if(e===t)return e;for(s=[],r=0;r<e.length&&!(r>t.length);r+=1)0===t[r]?s.push(e[r]):0===e[r]?s.push(t[r]):s.push(Math.round((e[r]+t[r])/2));return s}var n,a,d,p,g,u,c,f,_,h,m,y,w,H,v,q,I,b,S,x,C,F,U,O={},L={};for(S=Object.keys(e._.trip),x=0;x<S.length;x+=1)if(q=e._.trip[S[x]].route_id,!1==S[x]in L&&q in e._.routes&&"product"in e._.routes[q]){if(f=!1,w=[],y={},u=[],e._.trip[S[x]].stops.sort(function(e,t){return e[0]-t[0]}),v={},"reference"in e._.routes[q]&&!1==e._.routes[q].reference.slug in v&&(v[e._.routes[q].reference.slug]=e._.routes[q].reference),"reference"in e._.trip[S[x]]&&!1==e._.trip[S[x]].reference.slug in v&&(v[e._.trip[S[x]].reference.slug]=e._.trip[S[x]].reference),"block"in e._.trip[S[x]]&&1<e._.trip[S[x]].block.trips.length&&(0===e.config.isCircular.length||!1==q in e._.circular)){for(m=[],C=0;C<e._.trip[S[x]].block.trips.length;C+=1)if(!1==e._.trip[S[x]].block.trips[C]in L&&e._.trip[S[x]].block.trips[C]in e._.trip&&e._.trip[e._.trip[S[x]].block.trips[C]].service.join(":")===e._.trip[S[x]].service.join(":")&&e._.trip[e._.trip[S[x]].block.trips[C]].route_id in e._.routes&&e._.routes[e._.trip[e._.trip[S[x]].block.trips[C]].route_id].product===e._.routes[q].product&&"start"in e._.trip[e._.trip[S[x]].block.trips[C]]&&"end"in e._.trip[e._.trip[S[x]].block.trips[C]]){for(I=e._.trip[e._.trip[S[x]].block.trips[C]].stops.sort(function(e,t){return e[0]-t[0]}),p=[],d=[],F=0;F<I.length;F+=1)p.push(I[F][1]),d.push(I[F][2]);m.push([(e._.trip[e._.trip[S[x]].block.trips[C]].start+e._.trip[e._.trip[S[x]].block.trips[C]].end)/2,p,e._.trip[S[x]].block.trips[C],d])}if(1<m.length)for(m.sort(function(e,t){return e[0]-t[0]}),C=0;C<m.length;C+=1)if(0<m[C][1].length&&(0<w.length&&m[C][1][0]===w[w.length-1]&&(m[C][1]=m[C][1].slice(1),m[C][3]=m[C][3].slice(1)),w=w.concat(m[C][1]),u=u.concat(m[C][3]),m[C][2]!==S[x])){for(L[m[C][2]]="",g=["t","setdown","pickup"],F=0;F<g.length;F+=1)if(g[F]in e._.trip[m[C][2]])for(!1==(g[F]in e._.trip[S[x]])&&(e._.trip[S[x]][g[F]]=[]),U=0;U<e._.trip[m[C][2]][g[F]].length;U+=1)-1===e._.trip[S[x]][g[F]].indexOf(e._.trip[m[C][2]][g[F]][U])&&e._.trip[S[x]][g[F]].push(e._.trip[m[C][2]][g[F]][U]);e._.trip[m[C][2]].route_id in e._.routes&&"reference"in e._.routes[e._.trip[m[C][2]].route_id]&&!1==e._.routes[e._.trip[m[C][2]].route_id].reference.slug in v&&(v[e._.routes[e._.trip[m[C][2]].route_id].reference.slug]=e._.routes[e._.trip[m[C][2]].route_id].reference),"reference"in e._.trip[m[C][2]]&&!1==e._.trip[m[C][2]].reference.slug in v&&(v[e._.trip[m[C][2]].reference.slug]=e._.trip[m[C][2]].reference)}}for(c="f"+e._.routes[q].product,e.config.mirrorLink&&(a="f"+e._.routes[q].product),("setdown"in e._.trip[S[x]])&&0<e._.trip[S[x]].setdown.length&&(e._.trip[S[x]].setdown.sort(),c+="s"+e._.trip[S[x]].setdown.join(":")),("pickup"in e._.trip[S[x]])&&0<e._.trip[S[x]].pickup.length&&(e._.trip[S[x]].pickup.sort(),c+="u"+e._.trip[S[x]].pickup.join(":"),e.config.mirrorLink&&(a+="s"+e._.trip[S[x]].pickup.join(":"))),e.config.mirrorLink&&("setdown"in e._.trip[S[x]])&&0<e._.trip[S[x]].setdown.length&&(a+="u"+e._.trip[S[x]].setdown.join(":")),("t"in e._.trip[S[x]])&&(c+="t"+e._.trip[S[x]].t.join(":"),e.config.mirrorLink&&(a+="t"+e._.trip[S[x]].t.join(":"))),n=0===w.length,C=0;C<e._.trip[S[x]].stops.length;C+=1)n&&(w.push(e._.trip[S[x]].stops[C][1]),u.push(e._.trip[S[x]].stops[C][2])),e._.trip[S[x]].stops[C][1]in y?y[e._.trip[S[x]].stops[C][1]]+=1:y[e._.trip[S[x]].stops[C][1]]=1;if(e.config.mirrorLink&&(a=w.slice().reverse().join(":")+a),c=w.join(":")+c,c in O&&!1=="b"in e._.trip[S[x]])O[c].service=s(O[c].service,e._.trip[S[x]].service),"minutes"in O[c]&&"minutes"in e._.trip[S[x]]&&(O[c].minutes=r(O[c].minutes,e._.trip[S[x]].minutes)),"dwells"in O[c]&&(O[c].dwells=r(O[c].dwells,u));else if(e.config.mirrorLink&&a in O&&!1=="b"in e._.trip[S[x]])f=!0,O[a].service=s(O[a].service,e._.trip[S[x]].service),"minutes"in O[a]&&"minutes"in e._.trip[S[x]]&&(O[a].minutes=r(O[a].minutes,e._.trip[S[x]].minutes)),"dwells"in O[a]&&(O[a].dwells=r(O[a].dwells,u)),"direction"in O[a]&&delete O[a].direction;else{if(O[c]={direction:1,product:e._.routes[q].product,route:w,service:e._.trip[S[x]].service,dwells:u},"minutes"in e._.trip[S[x]]&&(O[c].minutes=e._.trip[S[x]].minutes),"setdown"in e._.trip[S[x]]){for(H=[],C=0;C<e._.trip[S[x]].setdown.length;C+=1)e._.trip[S[x]].setdown[C]in y&&1===y[e._.trip[S[x]].setdown[C]]&&H.push(e._.trip[S[x]].setdown[C]);0<H.length&&(O[c].setdown=H)}if("pickup"in e._.trip[S[x]]){for(H=[],C=0;C<e._.trip[S[x]].pickup.length;C+=1)e._.trip[S[x]].pickup[C]in y&&1===y[e._.trip[S[x]].pickup[C]]&&H.push(e._.trip[S[x]].pickup[C]);0<H.length&&(O[c].pickup=H)}if(t(e,q,e._.trip[S[x]],w)&&(O[c].circular=1),"b"in e._.trip[S[x]]&&(O[c].b=e._.trip[S[x]].b),"t"in e._.trip[S[x]]){for(H=[],C=0;C<e._.trip[S[x]].t.length;C+=1)e._.trip[S[x]].t[C]in y&&1===y[e._.trip[S[x]].t[C]]&&H.push(e._.trip[S[x]].t[C]);0<H.length&&(O[c].t=H)}}if(_=Object.keys(v),0<_.length)for(f&&!1==("reference"in O[a])&&(O[a].reference=[],O[a].referenceLookup={}),!1==f&&!1==("reference"in O[c])&&(O[c].reference=[],O[c].referenceLookup={}),C=0;C<_.length;C+=1)f&&!1==_[C]in O[a].referenceLookup&&(O[a].reference.push(v[_[C]]),O[a].referenceLookup[_[C]]=""),!1===f&&!1==_[C]in O[c].referenceLookup&&(O[c].reference.push(v[_[C]]),O[c].referenceLookup[_[C]]="")}for(delete e._.nodeLookup,delete e._.routes,delete e._.trip,e.aquius.link=[],e.summary.network=[],x=0;x<e.aquius.network.length;x+=1)if("service"in e.aquius)for(e.summary.network.push([]),C=0;C<e.aquius.service.length;C+=1)e.summary.network[x].push(0);else e.summary.network.push([0]);for(_=Object.keys(O),x=0;x<_.length;x+=1){for(b=O[_[x]],C=0;C<b.service.length;C+=1){for(F=0;F<e.aquius.network.length;F+=1)-1!==e.aquius.network[F][0].indexOf(b.product)&&(e.summary.network[F][C]+=b.service[C]);b.service[C]=10>b.service[C]?parseFloat(b.service[C].toPrecision(1)):parseInt(b.service[C],10)}if(!1===e.config.allowWaypoint&&"pickup"in b&&"setdown"in b)for(C=b.pickup.length-1;0<=C;C--)if(g=b.setdown.indexOf(b.pickup[C]),-1!==g){for(F=b.route.length-1;0<=F;F--)b.route[F]===b.pickup[C]&&b.route.splice(F,1);b.pickup.splice(C,1),b.setdown.splice(g,1)}if(h=[[b.product],b.service,b.route,{}],"reference"in b){for(C=0;C<b.reference.length;C+=1)delete b.reference[C].slug;h[3].r=b.reference}"color"in b&&(h[3].o=b.color),"circular"in b&&(h[3].c=1),"direction"in b&&(h[3].d=1),"pickup"in b&&(h[3].u=b.pickup),"setdown"in b&&(h[3].s=b.setdown),"t"in b&&(h[3].t=b.t),"b"in b&&(h[3].b=b.b),"minutes"in b&&(h[3].m=b.minutes),e.config.allowDwell&&"dwells"in b&&(h[3].w=b.dwells),e.aquius.link.push(h)}for(e.aquius.link.sort(function(e,t){return t[1].reduce(function(e,t){return e+t},0)-e[1].reduce(function(e,t){return e+t},0)}),x=0;x<e.summary.network.length;x+=1)for(C=0;C<e.summary.network[x].length;C+=1)e.summary.network[x][C]=Math.round(e.summary.network[x][C]);return delete e._.dayFactor,e}function E(e){var t,s,r,o,n,a,d={};for(n=0;n<e.aquius.link.length;n+=1)for(o=e.aquius.link[n][2],("u"in e.aquius.link[n][3])&&(o=o.concat(e.aquius.link[n][3].u)),("s"in e.aquius.link[n][3])&&(o=o.concat(e.aquius.link[n][3].s)),("t"in e.aquius.link[n][3])&&(o=o.concat(e.aquius.link[n][3].t)),a=0;a<o.length;a+=1)!1==o[a]in d?d[o[a]]=1:d[o[a]]+=1;for(o=[],t=Object.keys(d),n=0;n<t.length;n+=1)o.push([d[t[n]],t[n]]);for(o.sort(function(e,t){return e[0]-t[0]}),o.reverse(),s=[],r={},n=0;n<o.length;n+=1)s.push(e.aquius.node[o[n][1]]),r[o[n][1]]=n;for(e.aquius.node=s,n=0;n<e.aquius.link.length;n+=1){for(a=0;a<e.aquius.link[n][2].length;a+=1)e.aquius.link[n][2][a]=r[e.aquius.link[n][2][a]];if("u"in e.aquius.link[n][3])for(a=0;a<e.aquius.link[n][3].u.length;a+=1)e.aquius.link[n][3].u[a]=r[e.aquius.link[n][3].u[a]];if("s"in e.aquius.link[n][3])for(a=0;a<e.aquius.link[n][3].s.length;a+=1)e.aquius.link[n][3].s[a]=r[e.aquius.link[n][3].s[a]];if("t"in e.aquius.link[n][3])for(a=0;a<e.aquius.link[n][3].t.length;a+=1)e.aquius.link[n][3].t[a]=r[e.aquius.link[n][3].t[a]]}return e}function D(e,t,s){function r(e,t,s){var r,o,n,a,d,p,g,u,c;if(Array.isArray(s))for(g=0;g<s.length;g+=1)if(Array.isArray(s[g])){for(r=!1,u=0,c=s[g].length-1;u<s[g].length;c=u++)n=s[g][u][0],d=s[g][u][1],a=s[g][c][0],p=s[g][c][1],o=d>t!=p>t&&e<(a-n)*(t-d)/(p-d)+n,o&&(r=!r);if(r&&0===g&&1===s.length)return!0;if(!1===r&&0===g)return!1;if(r&&0<g)return!1;if(g===s.length-1)return!0}return!1}var o;if(!1=="geometry"in s||!1=="type"in s.geometry||!1=="coordinates"in s.geometry||!Array.isArray(s.geometry.coordinates))return!1;if("MultiPolygon"===s.geometry.type)for(o=0;o<s.geometry.coordinates.length;o+=1)if(r(e,t,s.geometry.coordinates[o]))return!0;return"Polygon"===s.geometry.type&&r(e,t,s.geometry.coordinates)}function N(e){function t(e,t){var s,r;if(Array.isArray(e))for(s=0;s<e.length;s+=1)if(Array.isArray(e[s]))for(r=0;r<e[s].length;r+=1)Array.isArray(e[s][r])&&2===e[s][r].length&&(!1=="maxX"in t?(t.maxX=e[s][r][0],t.minX=e[s][r][0],t.maxY=e[s][r][1],t.minY=e[s][r][1]):(e[s][r][0]>t.maxX?t.maxX=e[s][r][0]:e[s][r][0]<t.minX&&(t.minX=e[s][r][0]),e[s][r][1]>t.maxY?t.maxY=e[s][r][1]:e[s][r][1]<t.minY&&(t.minY=e[s][r][1])));return t}var s,r={};if("geometry"in e&&"type"in e.geometry&&"coordinates"in e.geometry&&Array.isArray(e.geometry.coordinates)){if("MultiPolygon"===e.geometry.type)for(s=0;s<e.geometry.coordinates.length;s+=1)r=t(e.geometry.coordinates[s],r);"Polygon"===e.geometry.type&&(r=t(e.geometry.coordinates,r))}return"maxX"in r?[(r.maxX+r.minX)/2,(r.maxY+r.minY)/2]:null}function R(e,t){var s,r,n,a,d,p,g,u,c,l,f,_,h,m,y={},k={},w=[],H=[],v=-1,q=Math.pow(10,e.config.coordinatePrecision),I=0,b={},S={},x=0,C={};if(e.aquius.place=[],"object"==typeof t&&"geojson"in t&&"type"in t.geojson&&"FeatureCollection"===t.geojson.type&&"features"in t.geojson&&Array.isArray(t.geojson.features)&&0<t.geojson.features.length){for(h=0;h<t.geojson.features.length;h+=1)s=N(t.geojson.features[h]),null!==s&&(w.push(h),k[h]={x:Math.round(s[0]*q)/q,y:Math.round(s[1]*q)/q},y[k[h].x+":"+k[h].y]=h);for(h=0;h<e.aquius.node.length;h+=1)H.push([e.aquius.node[h][0]+e.aquius.node[h][1],h]);for(H.sort(),h=0;h<H.length;h+=1){if(v=-1,l=e.aquius.node[H[h][1]],p=l[0]+":"+l[1],p in e.config.nodeGeojson&&e.config.nodeGeojson[p]in y&&(v=y[e.config.nodeGeojson[p]]),-1===v&&D(l[0],l[1],t.geojson.features[I])&&(v=I),-1===v){for(r={},r[I]=I,m=0;m<w.length;m+=1)if(_=Math.abs(l[0]+l[1]-(k[w[m]].x+k[w[m]].y)),0===m&&(u=_),u>=_&&!1==w[m]in r){if(D(l[0],l[1],t.geojson.features[w[m]])){v=w[m];break}r[w[m]]=w[m],5>Object.keys(r).length&&(u=_)}if(-1===v)for(m=0;m<t.geojson.features.length;m+=1)if(!1==m in r&&D(l[0],l[1],t.geojson.features[m])){v=m;break}if(-1===v&&!1===e.config.inGeojson)for(c=-1,m=0;m<w.length;m+=1)a=o(l[1],l[0],k[w[m]].y,k[w[m]].x),(-1===c||a<c)&&(c=a,v=m)}-1===v?!0===e.config.inGeojson&&(C[H[h][1]]=""):(I=v,v in S?e.aquius.node[H[h][1]][2].p=S[v]:v in k&&(p=[k[v].x,k[v].y].join(":"),p in b?d=b[p]:(e.aquius.place.push([k[v].x,k[v].y,{}]),d=e.aquius.place.length-1,b[p]=d),e.aquius.node[H[h][1]][2].p=d,S[v]=d,"properties"in t.geojson.features[v]&&e.config.populationProperty in t.geojson.features[v].properties&&(f=parseFloat(t.geojson.features[v].properties[e.config.populationProperty]),!Number.isNaN(f)&&(!1=="p"in e.aquius.place[d][2]&&(e.aquius.place[d][2].p=0),e.aquius.place[d][2].p+=f,e.aquius.place[d][2].p>x&&(x=e.aquius.place[d][2].p))),"properties"in t.geojson.features[v]&&e.config.placeNameProperty in t.geojson.features[v].properties&&null!==t.geojson.features[v].properties[e.config.placeNameProperty]&&(n={},n.n=t.geojson.features[v].properties[e.config.placeNameProperty].trim(),""!==n.n&&(!1=="r"in e.aquius.place[d][2]&&(e.aquius.place[d][2].r=[]),e.aquius.place[d][2].r.push(n)))),v in k&&(e.config.nodeGeojson[l[0]+":"+l[1]]=k[v].x+":"+k[v].y))}if(0<x&&!1=="placeScale"in e.config.option&&(e.config.option.placeScale=Math.round(1e5*(1/(x/2e6)))/1e5,!1=="option"in e.aquius&&(e.aquius.option={}),e.aquius.option.placeScale=e.config.option.placeScale),0<Object.keys(C).length)for(g=Object.keys(e._.nodeLookup),h=0;h<g.length;h+=1)e._.nodeLookup[g[h]]in C&&delete e._.nodeLookup[g[h]]}return e}function T(e){var t,s,r,o,n,a;if(!0===e.config.stopPlace&&"place"in e.aquius){for(r={},t=Object.keys(e._.nodeLookup),o=0;o<t.length;o+=1)!1==e._.nodeLookup[t[o]]in r&&(r[e._.nodeLookup[t[o]]]=[]),r[e._.nodeLookup[t[o]]].push(t[o]);for(o=0;o<e.aquius.place.length;o+=1)for(s=-1,n=0;n<e.aquius.node.length;n+=1)if("p"in e.aquius.node[n][2]&&e.aquius.node[n][2].p===o)if(-1===s)e.aquius.node[n][0]=e.aquius.place[o][0],e.aquius.node[n][1]=e.aquius.place[o][1],"r"in e.aquius.place[o][2]?e.aquius.node[n][2].r=e.aquius.place[o][2].r:"r"in e.aquius.node[n][2]&&delete e.aquius.node[n][2].r,s=n;else if(n in r)for(a=0;a<r[n].length;a+=1)e._.nodeLookup[r[n][a]]=s}return e}function A(e){let t,s,r;if("stopOverride"in e.config){for(t=Object.keys(e.config.stopOverride),s=[],r=0;r<t.length;r+=1)"x"in e.config.stopOverride[t[r]]&&0===e.config.stopOverride[t[r]].x&&"y"in e.config.stopOverride[t[r]]&&0===e.config.stopOverride[t[r]].y&&s.push(t[r]);0<s.length&&(!1=="warning"in e&&(e.warning=[]),e.warning.push("Caution: Contains "+s.length.toString()+" stop_id with coordinates 0,0, which can be corrected in config.stopOverride, or ignored by setting config.allowZeroCoordinate to false."))}return e}function G(e,t){if("aquius"in e&&"network"in e.aquius&&"summary"in e&&"network"in e.summary){let s,r,o,n,a;if(n="_vars"in t&&"configId"in t._vars?t._vars.configId:"",o=["Network"],r=[n+"Text"],!1=="service"in e.aquius||0===e.aquius.service.length)o.push("Service"),r.push(n+"Number");else for(a=0;a<e.aquius.service.length;a+=1)"en-US"in e.aquius.service[a][1]?o.push(e.aquius.service[a][1]["en-US"]):o.push(JSON.stringify(e.aquius.service[a][1])),r.push(n+"Number");for(s=[],a=0;a<e.summary.network.length;a+=1)"en-US"in e.aquius.network[a][1]?s.push([e.aquius.network[a][1]["en-US"]].concat(e.summary.network[a])):s.push([JSON.stringify(e.aquius.network[a][1])].concat(e.summary.network[a]));e.networkTable={data:s,format:r,header:o}}return e}function M(e,t){if("summary"in e&&"service"in e.summary&&0<e.summary.service.length){let s,r,o,n,a,d,i;if(a="_vars"in t&&"configId"in t._vars?t._vars.configId:"",o=["Hour"],r=[a+"Number"],!1=="service"in e.aquius||0===e.aquius.service.length)o.push("All"),r.push(a+"Number");else for(d=0;d<e.aquius.service.length;d+=1)"en-US"in e.aquius.service[d][1]?o.push(e.aquius.service[d][1]["en-US"]):o.push(JSON.stringify(e.aquius.service[d][1])),r.push(a+"Number");for(s=[],d=0;d<e.summary.service.length;d+=1){if(n=[d],void 0!==e.summary.service[d])for(i=0;i<e.summary.service[d].length;i+=1)0<e.summary.service[d][i]?n.push((100*e.summary.service[d][i]).toFixed(2)):n.push("-");else if(!1=="service"in e.aquius||0===e.aquius.service.length)n.push("-");else for(i=0;i<e.aquius.service.length;i+=1)n.push("-");s.push(n)}e.summaryTable={data:s,format:r,header:o}}return e}function B(e,t){var i;return delete e._,delete e.gtfs,delete e.gtfsHead,"object"==typeof t&&"callback"in t?("error"in e&&(i=new Error(e.error.join(". "))),t.callback(i,e,t),!0):e}var X={_:{},aquius:{},config:{},summary:{}};return(X=n(X,t),X=d(X,e),e=null,"error"in X)?B(X,t):(X=p(X),X=g(X),X=u(X),X=h(X),X=m(X),X=y(X),X=k(X),X=R(X,t),X=T(X),X=v(X),X=b(X),X=S(X),X=x(X),X=O(X),X=L(X),X=P(X),X=E(X),X=A(X),X=M(X,t),X=G(X,t),B(X,t))}};try{module.exports={gtfsToAquius}}catch{}