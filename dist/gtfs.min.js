var gtfsToAquius=gtfsToAquius||{init:function(e){"use strict";function t(e,t,n){var r,i,o,s=document.createElement(e);if(void 0!==t)for(r=Object.keys(t),o=0;o<r.length;o+=1)s[r[o]]=t[r[o]];if(void 0!==n)for(i=Object.keys(n),o=0;o<i.length;o+=1)s.style[i[o]]=n[i[o]];return s}function n(e,n,r,i){var o,s,a,f,u,d=t("table");if(void 0!==i&&d.appendChild(t("caption",{textContent:i})),n.length>0){for(a=t("tr"),f=0;f<n.length;f+=1)"object"==typeof n[f]?((s=t("th")).appendChild(n[f]),a.appendChild(s)):a.appendChild(t("th",{textContent:n[f].toString()}));d.appendChild(a)}for(f=0;f<e.length;f+=1){for(a=t("tr"),u=0;u<e[f].length;u+=1)"object"==typeof e[f][u]?(o=t("td")).appendChild(e[f][u]):o=t("td",{textContent:e[f][u].toString()}),void 0!==r&&r.length>u&&(o.className=r[u]),a.appendChild(o);d.appendChild(a)}return d}function r(e,r,o){var s,a,f,u,d,p,c,g,l,_=o._vars,h=document.getElementById(_.configId+"ImportFiles"),y=document.getElementById(_.configId+"Output"),m=document.getElementById(_.configId+"Progress");if(void 0!==e)return i(e,_),!1;if(!y||!m)return!1;for(;y.firstChild;)y.removeChild(y.firstChild);for(;m.firstChild;)m.removeChild(m.firstChild);for(null!==h&&(h.disabled=!1),y.className="",a=["aquius","config"],g=0;g<a.length;g+=1)a[g]in r&&Object.keys(r[a[g]]).length>0&&m.appendChild(t("a",{className:_.configId+"Download",href:window.URL.createObjectURL(new Blob([JSON.stringify(r[a[g]])],{type:"application/json;charset=utf-8"})),download:a[g]+".json",textContent:"Save "+a[g]+".json",role:"button"}));if(s="aquius"in r&&"translation"in r.aquius&&"en-US"in r.aquius.translation&&"link"in r.aquius.translation["en-US"]?r.aquius.translation["en-US"].link:"Services","undefined"!=typeof aquius&&"aquius"in r&&(y.appendChild(t("div",{id:_.configId+"Map"},{height:document.documentElement.clientHeight/2+"px"})),aquius.init(_.configId+"Map",{dataObject:r.aquius,uiStore:!1})),"config"in r&&"stopOverride"in r.config){for(a=Object.keys(r.config.stopOverride),c=[],g=0;g<a.length;g+=1)"x"in r.config.stopOverride[a[g]]&&0===r.config.stopOverride[a[g]].x&&"y"in r.config.stopOverride[a[g]]&&0===r.config.stopOverride[a[g]].y&&c.push(a[g]);c.length>0&&y.appendChild(t("p",{textContent:"Caution: Contains "+c.length.toString()+" stop_id with coordinates 0,0, which can be corrected in config.stopOverride."}))}if("aquius"in r&&"network"in r.aquius&&"summary"in r&&"network"in r.summary){if(d=["Network"],u=[_.configId+"Text"],"service"in r.aquius==!1||0===r.aquius.service.length)d.push("Service"),u.push(_.configId+"Number");else for(g=0;g<r.aquius.service.length;g+=1)"en-US"in r.aquius.service[g][1]?d.push(r.aquius.service[g][1]["en-US"]):d.push(JSON.stringify(r.aquius.service[g][1])),u.push(_.configId+"Number");for(f=[],g=0;g<r.summary.network.length;g+=1)"en-US"in r.aquius.network[g][1]?f.push([r.aquius.network[g][1]["en-US"]].concat(r.summary.network[g])):f.push([JSON.stringify(r.aquius.network[g][1])].concat(r.summary.network[g]));y.appendChild(n(f,d,u,s+" by Network"))}if("summary"in r&&"service"in r.summary&&r.summary.service.length>0){if(d=["Hour"],u=[_.configId+"Text"],"service"in r.aquius==!1||0===r.aquius.service.length)d.push("All"),u.push(_.configId+"Number");else for(g=0;g<r.aquius.service.length;g+=1)"en-US"in r.aquius.service[g][1]?d.push(r.aquius.service[g][1]["en-US"]):d.push(JSON.stringify(r.aquius.service[g][1])),u.push(_.configId+"Number");for(f=[],g=0;g<r.summary.service.length;g+=1){if(p=[g],void 0===r.summary.service[g])if("service"in r.aquius==!1||0===r.aquius.service.length)p.push("-");else for(l=0;l<r.aquius.service.length;l+=1)p.push("-");else for(l=0;l<r.summary.service[g].length;l+=1)r.summary.service[g][l]>0?p.push((100*r.summary.service[g][l]).toFixed(2)):p.push("-");f.push(p)}y.appendChild(n(f,d,u,s+" % by Hour (scheduled only)"))}}function i(e,n){var r,i=document.getElementById(n.configId+"ImportFiles"),o=document.getElementById(n.configId+"Output"),s=document.getElementById(n.configId+"Progress");if(void 0!==e&&null!==o){for(;o.firstChild;)o.removeChild(o.firstChild);if(o.className=n.configId+"OutputError",r="message"in e?e.message:JSON.stringify(e),o.appendChild(t("p",{textContent:"Error: "+r})),null!==s){for(;s.firstChild;)s.removeChild(s.firstChild);s.textContent="Failed"}null!==i&&(i.disabled=!1)}}return function(e,n,r){var i,o,s,a=document.getElementById(e.configId);if(!a)return!1;for(;a.firstChild;)a.removeChild(a.firstChild);return Object.keys&&[].indexOf&&"object"==typeof JSON&&window.File&&window.FileReader&&window.Blob?(document.head.appendChild(t("script",{src:"https://timhowgego.github.io/Aquius/dist/aquius.min.js",type:"text/javascript"})),o=t("form",{className:e.configId+"Input"}),s=t("label",{textContent:r}),(i=t("input",{id:e.configId+"ImportFiles",multiple:"multiple",name:e.configId+"ImportFiles[]",type:"file"})).addEventListener("change",function(){n(e)},!1),s.appendChild(i),o.appendChild(s),o.appendChild(t("span",{id:e.configId+"Progress"})),a.appendChild(o),a.appendChild(t("div",{id:e.configId+"Output"})),!0):(a.appendChild(document.createTextNode("Browser not supported: Try a modern browser")),!1)}({configId:e,process:this.process},function(e){var t,n={},o={},s=document.getElementById(e.configId+"ImportFiles"),a={_vars:e,callback:r},f=0,u=document.getElementById(e.configId+"Progress"),d=0;function p(t,r,s){var u,p,c,g,l;if((u=t.toLowerCase().split(".")).length>1&&"txt"===u[u.length-1]?((c=u.slice(0,u.length-1).join("."))in n==0&&(n[c]=[]),n[c][r]=s):((c=u.join("."))in o==0&&(o[c]=[]),o[c][r]=s),(f+=1)===d){for(g=Object.keys(o),l=0;l<g.length;l+=1)try{"type"in(p=JSON.parse(o[g[l]].join("")))&&"FeatureCollection"===p.type?a.geojson=p:a.config=p}catch(t){t instanceof SyntaxError==0&&i(t,e)}e.process(n,a)}}if(null!==s&&s.files.length>0){if(s.disabled=!0,null!==u){for(;u.firstChild;)u.removeChild(u.firstChild);u.textContent="Working..."}!function(n){var r,o,s,a=1e8,f=[];for(s=0;s<n.length;s+=1)for(o=0;n[s].size>=o;)f.push([n[s],parseInt(o/a,10)]),o+=a;for(d=f.length,s=0;s<d;s+=1)(t=new FileReader).onerror=function(n,r){i(new Error("Could not read "+r[0].name),e),t.abort()},t.onload=function(t){return function(){try{p(t[0].name,t[1],this.result)}catch(t){i(t,e)}}}(f[s]),r=f[s][0].slice(f[s][1]*a,f[s][1]*a+a),t.readAsText(r)}(s.files)}},"GTFS as .txt, optional config, and optional GeoJSON to process:")},process:function(e,t){"use strict";var n={_:{},aquius:{},config:{},summary:{}};function r(e){var t=new Date(e),n=t.getFullYear().toString();return t.getMonth()<9&&(n+="0"),n+=(t.getMonth()+1).toString(),t.getDate()<10&&(n+="0"),n+=t.getDate().toString()}function i(e){return e.length<8?0:Date.UTC(e.slice(0,4),e.slice(4,6)-1,e.slice(6,8))}function o(e,t,n){var r,i,o,s,a,f,u,d=-1,p=new RegExp('(\\,|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^\\,\\r\\n]*))',"gi"),c=-1,g=[];function l(e,t,n,r,i){return t.length===r&&(-1!==i?(t[i]in e.gtfs[n]==!1&&(e.gtfs[n][t[i]]=[]),e.gtfs[n][t[i]].push(t)):e.gtfs[n].push(t)),e}for(Array.isArray(n)||(n=[n]),f=0;f<n.length;f+=1)for(s=p.exec(n[f]),i=g.length-1,r=!0;null!==s;){if(s[1].length&&","!==s[1]){if(f>0&&!0===r&&(g.length>d&&i<g.length-1&&((a=g.slice(0,i)).push(g[i]+g[i+1]),g=a.concat(g.slice(i+2))),r=!1),-1===d){for(d=g.length,u=0;u<g.length;u+=1)g[u]in e.gtfsHead[t]&&(e.gtfsHead[t][g[u]]=u);if(t in e.gtfsRequired)for(u=0;u<e.gtfsRequired[t].length;u+=1)if(-1===e.gtfsHead[t][e.gtfsRequired[t][u]])return"error"in e==!1&&(e.error=[]),e.error.push("Missing value "+e.gtfsRequired[t][u]+" in GTFS "+t+".txt"),e;if(t in e.gtfsIndex){if(-1===(c=e.gtfsHead[t][e.gtfsIndex[t]]))return"error"in e==!1&&(e.error=[]),e.error.push("Missing index value "+e.gtfsIndex[t]+" in GTFS "+t+".txt"),e;e.gtfs[t]={}}else e.gtfs[t]=[]}else e=l(e,g,t,d,c);g=[]}void 0===(o=s[2]?s[2].replace(new RegExp('""',"g"),'"'):s[3])&&(o=""),g.push(o.trim()),s=p.exec(n[f])}return e=l(e,g,t,d,c)}function s(e,t,n){return"reference"in e.aquius==!1&&(e.aquius.reference={}),t in e.aquius.reference==!1&&(e.aquius.reference[t]=[],e._[t]={}),n in e._[t]==!1&&(e.aquius.reference[t].push(n),e._[t][n]=e.aquius.reference[t].length-1),e}function a(e,t,n){var r,i,o,a,f={};function u(e,t){var n,r,i,o=Object.keys(e);for(r=0;r<t.length;r+=1){for(n=!0,i=0;i<o.length;i+=1)if(o[i]in t[r]==!1||t[r][o[i]]!==e[o[i]]){n=!1;break}if(!0===n)return!0}return!1}return!0===e.config.allowName&&(i="",t[e.gtfsHead.stops.stop_id]in e.config.stopOverride&&"stop_name"in e.config.stopOverride[t[e.gtfsHead.stops.stop_id]]?i=e.config.stopOverride[t[e.gtfsHead.stops.stop_id]].stop_name:-1!==e.gtfsHead.stops.stop_name&&(i=t[e.gtfsHead.stops.stop_name].trim()),""!==i&&(f.n=i)),!0===e.config.allowStopUrl&&(i="",t[e.gtfsHead.stops.stop_id]in e.config.stopOverride&&"stop_url"in e.config.stopOverride[t[e.gtfsHead.stops.stop_id]]?i=e.config.stopOverride[t[e.gtfsHead.stops.stop_id]].stop_url:-1!==e.gtfsHead.stops.stop_url&&(i=t[e.gtfsHead.stops.stop_url].trim()),""!==i&&(a="[*]",-1===(o=i.lastIndexOf(a))&&-1!==e.gtfsHead.stops.stop_code&&(r=t[e.gtfsHead.stops.stop_code].trim(),-1!==(o=i.lastIndexOf(r))&&(i=i.substring(0,o)+a+i.substring(o+r.length),f.i=r)),-1===o&&-1!==e.gtfsHead.stops.stop_id&&(r=t[e.gtfsHead.stops.stop_id].trim(),-1!==(o=i.lastIndexOf(r))&&(i=i.substring(0,o)+a+i.substring(o+r.length),f.i=r)),e=s(e,"url",i),f.u=e._.url[i])),Object.keys(f).length>0&&("r"in e.aquius.node[n][2]?!1===u(f,e.aquius.node[n][2].r)&&e.aquius.node[n][2].r.push(f):e.aquius.node[n][2].r=[f]),!0===e.config.allowCode&&(f={},t[e.gtfsHead.stops.stop_id]in e.config.stopOverride&&"stop_code"in e.config.stopOverride[t[e.gtfsHead.stops.stop_id]]?f.n=e.config.stopOverride[t[e.gtfsHead.stops.stop_id]].stop_code:-1!==e.gtfsHead.stops.stop_code&&(f.n=t[e.gtfsHead.stops.stop_code].trim()),"n"in f&&""!==f.n&&("r"in e.aquius.node[n][2]?!1===u(f,e.aquius.node[n][2].r)&&e.aquius.node[n][2].r.push(f):e.aquius.node[n][2].r=[f])),e}function f(e,t){var n=Math.pow(10,e.config.coordinatePrecision);function r(e,t){var n=parseFloat(e);return Number.isNaN(n)?0:Math.round(n*t)/t}return-1!==e.gtfsHead.stops.stop_id&&t[e.gtfsHead.stops.stop_id]in e.config.stopOverride&&"x"in e.config.stopOverride[t[e.gtfsHead.stops.stop_id]]&&"y"in e.config.stopOverride[t[e.gtfsHead.stops.stop_id]]?[r(e.config.stopOverride[t[e.gtfsHead.stops.stop_id]].x,n),r(e.config.stopOverride[t[e.gtfsHead.stops.stop_id]].y,n)]:-1!==e.gtfsHead.stops.stop_lat&&-1!==e.gtfsHead.stops.stop_lon?[r(t[e.gtfsHead.stops.stop_lon],n),r(t[e.gtfsHead.stops.stop_lat],n)]:[0,0]}function u(e,t,n){return 0===t[0]&&0===t[1]&&(n in e.config.stopOverride==!1&&(e.config.stopOverride[n]={}),e.config.stopOverride[n].x=0,e.config.stopOverride[n].y=0),e}function d(e){var t,n,r=e.split(":");if(3!==r.length)return 0;for(n=0;n<r.length;n+=1){if(t=parseInt(r[n],10),Number.isNaN(t))return 0;r[n]=t}return 3600*r[0]+60*r[1]+r[2]}function p(e,t,n){var r;function i(e,t,n){var r,i,o,s,a,f,u,d;if(Array.isArray(n))for(f=0;f<n.length;f+=1)if(Array.isArray(n[f])){for(r=!1,u=0,d=n[f].length-1;u<n[f].length;d=u++)i=n[f][u][0],s=n[f][u][1],o=n[f][d][0],s>t!=(a=n[f][d][1])>t&&e<(o-i)*(t-s)/(a-s)+i&&(r=!r);if(r)return!0}return!1}if("geometry"in n==!1||"type"in n.geometry==!1||"coordinates"in n.geometry==!1||!Array.isArray(n.geometry.coordinates))return!1;if("MultiPolygon"===n.geometry.type)for(r=0;r<n.geometry.coordinates.length;r+=1)if(i(e,t,n.geometry.coordinates[r]))return!0;return"Polygon"===n.geometry.type&&i(e,t,n.geometry.coordinates)}function c(e){var t,n={};function r(e,t){var n,r;if(Array.isArray(e))for(n=0;n<e.length;n+=1)if(Array.isArray(e[n]))for(r=0;r<e[n].length;r+=1)Array.isArray(e[n][r])&&2===e[n][r].length&&("maxX"in t==!1?(t.maxX=e[n][r][0],t.minX=e[n][r][0],t.maxY=e[n][r][1],t.minY=e[n][r][1]):(e[n][r][0]>t.maxX?t.maxX=e[n][r][0]:e[n][r][0]<t.minX&&(t.minX=e[n][r][0]),e[n][r][1]>t.maxY?t.maxY=e[n][r][1]:e[n][r][1]<t.minY&&(t.minY=e[n][r][1])));return t}if("geometry"in e&&"type"in e.geometry&&"coordinates"in e.geometry&&Array.isArray(e.geometry.coordinates)){if("MultiPolygon"===e.geometry.type)for(t=0;t<e.geometry.coordinates.length;t+=1)n=r(e.geometry.coordinates[t],n);"Polygon"===e.geometry.type&&(n=r(e.geometry.coordinates,n))}return"maxX"in n?[(n.maxX+n.minX)/2,(n.maxY+n.minY)/2]:null}function g(e,t){var n;return delete e._,delete e.gtfs,delete e.gtfsHead,"object"==typeof t&&"callback"in t?("error"in e&&(n=new Error(e.error.join(". "))),t.callback(n,e,t),!0):e}return n=function(e,t){var n,r;e.gtfsIndex={stop_times:"trip_id"},e.gtfsHead={agency:{agency_id:-1,agency_name:-1},calendar:{service_id:-1,monday:-1,tuesday:-1,wednesday:-1,thursday:-1,friday:-1,saturday:-1,sunday:-1,start_date:-1,end_date:-1},calendar_dates:{service_id:-1,date:-1,exception_type:-1},frequencies:{trip_id:-1,start_time:-1,end_time:-1,headway_secs:-1},routes:{agency_id:-1,route_color:-1,route_id:-1,route_long_name:-1,route_short_name:-1,route_text_color:-1,route_url:-1},stop_times:{arrival_time:-1,departure_time:-1,trip_id:-1,stop_id:-1,stop_sequence:-1,pickup_type:-1,drop_off_type:-1},stops:{stop_code:-1,stop_id:-1,stop_lat:-1,stop_lon:-1,stop_name:-1,stop_url:-1,location_type:-1,parent_station:-1},transfers:{from_stop_id:-1,to_stop_id:-1,transfer_type:-1},trips:{block_id:-1,direction_id:-1,route_id:-1,service_id:-1,trip_headsign:-1,trip_id:-1,trip_short_name:-1}},e.gtfsRequired={routes:["route_id"],stops:["stop_id","stop_lat","stop_lon"],trips:["route_id","service_id","trip_id"],stop_times:["trip_id","stop_id","stop_sequence"]},"type"in e.config.networkFilter&&"mode"===e.config.networkFilter.type&&(e.gtfsHead.routes.route_type=-1),"name"in e.config.meta!=0&&"en-US"in e.config.meta.name!=0||("feed_info"in e.gtfsHead==0&&(e.gtfsHead.feed_info={}),e.gtfsHead.feed_info.feed_publisher_name=-1),"url"in e.config.meta==0&&("feed_info"in e.gtfsHead==0&&(e.gtfsHead.feed_info={}),e.gtfsHead.feed_info.feed_publisher_url=-1),n=Object.keys(e.gtfsRequired);for(r=0;r<n.length;r+=1)if(n[r]in t==0)return"error"in e==0&&(e.error=[]),e.error.push("Missing GTFS "+n[r]+".txt"),e;for(e.gtfs={},n=Object.keys(e.gtfsHead),r=0;r<n.length;r+=1)n[r]in t&&(e=o(e,n[r],t[n[r]]));return e}(n=function(e,t){var n,i={allowCabotage:!1,allowCode:!0,allowColor:!0,allowDuplication:!1,allowHeadsign:!1,allowName:!0,allowRoute:!0,allowRouteUrl:!0,allowSplit:!1,allowStopUrl:!0,coordinatePrecision:5,duplicationRouteOnly:!0,fromDate:r(Date.now()),inGeojson:!0,isCircular:[],meta:{schema:"0"},mirrorLink:!0,networkFilter:{type:"agency"},option:{},populationProperty:"population",placeNameProperty:"name",productOverride:{},routeExclude:[],routeInclude:[],routeOverride:{},serviceFilter:{},servicePer:1,stopExclude:[],stopInclude:[],stopOverride:{},toDate:r(Date.now()+5184e5),translation:{}},o=Object.keys(i);for("object"!=typeof t&&(t={}),n=0;n<o.length;n+=1)"config"in t&&o[n]in t.config&&typeof t.config[o[n]]==typeof i[o[n]]?e.config[o[n]]=t.config[o[n]]:e.config[o[n]]=i[o[n]];for(e._.circular={},n=0;n<e.config.isCircular.length;n+=1)e._.circular[e.config.isCircular[n]]=e.config.isCircular[n];return e}(n,t),e),e=null,g("error"in n?n:n=function(e){var t,n,r,i,o,s,a={};for(o=0;o<e.aquius.link.length;o+=1){i=e.aquius.link[o][2],"u"in e.aquius.link[o][3]&&(i=i.concat(e.aquius.link[o][3].u)),"s"in e.aquius.link[o][3]&&(i=i.concat(e.aquius.link[o][3].s)),"t"in e.aquius.link[o][3]&&(i=i.concat(e.aquius.link[o][3].t));for(s=0;s<i.length;s+=1)i[s]in a==0?a[i[s]]=1:a[i[s]]+=1}for(i=[],t=Object.keys(a),o=0;o<t.length;o+=1)i.push([t[o],a[t[o]]]);for(i.sort(function(e,t){return e[1]-t[1]}),i.reverse(),n=[],r={},o=0;o<i.length;o+=1)n.push(e.aquius.node[i[o][0]]),r[i[o][0]]=o;for(e.aquius.node=n,o=0;o<e.aquius.link.length;o+=1){for(s=0;s<e.aquius.link[o][2].length;s+=1)e.aquius.link[o][2][s]=r[e.aquius.link[o][2][s]];if("u"in e.aquius.link[o][3])for(s=0;s<e.aquius.link[o][3].u.length;s+=1)e.aquius.link[o][3].u[s]=r[e.aquius.link[o][3].u[s]];if("s"in e.aquius.link[o][3])for(s=0;s<e.aquius.link[o][3].s.length;s+=1)e.aquius.link[o][3].s[s]=r[e.aquius.link[o][3].s[s]];if("t"in e.aquius.link[o][3])for(s=0;s<e.aquius.link[o][3].t.length;s+=1)e.aquius.link[o][3].t[s]=r[e.aquius.link[o][3].t[s]]}return e}(n=function(e){var t,n,r,i,o,s,a,f,u,d,p,c={},g={},l=0;function _(e,t,n,r){return e.config.isCircular.length>0?t in e._.circular:!(r.length<3||r[0]!==r[r.length-1])&&("block"in n&&n.block>1||!(r.length<5)&&(i=e.aquius.node[r[1]][1],o=e.aquius.node[r[1]][0],s=e.aquius.node[r[r.length-2]][1],a=e.aquius.node[r.length-2][0],f=Math.PI/180,u=Math.sin((s-i)*f/2),d=Math.sin((a-o)*f/2),p=u*u+Math.cos(i*f)*Math.cos(s*f)*d*d,2*Math.atan2(Math.sqrt(p),Math.sqrt(1-p))*6371e3>200));var i,o,s,a,f,u,d,p}function h(e,t){var n,r;if(1===e.length&&e.length===t.length)return[e[0]+t[0]];for(n=[],r=0;r<e.length;r+=1)r<t.length&&n.push(e[r]+t[r]);return n}for(f=Object.keys(e._.trip),u=0;u<f.length;u+=1)if((s=e._.trip[f[u]].route_id)in e._.routes){o=[],e._.trip[f[u]].stops.sort(function(e,t){return e[0]-t[0]}),n="f"+e._.routes[s].product,e.config.mirrorLink&&(t="f"+e._.routes[s].product),"setdown"in e._.trip[f[u]]&&e._.trip[f[u]].setdown.length>0&&(e._.trip[f[u]].setdown.sort(),n+="s"+e._.trip[f[u]].setdown.join(":")),"pickup"in e._.trip[f[u]]&&e._.trip[f[u]].pickup.length>0&&(e._.trip[f[u]].pickup.sort(),n+="u"+e._.trip[f[u]].pickup.join(":"),e.config.mirrorLink&&(t+="s"+e._.trip[f[u]].pickup.join(":"))),e.config.mirrorLink&&"setdown"in e._.trip[f[u]]&&e._.trip[f[u]].setdown.length>0&&(t+="u"+e._.trip[f[u]].setdown.join(":")),"t"in e._.trip[f[u]]&&(n+="t"+e._.trip[f[u]].t.join(":"),e.config.mirrorLink&&(t+="t"+e._.trip[f[u]].t.join(":")));for(d=0;d<e._.trip[f[u]].stops.length;d+=1)o.push(e._.trip[f[u]].stops[d][1]);e.config.mirrorLink&&(t=o.slice().reverse().join(":")+t),(n=o.join(":")+n)in c&&("b"in e._.trip[f[u]]==0||"b"in c[n])?(c[n].service=h(c[n].service,e._.trip[f[u]].service),"reference"in e._.routes[s]&&"referenceLookup"in c[n]&&e._.routes[s].reference.slug in c[n].referenceLookup==0&&(c[n].reference.push(e._.routes[s].reference),c[n].referenceLookup[e._.routes[s].reference.slug]=""),"reference"in e._.trip[f[u]]&&"referenceLookup"in c[n]&&e._.trip[f[u]].reference.slug in c[n].referenceLookup==0&&(c[n].reference.push(e._.trip[f[u]].reference),c[n].referenceLookup[e._.trip[f[u]].reference.slug]=""),"b"in e._.trip[f[u]]&&(g[e._.trip[f[u]].b]=c[n].b)):e.config.mirrorLink&&t in c&&("b"in e._.trip[f[u]]==0||"b"in c[t])?(c[t].service=h(c[t].service,e._.trip[f[u]].service),"reference"in e._.routes[s]&&"referenceLookup"in c[t]&&e._.routes[s].reference.slug in c[t].referenceLookup==0&&(c[t].reference.push(e._.routes[s].reference),c[t].referenceLookup[e._.routes[s].reference.slug]=""),"direction"in c[t]&&delete c[t].direction,"reference"in e._.trip[f[u]]&&"referenceLookup"in c[t]&&e._.trip[f[u]].reference.slug in c[t].referenceLookup==0&&(c[t].reference.push(e._.trip[f[u]].reference),c[t].referenceLookup[e._.trip[f[u]].reference.slug]=""),"b"in e._.trip[f[u]]&&(g[e._.trip[f[u]].b]=c[t].b)):(c[n]={direction:1,product:e._.routes[s].product,route:o,service:e._.trip[f[u]].service},("reference"in e._.routes[s]||"reference"in e._.trip[f[u]])&&(c[n].reference=[],c[n].referenceLookup={}),"reference"in e._.routes[s]&&"slug"in e._.routes[s].reference&&(c[n].reference.push(e._.routes[s].reference),c[n].referenceLookup[e._.routes[s].reference.slug]=""),"reference"in e._.trip[f[u]]&&"slug"in e._.trip[f[u]].reference&&(c[n].reference.push(e._.trip[f[u]].reference),c[n].referenceLookup[e._.trip[f[u]].reference.slug]=""),"setdown"in e._.trip[f[u]]&&e._.trip[f[u]].setdown.length>0&&(c[n].setdown=e._.trip[f[u]].setdown),"pickup"in e._.trip[f[u]]&&e._.trip[f[u]].pickup.length>0&&(c[n].pickup=e._.trip[f[u]].pickup),_(e,s,e._.trip[f[u]],o)&&(c[n].circular=1),"b"in e._.trip[f[u]]&&(e._.trip[f[u]].b in g?c[n].b=g[e._.trip[f[u]].b]:(g[e._.trip[f[u]].b]=l,c[n].b=l,l+=1)),"t"in e._.trip[f[u]]&&(c[n].t=e._.trip[f[u]].t))}for(delete e._.nodeLookup,delete e._.routes,delete e._.trip,e.aquius.link=[],e.summary.network=[],u=0;u<e.aquius.network.length;u+=1)if("service"in e.aquius)for(e.summary.network.push([]),d=0;d<e.aquius.service.length;d+=1)e.summary.network[u].push(0);else e.summary.network.push([0]);for(r=Object.keys(c),u=0;u<r.length;u+=1){for(a=c[r[u]],d=0;d<a.service.length;d+=1){for(p=0;p<e.aquius.network.length;p+=1)-1!==e.aquius.network[p][0].indexOf(a.product)&&(e.summary.network[p][d]+=a.service[d]);a.service[d]<10?a.service[d]=parseFloat(a.service[d].toPrecision(1)):a.service[d]=parseInt(a.service[d],10)}if(i=[[a.product],a.service,a.route,{}],"reference"in a){for(d=0;d<a.reference.length;d+=1)delete a.reference[d].slug;i[3].r=a.reference}"color"in a&&(i[3].o=a.color),"circular"in a&&(i[3].c=1),"direction"in a&&(i[3].d=1),"pickup"in a&&(i[3].u=a.pickup),"setdown"in a&&(i[3].s=a.setdown),"t"in a&&(i[3].t=a.t),"b"in a&&(a.b in g?i[3].b=g[a.b]:i[3].b=a.b),e.aquius.link.push(i)}for(e.aquius.link.sort(function(e,t){return t[1].reduce(function(e,t){return e+t},0)-e[1].reduce(function(e,t){return e+t},0)}),u=0;u<e.summary.network.length;u+=1)for(d=0;d<e.summary.network[u].length;d+=1)e.summary.network[u][d]=Math.round(e.summary.network[u][d]);return delete e._.dayFactor,e}(n=function(e){var t,n,r,i,o,a,f,u,d,p,c={},g={};if(e._.routes={},e.config.routeExclude.length>0)for(d=0;d<e.config.routeExclude.length;d+=1)c[e.config.routeExclude[d]]="";if(e.config.routeInclude.length>0)for(d=0;d<e.config.routeInclude.length;d+=1)g[e.config.routeInclude[d]]="";for(d=0;d<e.gtfs.routes.length;d+=1)if(f=(a=e.gtfs.routes[d])[e.gtfsHead.routes.route_id],!(0!==e.config.routeExclude.length&&f in c!=0||0!==e.config.routeInclude.length&&f in g!=1)){if(e._.routes[f]={},o={slug:""},i="agency"===e.config.networkFilter.type&&-1!==e.gtfsHead.routes.agency_id&&a[e.gtfsHead.routes.agency_id]in e.config.productOverride?e.config.productOverride[a[e.gtfsHead.routes.agency_id]]:"mode"===e.config.networkFilter.type&&-1!==e.gtfsHead.routes.route_type&&a[e.gtfsHead.routes.route_type]in e.config.productOverride?e.config.productOverride[a[e.gtfsHead.routes.route_type]]:{},!0===e.config.allowRoute&&(t="",f in e.config.routeOverride&&"route_short_name"in e.config.routeOverride[f]?t=e.config.routeOverride[f].route_short_name:(-1!==e.gtfsHead.routes.route_short_name&&(t=a[e.gtfsHead.routes.route_short_name].trim()),""===t&&-1!==e.gtfsHead.routes.route_long_name&&(t=a[e.gtfsHead.routes.route_long_name].trim())),""!==t&&(o.n=t,o.slug+=t)),!0===e.config.allowColor)for(n=[["route_color","c"],["route_text_color","t"]],p=0;p<n.length;p+=1)t="",f in e.config.routeOverride&&n[p][0]in e.config.routeOverride[f]?t=e.config.routeOverride[f][n[p][0]]:n[p][0]in i?t=i[n[p][0]]:-1!==e.gtfsHead.routes[n[p][0]]&&(t=a[e.gtfsHead.routes[n[p][0]]].trim()),6===t.length&&(e=s(e,"color",t="#"+t),o[n[p][1]]=e._.color[t],o.slug+=t);e.config.allowRouteUrl&&(t="",f in e.config.routeOverride&&"route_url"in e.config.routeOverride[f]?t=e.config.routeOverride[f].route_url:-1!==e.gtfsHead.routes.route_url&&(t=a[e.gtfsHead.routes.route_url].trim()),""!==t&&(u="[*]",-1===(r=t.lastIndexOf(u))&&"n"in o&&-1!==(r=t.lastIndexOf(o.n))&&(t=t.substring(0,r)+u+t.substring(r+o.n.length)),-1===r&&-1!==(r=t.lastIndexOf(f))&&(t=t.substring(0,r)+u+t.substring(r+f.length),o.i=f),e=s(e,"url",t),o.u=e._.url[t],o.slug+=t)),"agency"===e.config.networkFilter.type?"agency_id"in e.gtfsHead.routes&&-1!==e.gtfsHead.routes.agency_id?e._.routes[f].product=e._.productIndex[a[e.gtfsHead.routes.agency_id]]:e._.routes[f].product=0:"mode"===e.config.networkFilter.type&&"route_type"in e.gtfsHead.routes&&-1!==e.gtfsHead.routes.route_type?e._.routes[f].product=e._.productIndex[a[e.gtfsHead.routes.route_type]]:e._.routes[f].product=e._.productIndex[Object.keys(e._.productIndex)[0]],Object.keys(o).length>1&&(e._.routes[f].reference=o)}return delete e._.productIndex,e}(n=function(e){var t,n,r,i,o,s,a,f=function(e){var t,n,r,i,o=Object.keys(e._.calendarDay);if("serviceFilter"in e.config&&"period"in e.config.serviceFilter){for(t=[],n=0;n<e.config.serviceFilter.period.length;n+=1)if("day"in e.config.serviceFilter.period[n])for(t.push([]),r=0;r<e.config.serviceFilter.period[n].day.length;r+=1)for(i=0;i<o.length;i+=1)e._.calendarDay[o[i]]===e.config.serviceFilter.period[n].day[r]&&t[n].push(o[i]);else t.push(o);return t}return[o]}(e),u=function(e){var t,n,r;if("serviceFilter"in e.config&&"period"in e.config.serviceFilter){for(t=[],n=0;n<e.config.serviceFilter.period.length;n+=1)if("time"in e.config.serviceFilter.period[n])for(t.push([]),r=0;r<e.config.serviceFilter.period[n].time.length;r+=1)"start"in e.config.serviceFilter.period[n].time[r]?t[n].push([d(e.config.serviceFilter.period[n].time[r].start)]):t[n].push([0]),"end"in e.config.serviceFilter.period[n].time[r]&&t[n][r].push(d(e.config.serviceFilter.period[n].time[r].end));else t.push([[0]]);return t}return[[[0]]]}(e),p=Object.keys(e._.trip),c=[];for(o=0;o<u.length;o+=1)c.push(0);for(e.summary.service=[],o=0;o<p.length;o+=1)if(e._.trip[p[o]].stops.length<2||0===Object.keys(e._.trip[p[o]].calendar).length)delete e._.trip[p[o]];else{for(s=0;s<f.length;s+=1){for(t=0,a=0;a<f[s].length;a+=1)f[s][a]in e._.trip[p[o]].calendar&&(t+=1);e._.trip[p[o]].service.push(t/f[s].length*e.config.servicePer)}if("frequent"in e._.trip[p[o]]==0){i="start"in e._.trip[p[o]]&&"end"in e._.trip[p[o]]?(e._.trip[p[o]].end-e._.trip[p[o]].start)/2+e._.trip[p[o]].start:null;for(s=0;s<u.length;s+=1)if(s<e._.trip[p[o]].service.length&&0!==e._.trip[p[o]].service[s]){if(u[s].length>1||u[s][0].length>1||0!==u[s][0][0]){if(r=!1,null!==i)for(a=0;a<u[s].length;a+=1)if(i>u[s][a][0]&&(1===u[s][a].length||i<u[s][a][1])){r=!0;break}0==r&&(e._.trip[p[o]].service[s]=0)}else r=!0;if(r){if(c[s]=c[s]+1,n=Math.floor(i/3600),void 0===e.summary.service[n])for(e.summary.service[n]=[],a=0;a<u.length;a+=1)e.summary.service[n].push(0);e.summary.service[n][s]=e.summary.service[n][s]+1}}}}for(o=0;o<e.summary.service.length;o+=1)if(void 0!==e.summary.service[o])for(s=0;s<e.summary.service[o].length;s+=1)c[s]>0&&(e.summary.service[o][s]=e.summary.service[o][s]/c[s]);return e=function(e,t){var n,r,i,o,s,a,f,u,p,c,g;if("frequencies"in e.gtfs&&-1!==e.gtfsHead.frequencies.trip_id&&-1!==e.gtfsHead.frequencies.start_time&&-1!==e.gtfsHead.frequencies.end_time&&-1!==e.gtfsHead.frequencies.headway_secs){for(r={},f={},p=0;p<e.gtfs.frequencies.length;p+=1)if((u=(i=e.gtfs.frequencies[p])[e.gtfsHead.frequencies.trip_id])in e._.trip&&"frequent"in e._.trip[u]){if(u in r==0)for(r[u]=[],c=0;c<t.length;c+=1)r[u].push(0);i[e.gtfsHead.frequencies.start_time]in f==0&&(f[i[e.gtfsHead.frequencies.start_time]]=d(i[e.gtfsHead.frequencies.start_time])),a=f[i[e.gtfsHead.frequencies.start_time]],i[e.gtfsHead.frequencies.end_time]in f==0&&(f[i[e.gtfsHead.frequencies.end_time]]=d(i[e.gtfsHead.frequencies.end_time])),(n=f[i[e.gtfsHead.frequencies.end_time]])<a&&(n+=86400);for(c=0;c<t.length;c+=1)if(c<e._.trip[u].service.length&&0!==e._.trip[u].service[c])if(1===t[c].length&&1===t[c][0].length&&0===t[c][0][0])r[u][c]+=(n-a)/parseInt(i[e.gtfsHead.frequencies.headway_secs],10);else for(g=0;g<t[c].length;g+=1)t[c][g][0]<n&&(1===t[c][g].length||a<t[c][g][1])&&(s=1,t[c][g][0]>a&&(s-=(t[c][g][0]-a)/(n-a)),t[c][g][1]<n&&(s-=(n-t[c][g][1])/(n-a)),r[u][c]+=(n-a)*s/parseInt(i[e.gtfsHead.frequencies.headway_secs],10))}for(o=Object.keys(r),p=0;p<o.length;p+=1)for(c=0;c<r[o[p]].length;c+=1)e._.trip[o[p]].service[c]=e._.trip[o[p]].service[c]*r[o[p]][c]}return e}(e,u)}(n=function(e){var t,n,r,i,o,s,a=0,f=Object.keys(e._.trip);function u(e,t){var n;if(e.length!==t.length)return!1;for(n=0;n<e.length;n+=1)if(e[n]!==t[n])return!1;return!0}for(o=0;o<f.length;o+=1)if("dup"in e._.trip[f[o]]&&(i=e._.trip[f[o]].dup.trip_id,e._.trip[f[o]].dup.stops.length>1&&i in e._.trip)){for(r=[],n=Object.keys(e._.trip[i].calendar),s=0;s<n.length;s+=1)n[s]in e._.trip[f[o]].calendar==0&&r.push(n[s]);for(t=[],n=Object.keys(e._.trip[f[o]].calendar),s=0;s<n.length;s+=1)n[s]in e._.trip[i].calendar==0&&t.push(n[s]);if(e.config.allowCabotage&&0===r.length&&0===t.length&&(-1!==e.gtfsHead.stop_times.pickup_type||-1!==e.gtfsHead.drop_off_type)&&("setdown"in e._.trip[f[o]]&&e._.trip[f[o]].setdown.length>0&&"setdown"in e._.trip[i]&&!1===u(e._.trip[i].setdown,e._.trip[f[o]].setdown)||"pickup"in e._.trip[f[o]]&&e._.trip[f[o]].pickup.length>0&&"pickup"in e._.trip[i]&&!1===u(e._.trip[i].pickup,e._.trip[f[o]].pickup)))"b"in e._.trip[i]?e._.trip[f[o]].b=e._.trip[i].b:(e._.trip[i].b=a,e._.trip[f[o]].b=a,a+=1);else if(e.config.allowSplit&&e._.trip[f[o]].dup.stops.length<e._.trip[f[o]].stops.length){if(0===t.length)for(e._.trip[f[o]].t=[],s=0;s<e._.trip[f[o]].stops.length;s+=1)-1===e._.trip[f[o]].dup.stops.indexOf(e._.trip[f[o]].stops[s][1])&&e._.trip[f[o]].t.push(e._.trip[f[o]].stops[s][1]);else if(0===r.length){for(e._.trip[i].t=[],n={},s=0;s<e._.trip[f[o]].stops.length;s+=1)n[e._.trip[f[o]].stops[s][1]]="";for(s=0;s<e._.trip[i].stops.length;s+=1)e._.trip[i].stops[s][1]in n==0&&e._.trip[i].t.push(e._.trip[i].stops[s][1])}}else if(!1===e.config.allowDuplication)if(0===t.length)delete e._.trip[f[o]];else for(e._.trip[f[o]].calendar={},s=0;s<t.length;s+=1)e._.trip[f[o]].calendar[t[s]]=""}return e}(n=function(e){var t,n,r,i,o,s,a,f,u,p,c,g,l,_={},h=Object.keys(e.gtfs.stop_times);for(!1!==e.config.allowDuplicate&&!0!==e.config.allowSplit&&!0!==e.config.allowCabotage||(i={}),p=0;p<h.length;p+=1)if(h[p]in e._.trip)for(n=Object.keys(e._.trip[h[p]].calendar),s=null,c=0;c<e.gtfs.stop_times[h[p]].length;c+=1)if((f=e.gtfs.stop_times[h[p]][c])[e.gtfsHead.stop_times.stop_id]in e._.nodeLookup&&(0===e._.trip[h[p]].stops.length||e._.trip[h[p]].stops[e._.trip[h[p]].stops.length-1][1]!==e._.nodeLookup[f[e.gtfsHead.stop_times.stop_id]])&&(a=e._.nodeLookup[f[e.gtfsHead.stop_times.stop_id]],t=0,r=0,e._.trip[h[p]].stops.push([f[e.gtfsHead.stop_times.stop_sequence],a]),-1!==e.gtfsHead.stop_times.pickup_type&&"1"===f[e.gtfsHead.stop_times.pickup_type]&&e._.trip[h[p]].setdown.push(e._.nodeLookup[f[e.gtfsHead.stop_times.stop_id]]),-1!==e.gtfsHead.stop_times.drop_off_type&&"1"===f[e.gtfsHead.stop_times.drop_off_type]&&e._.trip[h[p]].pickup.push(e._.nodeLookup[f[e.gtfsHead.stop_times.stop_id]]),"frequent"in e._.trip[h[p]]==0&&(-1!==e.gtfsHead.stop_times.departure_time&&""!==f[e.gtfsHead.stop_times.departure_time]&&(f[e.gtfsHead.stop_times.departure_time]in _==0&&(_[f[e.gtfsHead.stop_times.departure_time]]=d(f[e.gtfsHead.stop_times.departure_time])),r=_[f[e.gtfsHead.stop_times.departure_time]],("start"in e._.trip[h[p]]==0||r<e._.trip[h[p]].start)&&(e._.trip[h[p]].start=r)),-1!==e.gtfsHead.stop_times.arrival_time&&""!==f[e.gtfsHead.stop_times.arrival_time]&&(f[e.gtfsHead.stop_times.arrival_time]in _==0&&(_[f[e.gtfsHead.stop_times.arrival_time]]=d(f[e.gtfsHead.stop_times.arrival_time])),t=_[f[e.gtfsHead.stop_times.arrival_time]],("end"in e._.trip[h[p]]==0||t>e._.trip[h[p]].end)&&(e._.trip[h[p]].end=t)),void 0!==i))){for(u=[],0===t&&0===r||u.push({key:[a,t,r].join(":"),node:a}),!0===e.config.allowSplit&&0!==t&&e._.trip[h[p]].stops.length>1&&u.push({key:[a,t,e._.trip[h[p]].stops[e._.trip[h[p]].stops.length-1]].join(":"),node:a}),null!==s&&u.push({key:[a,s.key].join(":"),node:s.node}),g=0;g<u.length;g+=1)for(o=[u[g].key,e._.trip[h[p]].direction_id],e.config.duplicationRouteOnly&&o.push(e._.trip[h[p]].route_id),o=o.join(":"),l=0;l<n.length;l+=1)n[l]in i==0&&(i[n[l]]={}),o in i[n[l]]?("dup"in e._.trip[h[p]]==0&&(e._.trip[h[p]].dup={stops:[],trip_id:i[n[l]][o]}),0!==e._.trip[h[p]].dup.stops.length&&-1!==e._.trip[h[p]].dup.stops.indexOf(u[g].node)||e._.trip[h[p]].dup.stops.push(u[g].node)):i[n[l]][o]=h[p];!0===e.config.allowSplit&&(s=0!==r?{key:[r,a].join(":"),node:a}:null)}return e}(n=function(e){var t,n,r,o,s={},a=function(e){var t,n,r,o,s,a,f={};if("calendar"in e.gtfs)for(t=Object.keys(e._.calendarDay),s=0;s<e.gtfs.calendar.length;s+=1)for(r=e.gtfs.calendar[s][e.gtfsHead.calendar.service_id],o=i(e.gtfs.calendar[s][e.gtfsHead.calendar.start_date]),n=i(e.gtfs.calendar[s][e.gtfsHead.calendar.end_date]),a=0;a<t.length;a+=1)t[a]>=o&&t[a]<=n&&"1"===e.gtfs.calendar[s][e.gtfsHead.calendar[e._.calendarDay[t[a]]]]&&(r in f==0&&(f[r]={}),f[r][t[a]]="");if("calendar_dates"in e.gtfs&&-1!==e.gtfsHead.calendar_dates.service_id&&-1!==e.gtfsHead.calendar_dates.date&&-1!==e.gtfsHead.calendar_dates.exception_type)for(s=0;s<e.gtfs.calendar_dates.length;s+=1)e.gtfs.calendar_dates[s][e.gtfsHead.calendar_dates.date]in e._.calendarGtfs&&((r=e.gtfs.calendar_dates[s][e.gtfsHead.calendar_dates.service_id])in f==0&&(f[r]={}),"1"===e.gtfs.calendar_dates[s][e.gtfsHead.calendar_dates.exception_type]&&(f[r][e._.calendarGtfs[e.gtfs.calendar_dates[s][e.gtfsHead.calendar_dates.date]]]=""),"2"===e.gtfs.calendar_dates[s][e.gtfsHead.calendar_dates.exception_type]&&e._.calendarGtfs[e.gtfs.calendar_dates[s][e.gtfsHead.calendar_dates.date]]in f[r]&&(delete f[r][e._.calendarGtfs[e.gtfs.calendar_dates[s][e.gtfsHead.calendar_dates.date]]],0===Object.keys(f[r]).length&&delete f[r]));return f}(e),f=function(e){var t,n={};if("frequencies"in e.gtfs&&-1!==e.gtfsHead.frequencies.trip_id)for(t=0;t<e.gtfs.frequencies.length;t+=1)n[e.gtfs.frequencies[t][e.gtfsHead.frequencies.trip_id]]="";return n}(e),u=[];for(e._.trip={},o=0;o<e.gtfs.trips.length;o+=1)e.gtfs.trips[o][e.gtfsHead.trips.service_id]in a&&(n=(r=e.gtfs.trips[o])[e.gtfsHead.trips.trip_id],e._.trip[n]={calendar:a[r[e.gtfsHead.trips.service_id]],route_id:r[e.gtfsHead.trips.route_id],service:[],stops:[]},-1!==e.gtfsHead.trips.direction_id?e._.trip[n].direction_id=r[e.gtfsHead.trips.direction_id]:e._.trip[n].direction_id="",n in f&&(e._.trip[n].frequent=""),-1!==e.gtfsHead.stop_times.pickup_type&&(e._.trip[n].setdown=[]),-1!==e.gtfsHead.stop_times.drop_off_type&&(e._.trip[n].pickup=[]),-1!==e.gtfsHead.trips.block_id&&""!==r[e.gtfsHead.trips.block_id]&&(e._.trip[n].block=r[e.gtfsHead.trips.block_id],u.push(n),r[e.gtfsHead.trips.block_id]in s?s[r[e.gtfsHead.trips.block_id]]+=1:s[r[e.gtfsHead.trips.block_id]]=1),!0===e.config.allowHeadsign&&-1!==e.gtfsHead.trips.trip_headsign&&(""===(t=r[e.gtfsHead.trips.trip_headsign].trim())&&-1!==e.gtfsHead.trips.trip_short_name&&(t=r[e.gtfsHead.trips.trip_short_name].trim()),""!==t&&(e._.trip[n].reference={n:t,slug:t})));for(o=0;o<u.length;o+=1)e._.trip[u[o]].block=s[e._.trip[u[o]].block];return e}(n=function(e){var t=i(e.config.fromDate),n=i(e.config.toDate);for(e._.calendar={},e._.calendarDay={},e._.calendarGtfs={};n>=t;)e._.calendar[t]=r(t),e._.calendarDay[t]=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"][new Date(t).getDay()],e._.calendarGtfs[r(t)]=t,t+=864e5;return e}(n=function(e,t){var n,r,i,o,s,a,f,u,d,g,l,_,h={},y=[],m=[],k=-1,v=Math.pow(10,e.config.coordinatePrecision),H=0,q={},w={},b=0,S={};if(e.aquius.place=[],"object"==typeof t&&"geojson"in t&&"type"in t.geojson&&"FeatureCollection"===t.geojson.type&&"features"in t.geojson&&Array.isArray(t.geojson.features)&&t.geojson.features.length>0){for(l=0;l<t.geojson.features.length;l+=1)null!==(n=c(t.geojson.features[l]))&&(y.push(l),h[l]={x:Math.round(n[0]*v)/v,y:Math.round(n[1]*v)/v});for(l=0;l<e.aquius.node.length;l+=1)m.push([e.aquius.node[l][0]+e.aquius.node[l][1],l]);for(m.sort(),l=0;l<m.length;l+=1){if(k=-1,p((u=e.aquius.node[m[l][1]])[0],u[1],t.geojson.features[H]))k=H;else{for((r={})[H]=H,_=0;_<y.length;_+=1)if(g=Math.abs(u[0]+u[1]-(h[y[_]].x+h[y[_]].y)),0===_&&(f=g),f>=g&&y[_]in r==0){if(p(u[0],u[1],t.geojson.features[y[_]])){k=y[_];break}r[y[_]]=y[_],Object.keys(r).length<5&&(f=g)}if(-1===k)for(_=0;_<t.geojson.features.length;_+=1)if(_ in r==0&&p(u[0],u[1],t.geojson.features[_])){k=_;break}}-1!==k?(H=k,k in w?e.aquius.node[m[l][1]][2].p=w[k]:k in h&&((s=[h[k].x,h[k].y].join(":"))in q?o=q[s]:(e.aquius.place.push([h[k].x,h[k].y,{}]),o=e.aquius.place.length-1,q[s]=o),e.aquius.node[m[l][1]][2].p=o,w[k]=o,"properties"in t.geojson.features[k]&&e.config.populationProperty in t.geojson.features[k].properties&&(d=parseFloat(t.geojson.features[k].properties[e.config.populationProperty]),Number.isNaN(d)||("p"in e.aquius.place[o][2]==0&&(e.aquius.place[o][2].p=0),e.aquius.place[o][2].p+=d,e.aquius.place[o][2].p>b&&(b=e.aquius.place[o][2].p))),"properties"in t.geojson.features[k]&&e.config.placeNameProperty in t.geojson.features[k].properties&&null!==t.geojson.features[k].properties[e.config.placeNameProperty]&&((i={}).n=t.geojson.features[k].properties[e.config.placeNameProperty].trim(),""!==i.n&&("r"in e.aquius.place[o][2]==0&&(e.aquius.place[o][2].r=[]),e.aquius.place[o][2].r.push(i))))):!0===e.config.inGeojson&&(S[m[l][1]]="")}if(b>0&&"placeScale"in e.config.option==0&&(e.config.option.placeScale=Math.round(1/(b/2e6)*1e5)/1e5,"option"in e.aquius==0&&(e.aquius.option={}),e.aquius.option.placeScale=e.config.option.placeScale),Object.keys(S).length>0)for(a=Object.keys(e._.nodeLookup),l=0;l<a.length;l+=1)e._.nodeLookup[a[l]]in S&&delete e._.nodeLookup[a[l]]}return e}(n=function(e){var t,n,r,i;"nodeLookup"in e._==0&&(e._.nodeLookup={}),"nodeCoord"in e._==0&&(e._.nodeCoord={}),"node"in e.aquius==0&&(e.aquius.node=[]);for(i=0;i<e.gtfs.stops.length;i+=1)e.gtfs.stops[i].stop_id in e._.nodeLookup!=0||""===e.gtfs.stops[i][e.gtfsHead.stops.stop_id]||"stopExclude"in e._!=0&&e.gtfs.stops[i][e.gtfsHead.stops.stop_id]in e._.stopExclude!=0||!("stopInclude"in e._==0||e.gtfs.stops[i][e.gtfsHead.stops.stop_id]in e._.stopInclude)||(e=u(e,t=f(e,e.gtfs.stops[i]),e.gtfs.stops[i][e.gtfsHead.stops.stop_id]),(r=t[0].toString()+","+t[1].toString())in e._.nodeCoord?n=e._.nodeCoord[r]:(n=e.aquius.node.length,e.aquius.node.push([t[0],t[1],{}]),e._.nodeCoord[r]=n),e._.nodeLookup[e.gtfs.stops[i][e.gtfsHead.stops.stop_id]]=n,e=a(e,e.gtfs.stops[i],n));return delete e._.nodeCoord,e}(n=function(e){var t,n,r,i,o,s,d;if("transfers"in e.gtfs&&-1!==e.gtfsHead.transfers.from_stop_id&&-1!==e.gtfsHead.transfers.to_stop_id&&1!==e.gtfsHead.transfers.transfer_type){"nodeLookup"in e._==0&&(e._.nodeLookup={}),"nodeCoord"in e._==0&&(e._.nodeCoord={}),"node"in e.aquius==0&&(e.aquius.node=[]);for(s=0;s<e.gtfs.transfers.length;s+=1)if(""!==e.gtfs.transfers[s][e.gtfsHead.transfers.from_stop_id]&&("stopExclude"in e._==0||e.gtfs.transfers[s][e.gtfsHead.transfers.from_stop_id]in e._.stopExclude==0&&e.gtfs.transfers[s][e.gtfsHead.transfers.to_stop_id]in e._.stopExclude==0)&&("stopInclude"in e._==0||e.gtfs.transfers[s][e.gtfsHead.transfers.from_stop_id]in e._.stopInclude&&e.gtfs.transfers[s][e.gtfsHead.transfers.to_stop_id]in e._.stopInclude)&&(i=e._.nodeLookup[e.gtfs.transfers[s][e.gtfsHead.transfers.from_stop_id]])!==(o=e._.nodeLookup[e.gtfs.transfers[s][e.gtfsHead.transfers.to_stop_id]]))if(void 0!==i&&void 0!==o);else if(void 0!==i)e._.nodeLookup[o]=i;else if(void 0!==o)e._.nodeLookup[i]=o;else if(void 0===i&&void 0===o)for(d=0;d<e.gtfs.stops.length;d+=1)if(e.gtfs.stops[d][e.gtfsHead.stops.stop_id]===i){e=u(e,t=f(e,e.gtfs.stops[d]),e.gtfs.stops[d][e.gtfsHead.stops.stop_id]),(r=t[0].toString()+","+t[1].toString())in e._.nodeCoord?n=e._.nodeCoord[r]:(n=e.aquius.node.length,e.aquius.node.push([t[0],t[1],{}]),e._.nodeCoord[r]=n),e._.nodeLookup[i]=n,e._.nodeLookup[o]=n,e=a(e,e.gtfs.stops[d],n);break}}return e}(n=function(e){var t,n,r,i,o=[];if(-1!==e.gtfsHead.stops.location_type&&-1!==e.gtfsHead.stops.parent_station){"nodeLookup"in e._==0&&(e._.nodeLookup={}),"nodeCoord"in e._==0&&(e._.nodeCoord={}),"node"in e.aquius==0&&(e.aquius.node=[]);for(i=0;i<e.gtfs.stops.length;i+=1)"stopExclude"in e._!=0&&e.gtfs.stops[i][e.gtfsHead.stops.stop_id]in e._.stopExclude!=0||!("stopInclude"in e._==0||e.gtfs.stops[i][e.gtfsHead.stops.stop_id]in e._.stopInclude)||("1"===e.gtfs.stops[i][e.gtfsHead.stops.location_type]?(e=u(e,t=f(e,e.gtfs.stops[i]),e.gtfs.stops[i][e.gtfsHead.stops.stop_id]),(r=t[0].toString()+","+t[1].toString())in e._.nodeCoord?n=e._.nodeCoord[r]:(n=e.aquius.node.length,e.aquius.node.push([t[0],t[1],{}]),e._.nodeCoord[r]=n),e._.nodeLookup[e.gtfs.stops[i][e.gtfsHead.stops.stop_id]]=n,e=a(e,e.gtfs.stops[i],n)):""!==e.gtfs.stops[i][e.gtfsHead.stops.parent_station]&&o.push([e.gtfs.stops[i][e.gtfsHead.stops.stop_id],e.gtfs.stops[i][e.gtfsHead.stops.parent_station]]));for(i=0;i<o.length;i+=1)o[i][1]in e._.nodeLookup&&(e._.nodeLookup[o[i][0]]=e._.nodeLookup[o[i][1]])}return e}(n=function(e){var t;if(e.config.stopExclude.length>0)for(e._.stopExclude={},t=0;t<e.config.stopExclude.length;t+=1)e._.stopExclude[e.config.stopExclude[t]]="";if(e.config.stopInclude.length>0)for(e._.stopInclude={},t=0;t<e.config.stopInclude.length;t+=1)e._.stopInclude[e.config.stopInclude[t]]="";return e}(n=function(e){var t,n;if("serviceFilter"in e.config&&"type"in e.config.serviceFilter&&"period"===e.config.serviceFilter.type){"period"in e.config.serviceFilter!=0&&Array.isArray(e.config.serviceFilter.period)&&0!==e.config.serviceFilter.period.length||(t=["monday","tuesday","wednesday","thursday","friday"],e.config.serviceFilter.period=[{name:{"en-US":"Typical day"}},{day:t,name:{"en-US":"Typical weekday"}},{day:t,name:{"en-US":"Weekday early"},time:[{end:"10:00:00"}]},{day:t,name:{"en-US":"Weekday 10:00-17:00"},time:[{start:"10:00:00",end:"17:00:00"}]},{day:t,name:{"en-US":"Weekday evening"},time:[{start:"17:00:00"}]},{day:["saturday"],name:{"en-US":"Saturday"}},{day:["sunday"],name:{"en-US":"Sunday"}}]),e.aquius.service=[];for(n=0;n<e.config.serviceFilter.period.length;n+=1)"name"in e.config.serviceFilter.period[n]==0&&(e.config.serviceFilter.period[n].name={"en-US":"Period "+n}),e.aquius.service.push([[n],e.config.serviceFilter.period[n].name,{}])}return e}(n=function(e){var t,n,r,i,o,s,a={0:{"en-US":"Tram"},1:{"en-US":"Metro"},2:{"en-US":"Rail"},3:{"en-US":"Bus"},4:{"en-US":"Ferry"},5:{"en-US":"Cable car"},6:{"en-US":"Cable car"},7:{"en-US":"Funicular"},100:{"en-US":"Rail"},101:{"en-US":"High speed rail"},102:{"en-US":"Long distance rail"},103:{"en-US":"Inter-regional rail"},105:{"en-US":"Sleeper rail"},106:{"en-US":"Regional rail"},107:{"en-US":"Tourist rail"},108:{"en-US":"Rail shuttle"},109:{"en-US":"Suburban rail"},200:{"en-US":"Coach"},201:{"en-US":"International coach"},202:{"en-US":"National coach"},204:{"en-US":"Regional coach"},208:{"en-US":"Commuter coach"},400:{"en-US":"Urban rail"},401:{"en-US":"Metro"},402:{"en-US":"Underground"},405:{"en-US":"Monorail"},700:{"en-US":"Bus"},701:{"en-US":"Regional bus"},702:{"en-US":"Express bus"},704:{"en-US":"Local bus"},800:{"en-US":"Trolleybus"},900:{"en-US":"Tram"},1000:{"en-US":"Water"},1300:{"en-US":"Telecabin"},1400:{"en-US":"Funicular"},1501:{"en-US":"Shared taxi"},1700:{"en-US":"Other"},1701:{"en-US":"Cable car"},1702:{"en-US":"Horse-drawn"}};switch("type"in e.config.networkFilter==0&&(e.config.networkFilter.type="agency"),"reference"in e.config.networkFilter==0&&(e.config.networkFilter.reference={}),e._.productIndex={},"reference"in e.aquius==0&&(e.aquius.reference={}),e.aquius.reference.product=[],e.config.networkFilter.type){case"mode":if("route_type"in e.gtfsHead.routes&&-1!==e.gtfsHead.routes.route_type&&e.gtfs.routes.length>0)for(n=0,o=0;o<e.gtfs.routes.length;o+=1)e.gtfs.routes[o][e.gtfsHead.routes.route_type]in e._.productIndex==0&&(e._.productIndex[e.gtfs.routes[o][e.gtfsHead.routes.route_type]]=n,e.gtfs.routes[o][e.gtfsHead.routes.route_type]in e.config.networkFilter.reference==0&&(e.gtfs.routes[o][e.gtfsHead.routes.route_type]in a?e.config.networkFilter.reference[e.gtfs.routes[o][e.gtfsHead.routes.route_type]]=a[e.gtfs.routes[o][e.gtfsHead.routes.route_type]]:e.config.networkFilter.reference[e.gtfs.routes[o][e.gtfsHead.routes.route_type]]={}),e.aquius.reference.product[n]=e.config.networkFilter.reference[e.gtfs.routes[o][e.gtfsHead.routes.route_type]],n+=1);break;case"agency":default:if(e.config.networkFilter.type="agency","agency"in e.gtfs&&("agency_id"in e.gtfsHead.agency&&-1!==e.gtfsHead.agency.agency_id||"agency_name"in e.gtfsHead.agency&&-1!==e.gtfsHead.agency.agency_name)&&e.gtfs.agency.length>0){n=0,t="agency_id"in e.gtfsHead.agency&&-1!==e.gtfsHead.agency.agency_id?e.gtfsHead.agency.agency_id:e.gtfsHead.agency.agency_name;for(o=0;o<e.gtfs.agency.length;o+=1)void 0!==e.gtfs.agency[o][t]&&""!==e.gtfs.agency[o][t]&&e.gtfs.agency[o][t]in e._.productIndex==0&&(e._.productIndex[e.gtfs.agency[o][t]]=n,e.gtfs.agency[o][t]in e.config.networkFilter.reference==0&&(-1!==e.gtfsHead.agency.agency_name?e.config.networkFilter.reference[e.gtfs.agency[o][t]]={"en-US":e.gtfs.agency[o][e.gtfsHead.agency.agency_name]}:e.config.networkFilter.reference[e.gtfs.agency[o][t]]={"en-US":e.gtfs.agency[o][e.gtfsHead.agency.agency_id]}),e.aquius.reference.product[n]=e.config.networkFilter.reference[e.gtfs.agency[o][t]],n+=1)}0===Object.keys(e._.productIndex).length&&(e._.productIndex.agency=0,e.config.networkFilter.reference.agency={},e.aquius.reference.product[0]={})}if("network"in e.config.networkFilter==0||!Array.isArray(e.config.networkFilter.network))switch(e.config.networkFilter.network=[],r=Object.keys(e._.productIndex),e.config.networkFilter.type){case"mode":if(e.config.networkFilter.network.push([r,{"en-US":"All modes"}]),r.length>1)for(o=0;o<r.length;o+=1)r[o]in a?e.config.networkFilter.network.push([[r[o]],a[r[o]]]):e.config.networkFilter.network.push([[r[o]],{"en-US":"Mode #"+r[o]}]);break;case"agency":if(e.config.networkFilter.network.push([r,{"en-US":"All operators"}]),r.length>1)for(o=0;o<r.length;o+=1)if("agency"in e.gtfs&&-1!==e.gtfsHead.agency.agency_id&&-1!==e.gtfsHead.agency.agency_name){for(s=0;s<e.gtfs.agency.length;s+=1)if(e.gtfs.agency[s][e.gtfsHead.agency.agency_id]===r[o]){e.config.networkFilter.network.push([[r[o]],{"en-US":e.gtfs.agency[s][e.gtfsHead.agency.agency_name]}]);break}}else e.config.networkFilter.network.push([[r[o]],{"en-US":r[o]}]);break;default:e.config.networkFilter.network.push([r,{"en-US":"All"}])}for(e.aquius.network=[],o=0;o<e.config.networkFilter.network.length;o+=1)if(e.config.networkFilter.network[o].length>1&&Array.isArray(e.config.networkFilter.network[o][0])&&"object"==typeof e.config.networkFilter.network[o][1]){for(i=[],s=0;s<e.config.networkFilter.network[o][0].length;s+=1)e.config.networkFilter.network[o][0][s]in e._.productIndex&&i.push(e._.productIndex[e.config.networkFilter.network[o][0][s]]);e.aquius.network.push([i,e.config.networkFilter.network[o][1],{}])}return e}(n=function(e){if("schema"in e.config.meta!=0&&"0"===e.config.meta.schema||(e.config.meta.schema="0"),"name"in e.config.meta==0&&(e.config.meta.name={}),"en-US"in e.config.meta.name==0&&("feed_info"in e.gtfs&&-1!==e.gtfsHead.feed_info.feed_publisher_name&&e.gtfs.feed_info.length>0?e.config.meta.name["en-US"]=e.gtfs.feed_info[0][e.gtfsHead.feed_info.feed_publisher_name]+" ":e.config.meta.name["en-US"]="",e.config.meta.name["en-US"]+="("+e.config.fromDate,e.config.fromDate!==e.config.toDate&&(e.config.meta.name["en-US"]+="-"+e.config.toDate),e.config.meta.name["en-US"]+=")"),"url"in e.config.meta==0&&"feed_info"in e.gtfs&&-1!==e.gtfsHead.feed_info.feed_publisher_url&&e.gtfs.feed_info.length>0&&(e.config.meta.url=e.gtfs.feed_info[0][e.gtfsHead.feed_info.feed_publisher_url]),e.aquius.meta=e.config.meta,"en-US"in e.config.translation==0&&(e.config.translation["en-US"]={}),"link"in e.config.translation["en-US"]==0)switch(e.config.servicePer){case 1:e.config.translation["en-US"].link="Daily Services";break;case 7:e.config.translation["en-US"].link="Weekly Services";break;default:e.config.translation["en-US"].link="Services per "+e.config.servicePer+" Days"}return e.aquius.translation=e.config.translation,"c"in e.config.option!=0&&"k"in e.config.option!=0||(e.config.option.c=parseFloat(e.gtfs.stops[0][e.gtfsHead.stops.stop_lon]),e.config.option.k=parseFloat(e.gtfs.stops[0][e.gtfsHead.stops.stop_lat]),e.config.option.m=12),"x"in e.config.option!=0&&"y"in e.config.option!=0||(e.config.option.x=parseFloat(e.gtfs.stops[0][e.gtfsHead.stops.stop_lon]),e.config.option.y=parseFloat(e.gtfs.stops[0][e.gtfsHead.stops.stop_lat]),e.config.option.z=10),e.aquius.option=e.config.option,e}(n))))))),t))))))))),t)}};