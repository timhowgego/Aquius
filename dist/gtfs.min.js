var gtfsToAquius=gtfsToAquius||{init:function(e){"use strict";function t(e,t,i){var r,n,o,s=document.createElement(e);if(void 0!==t)for(r=Object.keys(t),o=0;o<r.length;o+=1)s[r[o]]=t[r[o]];if(void 0!==i)for(n=Object.keys(i),o=0;o<n.length;o+=1)s.style[n[o]]=i[n[o]];return s}function i(e,i,r,n){var o,s,a,d,f,c=t("table");if(void 0!==n&&c.appendChild(t("caption",{textContent:n})),i.length>0){for(a=t("tr"),d=0;d<i.length;d+=1)"object"==typeof i[d]?((s=t("th")).appendChild(i[d]),a.appendChild(s)):a.appendChild(t("th",{textContent:i[d].toString()}));c.appendChild(a)}for(d=0;d<e.length;d+=1){for(a=t("tr"),f=0;f<e[d].length;f+=1)"object"==typeof e[d][f]?(o=t("td")).appendChild(e[d][f]):o=t("td",{textContent:e[d][f].toString()}),void 0!==r&&r.length>f&&(o.className=r[f]),a.appendChild(o);c.appendChild(a)}return c}function r(e,r,o){var s,a,d,f,c,g,p,u,l=o._vars,_=document.getElementById(l.configId+"ImportFiles"),h=document.getElementById(l.configId+"Output"),m=document.getElementById(l.configId+"Progress");if(void 0!==e)return n(e,l),!1;if(!h||!m)return!1;for(;h.firstChild;)h.removeChild(h.firstChild);for(;m.firstChild;)m.removeChild(m.firstChild);for(null!==_&&(_.disabled=!1),h.className="",a=["aquius","config"],u=0;u<a.length;u+=1)a[u]in r&&Object.keys(r[a[u]]).length>0&&m.appendChild(t("a",{className:l.configId+"Download",href:window.URL.createObjectURL(new Blob([JSON.stringify(r[a[u]])],{type:"application/json;charset=utf-8"})),download:a[u]+".json",textContent:"Save "+a[u]+".json",role:"button"}));if(s="aquius"in r&&"translation"in r.aquius&&"en-US"in r.aquius.translation&&"link"in r.aquius.translation["en-US"]?r.aquius.translation["en-US"].link:"Services","undefined"!=typeof aquius&&"aquius"in r&&(h.appendChild(t("div",{id:l.configId+"Map"},{height:document.documentElement.clientHeight/2+"px"})),aquius.init(l.configId+"Map",{dataObject:r.aquius,uiStore:!1})),"config"in r&&"stopOverride"in r.config){for(a=Object.keys(r.config.stopOverride),p=[],u=0;u<a.length;u+=1)"x"in r.config.stopOverride[a[u]]&&0===r.config.stopOverride[a[u]].x&&"y"in r.config.stopOverride[a[u]]&&0===r.config.stopOverride[a[u]].y&&p.push(a[u]);p.length>0&&h.appendChild(t("p",{textContent:"Caution: Contains "+p.length.toString()+" stop_id with coordinates 0,0, which can be corrected in config.stopOverride."}))}if("aquius"in r&&"network"in r.aquius&&"summary"in r&&"network"in r.summary){if(g=["Network"],c=[l.configId+"Text"],"service"in r.aquius==!1||0===r.aquius.service.length)g.push("Service"),c.push(l.configId+"Number");else for(u=0;u<r.aquius.service.length;u+=1)"en-US"in r.aquius.service[u][1]?g.push(r.aquius.service[u][1]["en-US"]):g.push(JSON.stringify(r.aquius.service[u][1])),c.push(l.configId+"Number");for(f=[],u=0;u<r.summary.network.length;u+=1)"en-US"in r.aquius.network[u][1]?f.push([r.aquius.network[u][1]["en-US"]].concat(r.summary.network[u])):f.push([JSON.stringify(r.aquius.network[u][1])].concat(r.summary.network[u]));h.appendChild(i(f,g,c,s+" by Network"))}if("summary"in r&&"service"in r.summary){for(d=0,u=0;u<r.summary.service.length;u+=1)void 0!==r.summary.service[u]&&r.summary.service[u]>d&&(d=r.summary.service[u]);if(d>0){for(f=[],u=0;u<r.summary.service.length;u+=1)void 0===r.summary.service[u]?f.push([u,"-",""]):f.push([u,(100*r.summary.service[u]).toFixed(1),t("span",{},{"background-color":"#000",display:"inline-block",height:"7px",width:Math.round(r.summary.service[u]/d*100)+"%"})]);h.appendChild(i(f,["Hour","% Service","Histogram"],[l.configId+"Number",l.configId+"Number",l.configId+"Histogram"],s+" by Hour (scheduled only)"))}}}function n(e,i){var r,n=document.getElementById(i.configId+"ImportFiles"),o=document.getElementById(i.configId+"Output"),s=document.getElementById(i.configId+"Progress");if(void 0!==e&&null!==o){for(;o.firstChild;)o.removeChild(o.firstChild);if(o.className=i.configId+"OutputError",r="message"in e?e.message:JSON.stringify(e),o.appendChild(t("p",{textContent:"Error: "+r})),null!==s){for(;s.firstChild;)s.removeChild(s.firstChild);s.textContent="Failed"}null!==n&&(n.disabled=!1)}}return function(e,i,r){var n,o,s,a=document.getElementById(e.configId);if(!a)return!1;for(;a.firstChild;)a.removeChild(a.firstChild);return Object.keys&&[].indexOf&&"object"==typeof JSON&&window.File&&window.FileReader&&window.Blob?(document.head.appendChild(t("script",{src:"https://timhowgego.github.io/Aquius/dist/aquius.min.js",type:"text/javascript"})),o=t("form",{className:e.configId+"Input"}),s=t("label",{textContent:r}),(n=t("input",{id:e.configId+"ImportFiles",multiple:"multiple",name:e.configId+"ImportFiles[]",type:"file"})).addEventListener("change",function(){i(e)},!1),s.appendChild(n),o.appendChild(s),o.appendChild(t("span",{id:e.configId+"Progress"})),a.appendChild(o),a.appendChild(t("div",{id:e.configId+"Output"})),!0):(a.appendChild(document.createTextNode("Browser not supported: Try a modern browser")),!1)}({configId:e,process:this.process},function(e){var t,i={},o={},s=document.getElementById(e.configId+"ImportFiles"),a={_vars:e,callback:r},d=0,f=document.getElementById(e.configId+"Progress"),c=0;function g(t,r,s){var f,g,p,u,l;if((f=t.toLowerCase().split(".")).length>1&&"txt"===f[f.length-1]?((p=f.slice(0,f.length-1).join("."))in i==0&&(i[p]=[]),i[p][r]=s):((p=f.join("."))in o==0&&(o[p]=[]),o[p][r]=s),(d+=1)===c){for(u=Object.keys(o),l=0;l<u.length;l+=1)try{"type"in(g=JSON.parse(o[u[l]].join("")))&&"FeatureCollection"===g.type?a.geojson=g:a.config=g}catch(t){t instanceof SyntaxError==0&&n(t,e)}e.process(i,a)}}if(null!==s&&s.files.length>0){if(s.disabled=!0,null!==f){for(;f.firstChild;)f.removeChild(f.firstChild);f.textContent="Working..."}!function(i){var r,o,s,a=1e8,d=[];for(s=0;s<i.length;s+=1)for(o=0;i[s].size>=o;)d.push([i[s],parseInt(o/a,10)]),o+=a;for(c=d.length,s=0;s<c;s+=1)(t=new FileReader).onerror=function(i,r){n(new Error("Could not read "+r[0].name),e),t.abort()},t.onload=function(t){return function(){try{g(t[0].name,t[1],this.result)}catch(t){n(t,e)}}}(d[s]),r=d[s][0].slice(d[s][1]*a,d[s][1]*a+a),t.readAsText(r)}(s.files)}},"GTFS as .txt, optional config, and optional GeoJSON to process:")},process:function(e,t){"use strict";var i={_:{},aquius:{},config:{},summary:{}};function r(e){var t=new Date(e),i=t.getFullYear().toString();return t.getMonth()<9&&(i+="0"),i+=(t.getMonth()+1).toString(),t.getDate()<10&&(i+="0"),i+=t.getDate().toString()}function n(e){return e.length<8?0:Date.UTC(e.slice(0,4),e.slice(4,6)-1,e.slice(6,8))}function o(e,t,i){var r,n,o,s,a,d,f,c=-1,g=new RegExp('(\\,|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^\\,\\r\\n]*))',"gi"),p=-1,u=[];function l(e,t,i,r,n){return t.length===r&&(-1!==n?(t[n]in e.gtfs[i]==!1&&(e.gtfs[i][t[n]]=[]),e.gtfs[i][t[n]].push(t)):e.gtfs[i].push(t)),e}for(Array.isArray(i)||(i=[i]),d=0;d<i.length;d+=1)for(s=g.exec(i[d]),n=u.length-1,r=!0;null!==s;){if(s[1].length&&","!==s[1]){if(d>0&&!0===r&&(u.length>c&&n<u.length-1&&((a=u.slice(0,n)).push(u[n]+u[n+1]),u=a.concat(u.slice(n+2))),r=!1),-1===c){for(c=u.length,f=0;f<u.length;f+=1)u[f]in e.gtfsHead[t]&&(e.gtfsHead[t][u[f]]=f);if(t in e.gtfsRequired)for(f=0;f<e.gtfsRequired[t].length;f+=1)if(-1===e.gtfsHead[t][e.gtfsRequired[t][f]])return"error"in e==!1&&(e.error=[]),e.error.push("Missing value "+e.gtfsRequired[t][f]+" in GTFS "+t+".txt"),e;if(t in e.gtfsIndex){if(-1===(p=e.gtfsHead[t][e.gtfsIndex[t]]))return"error"in e==!1&&(e.error=[]),e.error.push("Missing index value "+e.gtfsIndex[t]+" in GTFS "+t+".txt"),e;e.gtfs[t]={}}else e.gtfs[t]=[]}else e=l(e,u,t,c,p);u=[]}void 0===(o=s[2]?s[2].replace(new RegExp('""',"g"),'"'):s[3])&&(o=""),u.push(o),s=g.exec(i[d])}return e=l(e,u,t,c,p)}function s(e,t,i){return"reference"in e.aquius==!1&&(e.aquius.reference={}),t in e.aquius.reference==!1&&(e.aquius.reference[t]=[],e._[t]={}),i in e._[t]==!1&&(e.aquius.reference[t].push(i),e._[t][i]=e.aquius.reference[t].length-1),e}function a(e,t,i){var r,n,o,a,d={};function f(e,t){var i,r,n,o=Object.keys(e);for(r=0;r<t.length;r+=1){for(i=!0,n=0;n<o.length;n+=1)if(o[n]in t[r]==!1||t[r][o[n]]!==e[o[n]]){i=!1;break}if(!0===i)return!0}return!1}return!0===e.config.allowName&&(n="",t[e.gtfsHead.stops.stop_id]in e.config.stopOverride&&"stop_name"in e.config.stopOverride[t[e.gtfsHead.stops.stop_id]]?n=e.config.stopOverride[t[e.gtfsHead.stops.stop_id]].stop_name:-1!==e.gtfsHead.stops.stop_name&&(n=t[e.gtfsHead.stops.stop_name].trim()),""!==n&&(d.n=n)),!0===e.config.allowStopUrl&&(n="",t[e.gtfsHead.stops.stop_id]in e.config.stopOverride&&"stop_url"in e.config.stopOverride[t[e.gtfsHead.stops.stop_id]]?n=e.config.stopOverride[t[e.gtfsHead.stops.stop_id]].stop_url:-1!==e.gtfsHead.stops.stop_url&&(n=t[e.gtfsHead.stops.stop_url].trim()),""!==n&&(a="[*]",-1===(o=n.lastIndexOf(a))&&-1!==e.gtfsHead.stops.stop_code&&(r=t[e.gtfsHead.stops.stop_code].trim(),-1!==(o=n.lastIndexOf(r))&&(n=n.substring(0,o)+a+n.substring(o+r.length),d.i=r)),-1===o&&-1!==e.gtfsHead.stops.stop_id&&(r=t[e.gtfsHead.stops.stop_id].trim(),-1!==(o=n.lastIndexOf(r))&&(n=n.substring(0,o)+a+n.substring(o+r.length),d.i=r)),e=s(e,"url",n),d.u=e._.url[n])),Object.keys(d).length>0&&("r"in e.aquius.node[i][2]?!1===f(d,e.aquius.node[i][2].r)&&e.aquius.node[i][2].r.push(d):e.aquius.node[i][2].r=[d]),!0===e.config.allowCode&&(d={},t[e.gtfsHead.stops.stop_id]in e.config.stopOverride&&"stop_code"in e.config.stopOverride[t[e.gtfsHead.stops.stop_id]]?d.n=e.config.stopOverride[t[e.gtfsHead.stops.stop_id]].stop_code:-1!==e.gtfsHead.stops.stop_code&&(d.n=t[e.gtfsHead.stops.stop_code].trim()),"n"in d&&""!==d.n&&("r"in e.aquius.node[i][2]?!1===f(d,e.aquius.node[i][2].r)&&e.aquius.node[i][2].r.push(d):e.aquius.node[i][2].r=[d])),e}function d(e,t){var i=Math.pow(10,e.config.coordinatePrecision);function r(e,t){var i=parseFloat(e);return Number.isNaN(i)?0:Math.round(i*t)/t}return-1!==e.gtfsHead.stops.stop_id&&t[e.gtfsHead.stops.stop_id]in e.config.stopOverride&&"x"in e.config.stopOverride[t[e.gtfsHead.stops.stop_id]]&&"y"in e.config.stopOverride[t[e.gtfsHead.stops.stop_id]]?[r(e.config.stopOverride[t[e.gtfsHead.stops.stop_id]].x,i),r(e.config.stopOverride[t[e.gtfsHead.stops.stop_id]].y,i)]:-1!==e.gtfsHead.stops.stop_lat&&-1!==e.gtfsHead.stops.stop_lon?[r(t[e.gtfsHead.stops.stop_lon],i),r(t[e.gtfsHead.stops.stop_lat],i)]:[0,0]}function f(e,t,i){return 0===t[0]&&0===t[1]&&(i in e.config.stopOverride==!1&&(e.config.stopOverride[i]={}),e.config.stopOverride[i].x=0,e.config.stopOverride[i].y=0),e}function c(e){var t,i,r=e.split(":");if(3!==r.length)return 0;for(i=0;i<r.length;i+=1){if(t=parseInt(r[i],10),Number.isNaN(t))return 0;r[i]=t}return 3600*r[0]+60*r[1]+r[2]}function g(e,t,i){var r;function n(e,t,i){var r,n,o,s,a,d,f,c;if(Array.isArray(i))for(d=0;d<i.length;d+=1)if(Array.isArray(i[d])){for(r=!1,f=0,c=i[d].length-1;f<i[d].length;c=f++)n=i[d][f][0],s=i[d][f][1],o=i[d][c][0],s>t!=(a=i[d][c][1])>t&&e<(o-n)*(t-s)/(a-s)+n&&(r=!r);if(r)return!0}return!1}if("geometry"in i==!1||"type"in i.geometry==!1||"coordinates"in i.geometry==!1||!Array.isArray(i.geometry.coordinates))return!1;if("MultiPolygon"===i.geometry.type)for(r=0;r<i.geometry.coordinates.length;r+=1)if(n(e,t,i.geometry.coordinates[r]))return!0;return"Polygon"===i.geometry.type&&n(e,t,i.geometry.coordinates)}function p(e){var t,i={};function r(e){var t,i,r={};if(Array.isArray(e))for(t=0;t<e.length;t+=1)if(Array.isArray(e[t]))for(i=0;i<e[t].length;i+=1)Array.isArray(e[t][i])&&2===e[t][i].length&&("maxX"in r==!1?(r.maxX=e[t][i][0],r.minX=e[t][i][0],r.maxY=e[t][i][1],r.minY=e[t][i][1]):(e[t][i][0]>r.maxX?r.maxX=e[t][i][0]:e[t][i][0]<r.minX&&(r.minX=e[t][i][0]),e[t][i][1]>r.maxY?r.maxY=e[t][i][1]:e[t][i][1]<r.minY&&(r.minY=e[t][i][1])));return r}if("geometry"in e&&"type"in e.geometry&&"coordinates"in e.geometry&&Array.isArray(e.geometry.coordinates)){if("MultiPolygon"===e.geometry.type)for(t=0;t<e.geometry.coordinates.length;t+=1)i=r(e.geometry.coordinates[t]);"Polygon"===e.geometry.type&&(i=r(e.geometry.coordinates))}return"maxX"in i?[(i.maxX+i.minX)/2,(i.maxY+i.minY)/2]:null}function u(e,t){var i;return delete e._,delete e.gtfs,delete e.gtfsHead,"object"==typeof t&&"callback"in t?("error"in e&&(i=new Error(e.error.join(". "))),t.callback(i,e,t),!0):e}return i=function(e,t){var i,r;e.gtfsIndex={stop_times:"trip_id"},e.gtfsHead={calendar:{service_id:-1,monday:-1,tuesday:-1,wednesday:-1,thursday:-1,friday:-1,saturday:-1,sunday:-1,start_date:-1,end_date:-1},calendar_dates:{service_id:-1,date:-1,exception_type:-1},frequencies:{trip_id:-1,start_time:-1,end_time:-1,headway_secs:-1},routes:{route_color:-1,route_id:-1,route_long_name:-1,route_short_name:-1,route_text_color:-1,route_url:-1},stop_times:{arrival_time:-1,departure_time:-1,trip_id:-1,stop_id:-1,stop_sequence:-1,pickup_type:-1,drop_off_type:-1},stops:{stop_code:-1,stop_id:-1,stop_lat:-1,stop_lon:-1,stop_name:-1,stop_url:-1,location_type:-1,parent_station:-1},transfers:{from_stop_id:-1,to_stop_id:-1,transfer_type:-1},trips:{block_id:-1,direction_id:-1,route_id:-1,service_id:-1,trip_headsign:-1,trip_id:-1}},e.gtfsRequired={routes:["route_id"],stops:["stop_id","stop_lat","stop_lon"],trips:["route_id","service_id","trip_id"],stop_times:["trip_id","stop_id","stop_sequence"]},"type"in e.config.networkFilter&&"agency"===e.config.networkFilter.type&&(e.gtfsHead.agency={agency_id:-1,agency_name:-1},e.gtfsHead.routes.agency_id=-1),"type"in e.config.networkFilter&&"mode"===e.config.networkFilter.type&&(e.gtfsHead.routes.route_type=-1),"name"in e.config.meta!=0&&"en-US"in e.config.meta.name!=0||("feed_info"in e.gtfsHead==0&&(e.gtfsHead.feed_info={}),e.gtfsHead.feed_info.feed_publisher_name=-1),"url"in e.config.meta==0&&("feed_info"in e.gtfsHead==0&&(e.gtfsHead.feed_info={}),e.gtfsHead.feed_info.feed_publisher_url=-1),i=Object.keys(e.gtfsRequired);for(r=0;r<i.length;r+=1)if(i[r]in t==0)return"error"in e==0&&(e.error=[]),e.error.push("Missing GTFS "+i[r]+".txt"),e;for(e.gtfs={},i=Object.keys(e.gtfsHead),r=0;r<i.length;r+=1)i[r]in t&&(e=o(e,i[r],t[i[r]]));return e}(i=function(e,t){var i,n={allowCabotage:!0,allowCode:!0,allowColor:!0,allowDuplication:!1,allowHeadsign:!1,allowName:!0,allowRoute:!0,allowRouteUrl:!0,allowSplit:!0,allowStopUrl:!0,coordinatePrecision:5,fromDate:r(Date.now()),inGeojson:!0,isCircular:[],meta:{schema:"0"},networkFilter:{type:"agency"},option:{},populationProperty:"population",productOverride:{},routeExclude:[],routeInclude:[],routeOverride:{},serviceFilter:{},servicePer:1,stopOverride:{},toDate:r(Date.now()+5184e5),translation:{}},o=Object.keys(n);for("object"!=typeof t&&(t={}),i=0;i<o.length;i+=1)"config"in t&&o[i]in t.config&&typeof t.config[o[i]]==typeof n[o[i]]?e.config[o[i]]=t.config[o[i]]:e.config[o[i]]=n[o[i]];for(e._.circular={},i=0;i<e.config.isCircular.length;i+=1)e._.circular[e.config.isCircular[i]]=e.config.isCircular[i];return e}(i,t),e),e=null,u("error"in i?i:i=function(e){var t,i,r,n,o,s,a,d,f,c,g,p={};function u(e,t,i,r){return e.config.isCircular.length>0?t in e._.circular:!(r.length<3||r[0]!==r[r.length-1])&&("block"in i&&e._.block[i.block]>1||!(r.length<5)&&(n=e.aquius.node[r[1]][1],o=e.aquius.node[r[1]][0],s=e.aquius.node[r[r.length-2]][1],a=e.aquius.node[r.length-2][0],d=Math.PI/180,f=Math.sin((s-n)*d/2),c=Math.sin((a-o)*d/2),g=f*f+Math.cos(n*d)*Math.cos(s*d)*c*c,2*Math.atan2(Math.sqrt(g),Math.sqrt(1-g))*6371e3>200));var n,o,s,a,d,f,c,g}function l(e,t){var i,r;if(1===e.length&&e.length===t.length)return[e[0]+t[0]];for(i=[],r=0;r<e.length;r+=1)r<t.length&&i.push(e[r]+t[r]);return i}for(f=0;f<e.gtfs.trips.length;f+=1)if(d=e.gtfs.trips[f][e.gtfsHead.trips.trip_id],s=e.gtfs.trips[f][e.gtfsHead.trips.route_id],d in e._.trip&&s in e._.routes){o=[],e._.trip[d].stops.sort(function(e,t){return e[0]-t[0]}),i="f"+e._.routes[s].product,-1!==e.gtfsHead.stop_times.pickup_type&&e._.trip[d].setdown.length>0&&(e._.trip[d].setdown.sort(),i+="s"+e._.trip[d].setdown.join(":")),-1!==e.gtfsHead.stop_times.drop_off_type&&e._.trip[d].pickup.length>0&&(e._.trip[d].pickup.sort(),i+="p"+e._.trip[d].pickup.join(":")),"t"in e._.trip[d]&&(i+="t"+e._.trip[d].t.join(":"));for(c=0;c<e._.trip[d].stops.length;c+=1)o.push(e._.trip[d].stops[c][1]);t=o.slice().reverse().join(":")+i,(i=o.join(":")+i)in p&&("b"in p[i]==0||"b"in e._.trip[d])?(p[i].service=l(p[i].service,e._.trip[d].service),"reference"in e._.routes[s]&&"referenceLookup"in p[i]&&e._.routes[s].reference.slug in p[i].referenceLookup==0&&(p[i].reference.push(e._.routes[s].reference),p[i].referenceLookup[e._.routes[s].reference.slug]="")):t in p?(p[t].service=l(p[t].service,e._.trip[d].service),"reference"in e._.routes[s]&&"referenceLookup"in p[t]&&e._.routes[s].reference.slug in p[t].referenceLookup==0&&(p[t].reference.push(e._.routes[s].reference),p[t].referenceLookup[e._.routes[s].reference.slug]=""),"direction"in p[t]&&delete p[t].direction):(p[i]={direction:1,product:e._.routes[s].product,route:o,service:e._.trip[d].service},("reference"in e._.routes[s]||"reference"in e._.trip[d])&&(p[i].reference=[],p[i].referenceLookup={}),"reference"in e._.routes[s]&&"slug"in e._.routes[s].reference&&(p[i].reference.push(e._.routes[s].reference),p[i].referenceLookup[e._.routes[s].reference.slug]=""),"reference"in e._.trip[d]&&"slug"in e._.trip[d].reference&&(p[i].reference.push(e._.trip[d].reference),p[i].referenceLookup[e._.trip[d].reference.slug]=""),-1!==e.gtfsHead.stop_times.pickup_type&&e._.trip[d].setdown.length>0&&(p[i].setdown=e._.trip[d].setdown),-1!==e.gtfsHead.stop_times.drop_off_type&&e._.trip[d].pickup.length>0&&(p[i].pickup=e._.trip[d].pickup),u(e,s,e._.trip[d],o)&&(p[i].circular=1),"b"in e._.trip[d]&&(p[i].b=e._.trip[d].b),"t"in e._.trip[d]&&(p[i].t=e._.trip[d].t))}for(delete e._.nodeLookup,delete e._.routes,delete e._.trip,e.aquius.link=[],e.summary.network=[],f=0;f<e.aquius.network.length;f+=1)if("service"in e.aquius)for(e.summary.network.push([]),c=0;c<e.aquius.service.length;c+=1)e.summary.network[f].push(0);else e.summary.network.push([0]);for(r=Object.keys(p),f=0;f<r.length;f+=1){for(a=p[r[f]],c=0;c<a.service.length;c+=1){for(a.service[c]=a.service[c]/e._.dayFactor[c]*e.config.servicePer,g=0;g<e.aquius.network.length;g+=1)-1!==e.aquius.network[g][0].indexOf(a.product)&&(e.summary.network[g][c]+=a.service[c]);a.service[c]<10?a.service[c]=parseFloat(a.service[c].toPrecision(1)):a.service[c]=parseInt(a.service[c],10)}if(n=[[a.product],a.service,a.route,{}],"reference"in a){for(c=0;c<a.reference.length;c+=1)delete a.reference[c].slug;n[3].r=a.reference}"color"in a&&(n[3].o=a.color),"circular"in a&&(n[3].c=1),"direction"in a&&(n[3].d=1),"pickup"in a&&(n[3].u=a.pickup),"setdown"in a&&(n[3].s=a.setdown),"b"in a&&(n[3].b=a.b),e.aquius.link.push(n)}for(e.aquius.link.sort(function(e,t){return t[1].reduce(function(e,t){return e+t},0)-e[1].reduce(function(e,t){return e+t},0)}),f=0;f<e.summary.network.length;f+=1)for(c=0;c<e.summary.network[f].length;c+=1)e.summary.network[f][c]=Math.round(e.summary.network[f][c]);return delete e._.dayFactor,e}(i=function(e){var t,i,r,n,o,a,d,f,c,g,p={},u={};if(e._.routes={},e.config.routeExclude.length>0)for(c=0;c<e.config.routeExclude.length;c+=1)p[e.config.routeExclude[c]]="";if(e.config.routeInclude.length>0)for(c=0;c<e.config.routeInclude.length;c+=1)u[e.config.routeInclude[c]]="";for(c=0;c<e.gtfs.routes.length;c+=1)if(d=(a=e.gtfs.routes[c])[e.gtfsHead.routes.route_id],!(0!==e.config.routeExclude.length&&d in p!=0||0!==e.config.routeInclude.length&&d in u!=1)){if(e._.routes[d]={},o={slug:""},n="agency"===e.config.networkFilter.type&&-1!==e.gtfsHead.routes.agency_id&&a[e.gtfsHead.routes.agency_id]in e.config.productOverride?e.config.productOverride[a[e.gtfsHead.routes.agency_id]]:"mode"===e.config.networkFilter.type&&-1!==e.gtfsHead.routes.route_type&&a[e.gtfsHead.routes.route_type]in e.config.productOverride?e.config.productOverride[a[e.gtfsHead.routes.route_type]]:{},!0===e.config.allowRoute&&(t="",d in e.config.routeOverride&&"route_short_name"in e.config.routeOverride[d]?t=e.config.routeOverride[d].route_short_name:(-1!==e.gtfsHead.routes.route_short_name&&(t=a[e.gtfsHead.routes.route_short_name].trim()),""===t&&-1!==e.gtfsHead.routes.route_long_name&&(t=a[e.gtfsHead.routes.route_long_name].trim())),""!==t&&(o.n=t,o.slug+=t)),!0===e.config.allowColor)for(i=[["route_color","c"],["route_text_color","t"]],g=0;g<i.length;g+=1)t="",d in e.config.routeOverride&&i[g][0]in e.config.routeOverride[d]?t=e.config.routeOverride[d][i[g][0]]:i[g][0]in n?t=n[i[g][0]]:-1!==e.gtfsHead.routes[i[g][0]]&&(t=a[e.gtfsHead.routes[i[g][0]]].trim()),6===t.length&&(e=s(e,"color",t="#"+t),o[i[g][1]]=e._.color[t],o.slug+=t);e.config.allowRouteUrl&&(t="",d in e.config.routeOverride&&"route_url"in e.config.routeOverride[d]?t=e.config.routeOverride[d].route_url:-1!==e.gtfsHead.routes.route_url&&(t=a[e.gtfsHead.routes.route_url].trim()),""!==t&&(f="[*]",-1===(r=t.lastIndexOf(f))&&"n"in o&&-1!==(r=t.lastIndexOf(o.n))&&(t=t.substring(0,r)+f+t.substring(r+o.n.length)),-1===r&&-1!==(r=t.lastIndexOf(d))&&(t=t.substring(0,r)+f+t.substring(r+d.length),o.i=d),e=s(e,"url",t),o.u=e._.url[t],o.slug+=t)),"agency"===e.config.networkFilter.type?"agency_id"in e.gtfsHead.routes&&-1!==e.gtfsHead.routes.agency_id?e._.routes[d].product=e._.productIndex[a[e.gtfsHead.routes.agency_id]]:e._.routes[d].product=0:"mode"===e.config.networkFilter.type&&"route_type"in e.gtfsHead.routes&&-1!==e.gtfsHead.routes.route_type?e._.routes[d].product=e._.productIndex[a[e.gtfsHead.routes.route_type]]:e._.routes[d].product=e._.productIndex[Object.keys(e._.productIndex)[0]],Object.keys(o).length>1&&(e._.routes[d].reference=o)}return delete e._.productIndex,e}(i=function(e){var t,i,r,n,o,s,a,d,f,g,p,u,l,_,h,m,y,v,k,H,w;function F(e,t){var i;if(e.length!==t.length)return!1;for(i=0;i<e.length;i+=1)if(e[i]!==t[i])return!1;return!0}for(n=function(e){var t,i,r,n,o,s,a,d,f={},g={};if("frequencies"in e.gtfs&&-1!==e.gtfsHead.frequencies.trip_id&&-1!==e.gtfsHead.frequencies.start_time&&-1!==e.gtfsHead.frequencies.end_time&&-1!==e.gtfsHead.frequencies.headway_secs)for(s=0;s<e.gtfs.frequencies.length;s+=1){if((o=(i=e.gtfs.frequencies[s])[e.gtfsHead.frequencies.trip_id])in f==0)for(f[o]=[],a=0;a<e._.timeFactor.length;a+=1)f[o].push(0);i[e.gtfsHead.frequencies.start_time]in g==0&&(g[i[e.gtfsHead.frequencies.start_time]]=c(i[e.gtfsHead.frequencies.start_time])),n=g[i[e.gtfsHead.frequencies.start_time]],i[e.gtfsHead.frequencies.end_time]in g==0&&(g[i[e.gtfsHead.frequencies.end_time]]=c(i[e.gtfsHead.frequencies.end_time])),(t=g[i[e.gtfsHead.frequencies.end_time]])<n&&(t+=86400);for(a=0;a<e._.timeFactor.length;a+=1)if(1===e._.timeFactor[a].length&&1===e._.timeFactor[a][0].length&&0===e._.timeFactor[a][0][0])f[o][a]+=(t-n)/parseInt(i[e.gtfsHead.frequencies.headway_secs],10);else for(d=0;d<e._.timeFactor[a].length;d+=1)e._.timeFactor[a][d][0]<t&&(1===e._.timeFactor[a][d].length||n<e._.timeFactor[a][d][1])&&(r=1,e._.timeFactor[a][d][0]>n&&(r-=(e._.timeFactor[a][d][0]-n)/(t-n)),e._.timeFactor[a][d][1]<t&&(r-=(t-e._.timeFactor[a][d][1])/(t-n)),f[o][a]+=(t-n)*r/parseInt(i[e.gtfsHead.frequencies.headway_secs],10))}return f}(e),e._.trip={},e._.block={},m={},e.summary.service=[],k=0;k<e.gtfs.trips.length;k+=1)if((v=e.gtfs.trips[k])[e.gtfsHead.trips.service_id]in e._.serviceDays){for(y=v[e.gtfsHead.trips.trip_id],e._.trip[y]={route_id:v[e.gtfsHead.trips.route_id],service:[],service_id:v[e.gtfsHead.trips.service_id],stops:[]},-1!==e.gtfsHead.trips.direction_id?e._.trip[y].direction_id=v[e.gtfsHead.trips.direction_id]:e._.trip[y].direction_id="",H=0;H<e._.serviceDays[v[e.gtfsHead.trips.service_id]].length;H+=1)y in n?e._.trip[y].service.push(e._.serviceDays[v[e.gtfsHead.trips.service_id]][H]*n[y][H]):e._.trip[y].service.push(e._.serviceDays[v[e.gtfsHead.trips.service_id]][H]);-1!==e.gtfsHead.stop_times.pickup_type&&(e._.trip[y].setdown=[]),-1!==e.gtfsHead.stop_times.drop_off_type&&(e._.trip[y].pickup=[]),-1!==e.gtfsHead.trips.block_id&&""!==v[e.gtfsHead.trips.block_id]&&(e._.trip[y].block=v[e.gtfsHead.trips.block_id],v[e.gtfsHead.trips.block_id]in e._.block?e._.block[v[e.gtfsHead.trips.block_id]]+=1:e._.block[v[e.gtfsHead.trips.block_id]]=1),!0===e.config.allowHeadsign&&-1!==e.gtfsHead.trips.trip_headsign&&""!==(a=v[e.gtfsHead.trips.trip_headsign].trim())&&(e._.trip[y].reference={n:a,slug:a})}for(!0===e.config.allowDuplicate&&!1===e.config.allowSplit&&!1===e.config.allowCabotage?_=!1:(_=!0,r={}),s=Object.keys(e.gtfs.stop_times),k=0;k<s.length;k+=1)for(y=s[k],H=0;H<e.gtfs.stop_times[s[k]].length;H+=1)l=e.gtfs.stop_times[s[k]][H],y in e._.trip&&l[e.gtfsHead.stop_times.stop_id]in e._.nodeLookup&&(0===e._.trip[y].stops.length||e._.trip[y].stops[e._.trip[y].stops.length-1][1]!==e._.nodeLookup[l[e.gtfsHead.stop_times.stop_id]])&&(i=0,t=0,p=e._.nodeLookup[l[e.gtfsHead.stop_times.stop_id]],e._.trip[y].stops.push([l[e.gtfsHead.stop_times.stop_sequence],p]),-1!==e.gtfsHead.stop_times.departure_time&&""!==l[e.gtfsHead.stop_times.departure_time]&&(l[e.gtfsHead.stop_times.departure_time]in m==0&&(m[l[e.gtfsHead.stop_times.departure_time]]=c(l[e.gtfsHead.stop_times.departure_time])),i=m[l[e.gtfsHead.stop_times.departure_time]],("start"in e._.trip[y]==0||i<e._.trip[y].start)&&(e._.trip[y].start=i)),-1!==e.gtfsHead.stop_times.arrival_time&&""!==l[e.gtfsHead.stop_times.arrival_time]&&(l[e.gtfsHead.stop_times.arrival_time]in m==0&&(m[l[e.gtfsHead.stop_times.arrival_time]]=c(l[e.gtfsHead.stop_times.arrival_time])),t=m[l[e.gtfsHead.stop_times.arrival_time]],("end"in e._.trip[y]==0||t>e._.trip[y].end)&&(e._.trip[y].end=t)),-1!==e.gtfsHead.stop_times.pickup_type&&"1"===l[e.gtfsHead.stop_times.pickup_type]&&e._.trip[y].setdown.push(e._.nodeLookup[l[e.gtfsHead.stop_times.stop_id]]),-1!==e.gtfsHead.stop_times.drop_off_type&&"1"===l[e.gtfsHead.stop_times.drop_off_type]&&e._.trip[y].pickup.push(e._.nodeLookup[l[e.gtfsHead.stop_times.stop_id]]),_&&0!==t&&0!==i&&((o=[p,t,i,e._.trip[y].route_id,e._.trip[y].service_id,e._.trip[y].direction_id].join(":"))in r?("dup"in e._.trip[y]==0&&(e._.trip[y].dup={trip_id:r[o],stops:[]}),e._.trip[y].dup.stops.push(p)):r[o]=y));for(g=0,u=(s=Object.keys(e._.trip)).length-Object.keys(n).length,k=0;k<s.length;k+=1){if(s[k]in n==0){"start"in e._.trip[s[k]]&&"end"in e._.trip[s[k]]?(h=(e._.trip[s[k]].end-e._.trip[s[k]].start)/2+e._.trip[s[k]].start,d=Math.floor(h/3600),void 0===e.summary.service[d]?e.summary.service[d]=1/u:e.summary.service[d]+=1/u):h=null;for(H=0;H<e._.timeFactor.length;H+=1)if(e._.timeFactor[H].length>1||e._.timeFactor[H][0].length>1||0!==e._.timeFactor[H][0][0]){if(f=!1,null!==h)for(w=0;w<e._.timeFactor[H].length;w+=1)if(h>e._.timeFactor[H][w][0]&&(1===e._.timeFactor[H][w].length||h<e._.timeFactor[H][w][1])){f=!0;break}!1===f&&(e._.trip[s[k]].service[H]=0)}}if(_&&"dup"in e._.trip[s[k]])if(e._.trip[s[k]].dup.stops.length>1)if(y=e._.trip[s[k]].dup.trip_id,e.config.allowCabotage&&(-1!==e.gtfsHead.stop_times.pickup_type||-1!==e.gtfsHead.drop_off_type)&&("setdown"in e._.trip[s[k]]&&e._.trip[s[k]].setdown.length>0&&"setdown"in e._.trip[y]&&!1===F(e._.trip[y].setdown,e._.trip[s[k]].setdown)||"pickup"in e._.trip[s[k]]&&e._.trip[s[k]].pickup.length>0&&"pickup"in e._.trip[y]&&!1===F(e._.trip[y].pickup,e._.trip[s[k]].pickup)))"b"in e._.trip[y]?e._.trip[s[k]].b=e._.trip[y].b:(e._.trip[y].b=g,e._.trip[s[k]].b=g,g+=1),delete e._.trip[s[k]].dup;else if(e.config.allowSplit&&e._.trip[s[k]].dup.stops.length<e._.trip[s[k]].stops.length){for(e._.trip[s[k]].t=[],H=0;H<e._.trip[s[k]].stops.length;H+=1)-1===e._.trip[s[k]].dup.stops.indexOf(e._.trip[s[k]].stops[H])&&e._.trip[s[k]].t.push(e._.trip[s[k]].stops[H]);delete e._.trip[s[k]].dup}else!1===e.config.allowDuplication&&delete e._.trip[s[k]].dup;else delete e._.trip[s[k]].dup;e._.trip[s[k]].stops.length<2&&delete e._.trip[s[k]]}return delete e._.serviceDays,delete e._.timeFactor,e}(i=function(e){var t,i,o,s,a,d,f,g,p,u,l,_={},h={},m={},y=n(e.config.fromDate),v=n(e.config.toDate);function k(e){return["sunday","monday","tuesday","wednesday","thursday","friday","saturday"][new Date(e).getDay()]}function H(e){var t,i=0,r=Object.keys(e);for(t=0;t<r.length;t+=1)i+=e[r[t]];return i}for(e._.serviceDays={},e._.dayFactor=[],e._.timeFactor=[],i=0;v>=y;)h[r(y)]=y,i+=1,"serviceFilter"in e.config&&"period"in e.config.serviceFilter&&((g=k(y))in m?m[g]+=1:m[g]=1),y+=864e5;if("serviceFilter"in e.config&&"period"in e.config.serviceFilter)for(p=0;p<e.config.serviceFilter.period.length;p+=1){if("day"in e.config.serviceFilter.period[p])for(e._.dayFactor.push(0),u=0;u<e.config.serviceFilter.period[p].day.length;u+=1)e.config.serviceFilter.period[p].day[u]in m&&(e._.dayFactor[p]+=m[e.config.serviceFilter.period[p].day[u]]);else e._.dayFactor.push(i);if("time"in e.config.serviceFilter.period[p])for(e._.timeFactor.push([]),u=0;u<e.config.serviceFilter.period[p].time.length;u+=1)"start"in e.config.serviceFilter.period[p].time[u]?e._.timeFactor[p].push([c(e.config.serviceFilter.period[p].time[u].start)]):e._.timeFactor[p].push([0]),"end"in e.config.serviceFilter.period[p].time[u]&&e._.timeFactor[p][u].push(c(e.config.serviceFilter.period[p].time[u].end));else e._.timeFactor.push([[0]])}else e._.dayFactor.push(i),e._.timeFactor.push([[0]]);if("calendar"in e.gtfs)for(p=0;p<e.gtfs.calendar.length;p+=1)for(d=e.gtfs.calendar[p][e.gtfsHead.calendar.service_id],f=n(e.gtfs.calendar[p][e.gtfsHead.calendar.start_date]),o=n(e.gtfs.calendar[p][e.gtfsHead.calendar.end_date]),t=Object.keys(h),u=0;u<t.length;u+=1)h[t[u]]>=f&&h[t[u]]<=o&&(g=k(h[t[u]]),"1"===e.gtfs.calendar[p][e.gtfsHead.calendar[k(h[t[u]])]]&&(d in _==0&&(_[d]={}),g in _[d]==0?_[d][g]=1:_[d][g]+=1));if("calendar_dates"in e.gtfs&&-1!==e.gtfsHead.calendar_dates.service_id&&-1!==e.gtfsHead.calendar_dates.date&&-1!==e.gtfsHead.calendar_dates.exception_type)for(p=0;p<e.gtfs.calendar_dates.length;p+=1)e.gtfs.calendar_dates[p][e.gtfsHead.calendar_dates.date]in h&&(g=k(h[e.gtfs.calendar_dates[p][e.gtfsHead.calendar_dates.date]]),(d=e.gtfs.calendar_dates[p][e.gtfsHead.calendar_dates.service_id])in _==0?"1"===e.gtfs.calendar_dates[p][e.gtfsHead.calendar_dates.exception_type]&&(_[d]={},_[d][g]=1):("1"===e.gtfs.calendar_dates[p][e.gtfsHead.calendar_dates.exception_type]&&(g in _[d]?_[d][g]+=1:_[d][g]=1),"2"===e.gtfs.calendar_dates[p][e.gtfsHead.calendar_dates.exception_type]&&(g in _[d]==0||_[d][g]<=1?(delete _[d][g],0===Object.keys(_[d]).length&&delete _[d]):_[d][g]=_[d][g]-1)));for(s=Object.keys(_),p=0;p<s.length;p+=1)if("serviceFilter"in e.config&&"period"in e.config.serviceFilter){for(e._.serviceDays[s[p]]=[],a=0,u=0;u<e.config.serviceFilter.period.length;u+=1){if("day"in e.config.serviceFilter.period[u])for(i=0,l=0;l<e.config.serviceFilter.period[u].day.length;l+=1)e.config.serviceFilter.period[u].day[l]in _[s[p]]&&(i+=_[s[p]][e.config.serviceFilter.period[u].day[l]]);else i=H(_[s[p]]);e._.serviceDays[s[p]].push(i),a+=i}0===a&&delete e._.serviceDays[s[p]]}else(i=H(_[s[p]]))>0&&(e._.serviceDays[s[p]]=[i]);return e}(i=function(e,t){var i,r,n,o,s,a,d,f,c,u,l,_={},h=[],m=[],y=-1,v=Math.pow(10,e.config.coordinatePrecision),k=0,H={},w={},F=0,b={};if(e.aquius.place=[],"object"==typeof t&&"geojson"in t&&"type"in t.geojson&&"FeatureCollection"===t.geojson.type&&"features"in t.geojson&&Array.isArray(t.geojson.features)&&t.geojson.features.length>0){for(u=0;u<t.geojson.features.length;u+=1)null!==(i=p(t.geojson.features[u]))&&(h.push(u),_[u]={x:Math.round(i[0]*v)/v,y:Math.round(i[1]*v)/v});for(u=0;u<e.aquius.node.length;u+=1)m.push([e.aquius.node[u][0]+e.aquius.node[u][1],u]);for(m.sort(),u=0;u<m.length;u+=1){if(y=-1,g((d=e.aquius.node[m[u][1]])[0],d[1],t.geojson.features[k]))y=k;else{for((r={})[k]=k,l=0;l<h.length;l+=1)if(c=Math.abs(d[0]+d[1]-(_[h[l]].x+_[h[l]].y)),0===l&&(a=c),a>=c&&h[l]in r==0){if(g(d[0],d[1],t.geojson.features[h[l]])){y=h[l];break}r[h[l]]=h[l],Object.keys(r).length<5&&(a=c)}if(-1===y)for(l=0;l<t.geojson.features.length;l+=1)if(l in r==0&&g(d[0],d[1],t.geojson.features[l])){y=l;break}}-1!==y?(k=y,y in w?e.aquius.node[m[u][1]][2].p=w[y]:y in _&&((o=[_[y].x,_[y].y].join(":"))in H?n=H[o]:(e.aquius.place.push([_[y].x,_[y].y,{}]),n=e.aquius.place.length-1,H[o]=n),e.aquius.node[m[u][1]][2].p=n,w[y]=n,"properties"in t.geojson.features[y]&&e.config.populationProperty in t.geojson.features[y].properties&&(f=parseFloat(t.geojson.features[y].properties[e.config.populationProperty]),Number.isNaN(f)||("p"in e.aquius.place[n][2]==0&&(e.aquius.place[n][2].p=0),e.aquius.place[n][2].p+=f,e.aquius.place[n][2].p>F&&(F=e.aquius.place[n][2].p))))):!0===e.config.inGeojson&&(b[m[u][1]]="")}if(F>0&&"placeScale"in e.config.option==0&&(e.config.option.placeScale=Math.round(1/(F/2e6)*1e5)/1e5,e.aquius.option.placeScale=e.config.option.placeScale),Object.keys(b).length>0)for(s=Object.keys(e._.nodeLookup),u=0;u<s.length;u+=1)e._.nodeLookup[s[u]]in b&&delete e._.nodeLookup[s[u]]}return e}(i=function(e){var t,i,r,n;"nodeLookup"in e._==0&&(e._.nodeLookup={}),"nodeCoord"in e._==0&&(e._.nodeCoord={}),"node"in e.aquius==0&&(e.aquius.node=[]);for(n=0;n<e.gtfs.stops.length;n+=1)e.gtfs.stops[n].stop_id in e._.nodeLookup==0&&""!==e.gtfs.stops[n][e.gtfsHead.stops.stop_id]&&(e=f(e,t=d(e,e.gtfs.stops[n]),e.gtfs.stops[n][e.gtfsHead.stops.stop_id]),(r=t[0].toString()+","+t[1].toString())in e._.nodeCoord?i=e._.nodeCoord[r]:(i=e.aquius.node.length,e.aquius.node.push([t[0],t[1],{}]),e._.nodeCoord[r]=i),e._.nodeLookup[e.gtfs.stops[n][e.gtfsHead.stops.stop_id]]=i,e=a(e,e.gtfs.stops[n],i));return delete e._.nodeCoord,e}(i=function(e){var t,i,r,n,o,s,c;if("transfers"in e.gtfs&&-1!==e.gtfsHead.transfers.from_stop_id&&-1!==e.gtfsHead.transfers.to_stop_id&&1!==e.gtfsHead.transfers.transfer_type){"nodeLookup"in e._==0&&(e._.nodeLookup={}),"nodeCoord"in e._==0&&(e._.nodeCoord={}),"node"in e.aquius==0&&(e.aquius.node=[]);for(s=0;s<e.gtfs.transfers.length;s+=1)if(""!==e.gtfs.transfers[s][e.gtfsHead.transfers.from_stop_id]&&(n=e._.nodeLookup[e.gtfs.transfers[s][e.gtfsHead.transfers.from_stop_id]])!==(o=e._.nodeLookup[e.gtfs.transfers[s][e.gtfsHead.transfers.to_stop_id]]))if(void 0!==n&&void 0!==o);else if(void 0!==n)e._.nodeLookup[o]=n;else if(void 0!==o)e._.nodeLookup[n]=o;else if(void 0===n&&void 0===o)for(c=0;c<e.gtfs.stops.length;c+=1)if(e.gtfs.stops[c][e.gtfsHead.stops.stop_id]===n){e=f(e,t=d(e,e.gtfs.stops[c]),e.gtfs.stops[c][e.gtfsHead.stops.stop_id]),(r=t[0].toString()+","+t[1].toString())in e._.nodeCoord?i=e._.nodeCoord[r]:(i=e.aquius.node.length,e.aquius.node.push([t[0],t[1],{}]),e._.nodeCoord[r]=i),e._.nodeLookup[n]=i,e._.nodeLookup[o]=i,e=a(e,e.gtfs.stops[c],i);break}}return e}(i=function(e){var t,i,r,n,o=[];if(-1!==e.gtfsHead.stops.location_type&&-1!==e.gtfsHead.stops.parent_station){"nodeLookup"in e._==0&&(e._.nodeLookup={}),"nodeCoord"in e._==0&&(e._.nodeCoord={}),"node"in e.aquius==0&&(e.aquius.node=[]);for(n=0;n<e.gtfs.stops.length;n+=1)"1"===e.gtfs.stops[n][e.gtfsHead.stops.location_type]?(e=f(e,t=d(e,e.gtfs.stops[n]),e.gtfs.stops[n][e.gtfsHead.stops.stop_id]),(r=t[0].toString()+","+t[1].toString())in e._.nodeCoord?i=e._.nodeCoord[r]:(i=e.aquius.node.length,e.aquius.node.push([t[0],t[1],{}]),e._.nodeCoord[r]=i),e._.nodeLookup[e.gtfs.stops[n][e.gtfsHead.stops.stop_id]]=i,e=a(e,e.gtfs.stops[n],i)):""!==e.gtfs.stops[n][e.gtfsHead.stops.parent_station]&&o.push([e.gtfs.stops[n][e.gtfsHead.stops.stop_id],e.gtfs.stops[n][e.gtfsHead.stops.parent_station]]);for(n=0;n<o.length;n+=1)o[n][1]in e._.nodeLookup&&(e._.nodeLookup[o[n][0]]=e._.nodeLookup[o[n][1]])}return e}(i=function(e){var t,i;if("serviceFilter"in e.config&&"type"in e.config.serviceFilter&&"period"===e.config.serviceFilter.type){"period"in e.config.serviceFilter!=0&&Array.isArray(e.config.serviceFilter.period)&&0!==e.config.serviceFilter.period.length||(t=["monday","tuesday","wednesday","thursday","friday"],e.config.serviceFilter.period=[{name:{"en-US":"Typical day"}},{day:t,name:{"en-US":"Typical weekday"}},{day:t,name:{"en-US":"Weekday early"},time:[{end:"10:00:00"}]},{day:t,name:{"en-US":"Weekday 10:00-17:00"},time:[{start:"10:00:00",end:"17:00:00"}]},{day:t,name:{"en-US":"Weekday evening"},time:[{start:"17:00:00"}]},{day:["saturday"],name:{"en-US":"Saturday"}},{day:["sunday"],name:{"en-US":"Sunday"}}]),e.aquius.service=[];for(i=0;i<e.config.serviceFilter.period.length;i+=1)"name"in e.config.serviceFilter.period[i]==0&&(e.config.serviceFilter.period[i].name={"en-US":"Period "+i}),e.aquius.service.push([[i],e.config.serviceFilter.period[i].name,{}])}return e}(i=function(e){var t,i,r,n,o,s={0:{"en-US":"Tram"},1:{"en-US":"Metro"},2:{"en-US":"Rail"},3:{"en-US":"Bus"},4:{"en-US":"Ferry"},5:{"en-US":"Cable car"},6:{"en-US":"Cable car"},7:{"en-US":"Funicular"},100:{"en-US":"Rail"},101:{"en-US":"High speed rail"},102:{"en-US":"Long distance rail"},103:{"en-US":"Inter-regional rail"},105:{"en-US":"Sleeper rail"},106:{"en-US":"Regional rail"},107:{"en-US":"Tourist rail"},108:{"en-US":"Rail shuttle"},109:{"en-US":"Suburban rail"},200:{"en-US":"Coach"},201:{"en-US":"International coach"},202:{"en-US":"National coach"},204:{"en-US":"Regional coach"},208:{"en-US":"Commuter coach"},400:{"en-US":"Urban rail"},401:{"en-US":"Metro"},402:{"en-US":"Underground"},405:{"en-US":"Monorail"},700:{"en-US":"Bus"},701:{"en-US":"Regional bus"},702:{"en-US":"Express bus"},704:{"en-US":"Local bus"},800:{"en-US":"Trolleybus"},900:{"en-US":"Tram"},1000:{"en-US":"Water"},1300:{"en-US":"Telecabin"},1400:{"en-US":"Funicular"},1501:{"en-US":"Shared taxi"},1700:{"en-US":"Other"},1701:{"en-US":"Cable car"},1702:{"en-US":"Horse-drawn"}};switch("type"in e.config.networkFilter==0&&(e.config.networkFilter.type="agency"),"reference"in e.config.networkFilter==0&&(e.config.networkFilter.reference=[]),e._.productIndex={},"reference"in e.aquius==0&&(e.aquius.reference={}),e.config.networkFilter.type){case"mode":if("route_type"in e.gtfsHead.routes&&-1!==e.gtfsHead.routes.route_type&&e.gtfs.routes.length>0)for(t=0,n=0;n<e.gtfs.routes.length;n+=1)e.gtfs.routes[n][e.gtfsHead.routes.route_type]in e._.productIndex==0&&(e._.productIndex[e.gtfs.routes[n][e.gtfsHead.routes.route_type]]=t,t>=e.config.networkFilter.reference.length&&(e.gtfs.routes[n][e.gtfsHead.routes.route_type]in s?e.config.networkFilter.reference[t]=s[e.gtfs.routes[n][e.gtfsHead.routes.route_type]]:e.config.networkFilter.reference[t]={}),t+=1);break;case"agency":default:if(e.config.networkFilter.type="agency","agency"in e.gtfs&&"agency_id"in e.gtfsHead.agency&&1!==e.gtfsHead.agency.agency_id&&e.gtfs.agency.length>0)for(t=0,n=0;n<e.gtfs.agency.length;n+=1)e.gtfs.agency[n][e.gtfsHead.agency.agency_id]in e._.productIndex==0&&(e._.productIndex[e.gtfs.agency[n][e.gtfsHead.agency.agency_id]]=t,t>=e.config.networkFilter.reference.length&&(-1!==e.gtfsHead.agency.agency_name?e.config.networkFilter.reference[t]={"en-US":e.gtfs.agency[n][e.gtfsHead.agency.agency_name]}:e.config.networkFilter.reference[t]={"en-US":e.gtfs.agency[n][e.gtfsHead.agency.agency_id]}),t+=1);else e._.productIndex.agency=0,e.config.networkFilter.reference.push({})}if(e.aquius.reference.product=e.config.networkFilter.reference,"network"in e.config.networkFilter==0||!Array.isArray(e.config.networkFilter.network))switch(e.config.networkFilter.network=[],i=Object.keys(e._.productIndex),e.config.networkFilter.type){case"mode":if(e.config.networkFilter.network.push([i,{"en-US":"All modes"}]),i.length>1)for(n=0;n<i.length;n+=1)i[n]in s?e.config.networkFilter.network.push([[i[n]],s[i[n]]]):e.config.networkFilter.network.push([[i[n]],{"en-US":"Mode #"+i[n]}]);break;case"agency":if(e.config.networkFilter.network.push([i,{"en-US":"All operators"}]),i.length>1)for(n=0;n<i.length;n+=1)if("agency"in e.gtfs&&-1!==e.gtfsHead.agency.agency_id&&-1!==e.gtfsHead.agency.agency_name){for(o=0;o<e.gtfs.agency.length;o+=1)if(e.gtfs.agency[o][e.gtfsHead.agency.agency_id]===i[n]){e.config.networkFilter.network.push([[i[n]],{"en-US":e.gtfs.agency[o][e.gtfsHead.agency.agency_name]}]);break}}else e.config.networkFilter.network.push([[i[n]],{"en-US":i[n]}]);break;default:e.config.networkFilter.network.push([i,{"en-US":"All"}])}for(e.aquius.network=[],n=0;n<e.config.networkFilter.network.length;n+=1)if(e.config.networkFilter.network[n].length>1&&Array.isArray(e.config.networkFilter.network[n][0])&&"object"==typeof e.config.networkFilter.network[n][1]){for(r=[],o=0;o<e.config.networkFilter.network[n][0].length;o+=1)r.push(e._.productIndex[e.config.networkFilter.network[n][0][o]]);e.aquius.network.push([r,e.config.networkFilter.network[n][1],{}])}return e}(i=function(e){if("schema"in e.config.meta!=0&&"0"===e.config.meta.schema||(e.config.meta.schema="0"),"name"in e.config.meta==0&&(e.config.meta.name={}),"en-US"in e.config.meta.name==0&&("feed_info"in e.gtfs&&-1!==e.gtfsHead.feed_info.feed_publisher_name&&e.gtfs.feed_info.length>0?e.config.meta.name["en-US"]=e.gtfs.feed_info[0][e.gtfsHead.feed_info.feed_publisher_name]+" ":e.config.meta.name["en-US"]="",e.config.meta.name["en-US"]+="("+e.config.fromDate,e.config.fromDate!==e.config.toDate&&(e.config.meta.name["en-US"]+="-"+e.config.toDate),e.config.meta.name["en-US"]+=")"),"url"in e.config.meta==0&&"feed_info"in e.gtfs&&-1!==e.gtfsHead.feed_info.feed_publisher_url&&e.gtfs.feed_info.length>0&&(e.config.meta.url=e.gtfs.feed_info[0][e.gtfsHead.feed_info.feed_publisher_url]),e.aquius.meta=e.config.meta,"en-US"in e.config.translation==0&&(e.config.translation["en-US"]={}),"link"in e.config.translation["en-US"]==0)switch(e.config.servicePer){case 1:e.config.translation["en-US"].link="Daily Services";break;case 7:e.config.translation["en-US"].link="Weekly Services";break;default:e.config.translation["en-US"].link="Services per "+e.config.servicePer+" Days"}return e.aquius.translation=e.config.translation,"c"in e.config.option!=0&&"k"in e.config.option!=0||(e.config.option.c=parseFloat(e.gtfs.stops[0][e.gtfsHead.stops.stop_lon]),e.config.option.k=parseFloat(e.gtfs.stops[0][e.gtfsHead.stops.stop_lat]),e.config.option.m=12),"x"in e.config.option!=0&&"y"in e.config.option!=0||(e.config.option.x=parseFloat(e.gtfs.stops[0][e.gtfsHead.stops.stop_lon]),e.config.option.y=parseFloat(e.gtfs.stops[0][e.gtfsHead.stops.stop_lat]),e.config.option.z=10),e.aquius.option=e.config.option,e}(i)))))),t))))),t)}};