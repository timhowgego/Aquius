var gtfsToAquius=gtfsToAquius||{init:function(e){"use strict";function t(e,t,s){var r,i,o,n=document.createElement(e);if(void 0!==t)for(r=Object.keys(t),o=0;o<r.length;o+=1)n[r[o]]=t[r[o]];if(void 0!==s)for(i=Object.keys(s),o=0;o<i.length;o+=1)n.style[i[o]]=s[i[o]];return n}function s(e,s,r,i){var o,n,a,f,d,g=t("table");if(void 0!==i&&g.appendChild(t("caption",{textContent:i})),s.length>0){for(a=t("tr"),f=0;f<s.length;f+=1)"object"==typeof s[f]?((n=t("th")).appendChild(s[f]),a.appendChild(n)):a.appendChild(t("th",{textContent:s[f].toString()}));g.appendChild(a)}for(f=0;f<e.length;f+=1){for(a=t("tr"),d=0;d<e[f].length;d+=1)"object"==typeof e[f][d]?(o=t("td")).appendChild(e[f][d]):o=t("td",{textContent:e[f][d].toString()}),void 0!==r&&r.length>d&&(o.className=r[d]),a.appendChild(o);g.appendChild(a)}return g}function r(e,r,o){var n,a,f,d,g,u,c,p=o._vars,l=document.getElementById(p.configId+"ImportFiles"),_=document.getElementById(p.configId+"Output"),m=document.getElementById(p.configId+"Progress");if(void 0!==e)return i(e,p),!1;if(!_||!m)return!1;for(;_.firstChild;)_.removeChild(_.firstChild);for(;m.firstChild;)m.removeChild(m.firstChild);for(null!==l&&(l.disabled=!1),_.className="",a=["aquius","config"],c=0;c<a.length;c+=1)a[c]in r&&Object.keys(r[a[c]]).length>0&&m.appendChild(t("a",{className:p.configId+"Download",href:window.URL.createObjectURL(new Blob([JSON.stringify(r[a[c]])],{type:"application/json;charset=utf-8"})),download:a[c]+".json",textContent:"Save "+a[c]+".json",role:"button"}));if(n="translation"in r.aquius&&"en-US"in r.aquius.translation&&"link"in r.aquius.translation["en-US"]?r.aquius.translation["en-US"].link:"Services","undefined"!=typeof aquius&&(_.appendChild(t("div",{id:p.configId+"Map"},{height:document.documentElement.clientHeight/2+"px"})),aquius.init(p.configId+"Map",{dataObject:r.aquius,uiStore:!1})),"aquius"in r&&"network"in r.aquius&&"summary"in r&&"network"in r.summary){if(u=["Network"],g=[p.configId+"Text"],"service"in r.aquius==!1||0===r.aquius.service.length)u.push("Service"),g.push(p.configId+"Number");else for(c=0;c<r.aquius.service.length;c+=1)"en-US"in r.aquius.service[c][1]?u.push(r.aquius.service[c][1]["en-US"]):u.push(JSON.stringify(r.aquius.service[c][1])),g.push(p.configId+"Number");for(d=[],c=0;c<r.summary.network.length;c+=1)"en-US"in r.aquius.network[c][1]?d.push([r.aquius.network[c][1]["en-US"]].concat(r.summary.network[c])):d.push([JSON.stringify(r.aquius.network[c][1])].concat(r.summary.network[c]));_.appendChild(s(d,u,g,n+" by Network"))}if("summary"in r&&"service"in r.summary){for(f=0,c=0;c<r.summary.service.length;c+=1)void 0!==r.summary.service[c]&&r.summary.service[c]>f&&(f=r.summary.service[c]);if(f>0){for(d=[],c=0;c<r.summary.service.length;c+=1)void 0===r.summary.service[c]?d.push([c,"-",""]):d.push([c,(100*r.summary.service[c]).toFixed(1),t("span",{},{"background-color":"#000",display:"inline-block",height:"7px",width:Math.round(r.summary.service[c]/f*100)+"%"})]);_.appendChild(s(d,["Hour","% Service","Histogram"],[p.configId+"Number",p.configId+"Number",p.configId+"Histogram"],n+" by Hour (scheduled only)"))}}}function i(e,s){var r,i=document.getElementById(s.configId+"ImportFiles"),o=document.getElementById(s.configId+"Output"),n=document.getElementById(s.configId+"Progress");if(void 0!==e&&null!==o){for(;o.firstChild;)o.removeChild(o.firstChild);if(o.className=s.configId+"OutputError",r="message"in e?e.message:JSON.stringify(e),o.appendChild(t("p",{textContent:"Error: "+r})),null!==n){for(;n.firstChild;)n.removeChild(n.firstChild);n.textContent="Failed"}null!==i&&(i.disabled=!1)}}return function(e){var s,o,n,a=document.getElementById(e.configId);if(!a)return!1;for(;a.firstChild;)a.removeChild(a.firstChild);return Object.keys&&[].indexOf&&"object"==typeof JSON&&window.File&&window.FileReader&&window.Blob?(document.head.appendChild(t("script",{src:"https://timhowgego.github.io/Aquius/dist/aquius.min.js",type:"text/javascript"})),o=t("form",{className:e.configId+"Input"}),n=t("label",{textContent:"GTFS as .txt, optional config, and optional GeoJSON to process:"}),(s=t("input",{id:e.configId+"ImportFiles",multiple:"multiple",name:e.configId+"ImportFiles[]",type:"file"})).addEventListener("change",function(){!function(e){var t,s,o,n={},a=document.getElementById(e.configId+"ImportFiles"),f={_vars:e,callback:r},d=0,g=document.getElementById(e.configId+"Progress"),u=0;function c(e,s){var r,i,o=e.toLowerCase().split(".");r=o.length>1?o.pop():"txt";try{switch(r){case"csv":case"txt":n[o.join("")]=s;break;case"geojson":case"js":case"json":"type"in(i=JSON.parse(s))&&"FeatureCollection"===i.type?f.geojson=i:f.config=i}}catch(e){t=e}}if(null!==a&&a.files.length>0){if(a.disabled=!0,null!==g){for(;g.firstChild;)g.removeChild(g.firstChild);g.textContent="Working..."}!function(r){for(u=r.length,o=0;o<u;o+=1)(s=new FileReader).onerror=function(e){t=new Error("Could not read "+e.name),s.abort()},s.onload=function(s){return function(){c(s.name,this.result),(d+=1)===u&&(void 0!==t?i(t,e):e.process(n,f))}}(r[o]),s.readAsText(r[o])}(a.files)}}(e)},!1),n.appendChild(s),o.appendChild(n),o.appendChild(t("span",{id:e.configId+"Progress"})),a.appendChild(o),a.appendChild(t("div",{id:e.configId+"Output"})),!0):(a.appendChild(document.createTextNode("Browser not supported: Try a modern browser")),!1)}({configId:e,process:this.process})},process:function(e,t){"use strict";var s={_:{},aquius:{},config:{},summary:{}};function r(e){var t=new Date(e),s=t.getFullYear().toString();return t.getMonth()<9&&(s+="0"),s+=(t.getMonth()+1).toString(),t.getDate()<10&&(s+="0"),s+=t.getDate().toString()}function i(e){return e.length<8?0:Date.UTC(e.slice(0,4),e.slice(4,6)-1,e.slice(6,8))}function o(e){var t,s=new RegExp('(\\,|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^\\,\\r\\n]*))',"gi"),r=s.exec(e),i=[[]];for(e=e.trim();null!==r;)r[1].length&&","!==r[1]&&i.push([]),t=r[2]?r[2].replace(new RegExp('""',"g"),'"'):r[3],i[i.length-1].push(t),r=s.exec(e);return i}function n(e,t,s){return"reference"in e.aquius==!1&&(e.aquius.reference={}),t in e.aquius.reference==!1&&(e.aquius.reference[t]=[],e._[t]={}),s in e._[t]==!1&&(e.aquius.reference[t].push(s),e._[t][s]=e.aquius.reference[t].length-1),e}function a(e,t){var s,r,i,o,a={};return!0===e.config.allowName&&(r="",-1!==e.gtfsHead.stops.stop_name&&(r=t[e.gtfsHead.stops.stop_name].trim()),-1!==e.gtfsHead.stops.stop_code&&""!==(s=t[e.gtfsHead.stops.stop_code].trim())&&(""===r?r=s:r+=" ("+s+")"),""!==r&&(a.n=r)),!0===e.config.allowURL&&-1!==e.gtfsHead.stops.stop_url&&""!==(r=t[e.gtfsHead.stops.stop_url].trim())&&(o="[*]",-1===(i=r.lastIndexOf(o))&&-1!==e.gtfsHead.stops.stop_code&&(s=t[e.gtfsHead.stops.stop_code].trim(),-1!==(i=r.lastIndexOf(s))&&(r=r.substring(0,i)+o+r.substring(i+o.length+1),a.i=s)),-1===i&&-1!==e.gtfsHead.stops.stop_id&&(s=t[e.gtfsHead.stops.stop_id].trim(),-1!==(i=r.lastIndexOf(s))&&(r=r.substring(0,i)+o+r.substring(i+o.length+1),a.i=s)),e=n(e,"url",r),a.u=e._.url[r]),Object.keys(a).length>0&&(e.aquius.node[e.aquius.node.length-1][2].r=[a]),e}function f(e){return e=parseFloat(e),Number.isNaN(e)?0:Math.round(1e5*e)/1e5}function d(e){var t,s,r=e.split(":");if(3!==r.length)return 0;for(s=0;s<r.length;s+=1){if(t=parseInt(r[s],10),Number.isNaN(t))return 0;r[s]=t}return 3600*r[0]+60*r[1]+r[2]}function g(e,t,s){var r;function i(e,t,s){var r,i,o,n,a,f,d,g;if(Array.isArray(s))for(f=0;f<s.length;f+=1)if(Array.isArray(s[f])){for(r=!1,d=0,g=s[f].length-1;d<s[f].length;g=d++)i=s[f][d][0],n=s[f][d][1],o=s[f][g][0],n>t!=(a=s[f][g][1])>t&&e<(o-i)*(t-n)/(a-n)+i&&(r=!r);if(r)return!0}return!1}if("geometry"in s==!1||"type"in s.geometry==!1||"coordinates"in s.geometry==!1||!Array.isArray(s.geometry.coordinates))return!1;if("MultiPolygon"===s.geometry.type)for(r=0;r<s.geometry.coordinates.length;r+=1)if(i(e,t,s.geometry.coordinates[r]))return!0;return"Polygon"===s.geometry.type&&i(e,t,s.geometry.coordinates)}function u(e){var t,s={};function r(e){var t,s,r={};if(Array.isArray(e))for(t=0;t<e.length;t+=1)if(Array.isArray(e[t]))for(s=0;s<e[t].length;s+=1)Array.isArray(e[t][s])&&2===e[t][s].length&&("maxX"in r==!1?(r.maxX=e[t][s][0],r.minX=e[t][s][0],r.maxY=e[t][s][1],r.minY=e[t][s][1]):(e[t][s][0]>r.maxX?r.maxX=e[t][s][0]:e[t][s][0]<r.minX&&(r.minX=e[t][s][0]),e[t][s][1]>r.maxY?r.maxY=e[t][s][1]:e[t][s][1]<r.minY&&(r.minY=e[t][s][1])));return r}if("geometry"in e&&"type"in e.geometry&&"coordinates"in e.geometry&&Array.isArray(e.geometry.coordinates)){if("MultiPolygon"===e.geometry.type)for(t=0;t<e.geometry.coordinates.length;t+=1)s=r(e.geometry.coordinates[t]);"Polygon"===e.geometry.type&&(s=r(e.geometry.coordinates))}return"maxX"in s?{x:Math.round((s.maxX+s.minX)/2*1e5)/1e5,y:Math.round((s.maxY+s.minY)/2*1e5)/1e5}:null}function c(e,t,s){var r;return"_"in e&&delete e._,"object"==typeof s&&"callback"in s?("error"in e&&(r=new Error(e.error.join(". "))),s.callback(r,e,s),!0):e}return"error"in(s=function(e,t){var s,r,i,n,a;e.gtfsHead={calendar:{service_id:-1,monday:-1,tuesday:-1,wednesday:-1,thursday:-1,friday:-1,saturday:-1,sunday:-1,start_date:-1,end_date:-1},calendar_dates:{service_id:-1,date:-1,exception_type:-1},frequencies:{trip_id:-1,start_time:-1,end_time:-1,headway_secs:-1},routes:{route_color:-1,route_id:-1,route_long_name:-1,route_short_name:-1,route_text_color:-1,route_url:-1},stop_times:{arrival_time:-1,departure_time:-1,trip_id:-1,stop_id:-1,stop_sequence:-1,pickup_type:-1,drop_off_type:-1},stops:{stop_code:-1,stop_id:-1,stop_lat:-1,stop_lon:-1,stop_name:-1,stop_url:-1,location_type:-1,parent_station:-1},transfers:{from_stop_id:-1,to_stop_id:-1,transfer_type:-1},trips:{route_id:-1,service_id:-1,trip_id:-1}},i={routes:["route_id"],stops:["stop_id","stop_lat","stop_lon"],trips:["route_id","service_id","trip_id"],stop_times:["trip_id","stop_id","stop_sequence"]},"type"in e.config.networkFilter&&"agency"===e.config.networkFilter.type&&(e.gtfsHead.agency={agency_id:-1,agency_name:-1},e.gtfsHead.routes.agency_id=-1),"type"in e.config.networkFilter&&"mode"===e.config.networkFilter.type&&(e.gtfsHead.routes.route_type=-1),"name"in e.config.meta!=0&&"en-US"in e.config.meta.name!=0||("feed_info"in e.gtfsHead==0&&(e.gtfsHead.feed_info={}),e.gtfsHead.feed_info.feed_publisher_name=-1),"url"in e.config.meta==0&&("feed_info"in e.gtfsHead==0&&(e.gtfsHead.feed_info={}),e.gtfsHead.feed_info.feed_publisher_url=-1),e.gtfs={},r=Object.keys(e.gtfsHead);for(n=0;n<r.length;n+=1)if(r[n]in t&&(s=o(t[r[n]])).length>1){for(a=0;a<s[0].length;a+=1)s[0][a]in e.gtfsHead[r[n]]&&(e.gtfsHead[r[n]][s[0][a]]=a);e.gtfs[r[n]]=s.splice(1)}for(r=Object.keys(i),n=0;n<r.length;n+=1)if(r[n]in e.gtfs==0)"error"in e==0&&(e.error=[]),e.error.push("Missing GTFS "+r[n]+".txt");else if(r[n]in e.gtfsHead)for(a=0;a<i[r[n]].length;a+=1)i[r[n]][a]in e.gtfsHead[r[n]]!=0&&-1!==e.gtfsHead[r[n]][i[r[n]][a]]||("error"in e==0&&(e.error=[]),e.error.push("Missing value "+i[r[n]][a]+" in GTFS "+r[n]+".txt"));return e}(s=function(e,t){var s,i={allowColor:!0,allowName:!0,allowRoute:!0,allowURL:!0,fromDate:r(Date.now()),meta:{schema:"0"},networkFilter:{type:"agency"},option:{},populationProperty:"population",productOverride:{},serviceFilter:{},servicePer:1,toDate:r(Date.now()+5184e5),translation:{}},o=Object.keys(i);for("object"!=typeof t&&(t={}),s=0;s<o.length;s+=1)"config"in t&&o[s]in t.config&&typeof t.config[o[s]]==typeof i[o[s]]?e.config[o[s]]=t.config[o[s]]:e.config[o[s]]=i[o[s]];return e}(s,t),e))?c(s,0,t):c(s=function(e,t){var s,r,i,o,n,a,f,d={},c=[],p=[],l=-1,_=0,m={},y=0;if(e.aquius.place=[],"object"==typeof t&&"geojson"in t&&"type"in t.geojson&&"FeatureCollection"===t.geojson.type&&"features"in t.geojson&&Array.isArray(t.geojson.features)&&t.geojson.features.length>0){for(a=0;a<t.geojson.features.length;a+=1)null!==(s=u(t.geojson.features[a]))&&(c.push(a),d[a]=s);for(a=0;a<e.aquius.node.length;a+=1)p.push([e.aquius.node[a][0]+e.aquius.node[a][1],a]);for(p.sort(),a=0;a<p.length;a+=1){if(l=-1,g(e.aquius.node[p[a][1]][0],e.aquius.node[p[a][1]][1],t.geojson.features[_]))l=_;else{for((r={})[_]=_,f=0;f<c.length;f+=1)if(n=Math.abs(e.aquius.node[p[a][1]][0]+e.aquius.node[p[a][1]][1]-(d[c[f]].x+d[c[f]].y)),0===f&&(i=n),i>=n&&c[f]in r==0){if(g(e.aquius.node[p[a][1]][0],e.aquius.node[p[a][1]][1],t.geojson.features[c[f]])){l=c[f];break}r[c[f]]=c[f],Object.keys(r).length<5&&(i=n)}if(-1===l)for(f=0;f<t.geojson.features.length;f+=1)if(f in r==0&&g(e.aquius.node[p[a][1]][0],e.aquius.node[p[a][1]][1],t.geojson.features[f])){l=f;break}}-1!==l&&(_=l,l in m?e.aquius.node[p[a][1]][2].p=m[l]:l in d&&(e.aquius.place.push([d[l].x,d[l].y,{}]),e.aquius.node[p[a][1]][2].p=e.aquius.place.length-1,m[l]=e.aquius.place.length-1,"properties"in t.geojson.features[l]&&e.config.populationProperty in t.geojson.features[l].properties&&(o=parseFloat(t.geojson.features[l].properties[e.config.populationProperty]),Number.isNaN(o)||(e.aquius.place[e.aquius.place.length-1][2].p=o,o>y&&(y=o)))))}y>0&&"placeScale"in e.config.option==0&&(e.config.option.placeScale=Math.round(1/(y/2e6)*1e5)/1e5,e.aquius.option.placeScale=e.config.option.placeScale)}return e}(s=function(e){var t,s,r,i,o,n,a,f,d={};function g(e){var t,s;if(e.length<3||e[0]!==e[e.length-1])return 0;for(t=e.slice(1,e.length-2),s=0;s<t.length;s+=1)if(t.indexOf(t[s])!==t.lastIndexOf(t[s]))return 0;return 1}function u(e,t){var s,r;if(1===e.length&&e.length===t.length)return[e[0]+t[0]];for(s=[],r=0;r<e.length;r+=1)r<t.length&&s.push(e[r]+t[r]);return s}for(n=0;n<e.gtfs.trips.length;n+=1)if(e.gtfs.trips[n][e.gtfsHead.trips.trip_id]in e._.trip){for(o=[],e._.trip[e.gtfs.trips[n][e.gtfsHead.trips.trip_id]].stops.sort(function(e,t){return e[0]-t[0]}),a=0;a<e._.trip[e.gtfs.trips[n][e.gtfsHead.trips.trip_id]].stops.length;a+=1)o.push(e._.trip[e.gtfs.trips[n][e.gtfsHead.trips.trip_id]].stops[a][1]);s="f"+e._.routes[e.gtfs.trips[n][e.gtfsHead.trips.route_id]].product,-1!==e.gtfsHead.stop_times.pickup_type&&e._.trip[e.gtfs.trips[n][e.gtfsHead.trips.trip_id]].setdown.length>0&&(e._.trip[e.gtfs.trips[n][e.gtfsHead.trips.trip_id]].setdown.sort(),s+="s"+e._.trip[e.gtfs.trips[n][e.gtfsHead.trips.trip_id]].setdown.join(":")),-1!==e.gtfsHead.stop_times.drop_off_type&&e._.trip[e.gtfs.trips[n][e.gtfsHead.trips.trip_id]].pickup.length>0&&(e._.trip[e.gtfs.trips[n][e.gtfsHead.trips.trip_id]].pickup.sort(),s+="p"+e._.trip[e.gtfs.trips[n][e.gtfsHead.trips.trip_id]].pickup.join(":")),t=o.slice().reverse().join(":")+s,(s=o.join(":")+s)in d?(d[s].service=u(d[s].service,e._.trip[e.gtfs.trips[n][e.gtfsHead.trips.trip_id]].service),"reference"in e._.routes[e.gtfs.trips[n][e.gtfsHead.trips.route_id]]&&Object.keys(e._.routes[e.gtfs.trips[n][e.gtfsHead.trips.route_id]].reference).length>1&&e._.routes[e.gtfs.trips[n][e.gtfsHead.trips.route_id]].reference.slug in d[s].referenceLookup==0&&(d[s].reference.push(e._.routes[e.gtfs.trips[n][e.gtfsHead.trips.route_id]].reference),d[s].referenceLookup[e._.routes[e.gtfs.trips[n][e.gtfsHead.trips.route_id]].reference.slug]=e._.routes[e.gtfs.trips[n][e.gtfsHead.trips.route_id]].reference.slug)):t in d?(d[t].service=u(d[t].service,e._.trip[e.gtfs.trips[n][e.gtfsHead.trips.trip_id]].service),"reference"in e._.routes[e.gtfs.trips[n][e.gtfsHead.trips.route_id]]&&Object.keys(e._.routes[e.gtfs.trips[n][e.gtfsHead.trips.route_id]].reference).length>1&&e._.routes[e.gtfs.trips[n][e.gtfsHead.trips.route_id]].reference.slug in d[t].referenceLookup==0&&(d[t].reference.push(e._.routes[e.gtfs.trips[n][e.gtfsHead.trips.route_id]].reference),d[t].referenceLookup[e._.routes[e.gtfs.trips[n][e.gtfsHead.trips.route_id]].reference.slug]=e._.routes[e.gtfs.trips[n][e.gtfsHead.trips.route_id]].reference.slug),"direction"in d[t]&&delete d[t].direction):(d[s]={direction:1,product:e._.routes[e.gtfs.trips[n][e.gtfsHead.trips.route_id]].product,route:o,service:e._.trip[e.gtfs.trips[n][e.gtfsHead.trips.trip_id]].service},"reference"in e._.routes[e.gtfs.trips[n][e.gtfsHead.trips.route_id]]&&Object.keys(e._.routes[e.gtfs.trips[n][e.gtfsHead.trips.route_id]].reference).length>1&&(d[s].reference=[e._.routes[e.gtfs.trips[n][e.gtfsHead.trips.route_id]].reference],d[s].referenceLookup={},d[s].referenceLookup[e._.routes[e.gtfs.trips[n][e.gtfsHead.trips.route_id]].reference.slug]=e._.routes[e.gtfs.trips[n][e.gtfsHead.trips.route_id]].reference.slug),-1!==e.gtfsHead.stop_times.pickup_type&&e._.trip[e.gtfs.trips[n][e.gtfsHead.trips.trip_id]].setdown.length>0&&(d[s].setdown=e._.trip[e.gtfs.trips[n][e.gtfsHead.trips.trip_id]].setdown),-1!==e.gtfsHead.stop_times.drop_off_type&&e._.trip[e.gtfs.trips[n][e.gtfsHead.trips.trip_id]].pickup.length>0&&(d[s].pickup=e._.trip[e.gtfs.trips[n][e.gtfsHead.trips.trip_id]].pickup),g(o)&&(d[s].circular=1))}for(delete e._.routes,delete e._.trip,e.aquius.link=[],e.summary.network=[],n=0;n<e.aquius.network.length;n+=1)if("service"in e.aquius)for(e.summary.network.push([]),a=0;a<e.aquius.service.length;a+=1)e.summary.network[n].push(0);else e.summary.network.push([0]);for(r=Object.keys(d),n=0;n<r.length;n+=1){for(a=0;a<d[r[n]].service.length;a+=1){for(d[r[n]].service[a]=d[r[n]].service[a]/e._.dayFactor[a]*e.config.servicePer,f=0;f<e.aquius.network.length;f+=1)-1!==e.aquius.network[f][0].indexOf(d[r[n]].product)&&(e.summary.network[f][a]+=d[r[n]].service[a]);d[r[n]].service[a]<10?d[r[n]].service[a]=parseFloat(d[r[n]].service[a].toPrecision(1)):d[r[n]].service[a]=parseInt(d[r[n]].service[a],10)}if(i=[[d[r[n]].product],d[r[n]].service,d[r[n]].route,{}],"reference"in d[r[n]]){for(a=0;a<d[r[n]].reference.length;a+=1)delete d[r[n]].reference[a].slug;Object.keys(d[r[n]].reference).length>0&&(i[3].r=d[r[n]].reference)}"color"in d[r[n]]&&(i[3].o=d[r[n]].color),"circular"in d[r[n]]&&(i[3].c=1),"direction"in d[r[n]]&&(i[3].d=1),"pickup"in d[r[n]]&&(i[3].u=d[r[n]].pickup),"setdown"in d[r[n]]&&(i[3].s=d[r[n]].setdown),e.aquius.link.push(i)}for(e.aquius.link.sort(function(e,t){return t[1].reduce(function(e,t){return e+t},0)-e[1].reduce(function(e,t){return e+t},0)}),n=0;n<e.summary.network.length;n+=1)for(a=0;a<e.summary.network[n].length;a+=1)e.summary.network[n][a]=Math.round(e.summary.network[n][a]);return delete e._.dayFactor,e}(s=function(e){var t,s,r,i,o;for(e._.routes={},o=0;o<e.gtfs.routes.length;o+=1)e._.routes[e.gtfs.routes[o][e.gtfsHead.routes.route_id]]={},e._.routes[e.gtfs.routes[o][e.gtfsHead.routes.route_id]].reference={slug:""},r="agency"===e.config.networkFilter.type&&-1!==e.gtfsHead.routes.agency_id&&e.gtfs.routes[o][e.gtfsHead.routes.agency_id]in e.config.productOverride?e.config.productOverride[e.gtfs.routes[o][e.gtfsHead.routes.agency_id]]:"mode"===e.config.networkFilter.type&&-1!==e.gtfsHead.routes.route_type&&e.gtfs.routes[o][e.gtfsHead.routes.route_type]in e.config.productOverride?e.config.productOverride[e.gtfs.routes[o][e.gtfsHead.routes.route_type]]:{},!0===e.config.allowRoute&&(t="",-1!==e.gtfsHead.routes.route_short_name&&""===(t=e.gtfs.routes[o][e.gtfsHead.routes.route_short_name].trim())&&!0===e.config.allowName&&-1!==e.gtfsHead.routes.route_long_name&&(t=e.gtfs.routes[o][e.gtfsHead.routes.route_long_name].trim()),""!==t&&(e._.routes[e.gtfs.routes[o][e.gtfsHead.routes.route_id]].reference.n=t,e._.routes[e.gtfs.routes[o][e.gtfsHead.routes.route_id]].reference.slug+=t)),!0===e.config.allowColor&&(-1!==e.gtfsHead.routes.route_color||"route_color"in r)&&6===(t="route_color"in r?r.route_color:e.gtfs.routes[o][e.gtfsHead.routes.route_color].trim()).length&&((e=n(e,"color",t="#"+t))._.routes[e.gtfs.routes[o][e.gtfsHead.routes.route_id]].reference.c=e._.color[t],e._.routes[e.gtfs.routes[o][e.gtfsHead.routes.route_id]].reference.slug+=t),!0===e.config.allowColor&&(-1!==e.gtfsHead.routes.route_text_color||"route_text_color"in r)&&6===(t="route_text_color"in r?r.route_text_color:e.gtfs.routes[o][e.gtfsHead.routes.route_text_color].trim()).length&&((e=n(e,"color",t="#"+t))._.routes[e.gtfs.routes[o][e.gtfsHead.routes.route_id]].reference.t=e._.color[t],e._.routes[e.gtfs.routes[o][e.gtfsHead.routes.route_id]].reference.slug+=t),!0===e.config.allowURL&&-1!==e.gtfsHead.routes.route_url&&""!==(t=e.gtfs.routes[o][e.gtfsHead.routes.route_url].trim())&&(i="[*]",-1===(s=t.lastIndexOf(i))&&"n"in e._.routes[e.gtfs.routes[o][e.gtfsHead.routes.route_id]].reference&&-1!==(s=t.lastIndexOf(e._.routes[e.gtfs.routes[o][e.gtfsHead.routes.route_id]].reference.n))&&(t=t.substring(0,s)+i+t.substring(s+i.length+1)),-1===s&&-1!==(s=t.lastIndexOf(e.gtfs.routes[o][e.gtfsHead.routes.route_id]))&&(t=t.substring(0,s)+i+t.substring(s+i.length+1),e._.routes[e.gtfs.routes[o][e.gtfsHead.routes.route_id]].reference.i=e.gtfs.routes[o][e.gtfsHead.routes.route_id]),(e=n(e,"url",t))._.routes[e.gtfs.routes[o][e.gtfsHead.routes.route_id]].reference.u=e._.url[t],e._.routes[e.gtfs.routes[o][e.gtfsHead.routes.route_id]].reference.slug+=t),"agency"===e.config.networkFilter.type?"agency_id"in e.gtfsHead.routes&&-1!==e.gtfsHead.routes.agency_id?e._.routes[e.gtfs.routes[o][e.gtfsHead.routes.route_id]].product=e._.productIndex[e.gtfs.routes[o][e.gtfsHead.routes.agency_id]]:e._.routes[e.gtfs.routes[o][e.gtfsHead.routes.route_id]].product=0:"mode"===e.config.networkFilter.type&&"route_type"in e.gtfsHead.routes&&-1!==e.gtfsHead.routes.route_type?e._.routes[e.gtfs.routes[o][e.gtfsHead.routes.route_id]].product=e._.productIndex[e.gtfs.routes[o][e.gtfsHead.routes.route_type]]:e._.routes[e.gtfs.routes[o][e.gtfsHead.routes.route_id]].product=e._.productIndex[Object.keys(e._.productIndex)[0]];return delete e._.productIndex,e}(s=function(e){var t,s,r,i,o,n,a,f,g,u;for(t=function(e){var t,s,r,i,o,n,a={},f={};if("frequencies"in e.gtfs&&-1!==e.gtfsHead.frequencies.trip_id&&-1!==e.gtfsHead.frequencies.start_time&&-1!==e.gtfsHead.frequencies.end_time&&-1!==e.gtfsHead.frequencies.headway_secs)for(i=0;i<e.gtfs.frequencies.length;i+=1){if(e.gtfs.frequencies[i][e.gtfsHead.frequencies.trip_id]in a==0)for(a[e.gtfs.frequencies[i][e.gtfsHead.frequencies.trip_id]]=[],o=0;o<e._.timeFactor.length;o+=1)a[e.gtfs.frequencies[i][e.gtfsHead.frequencies.trip_id]].push(0);e.gtfs.frequencies[i][e.gtfsHead.frequencies.start_time]in f==0&&(f[e.gtfs.frequencies[i][e.gtfsHead.frequencies.start_time]]=d(e.gtfs.frequencies[i][e.gtfsHead.frequencies.start_time])),r=f[e.gtfs.frequencies[i][e.gtfsHead.frequencies.start_time]],e.gtfs.frequencies[i][e.gtfsHead.frequencies.end_time]in f==0&&(f[e.gtfs.frequencies[i][e.gtfsHead.frequencies.end_time]]=d(e.gtfs.frequencies[i][e.gtfsHead.frequencies.end_time])),(t=f[e.gtfs.frequencies[i][e.gtfsHead.frequencies.end_time]])<r&&(t+=86400);for(o=0;o<e._.timeFactor.length;o+=1)if(1===e._.timeFactor[o].length&&1===e._.timeFactor[o][0].length&&0===e._.timeFactor[o][0][0])a[e.gtfs.frequencies[i][e.gtfsHead.frequencies.trip_id]][o]+=(t-r)/parseInt(e.gtfs.frequencies[i][e.gtfsHead.frequencies.headway_secs],10);else for(n=0;n<e._.timeFactor[o].length;n+=1)e._.timeFactor[o][n][0]<t&&(1===e._.timeFactor[o][n].length||r<e._.timeFactor[o][n][1])&&(s=1,e._.timeFactor[o][n][0]>r&&(s-=(e._.timeFactor[o][n][0]-r)/(t-r)),e._.timeFactor[o][n][1]<t&&(s-=(t-e._.timeFactor[o][n][1])/(t-r)),a[e.gtfs.frequencies[i][e.gtfsHead.frequencies.trip_id]][o]+=(t-r)*s/parseInt(e.gtfs.frequencies[i][e.gtfsHead.frequencies.headway_secs],10))}return a}(e),e._.trip={},a={},e.summary.service=[],f=0;f<e.gtfs.trips.length;f+=1)if(e.gtfs.trips[f][e.gtfsHead.trips.service_id]in e._.serviceDays){for(e._.trip[e.gtfs.trips[f][e.gtfsHead.trips.trip_id]]={service:[],stops:[]},g=0;g<e._.serviceDays[e.gtfs.trips[f][e.gtfsHead.trips.service_id]].length;g+=1)e.gtfs.trips[f][e.gtfsHead.trips.trip_id]in t?e._.trip[e.gtfs.trips[f][e.gtfsHead.trips.trip_id]].service.push(e._.serviceDays[e.gtfs.trips[f][e.gtfsHead.trips.service_id]][g]*t[e.gtfs.trips[f][e.gtfsHead.trips.trip_id]][g]):e._.trip[e.gtfs.trips[f][e.gtfsHead.trips.trip_id]].service.push(e._.serviceDays[e.gtfs.trips[f][e.gtfsHead.trips.service_id]][g]);-1!==e.gtfsHead.stop_times.pickup_type&&(e._.trip[e.gtfs.trips[f][e.gtfsHead.trips.trip_id]].setdown=[]),-1!==e.gtfsHead.stop_times.drop_off_type&&(e._.trip[e.gtfs.trips[f][e.gtfsHead.trips.trip_id]].pickup=[])}for(f=0;f<e.gtfs.stop_times.length;f+=1)void 0!==e._.trip[e.gtfs.stop_times[f][e.gtfsHead.stop_times.trip_id]]&&(0===e._.trip[e.gtfs.stop_times[f][e.gtfsHead.stop_times.trip_id]].stops.length||e._.trip[e.gtfs.stop_times[f][e.gtfsHead.stop_times.trip_id]].stops[e._.trip[e.gtfs.stop_times[f][e.gtfsHead.stop_times.trip_id]].stops.length-1]!==e._.nodeLookup[e.gtfs.stop_times[f][e.gtfsHead.stop_times.stop_id]])&&e.gtfs.stop_times[f][e.gtfsHead.stop_times.stop_id]in e._.nodeLookup&&(e._.trip[e.gtfs.stop_times[f][e.gtfsHead.stop_times.trip_id]].stops.push([e.gtfs.stop_times[f][e.gtfsHead.stop_times.stop_sequence],e._.nodeLookup[e.gtfs.stop_times[f][e.gtfsHead.stop_times.stop_id]]]),-1!==e.gtfsHead.stop_times.departure_time&&""!==e.gtfs.stop_times[f][e.gtfsHead.stop_times.departure_time]&&(e.gtfs.stop_times[f][e.gtfsHead.stop_times.departure_time]in a==0&&(a[e.gtfs.stop_times[f][e.gtfsHead.stop_times.departure_time]]=d(e.gtfs.stop_times[f][e.gtfsHead.stop_times.departure_time])),n=a[e.gtfs.stop_times[f][e.gtfsHead.stop_times.departure_time]],("start"in e._.trip[e.gtfs.stop_times[f][e.gtfsHead.stop_times.trip_id]]==0||n<e._.trip[e.gtfs.stop_times[f][e.gtfsHead.stop_times.trip_id]].start)&&(e._.trip[e.gtfs.stop_times[f][e.gtfsHead.stop_times.trip_id]].start=n)),-1!==e.gtfsHead.stop_times.arrival_time&&""!==e.gtfs.stop_times[f][e.gtfsHead.stop_times.arrival_time]&&(e.gtfs.stop_times[f][e.gtfsHead.stop_times.arrival_time]in a==0&&(a[e.gtfs.stop_times[f][e.gtfsHead.stop_times.arrival_time]]=d(e.gtfs.stop_times[f][e.gtfsHead.stop_times.arrival_time])),n=a[e.gtfs.stop_times[f][e.gtfsHead.stop_times.arrival_time]],("end"in e._.trip[e.gtfs.stop_times[f][e.gtfsHead.stop_times.trip_id]]==0||n>e._.trip[e.gtfs.stop_times[f][e.gtfsHead.stop_times.trip_id]].end)&&(e._.trip[e.gtfs.stop_times[f][e.gtfsHead.stop_times.trip_id]].end=n)),-1!==e.gtfsHead.stop_times.pickup_type&&"1"===e.gtfs.stop_times[f][e.gtfsHead.stop_times.pickup_type]&&e._.trip[e.gtfs.stop_times[f][e.gtfsHead.stop_times.trip_id]].setdown.push(e._.nodeLookup[e.gtfs.stop_times[f][e.gtfsHead.stop_times.stop_id]]),-1!==e.gtfsHead.stop_times.drop_off_type&&"1"===e.gtfs.stop_times[f][e.gtfsHead.stop_times.drop_off_type]&&e._.trip[e.gtfs.stop_times[f][e.gtfsHead.stop_times.trip_id]].pickup.push(e._.nodeLookup[e.gtfs.stop_times[f][e.gtfsHead.stop_times.stop_id]]));for(o=(s=Object.keys(e._.trip)).length-Object.keys(t).length,f=0;f<s.length;f+=1)if(s[f]in t==0){"start"in e._.trip[s[f]]&&"end"in e._.trip[s[f]]?(n=(e._.trip[s[f]].end-e._.trip[s[f]].start)/2+e._.trip[s[f]].start,r=Math.floor(n/3600),void 0===e.summary.service[r]?e.summary.service[r]=1/o:e.summary.service[r]+=1/o):n=null;for(g=0;g<e._.timeFactor.length;g+=1)if(e._.timeFactor[g].length>1||e._.timeFactor[g][0].length>1||0!==e._.timeFactor[g][0][0]){if(i=!1,null!==n)for(u=0;u<e._.timeFactor[g].length;u+=1)if(n>e._.timeFactor[g][u][0]&&(1===e._.timeFactor[g][u].length||n<e._.timeFactor[g][u][1])){i=!0;break}!1===i&&(e._.trip[s[f]].service[g]=0)}}return delete e._.nodeLookup,delete e._.serviceDays,delete e._.timeFactor,e}(s=function(e){var t,s,o,n,a,f,g,u,c,p,l={},_={},m={},y=i(e.config.fromDate),h=i(e.config.toDate);function H(e){return["sunday","monday","tuesday","wednesday","thursday","friday","saturday"][new Date(e).getDay()]}function v(e){var t,s=0,r=Object.keys(e);for(t=0;t<r.length;t+=1)s+=e[r[t]];return s}for(e._.serviceDays={},e._.dayFactor=[],e._.timeFactor=[],s=0;h>=y;)_[r(y)]=y,s+=1,"serviceFilter"in e.config&&"period"in e.config.serviceFilter&&((g=H(y))in m?m[g]+=1:m[g]=1),y+=864e5;if("serviceFilter"in e.config&&"period"in e.config.serviceFilter)for(u=0;u<e.config.serviceFilter.period.length;u+=1){if("day"in e.config.serviceFilter.period[u])for(e._.dayFactor.push(0),c=0;c<e.config.serviceFilter.period[u].day.length;c+=1)e.config.serviceFilter.period[u].day[c]in m&&(e._.dayFactor[u]+=m[e.config.serviceFilter.period[u].day[c]]);else e._.dayFactor.push(s);if("time"in e.config.serviceFilter.period[u])for(e._.timeFactor.push([]),c=0;c<e.config.serviceFilter.period[u].time.length;c+=1)"start"in e.config.serviceFilter.period[u].time[c]?e._.timeFactor[u].push([d(e.config.serviceFilter.period[u].time[c].start)]):e._.timeFactor[u].push([0]),"end"in e.config.serviceFilter.period[u].time[c]&&e._.timeFactor[u][c].push(d(e.config.serviceFilter.period[u].time[c].end));else e._.timeFactor.push([[0]])}else e._.dayFactor.push(s),e._.timeFactor.push([[0]]);if("calendar"in e.gtfs)for(u=0;u<e.gtfs.calendar.length;u+=1)for(f=i(e.gtfs.calendar[u][e.gtfsHead.calendar.start_date]),o=i(e.gtfs.calendar[u][e.gtfsHead.calendar.end_date]),t=Object.keys(_),c=0;c<t.length;c+=1)_[t[c]]>=f&&_[t[c]]<=o&&(g=H(_[t[c]]),"1"===e.gtfs.calendar[u][e.gtfsHead.calendar[H(_[t[c]])]]&&(e.gtfs.calendar[u][e.gtfsHead.calendar.service_id]in l==0&&(l[e.gtfs.calendar[u][e.gtfsHead.calendar.service_id]]={}),g in l[e.gtfs.calendar[u][e.gtfsHead.calendar.service_id]]==0?l[e.gtfs.calendar[u][e.gtfsHead.calendar.service_id]][g]=1:l[e.gtfs.calendar[u][e.gtfsHead.calendar.service_id]][g]+=1));if("calendar_dates"in e.gtfs&&-1!==e.gtfsHead.calendar_dates.service_id&&-1!==e.gtfsHead.calendar_dates.date&&-1!==e.gtfsHead.calendar_dates.exception_type)for(u=0;u<e.gtfs.calendar_dates.length;u+=1)e.gtfs.calendar_dates[u][e.gtfsHead.calendar_dates.date]in _&&(g=H(_[e.gtfs.calendar_dates[u][e.gtfsHead.calendar_dates.date]]),e.gtfs.calendar_dates[u][e.gtfsHead.calendar_dates.service_id]in l==0?"1"===e.gtfs.calendar_dates[u][e.gtfsHead.calendar_dates.exception_type]&&(l[e.gtfs.calendar_dates[u][e.gtfsHead.calendar_dates.service_id]]={},l[e.gtfs.calendar_dates[u][e.gtfsHead.calendar_dates.service_id]][g]=1):("1"===e.gtfs.calendar_dates[u][e.gtfsHead.calendar_dates.exception_type]&&(g in l[e.gtfs.calendar_dates[u][e.gtfsHead.calendar_dates.service_id]]?l[e.gtfs.calendar_dates[u][e.gtfsHead.calendar_dates.service_id]][g]+=1:l[e.gtfs.calendar_dates[u][e.gtfsHead.calendar_dates.service_id]][g]=1),"2"===e.gtfs.calendar_dates[u][e.gtfsHead.calendar_dates.exception_type]&&(g in l[e.gtfs.calendar_dates[u][e.gtfsHead.calendar_dates.service_id]]==0||l[e.gtfs.calendar_dates[u][e.gtfsHead.calendar_dates.service_id]][g]<=1?(delete l[e.gtfs.calendar_dates[u][e.gtfsHead.calendar_dates.service_id]][g],0===Object.keys(l[e.gtfs.calendar_dates[u][e.gtfsHead.calendar_dates.service_id]]).length&&delete l[e.gtfs.calendar_dates[u][e.gtfsHead.calendar_dates.service_id]]):l[e.gtfs.calendar_dates[u][e.gtfsHead.calendar_dates.service_id]][g]=l[e.gtfs.calendar_dates[u][e.gtfsHead.calendar_dates.service_id]][g]-1)));for(n=Object.keys(l),u=0;u<n.length;u+=1)if("serviceFilter"in e.config&&"period"in e.config.serviceFilter){for(e._.serviceDays[n[u]]=[],a=0,c=0;c<e.config.serviceFilter.period.length;c+=1){if("day"in e.config.serviceFilter.period[c])for(s=0,p=0;p<e.config.serviceFilter.period[c].day.length;p+=1)e.config.serviceFilter.period[c].day[p]in l[n[u]]&&(s+=l[n[u]][e.config.serviceFilter.period[c].day[p]]);else s=v(l[n[u]]);e._.serviceDays[n[u]].push(s),a+=s}0===a&&delete e._.serviceDays[n[u]]}else(s=v(l[n[u]]))>0&&(e._.serviceDays[n[u]]=[s]);return e}(s=function(e){var t;"nodeLookup"in e._==0&&(e._.nodeLookup={}),"node"in e.aquius==0&&(e.aquius.node=[]);for(t=0;t<e.gtfs.stops.length;t+=1)e.gtfs.stops[t].stop_id in e._.nodeLookup==0&&""!==e.gtfs.stops[t][e.gtfsHead.stops.stop_id]&&(e._.nodeLookup[e.gtfs.stops[t][e.gtfsHead.stops.stop_id]]=e.aquius.node.length,e.aquius.node.push([f(e.gtfs.stops[t][e.gtfsHead.stops.stop_lon]),f(e.gtfs.stops[t][e.gtfsHead.stops.stop_lat]),{}]),e=a(e,e.gtfs.stops[t]));return e}(s=function(e){var t,s,r,i;if("transfers"in e.gtfs&&-1!==e.gtfsHead.transfers.from_stop_id&&-1!==e.gtfsHead.transfers.to_stop_id&&1!==e.gtfsHead.transfers.transfer_type){"nodeLookup"in e._==0&&(e._.nodeLookup={}),"node"in e.aquius==0&&(e.aquius.node=[]);for(r=0;r<e.gtfs.transfers.length;r+=1)if(""!==e.gtfs.transfers[r][e.gtfsHead.transfers.from_stop_id]&&(t=e._.nodeLookup[e.gtfs.transfers[r][e.gtfsHead.transfers.from_stop_id]])!==(s=e._.nodeLookup[e.gtfs.transfers[r][e.gtfsHead.transfers.to_stop_id]]))if(void 0!==t&&void 0!==s);else if(void 0!==t)e._.nodeLookup[s]=t;else if(void 0!==s)e._.nodeLookup[t]=s;else if(void 0===t&&void 0===s)for(i=0;i<e.gtfs.stops.length;i+=1)if(e.gtfs.stops[i][e.gtfsHead.stops.stop_id]===t){e._.nodeLookup[t]=e.aquius.node.length,e._.nodeLookup[s]=e.aquius.node.length,e.aquius.node.push([f(e.gtfs.stops[i][e.gtfsHead.stops.stop_lon]),f(e.gtfs.stops[i][e.gtfsHead.stops.stop_lat]),{}]),e=a(e,e.gtfs.stops[i]);break}}return e}(s=function(e){var t,s=[];if(-1!==e.gtfsHead.stops.location_type&&-1!==e.gtfsHead.stops.parent_station){"nodeLookup"in e._==0&&(e._.nodeLookup={}),"node"in e.aquius==0&&(e.aquius.node=[]);for(t=0;t<e.gtfs.stops.length;t+=1)"1"===e.gtfs.stops[t][e.gtfsHead.stops.location_type]?(e._.nodeLookup[e.gtfs.stops[t][e.gtfsHead.stops.stop_id]]=e.aquius.node.length,e.aquius.node.push([f(e.gtfs.stops[t][e.gtfsHead.stops.stop_lon]),f(e.gtfs.stops[t][e.gtfsHead.stops.stop_lat]),{}]),e=a(e,e.gtfs.stops[t])):""!==e.gtfs.stops[t][e.gtfsHead.stops.parent_station]&&s.push([e.gtfs.stops[t][e.gtfsHead.stops.stop_id],e.gtfs.stops[t][e.gtfsHead.stops.parent_station]]);for(t=0;t<s.length;t+=1)s[t][1]in e._.nodeLookup&&(e._.nodeLookup[s[t][0]]=e._.nodeLookup[s[t][1]])}return e}(s=function(e){var t,s;if("serviceFilter"in e.config&&"type"in e.config.serviceFilter&&"period"===e.config.serviceFilter.type){"period"in e.config.serviceFilter!=0&&Array.isArray(e.config.serviceFilter.period)&&0!==e.config.serviceFilter.period.length||(t=["monday","tuesday","wednesday","thursday","friday"],e.config.serviceFilter.period=[{name:{"en-US":"Typical day"}},{day:t,name:{"en-US":"Typical weekday"}},{day:t,name:{"en-US":"Weekday early"},time:[{end:"10:00:00"}]},{day:t,name:{"en-US":"Weekday 10:00-17:00"},time:[{start:"10:00:00",end:"17:00:00"}]},{day:t,name:{"en-US":"Weekday evening"},time:[{start:"17:00:00"}]},{day:["saturday"],name:{"en-US":"Saturday"}},{day:["sunday"],name:{"en-US":"Sunday"}}]),e.aquius.service=[];for(s=0;s<e.config.serviceFilter.period.length;s+=1)"name"in e.config.serviceFilter.period[s]==0&&(e.config.serviceFilter.period[s].name={"en-US":"Period "+s}),e.aquius.service.push([[s],e.config.serviceFilter.period[s].name,{}])}return e}(s=function(e){var t,s,r,i,o,n={0:{"en-US":"Tram"},1:{"en-US":"Metro"},2:{"en-US":"Rail"},3:{"en-US":"Bus"},4:{"en-US":"Ferry"},5:{"en-US":"Cable car"},6:{"en-US":"Cable car"},7:{"en-US":"Funicular"},100:{"en-US":"Rail"},101:{"en-US":"High speed rail"},102:{"en-US":"Long distance rail"},103:{"en-US":"Inter-regional rail"},105:{"en-US":"Sleeper rail"},106:{"en-US":"Regional rail"},107:{"en-US":"Tourist rail"},108:{"en-US":"Rail shuttle"},109:{"en-US":"Suburban rail"},200:{"en-US":"Coach"},201:{"en-US":"International coach"},202:{"en-US":"National coach"},204:{"en-US":"Regional coach"},208:{"en-US":"Commuter coach"},400:{"en-US":"Urban rail"},401:{"en-US":"Metro"},402:{"en-US":"Underground"},405:{"en-US":"Monorail"},700:{"en-US":"Bus"},701:{"en-US":"Regional bus"},702:{"en-US":"Express bus"},704:{"en-US":"Local bus"},800:{"en-US":"Trolleybus"},900:{"en-US":"Tram"},1000:{"en-US":"Water"},1300:{"en-US":"Telecabin"},1400:{"en-US":"Funicular"},1501:{"en-US":"Shared taxi"},1700:{"en-US":"Other"},1701:{"en-US":"Cable car"},1702:{"en-US":"Horse-drawn"}};switch("type"in e.config.networkFilter==0&&(e.config.networkFilter.type="agency"),"reference"in e.config.networkFilter==0&&(e.config.networkFilter.reference=[]),e._.productIndex={},"reference"in e.aquius==0&&(e.aquius.reference={}),e.config.networkFilter.type){case"mode":if("route_type"in e.gtfsHead.routes&&-1!==e.gtfsHead.routes.route_type)for(t=0,i=0;i<e.gtfs.routes.length;i+=1)e.gtfs.routes[i][e.gtfsHead.routes.route_type]in e._.productIndex==0&&(e._.productIndex[e.gtfs.routes[i][e.gtfsHead.routes.route_type]]=t,t>=e.config.networkFilter.reference.length&&(e.gtfs.routes[i][e.gtfsHead.routes.route_type]in n?e.config.networkFilter.reference[t]=n[e.gtfs.routes[i][e.gtfsHead.routes.route_type]]:e.config.networkFilter.reference[t]={}),t+=1);break;case"agency":default:if(e.config.networkFilter.type="agency","agency"in e.gtfs&&"agency_id"in e.gtfsHead.agency&&1!==e.gtfsHead.agency.agency_id)for(t=0,i=0;i<e.gtfs.agency.length;i+=1)e.gtfs.agency[i][e.gtfsHead.agency.agency_id]in e._.productIndex==0&&(e._.productIndex[e.gtfs.agency[i][e.gtfsHead.agency.agency_id]]=t,t>=e.config.networkFilter.reference.length&&(-1!==e.gtfsHead.agency.agency_name?e.config.networkFilter.reference[t]={"en-US":e.gtfs.agency[i][e.gtfsHead.agency.agency_name]}:e.config.networkFilter.reference[t]={"en-US":e.gtfs.agency[i][e.gtfsHead.agency.agency_id]}),t+=1);else e._.productIndex.agency=0,e.aquius.reference.product.push({})}if(e.aquius.reference.product=e.config.networkFilter.reference,"network"in e.config.networkFilter==0||!Array.isArray(e.config.networkFilter.network))switch(e.config.networkFilter.network=[],s=Object.keys(e._.productIndex),e.config.networkFilter.type){case"mode":if(e.config.networkFilter.network.push([s,{"en-US":"All modes"}]),s.length>1)for(i=0;i<s.length;i+=1)s[i]in n?e.config.networkFilter.network.push([[s[i]],n[s[i]]]):e.config.networkFilter.network.push([[s[i]],{"en-US":"Mode #"+s[i]}]);break;case"agency":if(e.config.networkFilter.network.push([s,{"en-US":"All operators"}]),s.length>1)for(i=0;i<s.length;i+=1)if("agency"in e.gtfs&&-1!==e.gtfsHead.agency.agency_id&&-1!==e.gtfsHead.agency.agency_name){for(o=0;o<e.gtfs.agency.length;o+=1)if(e.gtfs.agency[o][e.gtfsHead.agency.agency_id]===s[i]){e.config.networkFilter.network.push([[s[i]],{"en-US":e.gtfs.agency[o][e.gtfsHead.agency.agency_name]}]);break}}else e.config.networkFilter.network.push([[s[i]],{"en-US":s[i]}]);break;default:e.config.networkFilter.network.push([s,{"en-US":"All"}])}for(e.aquius.network=[],i=0;i<e.config.networkFilter.network.length;i+=1)if(e.config.networkFilter.network[i].length>1&&Array.isArray(e.config.networkFilter.network[i][0])&&"object"==typeof e.config.networkFilter.network[i][1]){for(r=[],o=0;o<e.config.networkFilter.network[i][0].length;o+=1)r.push(e._.productIndex[e.config.networkFilter.network[i][0][o]]);e.aquius.network.push([r,e.config.networkFilter.network[i][1],{}])}return e}(s=function(e){if("schema"in e.config.meta!=0&&"0"===e.config.meta.schema||(e.config.meta.schema="0"),"name"in e.config.meta==0&&(e.config.meta.name={}),"en-US"in e.config.meta.name==0&&("feed_info"in e.gtfs&&-1!==e.gtfsHead.feed_info.feed_publisher_name?e.config.meta.name["en-US"]=e.gtfs.feed_info[0][e.gtfsHead.feed_info.feed_publisher_name]+" ":e.config.meta.name["en-US"]="",e.config.meta.name["en-US"]+="("+e.config.fromDate,e.config.fromDate!==e.config.toDate&&(e.config.meta.name["en-US"]+="-"+e.config.toDate),e.config.meta.name["en-US"]+=")"),"url"in e.config.meta==0&&"feed_info"in e.gtfs&&-1!==e.gtfsHead.feed_info.feed_publisher_url&&(e.config.meta.url=e.gtfs.feed_info[0][e.gtfsHead.feed_info.feed_publisher_url]),e.aquius.meta=e.config.meta,"en-US"in e.config.translation==0&&(e.config.translation["en-US"]={}),"link"in e.config.translation["en-US"]==0)switch(e.config.servicePer){case 1:e.config.translation["en-US"].link="Daily Services";break;case 7:e.config.translation["en-US"].link="Weekly Services";break;default:e.config.translation["en-US"].link="Services per "+e.config.servicePer+" Days"}return e.aquius.translation=e.config.translation,"c"in e.config.option!=0&&"k"in e.config.option!=0||(e.config.option.c=parseFloat(e.gtfs.stops[0][e.gtfsHead.stops.stop_lon]),e.config.option.k=parseFloat(e.gtfs.stops[0][e.gtfsHead.stops.stop_lat]),e.config.option.m=12),"x"in e.config.option!=0&&"y"in e.config.option!=0||(e.config.option.x=parseFloat(e.gtfs.stops[0][e.gtfsHead.stops.stop_lon]),e.config.option.y=parseFloat(e.gtfs.stops[0][e.gtfsHead.stops.stop_lat]),e.config.option.z=10),e.aquius.option=e.config.option,e}(s)))))))))),t),0,t)}};