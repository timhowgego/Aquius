var gtfsToAquius=gtfsToAquius||{init:function(e){"use strict";function t(e,t,s){var o,r,i=document.createElement(e);if(void 0!==t)for(o=Object.keys(t),r=0;r<o.length;r+=1)i[o[r]]=t[o[r]];if(void 0!==s)for(o=Object.keys(s),r=0;r<o.length;r+=1)i.style[o[r]]=s[o[r]];return i}function s(e,s){var o,r=document.getElementById(s.configId+"ImportFiles"),i=document.getElementById(s.configId+"Output"),n=document.getElementById(s.configId+"Progress");if(void 0!==e&&null!==i){for(;i.firstChild;)i.removeChild(i.firstChild);if(i.className=s.configId+"OutputError",o="message"in e?e.message:JSON.stringify(e),i.appendChild(t("p",{textContent:"Error: "+o})),null!==n){for(;n.firstChild;)n.removeChild(n.firstChild);n.textContent="Failed"}null!==r&&(r.disabled=!1)}}function o(e,o,r){var i,n,a,f,d,g=r._vars,u=document.getElementById(g.configId+"ImportFiles"),p=document.getElementById(g.configId+"Output"),c=document.getElementById(g.configId+"Progress");if(void 0!==e)return s(e,g),!1;if(!p||!c)return!1;for(;p.firstChild;)p.removeChild(p.firstChild);for(;c.firstChild;)c.removeChild(c.firstChild);for(null!==u&&(u.disabled=!1),p.className="",i=["aquius","config"],f=0;f<i.length;f+=1)i[f]in o&&Object.keys(o[i[f]]).length>0&&c.appendChild(t("a",{className:g.configId+"Download",href:window.URL.createObjectURL(new Blob([JSON.stringify(o[i[f]])],{type:"application/json;charset=utf-8"})),download:i[f]+".json",textContent:"Save "+i[f]+".json",role:"button"}));if("undefined"!=typeof aquius&&(p.appendChild(t("div",{id:g.configId+"Map"},{height:document.documentElement.clientHeight/2+"px"})),aquius.init(g.configId+"Map",{dataObject:o.aquius,uiStore:!1})),"aquius"in o&&"network"in o.aquius&&"link"in o.aquius){for(n=[],f=0;f<o.aquius.network.length;f+=1){a=[],"en-US"in o.aquius.network[f][1]?a.push(o.aquius.network[f][1]["en-US"]):a.push(JSON.stringify(o.aquius.network[f][1])),a.push(0,0);for(d=0;d<o.aquius.link.length;d+=1)-1!==o.aquius.network[f][0].indexOf(o.aquius.link[d][0][0])&&(a[1]+=1,a[2]+=o.aquius.link[d][1].reduce(function(e,t){return e+t},0));a[1]=Math.round(a[1]),a[2]=Math.round(a[2]),n.push(a)}p.appendChild(function(e,s,o){var r,i,n,a,f=t("table");if(s.length>0){for(i=t("tr"),n=0;n<s.length;n+=1)i.appendChild(t("th",{textContent:s[n].toString()}));f.appendChild(i)}for(n=0;n<e.length;n+=1){for(i=t("tr"),a=0;a<e[n].length;a+=1)r=t("td",{textContent:e[n][a].toString()}),void 0!==o&&o.length>a&&(r.className=o[a]),i.appendChild(r);f.appendChild(i)}return f}(n,["Network","Routes","Services"],[g.configId+"Text",g.configId+"Number",g.configId+"Number"]))}}return function(e){var r,i,n,a=document.getElementById(e.configId);if(!a)return!1;for(;a.firstChild;)a.removeChild(a.firstChild);return Object.keys&&[].indexOf&&"object"==typeof JSON&&window.File&&window.FileReader&&window.Blob?(document.head.appendChild(t("script",{src:"https://timhowgego.github.io/Aquius/dist/aquius.min.js",type:"text/javascript"})),i=t("form",{className:e.configId+"Input"}),n=t("label",{textContent:"GTFS as .txt, optional config, and optional GeoJSON to process:"}),(r=t("input",{id:e.configId+"ImportFiles",multiple:"multiple",name:e.configId+"ImportFiles[]",type:"file"})).addEventListener("change",function(){!function(e){var t,r,i,n={},a=document.getElementById(e.configId+"ImportFiles"),f={_vars:e,callback:o},d=0,g=document.getElementById(e.configId+"Progress"),u=0;function p(e,s){var o,r,i=e.toLowerCase().split(".");o=i.length>1?i.pop():"txt";try{switch(o){case"csv":case"txt":n[i.join("")]=s;break;case"geojson":case"js":case"json":"type"in(r=JSON.parse(s))&&"FeatureCollection"===r.type?f.geojson=r:f.config=r}}catch(e){t=e}}if(null!==a&&a.files.length>0){if(a.disabled=!0,null!==g){for(;g.firstChild;)g.removeChild(g.firstChild);g.textContent="Working..."}!function(o){for(u=o.length,i=0;i<u;i+=1)(r=new FileReader).onerror=function(e){t=new Error("Could not read "+e.name),r.abort()},r.onload=function(o){return function(){p(o.name,this.result),(d+=1)===u&&(void 0!==t?s(t,e):e.process(n,f))}}(o[i]),r.readAsText(o[i])}(a.files)}}(e)},!1),n.appendChild(r),i.appendChild(n),i.appendChild(t("span",{id:e.configId+"Progress"})),a.appendChild(i),a.appendChild(t("div",{id:e.configId+"Output"})),!0):(a.appendChild(document.createTextNode("Browser not supported: Try a modern browser")),!1)}({configId:e,process:this.process})},process:function(e,t){"use strict";var s={};function o(e,t,s){var o,r,i=["node","nodeLookup"];for(r=0;r<i.length;r+=1)i[r]in e&&delete e[i[r]];return"object"==typeof s&&"callback"in s?("error"in e&&(o=new Error(e.error.join(". "))),s.callback(o,e,s)):e}function r(e){var t=new RegExp('(\\,|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^\\,\\r\\n]*))',"gi"),s=t.exec(e),o=[[]];for(e=e.trim();null!==s;)s[1].length&&","!==s[1]&&o.push([]),o[o.length-1].push(s[2]?s[2].replace(new RegExp('""',"g"),'"'):s[3]),s=t.exec(e);return o}function i(e){var t=new Date(e),s=t.getFullYear().toString();return t.getMonth()<9&&(s+="0"),s+=(t.getMonth()+1).toString(),t.getDate()<10&&(s+="0"),s+=t.getDate().toString()}function n(e){return e.length<8?0:Date.UTC(e.slice(0,4),e.slice(4,6)-1,e.slice(6,8))}function a(e,t){var s={};return!0===e.config.allowName&&-1!==e.gtfsHead.stops.stop_name&&""!==t[e.gtfsHead.stops.stop_name]&&(s.n=t[e.gtfsHead.stops.stop_name],-1!==e.gtfsHead.stops.stop_code&&""!==t[e.gtfsHead.stops.stop_code]&&(s.n+=" ("+t[e.gtfsHead.stops.stop_code]+")")),!0===e.config.allowURL&&-1!==e.gtfsHead.stops.stop_url&&""!==t[e.gtfsHead.stops.stop_url]&&(s.u=t[e.gtfsHead.stops.stop_url]),Object.keys(s).length>0?{r:[s]}:{}}function f(e){return e=parseFloat(e),Number.isNaN(e)?0:Math.round(1e5*e)/1e5}function d(e,t){function s(e){var t,s,o=e.split(":");if(o.length<3)return-1;for(s=0;s<o.length;s+=1){if(t=parseInt(o[s],10),Number.isNaN(t))return-1;o[s]=t}return 3600*o[0]+60*o[1]+o[2]}var o=s(e),r=s(t);return o>r?r-o-86400:r-o}function g(e,t,s){var o;function r(s){var o,r,i,n,a,f,d,g;if(Array.isArray(s))for(f=0;f<s.length;f+=1)if(Array.isArray(s[f])){for(o=!1,d=0,g=s[f].length-1;d<s[f].length;g=d++)r=s[f][d][0],n=s[f][d][1],i=s[f][g][0],a=s[f][g][1],n>t!=a>t&&e<(i-r)*(t-n)/(a-n)+r&&(o=!o);if(o)return!0}return!1}if("geometry"in s==!1||"type"in s.geometry==!1||"coordinates"in s.geometry==!1||!Array.isArray(s.geometry.coordinates))return!1;if("MultiPolygon"===s.geometry.type)for(o=0;o<s.geometry.coordinates.length;o+=1)if(r(s.geometry.coordinates[o]))return!0;return"Polygon"===s.geometry.type&&r(s.geometry.coordinates)}function u(e){var t,s={};function o(e){var t,s,o={};if(Array.isArray(e))for(t=0;t<e.length;t+=1)if(Array.isArray(e[t]))for(s=0;s<e[t].length;s+=1)Array.isArray(e[t][s])&&2===e[t][s].length&&("maxX"in o==!1?(o.maxX=e[t][s][0],o.minX=e[t][s][0],o.maxY=e[t][s][1],o.minY=e[t][s][1]):(e[t][s][0]>o.maxX?o.maxX=e[t][s][0]:e[t][s][0]<o.minX&&(o.minX=e[t][s][0]),e[t][s][1]>o.maxY?o.maxY=e[t][s][1]:e[t][s][1]<o.minY&&(o.minY=e[t][s][1])));return o}if("geometry"in e&&"type"in e.geometry&&"coordinates"in e.geometry&&Array.isArray(e.geometry.coordinates)){if("MultiPolygon"===e.geometry.type)for(t=0;t<e.geometry.coordinates.length;t+=1)s=o(e.geometry.coordinates[t]);"Polygon"===e.geometry.type&&(s=o(e.geometry.coordinates))}return"maxX"in s?{x:Math.round((s.maxX+s.minX)/2*1e5)/1e5,y:Math.round((s.maxY+s.minY)/2*1e5)/1e5}:null}return"error"in(s=function(e,t){var s,o,i,n,a;"gtfsHead"in e==0&&(e.gtfsHead={calendar:{service_id:-1,monday:-1,tuesday:-1,wednesday:-1,thursday:-1,friday:-1,saturday:-1,sunday:-1,start_date:-1,end_date:-1},calendar_dates:{service_id:-1,date:-1,exception_type:-1},frequencies:{trip_id:-1,start_time:-1,end_time:-1,headway_secs:-1},routes:{route_color:-1,route_id:-1,route_long_name:-1,route_short_name:-1,route_text_color:-1,route_url:-1},stop_times:{trip_id:-1,stop_id:-1,stop_sequence:-1,pickup_type:-1,drop_off_type:-1},stops:{stop_code:-1,stop_id:-1,stop_lat:-1,stop_lon:-1,stop_name:-1,stop_url:-1,location_type:-1,parent_station:-1},transfers:{from_stop_id:-1,to_stop_id:-1,transfer_type:-1},trips:{route_id:-1,service_id:-1,trip_id:-1}}),i={routes:["route_id"],stops:["stop_id","stop_lat","stop_lon"],trips:["route_id","service_id","trip_id"],stop_times:["trip_id","stop_id","stop_sequence"]},"type"in e.config.productFilter&&"agency"===e.config.productFilter.type&&(e.gtfsHead.agency={agency_id:-1,agency_name:-1},e.gtfsHead.routes.agency_id=-1),"type"in e.config.productFilter&&"mode"===e.config.productFilter.type&&(e.gtfsHead.routes.route_type=-1),"name"in e.config.meta!=0&&"en-US"in e.config.meta.name!=0||("feed_info"in e.gtfsHead==0&&(e.gtfsHead.feed_info={}),e.gtfsHead.feed_info.feed_publisher_name=-1),"url"in e.config.meta==0&&("feed_info"in e.gtfsHead==0&&(e.gtfsHead.feed_info={}),e.gtfsHead.feed_info.feed_publisher_url=-1),"gtfs"in e==0&&(e.gtfs={}),o=Object.keys(e.gtfsHead);for(n=0;n<o.length;n+=1)if(o[n]in t&&(s=r(t[o[n]])).length>1){for(a=0;a<s[0].length;a+=1)s[0][a]in e.gtfsHead[o[n]]&&(e.gtfsHead[o[n]][s[0][a]]=a);e.gtfs[o[n]]=s.splice(1)}for(o=Object.keys(i),n=0;n<o.length;n+=1)if(o[n]in e.gtfs==0)"error"in e==0&&(e.error=[]),e.error.push("Missing GTFS "+o[n]+".txt");else if(o[n]in e.gtfsHead)for(a=0;a<i[o[n]].length;a+=1)i[o[n]][a]in e.gtfsHead[o[n]]!=0&&-1!==e.gtfsHead[o[n]][i[o[n]][a]]||("error"in e==0&&(e.error=[]),e.error.push("Missing value "+i[o[n]][a]+" in GTFS "+o[n]+".txt"));return e}(s=function(e,t){var s,o={allowColor:!0,allowName:!0,allowRoute:!0,allowURL:!0,fromDate:i(Date.now()),meta:{schema:"0"},option:{},populationProperty:"population",productFilter:{type:"agency"},servicePer:1,toDate:i(Date.now()+5184e5),translation:{}},r=Object.keys(o);"config"in e==0&&(e.config={}),"object"!=typeof t&&(t={});for(s=0;s<r.length;s+=1)"config"in t&&r[s]in t.config&&typeof t.config[r[s]]==typeof o[r[s]]?e.config[r[s]]=t.config[r[s]]:e.config[r[s]]=o[r[s]];return e}(s,t),e))?o(s,0,t):o(s=function(e,t){var s,o,r,i,n,a,f,d,p={},c=[],l=[],_=-1,m=0,h=[],H=0;if("aquius"in e==0&&(e.aquius={}),"place"in e.aquius==0&&(e.aquius.place=[]),"object"==typeof t&&"geojson"in t&&"type"in t.geojson&&"FeatureCollection"===t.geojson.type&&"features"in t.geojson&&Array.isArray(t.geojson.features)&&t.geojson.features.length>0){for(f=0;f<t.geojson.features.length;f+=1)null!==(s=u(t.geojson.features[f]))&&(c.push(f),p[f]=s);for(f=0;f<e.aquius.node.length;f+=1)l.push([e.aquius.node[f][0]+e.aquius.node[f][1],f]);for(l.sort(),f=0;f<l.length;f+=1){if(_=-1,g(e.aquius.node[l[f][1]][0],e.aquius.node[l[f][1]][1],t.geojson.features[m]))_=m;else{for(o=[m],d=0;d<c.length;d+=1)if(a=Math.abs(e.aquius.node[l[f][1]][0]+e.aquius.node[l[f][1]][1]-(p[c[d]].x+p[c[d]].y)),0===d&&(r=a),r>=a&&-1===o.indexOf(c[d])){if(g(e.aquius.node[l[f][1]][0],e.aquius.node[l[f][1]][1],t.geojson.features[c[d]])){_=c[d];break}o.push(c[d]),o.length<5&&(r=a)}if(-1===_)for(d=0;d<t.geojson.features.length;d+=1)if(-1===o.indexOf(d)&&g(e.aquius.node[l[f][1]][0],e.aquius.node[l[f][1]][1],t.geojson.features[d])){_=d;break}}-1!==_&&(m=_,-1!==(i=h.indexOf(_))?e.aquius.node[l[f][1]][2].p=i:_ in p&&(e.aquius.place.push([p[_].x,p[_].y,{}]),e.aquius.node[l[f][1]][2].p=e.aquius.place.length-1,h.push(_),"properties"in t.geojson.features[_]&&e.config.populationProperty in t.geojson.features[_].properties&&(n=parseFloat(t.geojson.features[_].properties[e.config.populationProperty]),Number.isNaN(n)||(e.aquius.place[e.aquius.place.length-1][2].p=n,n>H&&(H=n)))))}H>0&&"placeScale"in e.config.option==0&&(e.config.option.placeScale=Math.round(1/(H/2e6)*1e5)/1e5,e.aquius.option.placeScale=e.config.option.placeScale)}return e}(s=function(e,t){var s,o,r,i,a=Object.keys(t),f=e.config.servicePer/(1+(n(e.config.toDate)-n(e.config.fromDate))/864e5);"aquius"in e==0&&(e.aquius={}),"link"in e.aquius==0&&(e.aquius.link=[]);for(r=0;r<a.length;r+=1){if(o=(o=t[a[r]].service*f)<1?parseFloat(o.toPrecision(1)):parseInt(o,10),s=[[t[a[r]].product],[o],t[a[r]].route,{}],"reference"in t[a[r]]){for(i=0;i<t[a[r]].reference.length;i+=1)delete t[a[r]].reference[i].slug;Object.keys(t[a[r]].reference).length>0&&(s[3].r=t[a[r]].reference)}"color"in t[a[r]]&&(s[3].o=t[a[r]].color),"circular"in t[a[r]]&&(s[3].c=1),"direction"in t[a[r]]&&(s[3].d=1),"pickup"in t[a[r]]&&(s[3].u=t[a[r]].pickup),"setdown"in t[a[r]]&&(s[3].s=t[a[r]].setdown),e.aquius.link.push(s)}return e.aquius.link.sort(function(e,t){return t[1].reduce(function(e,t){return e+t},0)-e[1].reduce(function(e,t){return e+t},0)}),e}(s=function(e){var t;"nodeLookup"in e==0&&(e.nodeLookup={}),"aquius"in e==0&&(e.aquius={}),"node"in e.aquius==0&&(e.aquius.node=[]);for(t=0;t<e.gtfs.stops.length;t+=1)e.gtfs.stops[t].stop_id in e.nodeLookup==0&&""!==e.gtfs.stops[t][e.gtfsHead.stops.stop_id]&&(e.nodeLookup[e.gtfs.stops[t][e.gtfsHead.stops.stop_id]]=e.aquius.node.length,e.aquius.node.push([f(e.gtfs.stops[t][e.gtfsHead.stops.stop_lon]),f(e.gtfs.stops[t][e.gtfsHead.stops.stop_lat]),a(e,e.gtfs.stops[t])]));return e}(s=function(e){var t,s,o,r;if("transfers"in e.gtfs&&-1!==e.gtfsHead.transfers.from_stop_id&&-1!==e.gtfsHead.transfers.to_stop_id&&1!==e.gtfsHead.transfers.transfer_type){"nodeLookup"in e==0&&(e.nodeLookup={}),"aquius"in e==0&&(e.aquius={}),"node"in e.aquius==0&&(e.aquius.node=[]);for(o=0;o<e.gtfs.transfers.length;o+=1)if(""!==e.gtfs.transfers[o][e.gtfsHead.transfers.from_stop_id]&&(t=e.nodeLookup[e.gtfs.transfers[o][e.gtfsHead.transfers.from_stop_id]])!==(s=e.nodeLookup[e.gtfs.transfers[o][e.gtfsHead.transfers.to_stop_id]]))if(void 0!==t&&void 0!==s);else if(void 0!==t)e.nodeLookup[s]=t;else if(void 0!==s)e.nodeLookup[t]=s;else if(void 0===t&&void 0===s)for(r=0;r<e.gtfs.stops.length;r+=1)if(e.gtfs.stops[r][e.gtfsHead.stops.stop_id]===t){e.nodeLookup[t]=e.aquius.node.length,e.nodeLookup[s]=e.aquius.node.length,e.aquius.node.push([f(e.gtfs.stops[r][e.gtfsHead.stops.stop_lon]),f(e.gtfs.stops[r][e.gtfsHead.stops.stop_lat]),a(e,e.gtfs.stops[r])]);break}}return e}(s=function(e){var t,s=[];if(-1!==e.gtfsHead.stops.location_type&&-1!==e.gtfsHead.stops.parent_station){"nodeLookup"in e==0&&(e.nodeLookup={}),"aquius"in e==0&&(e.aquius={}),"node"in e.aquius==0&&(e.aquius.node=[]);for(t=0;t<e.gtfs.stops.length;t+=1)"1"===e.gtfs.stops[t][e.gtfsHead.stops.location_type]?(e.nodeLookup[e.gtfs.stops[t][e.gtfsHead.stops.stop_id]]=e.aquius.node.length,e.aquius.node.push([f(e.gtfs.stops[t][e.gtfsHead.stops.stop_lon]),f(e.gtfs.stops[t][e.gtfsHead.stops.stop_lat]),a(e,e.gtfs.stops[t])])):""!==e.gtfs.stops[t][e.gtfsHead.stops.parent_station]&&s.push([e.gtfs.stops[t][e.gtfsHead.stops.stop_id],e.gtfs.stops[t][e.gtfsHead.stops.parent_station]]);for(t=0;t<s.length;t+=1)s[t][1]in e.nodeLookup&&(e.nodeLookup[s[t][0]]=e.nodeLookup[s[t][1]])}return e}(s=function(e){var t,s,o,r={0:{"en-US":"Tram"},1:{"en-US":"Metro"},2:{"en-US":"Rail"},3:{"en-US":"Bus"},4:{"en-US":"Ferry"},5:{"en-US":"Cable car"},6:{"en-US":"Cable car"},7:{"en-US":"Funicular"},100:{"en-US":"Rail"},101:{"en-US":"High speed rail"},102:{"en-US":"Long distance rail"},103:{"en-US":"Inter-regional rail"},105:{"en-US":"Sleeper rail"},106:{"en-US":"Regional rail"},107:{"en-US":"Tourist rail"},108:{"en-US":"Rail shuttle"},109:{"en-US":"Suburban rail"},200:{"en-US":"Coach"},201:{"en-US":"International coach"},202:{"en-US":"National coach"},204:{"en-US":"Regional coach"},208:{"en-US":"Commuter coach"},400:{"en-US":"Urban rail"},401:{"en-US":"Metro"},402:{"en-US":"Underground"},405:{"en-US":"Monorail"},700:{"en-US":"Bus"},701:{"en-US":"Regional bus"},702:{"en-US":"Express bus"},704:{"en-US":"Local bus"},800:{"en-US":"Trolleybus"},900:{"en-US":"Tram"},1000:{"en-US":"Water"},1300:{"en-US":"Telecabin"},1400:{"en-US":"Funicular"},1501:{"en-US":"Shared taxi"},1700:{"en-US":"Other"},1701:{"en-US":"Cable car"},1702:{"en-US":"Horse-drawn"}};switch("type"in e.config.productFilter==0&&(e.config.productFilter.type="agency"),"index"in e.config.productFilter!=0&&"object"==typeof e.config.productFilter.index||(e.config.productFilter.index=[]),e.config.productFilter.type){case"mode":if("route_type"in e.gtfsHead.routes&&-1!==e.gtfsHead.routes.route_type)for(s=0;s<e.gtfs.routes.length;s+=1)-1===e.config.productFilter.index.indexOf(e.gtfs.routes[s][e.gtfsHead.routes.route_type])&&e.config.productFilter.index.push(e.gtfs.routes[s][e.gtfsHead.routes.route_type]);break;case"agency":default:if(e.config.productFilter.type="agency","agency"in e.gtfs&&"agency_id"in e.gtfsHead.agency&&1!==e.gtfsHead.agency.agency_id)for(s=0;s<e.gtfs.agency.length;s+=1)-1===e.config.productFilter.index.indexOf(e.gtfs.agency[s][e.gtfsHead.agency.agency_id])&&e.config.productFilter.index.push(e.gtfs.agency[s][e.gtfsHead.agency.agency_id]);else e.config.productFilter.index.push("agency")}if("network"in e.config.productFilter==0||!Array.isArray(e.config.productFilter.network))switch(e.config.productFilter.network=[],e.config.productFilter.type){case"mode":if(e.config.productFilter.network.push([e.config.productFilter.index,{"en-US":"All modes"}]),e.config.productFilter.index.length>1)for(s=0;s<e.config.productFilter.index.length;s+=1)e.config.productFilter.index[s]in r?e.config.productFilter.network.push([[e.config.productFilter.index[s]],r[e.config.productFilter.index[s]]]):e.config.productFilter.network.push([[e.config.productFilter.index[s]],{"en-US":"Mode #"+e.config.productFilter.index[s]}]);break;case"agency":if(e.config.productFilter.network.push([e.config.productFilter.index,{"en-US":"All operators"}]),e.config.productFilter.index.length>1)for(s=0;s<e.config.productFilter.index.length;s+=1)if("agency"in e.gtfs&&-1!==e.gtfsHead.agency.agency_id&&-1!==e.gtfsHead.agency.agency_name){for(o=0;o<e.gtfs.agency.length;o+=1)if(e.gtfs.agency[o][e.gtfsHead.agency.agency_id]===e.config.productFilter.index[s]){e.config.productFilter.network.push([[e.config.productFilter.index[s]],{"en-US":e.gtfs.agency[o][e.gtfsHead.agency.agency_name]}]);break}}else e.config.productFilter.network.push([[e.config.productFilter.index[s]],{"en-US":e.config.productFilter.index[s]}]);break;default:e.config.productFilter.network.push([e.config.productFilter.index,{"en-US":"All"}])}"aquius"in e==0&&(e.aquius={}),"network"in e.aquius==0&&(e.aquius.network=[]);for(s=0;s<e.config.productFilter.network.length;s+=1)if(e.config.productFilter.network[s].length>1&&Array.isArray(e.config.productFilter.network[s][0])&&"object"==typeof e.config.productFilter.network[s][1]){for(t=[],o=0;o<e.config.productFilter.network[s][0].length;o+=1)t.push(e.config.productFilter.index.indexOf(e.config.productFilter.network[s][0][o]));e.aquius.network.push([t,e.config.productFilter.network[s][1]])}return e}(s=function(e){if("aquius"in e==0&&(e.aquius={}),"schema"in e.config.meta!=0&&"0"===e.config.meta.schema||(e.config.meta.schema="0"),"name"in e.config.meta==0&&(e.config.meta.name={}),"en-US"in e.config.meta.name==0&&("feed_info"in e.gtfs&&-1!==e.gtfsHead.feed_info.feed_publisher_name?e.config.meta.name["en-US"]=e.gtfs.feed_info[0][e.gtfsHead.feed_info.feed_publisher_name]+" ":e.config.meta.name["en-US"]="",e.config.meta.name["en-US"]+="("+e.config.fromDate,e.config.fromDate!==e.config.toDate&&(e.config.meta.name["en-US"]+="-"+e.config.toDate),e.config.meta.name["en-US"]+=")"),"url"in e.config.meta==0&&"feed_info"in e.gtfs&&-1!==e.gtfsHead.feed_info.feed_publisher_url&&(e.config.meta.url=e.gtfs.feed_info[0][e.gtfsHead.feed_info.feed_publisher_url]),e.aquius.meta=e.config.meta,"en-US"in e.config.translation==0&&(e.config.translation["en-US"]={}),"link"in e.config.translation["en-US"]==0)switch(e.config.servicePer){case 1:e.config.translation["en-US"].link="Daily Services";break;case 7:e.config.translation["en-US"].link="Weekly Services";break;default:e.config.translation["en-US"].link="Services per "+e.config.servicePer+" Days"}return e.aquius.translation=e.config.translation,"c"in e.config.option!=0&&"k"in e.config.option!=0||(e.config.option.c=parseFloat(e.gtfs.stops[0][e.gtfsHead.stops.stop_lon]),e.config.option.k=parseFloat(e.gtfs.stops[0][e.gtfsHead.stops.stop_lat]),e.config.option.m=12),"x"in e.config.option!=0&&"y"in e.config.option!=0||(e.config.option.x=parseFloat(e.gtfs.stops[0][e.gtfsHead.stops.stop_lon]),e.config.option.y=parseFloat(e.gtfs.stops[0][e.gtfsHead.stops.stop_lat]),e.config.option.z=10),e.aquius.option=e.config.option,e}(s))))),function(e,t,s){var o,r,i,n,a;function f(e){var t,s;if(e.length<3||e[0]!==e[e.length-1])return 0;for(t=e.slice(1,e.length-2),s=0;s<t.length;s+=1)if(t.indexOf(t[s])!==t.lastIndexOf(t[s]))return 0;return 1}var d={};for(n=0;n<e.gtfs.trips.length;n+=1)if(e.gtfs.trips[n][e.gtfsHead.trips.trip_id]in t){for(i=[],t[e.gtfs.trips[n][e.gtfsHead.trips.trip_id]].stops.sort(function(e,t){return e[0]-t[0]}),a=0;a<t[e.gtfs.trips[n][e.gtfsHead.trips.trip_id]].stops.length;a+=1)i.push(t[e.gtfs.trips[n][e.gtfsHead.trips.trip_id]].stops[a][1]);r="f"+s[e.gtfs.trips[n][e.gtfsHead.trips.route_id]].product,-1!==e.gtfsHead.stop_times.pickup_type&&t[e.gtfs.trips[n][e.gtfsHead.trips.trip_id]].setdown.length>0&&(t[e.gtfs.trips[n][e.gtfsHead.trips.trip_id]].setdown.sort(),r+="s"+t[e.gtfs.trips[n][e.gtfsHead.trips.trip_id]].setdown.join(":")),-1!==e.gtfsHead.stop_times.drop_off_type&&t[e.gtfs.trips[n][e.gtfsHead.trips.trip_id]].pickup.length>0&&(t[e.gtfs.trips[n][e.gtfsHead.trips.trip_id]].pickup.sort(),r+="p"+t[e.gtfs.trips[n][e.gtfsHead.trips.trip_id]].pickup.join(":")),o=i.slice().reverse().join(":")+r,(r=i.join(":")+r)in d?(d[r].service+=t[e.gtfs.trips[n][e.gtfsHead.trips.trip_id]].service,"reference"in s[e.gtfs.trips[n][e.gtfsHead.trips.route_id]]&&Object.keys(s[e.gtfs.trips[n][e.gtfsHead.trips.route_id]].reference).length>1&&-1===d[r].referenceLookup.indexOf(s[e.gtfs.trips[n][e.gtfsHead.trips.route_id]].reference.slug)&&(d[r].reference.push(s[e.gtfs.trips[n][e.gtfsHead.trips.route_id]].reference),d[r].referenceLookup.push(s[e.gtfs.trips[n][e.gtfsHead.trips.route_id]].reference.slug))):o in d?(d[o].service+=t[e.gtfs.trips[n][e.gtfsHead.trips.trip_id]].service,"reference"in s[e.gtfs.trips[n][e.gtfsHead.trips.route_id]]&&Object.keys(s[e.gtfs.trips[n][e.gtfsHead.trips.route_id]].reference).length>1&&-1===d[o].referenceLookup.indexOf(s[e.gtfs.trips[n][e.gtfsHead.trips.route_id]].reference.slug)&&(d[o].reference.push(s[e.gtfs.trips[n][e.gtfsHead.trips.route_id]].reference),d[o].referenceLookup.push(s[e.gtfs.trips[n][e.gtfsHead.trips.route_id]].reference.slug)),"direction"in d[o]&&delete d[o].direction):(d[r]={direction:1,product:s[e.gtfs.trips[n][e.gtfsHead.trips.route_id]].product,route:i,service:t[e.gtfs.trips[n][e.gtfsHead.trips.trip_id]].service},"reference"in s[e.gtfs.trips[n][e.gtfsHead.trips.route_id]]&&Object.keys(s[e.gtfs.trips[n][e.gtfsHead.trips.route_id]].reference).length>1&&(d[r].reference=[s[e.gtfs.trips[n][e.gtfsHead.trips.route_id]].reference],d[r].referenceLookup=[s[e.gtfs.trips[n][e.gtfsHead.trips.route_id]].reference.slug]),-1!==e.gtfsHead.stop_times.pickup_type&&t[e.gtfs.trips[n][e.gtfsHead.trips.trip_id]].setdown.length>0&&(d[r].setdown=t[e.gtfs.trips[n][e.gtfsHead.trips.trip_id]].setdown),-1!==e.gtfsHead.stop_times.drop_off_type&&t[e.gtfs.trips[n][e.gtfsHead.trips.trip_id]].pickup.length>0&&(d[r].pickup=t[e.gtfs.trips[n][e.gtfsHead.trips.trip_id]].pickup),f(i)&&(d[r].circular=1))}return d}(s,function(e,t,s){var o,r={};for(o=0;o<e.gtfs.trips.length;o+=1)s[e.gtfs.trips[o][e.gtfsHead.trips.service_id]]>0&&(r[e.gtfs.trips[o][e.gtfsHead.trips.trip_id]]={stops:[]},e.gtfs.trips[o][e.gtfsHead.trips.trip_id]in t?r[e.gtfs.trips[o][e.gtfsHead.trips.trip_id]].service=t[e.gtfs.trips[o][e.gtfsHead.trips.trip_id]]*s[e.gtfs.trips[o][e.gtfsHead.trips.service_id]]:r[e.gtfs.trips[o][e.gtfsHead.trips.trip_id]].service=s[e.gtfs.trips[o][e.gtfsHead.trips.service_id]],-1!==e.gtfsHead.stop_times.pickup_type&&(r[e.gtfs.trips[o][e.gtfsHead.trips.trip_id]].setdown=[]),-1!==e.gtfsHead.stop_times.drop_off_type&&(r[e.gtfs.trips[o][e.gtfsHead.trips.trip_id]].pickup=[]));for(o=0;o<e.gtfs.stop_times.length;o+=1)void 0!==r[e.gtfs.stop_times[o][e.gtfsHead.stop_times.trip_id]]&&(0===r[e.gtfs.stop_times[o][e.gtfsHead.stop_times.trip_id]].stops.length||r[e.gtfs.stop_times[o][e.gtfsHead.stop_times.trip_id]].stops[r[e.gtfs.stop_times[o][e.gtfsHead.stop_times.trip_id]].stops.length-1]!==e.nodeLookup[e.gtfs.stop_times[o][e.gtfsHead.stop_times.stop_id]])&&e.gtfs.stop_times[o][e.gtfsHead.stop_times.stop_id]in e.nodeLookup&&(r[e.gtfs.stop_times[o][e.gtfsHead.stop_times.trip_id]].stops.push([e.gtfs.stop_times[o][e.gtfsHead.stop_times.stop_sequence],e.nodeLookup[e.gtfs.stop_times[o][e.gtfsHead.stop_times.stop_id]]]),-1!==e.gtfsHead.stop_times.pickup_type&&"1"===e.gtfs.stop_times[o][e.gtfsHead.stop_times.pickup_type]&&r[e.gtfs.stop_times[o][e.gtfsHead.stop_times.trip_id]].setdown.push(e.nodeLookup[e.gtfs.stop_times[o][e.gtfsHead.stop_times.stop_id]]),-1!==e.gtfsHead.stop_times.drop_off_type&&"1"===e.gtfs.stop_times[o][e.gtfsHead.stop_times.drop_off_type]&&r[e.gtfs.stop_times[o][e.gtfsHead.stop_times.trip_id]].pickup.push(e.nodeLookup[e.gtfs.stop_times[o][e.gtfsHead.stop_times.stop_id]]));return r}(s,function(e){var t,s,o={};if("frequencies"in e.gtfs&&-1!==e.gtfsHead.frequencies.trip_id&&-1!==e.gtfsHead.frequencies.start_time&&-1!==e.gtfsHead.frequencies.end_time&&-1!==e.gtfsHead.frequencies.headway_secs)for(t=0;t<e.gtfs.frequencies.length;t+=1)s=d(e.gtfs.frequencies[t][e.gtfsHead.frequencies.start_time],e.gtfs.frequencies[t][e.gtfsHead.frequencies.end_time])/parseInt(e.gtfs.frequencies[t][e.gtfsHead.frequencies.headway_secs],10),e.gtfs.frequencies[t][e.gtfsHead.frequencies.trip_id]in o?o[e.gtfs.frequencies[t][e.gtfsHead.frequencies.trip_id]]+=s:o[e.gtfs.frequencies[t][e.gtfsHead.frequencies.trip_id]]=s;return o}(s),function(e){for(var t,s,o,r,a,f,d,g,u={},p={},c=n(e.config.fromDate),l=n(e.config.toDate);l>=c;)p[i(c)]=c,c+=864e5;if("calendar"in e.gtfs)for(f=0;f<e.gtfs.calendar.length;f+=1){for(s=0,r=n(e.gtfs.calendar[f][e.gtfsHead.calendar.start_date]),o=n(e.gtfs.calendar[f][e.gtfsHead.calendar.end_date]),t=Object.keys(p),d=0;d<t.length;d+=1)p[t[d]]>=r&&p[t[d]]<=o&&(a=parseInt(e.gtfs.calendar[f][e.gtfsHead.calendar[(g=p[t[d]],["sunday","monday","tuesday","wednesday","thursday","friday","saturday"][new Date(g).getDay()])]],10),Number.isNaN(a)||(s+=a));s>0&&(u[e.gtfs.calendar[f][e.gtfsHead.calendar.service_id]]=s)}if("calendar_dates"in e.gtfs&&-1!==e.gtfsHead.calendar_dates.service_id&&-1!==e.gtfsHead.calendar_dates.date&&-1!==e.gtfsHead.calendar_dates.exception_type)for(f=0;f<e.gtfs.calendar_dates.length;f+=1)void 0!==p[e.gtfs.calendar_dates[f][e.gtfsHead.calendar_dates.date]]&&(void 0===u[e.gtfs.calendar_dates[f][e.gtfsHead.calendar_dates.service_id]]?"1"===e.gtfs.calendar_dates[f][e.gtfsHead.calendar_dates.exception_type]&&(u[e.gtfs.calendar_dates[f][e.gtfsHead.calendar_dates.service_id]]=1):("1"===e.gtfs.calendar_dates[f][e.gtfsHead.calendar_dates.exception_type]&&(u[e.gtfs.calendar_dates[f][e.gtfsHead.calendar_dates.service_id]]+=1),"2"===e.gtfs.calendar_dates[f][e.gtfsHead.calendar_dates.exception_type]&&(1===u[e.gtfs.calendar_dates[f][e.gtfsHead.calendar_dates.service_id]]?delete u[e.gtfs.calendar_dates[f][e.gtfsHead.calendar_dates.service_id]]:u[e.gtfs.calendar_dates[f][e.gtfsHead.calendar_dates.service_id]]=u[e.gtfs.calendar_dates[f][e.gtfsHead.calendar_dates.service_id]]-1)));return u}(s)),function(e){var t,s={};for(t=0;t<e.gtfs.routes.length;t+=1)s[e.gtfs.routes[t][e.gtfsHead.routes.route_id]]={},s[e.gtfs.routes[t][e.gtfsHead.routes.route_id]].reference={slug:""},!0===e.config.allowRoute&&(-1!==e.gtfsHead.routes.route_short_name&&""!==e.gtfs.routes[t][e.gtfsHead.routes.route_short_name]?(s[e.gtfs.routes[t][e.gtfsHead.routes.route_id]].reference.n=e.gtfs.routes[t][e.gtfsHead.routes.route_short_name],s[e.gtfs.routes[t][e.gtfsHead.routes.route_id]].reference.slug+=e.gtfs.routes[t][e.gtfsHead.routes.route_short_name]):!0===e.config.allowName&&-1!==e.gtfsHead.routes.route_long_name&&""!==e.gtfs.routes[t][e.gtfsHead.routes.route_long_name]&&(s[e.gtfs.routes[t][e.gtfsHead.routes.route_id]].reference.n=e.gtfs.routes[t][e.gtfsHead.routes.route_long_name],s[e.gtfs.routes[t][e.gtfsHead.routes.route_id]].reference.slug+=e.gtfs.routes[t][e.gtfsHead.routes.route_long_name])),!0===e.config.allowColor&&-1!==e.gtfsHead.routes.route_color&&""!==e.gtfs.routes[t][e.gtfsHead.routes.route_color]&&(s[e.gtfs.routes[t][e.gtfsHead.routes.route_id]].reference.c=e.gtfs.routes[t][e.gtfsHead.routes.route_color],s[e.gtfs.routes[t][e.gtfsHead.routes.route_id]].reference.slug+=e.gtfs.routes[t][e.gtfsHead.routes.route_color]),!0===e.config.allowColor&&-1!==e.gtfsHead.routes.route_text_color&&""!==e.gtfs.routes[t][e.gtfsHead.routes.route_text_color]&&(s[e.gtfs.routes[t][e.gtfsHead.routes.route_id]].reference.t=e.gtfs.routes[t][e.gtfsHead.routes.route_text_color],s[e.gtfs.routes[t][e.gtfsHead.routes.route_id]].reference.slug+=e.gtfs.routes[t][e.gtfsHead.routes.route_text_color]),!0===e.config.allowURL&&-1!==e.gtfsHead.routes.route_url&&""!==e.gtfs.routes[t][e.gtfsHead.routes.route_url]&&(s[e.gtfs.routes[t][e.gtfsHead.routes.route_id]].reference.u=e.gtfs.routes[t][e.gtfsHead.routes.route_url],s[e.gtfs.routes[t][e.gtfsHead.routes.route_id]].reference.slug+=e.gtfs.routes[t][e.gtfsHead.routes.route_url]),"agency"===e.config.productFilter.type?"agency_id"in e.gtfsHead.routes&&-1!==e.gtfsHead.routes.agency_id?s[e.gtfs.routes[t][e.gtfsHead.routes.route_id]].product=e.config.productFilter.index.indexOf(e.gtfs.routes[t][e.gtfsHead.routes.agency_id]):s[e.gtfs.routes[t][e.gtfsHead.routes.route_id]].product=0:"mode"===e.config.productFilter.type&&"route_type"in e.gtfsHead.routes&&-1!==e.gtfsHead.routes.route_type?s[e.gtfs.routes[t][e.gtfsHead.routes.route_id]].product=e.config.productFilter.index.indexOf(e.gtfs.routes[t][e.gtfsHead.routes.route_type]):s[e.gtfs.routes[t][e.gtfsHead.routes.route_id]].product=e.config.productFilter.index[0];return s}(s))),t),0,t)}};