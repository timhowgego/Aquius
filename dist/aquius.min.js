var aquius=aquius||{LOC:{"en-US":{language:"English",embed:"Embed",export:"Export",here:"Here",link:"Services",node:"Stops",place:"People",scale:"Scale"},"es-ES":{language:"EspaÃ±ol",embed:"Insertar",export:"Exportar",here:"AquÃ­",link:"Servicios",node:"Paradas",place:"Personas",scale:"Escala"}},OPT:{base:[{options:{attribution:"&copy; <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors",maxZoom:18},type:"",url:"http://{s}.tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png"}],c:-1.43,dataset:"",id:"",hereColor:"green",k:54.54,linkColor:"red",linkScale:1,locale:"en-US",m:9,n:0,network:[],nodeColor:"black",nodeScale:1,panelScale:1,placeColor:"blue",placeOpacity:.5,placeScale:1,v:"lph",s:5,uiHash:!1,uiLocale:!0,uiNetwork:!0,uiPanel:!0,uiScale:!0,uiShare:!0,t:"en-US",translation:{},x:10.35,y:50.03,z:4},init:function(t,e){"use strict";var n,i,o,a,r,s,l,h,c,d;if(!document.getElementById(t))return!1;if(this.OPT.id=t,!Object.keys||![].indexOf||"object"!=typeof JSON)return document.getElementById(t).appendChild(document.createTextNode("Browser not supported: Try a modern browser")),document.getElementById(t).style.height="auto",!1;if(this.statusIcon("ðŸŒ"),n="object"==typeof e&&"dataset"in e&&"string"==typeof e.dataset?e.dataset:"https://github.com/timhowgego/Aquius/dist/default.json",i="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css",o="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js",a=this,"undefined"!=typeof Promise)Promise.all([fetch(n),a.promiseMe(i),a.promiseMe(o)]).then(function(t){return t[0].json()}).catch(function(t){return a.statusIcon("ðŸš«",t)}).then(function(t){return a.postInit(t,e)});else for(s=function(){a.fetchJson(n,function(t){a.postInit(t,e)})},l=0,h=function(){r=arguments,(l+=1)>=c.length&&s.call(a,r)},c=[i,o],d=0;d<c.length&&!(d>=c.length);d+=1)a.loadMe(c[d],h)},statusIcon:function(t,e){"use strict";var n=document.getElementById(this.OPT.id);function i(t,e,n){var i=document.createElement("div");i.textContent=e,i.style["text-align"]="center",void 0!==n&&(i.style["font-size"]=n),t.appendChild(i)}for(;n.firstChild;)n.removeChild(n.firstChild);return i(n,t,"1000%"),!("object"==typeof e&&"message"in e)||(i(n,"( "+e.message+" )"),!1)},fetchJson:function(t,e){"use strict";var n=this,i=new XMLHttpRequest;i.onreadystatechange=function(){if(4===i.readyState)if(200===i.status){var o=JSON.parse(i.responseText);e&&e(o)}else n.statusIcon("ðŸš«",{message:i.status+": Could not load "+t})},i.open("GET",t),i.send()},loadMe:function(t,e){"use strict";var n,i=this;"css"===t.split(".").pop()?((n=document.createElement("link")).rel="stylesheet",n.href=t):((n=document.createElement("script")).type="text/javascript",n.src=t),n.onreadystatechange=e,n.onload=e,n.onerror=function(){i.statusIcon("ðŸš«",{message:"Could not load "+t})},document.head.appendChild(n)},promiseMe:function(t){"use strict";return new Promise(function(e,n){var i;"css"===t.split(".").pop()?((i=document.createElement("link")).rel="stylesheet",i.href=t):(i=document.createElement("script")).src=t,i.onload=e,i.onerror=n,document.head.appendChild(i)})},postInit:function(t,e){"use strict";var n,i;try{if("undefined"==typeof L)throw new Error("Could not find Leaflet");if("object"!=typeof t)throw new Error("Could not find dataset network");for(this.MEM={},this.MEM.text={},this.MEM.net=this.parseNetwork(t),this.parseOption(e),n=document.getElementsByTagName("script"),i=0;i<n.length;i+=1)if(-1!==n[i].src.indexOf("aquius")){this.MEM.scriptUrl=n[i].src;break}return!!this.ui()&&this.draw()}catch(t){return this.statusIcon("ðŸš«",t)}},getHash:function(){"use strict";var t,e,n={},i=decodeURIComponent(document.location.hash.trim());if(0===i.length||"#"!==i[0])return n;for(t=i.slice(1).split("/"),e=0;e<t.length;e+=1)t[e].length>=2&&/^[a-z\-()]$/.test(t[e][0])&&(n[t[e][0]]=t[e].slice(1));return n},setHash:function(t){"use strict";var e,n=[],i=this.getHash(),o=Object.keys(t);for(e=0;e<o.length;e+=1)/^[a-z\-()]$/.test(o[e])&&(i[o[e]]=t[o[e]]);for(o=Object.keys(i),e=0;e<o.length;e+=1)n.push(o[e]+encodeURIComponent(i[o[e]]));return location.hash="#"+n.join("/"),!0},parseOption:function(t){"use strict";var e,n,i,o,a,r;"object"!=typeof t&&(t={}),e="uiHash"in t&&!0===t.uiHash?this.getHash():{},n={},i=["locale","t"],o=Object.keys(this.OPT);t:for(a=0;a<o.length;a+=1)if("id"!==o[a]){if(o[a]in e){if("string"==typeof this.OPT[o[a]]){if(-1!==i.indexOf(o[a])){n[o[a]]=e[o[a]].toString();continue}this.OPT[o[a]]=e[o[a]].toString();continue}if("number"==typeof this.OPT[o[a]]&&!Number.isNaN(parseFloat(e[o[a]]))){this.OPT[o[a]]=parseFloat(e[o[a]]);continue}}if(o[a]in t&&typeof t[o[a]]==typeof this.OPT[o[a]]){if("base"===o[a]&&!1===Array.isArray(t[o[a]]))continue;if("network"===o[a]&&Array.isArray(t[o[a]])){for(r=0;r<t[o[a]].length;r+=1)if(t[o[a]][r].length<2||"object"!=typeof t[o[a]][r][0]||"object"!=typeof t[o[a]][r][1])continue t;if("MEM"in this&&"net"in this.MEM){"network"in this.MEM.net?this.MEM.net.network=this.MEM.net.network.concat(t[o[a]]):this.MEM.net.network=t[o[a]];continue}}this.OPT[o[a]]=t[o[a]]}if("MEM"in this&&"net"in this.MEM&&"option"in this.MEM.net&&o[a]in this.MEM.net.option&&typeof this.MEM.net.option[o[a]]==typeof this.OPT[o[a]]){if("network"===o[a]||"base"===o[a]&&!1===Array.isArray(t[o[a]]))continue;this.OPT[o[a]]=this.MEM.net.option[o[a]]}else;}for(this.OPT.n=parseInt(this.OPT.n,10),(this.OPT.n>=this.MEM.net.network.length||this.OPT.n<0)&&(this.OPT.n=0),o=Object.keys(n),a=0;a<o.length;a+=1)(o[o[a]]in this.LOC||o[o[a]]in this.OPT.translation||"MEM"in this&&"net"in this.MEM&&"translation"in this.MEM.net&&o[o[a]]in this.MEM.net.translation)&&(this.OPT[o[a]]=o[o[a]]);return!0},parseNetwork:function(t){"use strict";var e,n,i,o,a,r,s="Malformed JSON dataset: ";if("object"!=typeof t)throw new Error(s+"json");for(e=["meta","translation","option"],n=0;n<e.length;n+=1)if(e[n]in t&&"object"!=typeof t[e[n]])throw new Error(s+e[n]);if("meta"in t==!1||"schema"in t.meta==!1)throw new Error(s+"meta.schema");for(i=["object","number"],o={network:[0,0],link:[1,1,0,0],node:[1,1,1],place:[1,1,1]},a=Object.keys(o),n=0;n<a.length;n+=1){a[n]in t!=!1&&!1!==Array.isArray(t[a[n]])||(t[a[n]]=[]);for(r=0;r<t[a[n]].length;r+=1){if(!1===Array.isArray(t[a[n]][r]))throw new Error(s+a[n]+"["+(r+1)+"] not iterable");if(t[a[n]][r].length<o[a[n]].length)throw new Error(s+a[n]+"["+(r+1)+"] length < "+o[a[n]].length+")");for(var l=0;l<o[a[n]].length;l+=1)if(typeof t[a[n]][r][l]!==i[o[a[n]][l]])throw new Error(s+a[n]+"["+(r+1)+"]["+l+"] not type "+i[o[a[n]][l]])}}return t},ui:function(){"use strict";var t,e,n,i,o,a,r,s,l,h,c,d,u,p,M,f,m,O,T=this;if("undefined"==typeof L)throw new Error("Could not find Leaflet");if("MEM"in this==!1)return!1;for(;document.getElementById(T.OPT.id).firstChild;)document.getElementById(T.OPT.id).removeChild(document.getElementById(T.OPT.id).firstChild);for(T.MEM.map=L.map(T.OPT.id,{preferCanvas:!0}).setView([T.OPT.y,T.OPT.x],T.OPT.z),T.MEM.map.on("moveend",function(){var t=T.MEM.map.getCenter();T.OPT.x=t.lng,T.OPT.y=t.lat,T.OPT.z=T.MEM.map.getZoom(),!0===T.OPT.uiHash&&T.setHash({x:t.lng.toFixed(Math.ceil(T.OPT.z/3)),y:t.lat.toFixed(Math.ceil(T.OPT.z/3)),z:T.OPT.z})}),T.MEM.map.on("click",function(t){T.OPT.c=t.latlng.lng,T.OPT.k=t.latlng.lat,T.OPT.m=T.OPT.z,!0===T.OPT.uiHash&&T.setHash({c:T.OPT.c.toFixed(Math.ceil(T.OPT.z/3)),k:T.OPT.k.toFixed(Math.ceil(T.OPT.z/3)),m:T.OPT.m}),T.draw()}),T.MEM.map.attributionControl.addAttribution("<a href='https://github.com/timhowgego/Aquius'>Aquius</a>"),t=0;t<T.OPT.base.length;t+=1)"url"in T.OPT.base[t]&&("options"in T.OPT.base[t]==!1&&(T.OPT.base[t].options={}),"type"in T.OPT.base[t]&&"wms"===T.OPT.base[t].type?L.tileLayer.wms(T.OPT.base[t].url,T.OPT.base[t].options).addTo(T.MEM.map):L.tileLayer(T.OPT.base[t].url,T.OPT.base[t].options).addTo(T.MEM.map));for(T.MEM.control=L.control.layers(),e=["here","link","place","node"],h=function(t){T.MEM[e[t]]=L.layerGroup(),T.MEM[e[t]].on("add",function(){-1===T.OPT.v.indexOf(e[t][0])&&(T.OPT.v+=e[t][0],!0===T.OPT.uiHash&&T.setHash({v:T.OPT.v}))}),T.MEM[e[t]].on("remove",function(){T.OPT.v=T.OPT.v.replace(e[t][0],""),!0===T.OPT.uiHash&&T.setHash({v:T.OPT.v})}),-1!==T.OPT.v.indexOf(e[t][0])&&T.MEM[e[t]].addTo(T.MEM.map),(a=L.DomUtil.create("span")).style.color=T.OPT[e[t]+"Color"],a.id=T.OPT.id+"-layercontrol-"+e[t],T.MEM.text[a.id]=e[t],T.MEM.control.addOverlay(T.MEM[e[t]],a.outerHTML)},t=0;t<e.length;t+=1)h(t);for(T.MEM.control.addTo(T.MEM.map),c=T.MEM.control.getContainer().childNodes,d=null,t=0;t<c.length;t+=1)if("FORM"===c[t].tagName){d=c[t];break}if(null!==d&&!0===T.OPT.uiLocale){for(u=Object.keys(T.LOC),O=Object.keys(T.OPT.translation),t=0;t<O.length;t+=1)-1===u.indexOf(O[t])&&u.push(O[t]);if(u.length>1){for((n=document.createElement("div")).id=T.OPT.id+"-language",p=n.id+"-radio",n.addEventListener("change",function(){T.OPT.t=document.querySelector("input[name='"+p+"']:checked").value,!0===T.OPT.uiHash&&T.setHash({t:T.OPT.t}),T.localise()}),t=0;t<u.length;t+=1)(i=document.createElement("input")).value=u[t],i.type="radio",i.name=p,T.OPT.t===u[t]&&(i.checked="checked"),(o=document.createElement("label")).appendChild(i),l=u[t]in T.OPT.translation&&"language"in T.OPT.translation[u[t]]?T.OPT.translation[u[t]].language:u[t]in T.LOC&&"language"in T.LOC[u[t]]?T.LOC[u[t]].language:u[t],o.appendChild(document.createTextNode(l)),n.appendChild(o);d.insertBefore(n,d.childNodes[0])}}if(null!==d&&!0===T.OPT.uiNetwork&&T.MEM.net.network.length>1){for((n=document.createElement("div")).id=T.OPT.id+"-network",s=n.id+"-radio",n.addEventListener("change",function(){T.OPT.n=document.querySelector("input[name='"+s+"']:checked").value-0,!0===T.OPT.uiHash&&T.setHash({n:T.OPT.n}),T.draw()}),t=0;t<T.MEM.net.network.length;t+=1)(i=document.createElement("input")).value=t,i.type="radio",i.name=s,t===T.OPT.n&&(i.checked="checked"),(a=document.createElement("span")).id=n.id+t,T.MEM.text[a.id]="network"+t,(o=document.createElement("label")).appendChild(i),o.appendChild(a),n.appendChild(o);d.appendChild(n)}null!==d&&!0===T.OPT.uiScale&&(o=document.createElement("label"),(i=document.createElement("input")).id=T.OPT.id+"-scale",i.type="range",i.min=1,i.value=T.OPT.s,i.max=9,i.step=2,i.addEventListener("change",function(){T.OPT.s=parseInt(document.getElementById(i.id).value,10),!0===T.OPT.uiHash&&T.setHash({s:T.OPT.s}),T.draw()}),(r=document.createElement("div")).id=i.id+"-text",r.style["text-align"]="center",T.MEM.text[r.id]="scale",o.appendChild(r),o.appendChild(i),d.appendChild(o)),null!==d&&!0===T.OPT.uiShare&&Blob&&((r=document.createElement("div")).style["text-align"]="center",(M=document.createElement("a")).id=T.OPT.id+"-embed",T.MEM.text[M.id]="embed",M.style.cursor="pointer",M.download=T.OPT.id+".html",M.addEventListener("click",function(){var t,e,n="scriptUrl"in T.MEM?T.MEM.scriptUrl:"\x3c!-- Add Script URL --\x3e",i=Object.keys(T.OPT),o={};for(t=0;t<i.length;t+=1)"id"!==i[t]&&(o[i[t]]=T.OPT[i[t]]);o.uiHash=!1,o.locale=T.OPT.t,e=new Blob(['<!DOCTYPE html><html style="height:100%;" lang="'+o.t+'"><head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /></head><body style="height:100%;margin:0;">\n\n\n<div id="'+T.OPT.id+'" style="height:100%;"></div><script src="'+n+'" async><\/script><script>window.addEventListener("load",function(){aquius.init("'+T.OPT.id+'",'+JSON.stringify(o)+")});<\/script>\n\n\n</body></html>"],{type:"text/html;charset=utf-8"}),M.href=window.URL.createObjectURL(e)}),r.appendChild(M),r.appendChild(document.createTextNode(" | ")),(f=document.createElement("a")).id=T.OPT.id+"-export",T.MEM.text[f.id]="export",f.style.cursor="pointer",f.download=T.OPT.id+".geojson",f.addEventListener("click",function(){for(var t=[],e=Object.keys(T.MEM.outputMap),n=0;n<e.length;n+=1)-1!==T.OPT.v.indexOf(e[n])&&(t=t.concat(T.MEM.outputMap[e[n]]));var i=new Blob([JSON.stringify(L.featureGroup(t).toGeoJSON())],{type:"application/json;charset=utf-8"});f.href=window.URL.createObjectURL(i)}),r.appendChild(f),d.appendChild(r));var g=["link","place","node"];return!0===T.OPT.uiPanel&&(T.MEM.panel=L.control({position:"bottomleft"}),T.MEM.panel.onAdd=function(){for(r=document.createElement("div"),L.DomEvent.disableClickPropagation(r),r.id=T.OPT.id+"-panel",r.style["font-weight"]="bold",r.style.padding="0.1em 0.6em",r.style["border-radius"]="2em",r.style["background-color"]="rgba(255, 255, 255, 0.7)",t=0;t<g.length;t+=1)(a=document.createElement("span")).id=r.id+"-"+g[t],a.style.color=T.OPT[g[t]+"Color"],a.appendChild(document.createTextNode(" ")),(m=document.createElement("span")).id=a.id+"-value",m.style["font-size"]=Math.round(200*T.OPT.panelScale)+"%",m.textContent="0",a.appendChild(m),a.appendChild(document.createTextNode(" ")),(o=document.createElement("span")).id=a.id+"-label",o.style["font-size"]=Math.round(100*T.OPT.panelScale)+"%",o.style["vertical-align"]=Math.round(20*T.OPT.panelScale)+"%",T.MEM.text[o.id]=g[t],a.appendChild(o),a.appendChild(document.createTextNode(" ")),r.appendChild(a);return r},T.MEM.panel.addTo(T.MEM.map)),T.localise()},localise:function(){"use strict";var t,e,n,i,o,a,r,s;function l(t,e){"string"!=typeof e&&(e=e.toString()),document.getElementById(t)&&(document.getElementById(t).textContent=e)}if("MEM"in this==!1)return!1;t=Object.keys(this.MEM.text),e=[this.OPT.t,this.OPT.locale];t:for(i=0;i<t.length;i+=1){for(o=0;o<e.length;o+=1){if(n=this.MEM.text[t[i]],e[o]in this.OPT.translation&&n in this.OPT.translation[e[o]]){l(t[i],this.OPT.translation[e[o]][n]);continue t}if("translation"in this.MEM.net&&e[o]in this.MEM.net.translation&&n in this.MEM.net.translation[e[o]]){l(t[i],this.MEM.net.translation[e[o]][n]);continue t}if(/^network\d+/.test(n)&&(a=n.slice(7)-0)>=0&&a<this.MEM.net.network.length&&e[o]in this.MEM.net.network[a][1]){l(t[i],this.MEM.net.network[a][1][e[o]]);continue t}if(e[o]in this.LOC&&n in this.LOC[e[o]]){l(t[i],this.LOC[e[o]][n]);continue t}}l(t[i],n)}return"attribution"in this.MEM&&this.MEM.map.attributionControl.removeAttribution(this.MEM.attribution),"name"in this.MEM.net.meta&&(this.OPT.t in this.MEM.net.meta.name&&"string"==typeof this.MEM.net.meta.name[this.OPT.t]?r=this.MEM.net.meta.name[this.OPT.t]:this.OPT.locale in this.MEM.net.meta.name&&"string"==typeof this.MEM.net.meta.name[this.OPT.locale]&&(r=this.MEM.net.meta.name[this.OPT.locale]),"string"==typeof r&&("url"in this.MEM.net.meta&&"string"==typeof this.MEM.net.meta.url&&((s=document.createElement("a")).href=this.MEM.net.meta.url,s.textContent=r,r=s.outerHTML),"attribution"in this.MEM.net.meta&&"object"==typeof this.MEM.net.meta.attribution&&(this.OPT.t in this.MEM.net.meta.attribution&&"string"==typeof this.MEM.net.meta.attribution[this.OPT.t]?r+=" "+this.MEM.net.meta.attribution[this.OPT.t]:this.OPT.locale in this.MEM.net.meta.name&&"string"==typeof this.MEM.net.meta.name[this.OPT.locale]&&(r+=" "+this.MEM.net.meta.attribution[this.OPT.locale])),this.MEM.attribution=r,this.MEM.map.attributionControl.addAttribution(this.MEM.attribution))),!0},draw:function(){"use strict";var t,e,n,i,o,a,r,s,l,h,c,d,u,p,M,f,m,O,T,g,E,P,y,b,k,w,v,C,x,S,j,I,H,N,A,B,z,U,q,F,R,J,G,D;function Z(t,e){for(var n,i,o=Object.keys(t),a=0;a<o.length;a+=1)if(n=e.id+"-panel-"+o[a]+"-value",i=t[o[a]].toString(),document.getElementById(n)){if("function"==typeof Intl.NumberFormat)try{i=new Intl.NumberFormat(e.t).format(t[o[a]])}catch(t){}document.getElementById(n).textContent=i}}if("undefined"==typeof L)throw new Error("Could not find Leaflet");if("MEM"in this==!1)return!1;if("map"in this.MEM==!1)return this.ui();for(t=["link","place","here","node"],e=0;e<t.length;e+=1){if(t[e]in this.MEM==!1)return!1;this.MEM[t[e]].clearLayers()}for(n=5e6/Math.pow(2,this.OPT.m),i=L.latLng(this.OPT.k,this.OPT.c),o=[],a={link:0,place:0,node:0},r=Math.exp((this.OPT.s-5)/2),s=this.MEM.net.link,l=this.MEM.net.network,h=this.MEM.net.node,c=this.MEM.net.place,(d=L.circle(i,{color:this.OPT.hereColor,weight:2,fill:!1,radius:n})).addTo(this.MEM.here),e=0;e<h.length;e+=1)h[e].length>1&&n>=i.distanceTo(L.latLng(h[e][1],h[e][0]))&&o.push(e);if(0===o.length)return!0===this.OPT.uiPanel&&Z(a,this.OPT),!0;for(u=[],p=[],e=0;e<s.length;e+=1)if(-1!==l[this.OPT.n][0].indexOf(s[e][0])&&!(s[e][2].length<2||"shared"in s[e][3]&&-1!==l[this.OPT.n][0].indexOf(s[e][3].shared)||0===s[e][2].filter(function(t){return-1!==o.indexOf(t)}).length)){if(M=0,"split"in s[e][3]&&Array.isArray(s[e][3].split)&&(M=s[e][2].filter(function(t){return-1===s[e][3].split.indexOf(t)}).filter(function(t){return-1!==o.indexOf(t)}).length>0?1:2),f="circular"in s[e][3]&&!0===s[e][3].circular?s[e][2].length-1:null,m=[],1===(T="direction"in s[e][3]&&!0===s[e][3].direction?1:0)){for(g=0;g<s[e][2].length;g+=1)if(-1!==o.indexOf(s[e][2][g])){null!==f?(m=(m=s[e][2].slice(0,-1)).slice(g).concat(m.slice(0,g))).push(m[0]):m=s[e][2].slice(g);break}}else m=s[e][2];for(1!==M&&(a.link+=s[e][1]),g=0;g<m.length;g+=1)if(1===M&&-1===s[e][3].split.indexOf(m[g])||f===g||(O=1===T||-1!==o.indexOf(m[g])?s[e][1]:s[e][1]/2,p[m[g]]=void 0!==p[m[g]]?p[m[g]]+O:O),m.length-1>g&&(1!==M||-1!==s[e][3].split.indexOf(m[g])||-1!==s[e][3].split.indexOf(m[g+1])))for(E=[[m[g],m[g+1]],[m[g+1],m[g]]],O=1===T||-1!==o.indexOf(m[g])&&-1!==o.indexOf(m[g+1])?s[e][1]:s[e][1]/2,P=0;P<E.length;P+=1)void 0===u[E[P][0]]&&(u[E[P][0]]=[]),void 0===u[E[P][0]][E[P][1]]?u[E[P][0]][E[P][1]]=O:u[E[P][0]][E[P][1]]+=O}if(0===u.length)return!0===this.OPT.uiPanel&&Z(a,this.OPT),!0;for(y=[],b=[],k=[],w=[],v={weight:1,color:this.OPT.nodeColor,fill:!1},C={stroke:!1,fill:!0,fillColor:this.OPT.placeColor,fillOpacity:this.OPT.placeOpacity},x={color:this.OPT.linkColor},S=Object.keys(u),j={},I={},z=0;z<S.length;z+=1)for(A=S[z]-0,H=Object.keys(u[A]),U=0;U<H.length;U+=1)H[U]+"-"+S[z]in j==!1&&(B=H[U]-0,j[S[z]+"-"+H[U]]=[A,B,u[A][B]],(N=u[A][B]+"-"+S[z])in I?I[N].push(S[z]+"-"+H[U]):I[N]=[S[z]+"-"+H[U]]);for(q=Object.keys(j),0;;){for(G=[j[J=q.shift()][0],j[J][1]],D=j[J][2];(N=D+"-"+G[G.length-1])in I&&I[N].length>0;)R=I[N].pop(),G.push(j[R][1]);for(F=[],e=0;e<G.length;e+=1)F.push([h[G[e]][1],h[G[e]][0]]);if(x.weight=Math.ceil(Math.log(1+D*(1/(4*this.OPT.linkScale*r)))*this.OPT.linkScale*4*r),k.push(L.polyline(F,x).bindTooltip(D.toString())),0===q.length)break}for(e=0;e<p.length;e+=1)void 0!==p[e]&&h.length-1>=e&&(a.node+=1,v.radius=Math.ceil(Math.log(1+p[e]*(1/(4*this.OPT.nodeScale*r)))*this.OPT.nodeScale*2*r),b.push(L.circleMarker([h[e][1],h[e][0]],v).bindTooltip(p[e].toString())),-1===w.indexOf(h[e][2])&&w.push(h[e][2]));for(e=0;e<w.length;e+=1)c.length-1>=e&&(a.place+=c[w[e]][2],C.radius=Math.ceil(Math.sqrt(c[w[e]][2]*this.OPT.placeScale*r/666)),y.push(L.circleMarker([c[w[e]][1],c[w[e]][0]],C).bindTooltip(c[w[e]][2].toString())));return L.layerGroup(y).addTo(this.MEM.place),L.layerGroup(k).addTo(this.MEM.link),L.layerGroup(b).addTo(this.MEM.node),this.MEM.outputMap={p:y,l:k,n:b,h:d},!0===this.OPT.uiPanel&&Z(a,this.OPT),!0}};