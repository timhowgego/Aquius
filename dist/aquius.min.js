var aquius=aquius||{init:function(e,t){"use strict";var n,a,r=document.getElementById(e);function i(e,t){function n(e,t){var n,a=[];for(n=0;n<t.length;n+=1)("here"===t[n]||t[n]in e.dataObject&&e.dataObject[t[n]].length>0)&&a.push(t[n]);return a}return n(e,"boolean"==typeof t&&!0===t?["link","place","node"]:["place","link","node","here"])}function o(e,t,n){var a,r,i,o=document.createElement(e);if(void 0!==t)for(a=Object.keys(t),i=0;i<a.length;i+=1)o[a[i]]=t[a[i]];if(void 0!==n)for(r=Object.keys(n),i=0;i<r.length;i+=1)o.style[r[i]]=n[r[i]];return o}function c(e,t){for(var n,a=document.getElementById(e._id),r=o("div",{},{margin:"0 auto","max-width":"800px","text-align":"center"});a.firstChild;)a.removeChild(a.firstChild);return"map"in e&&"function"==typeof e.map.remove&&(e.map.remove(),a.className=""),n=void 0!==t?"🚫":"🌍",r.appendChild(o("div",{textContent:n},{"font-size":"1000%"})),void 0!==t&&r.appendChild(o("p",{textContent:t.toString()})),a.appendChild(r),void 0===t}function l(e,t){var n,a,r,i,o;function l(t,n){var a;"css"===t.split(".").pop()?((a=document.createElement("link")).rel="stylesheet",a.href=t):((a=document.createElement("script")).type="text/javascript",a.src=t),a.onreadystatechange=n,a.onload=n,a.onerror=function(){return c(e,{message:"Could not load "+t})},document.head.appendChild(a)}if(a=function(){var t,n,a;"dataset"in e&&"string"==typeof e.dataset?(t=e.dataset,n=function(t){return e.dataObject=t,v(e)},(a=new XMLHttpRequest).onreadystatechange=function(){if(4===a.readyState){if(200!==a.status)return c(e,{message:a.status+": Could not load "+t});var r=JSON.parse(a.responseText);n&&n(r)}},a.open("GET",t),a.send()):v(e)},0===t.length)a();else for(r=0,i=function(){n=arguments,(r+=1)>=t.length&&a.call(this,n)},o=0;o<t.length&&!(o>=t.length);o+=1)l(t[o],i)}function d(e,t){return e.t in e.translation&&t in e.translation[e.t]?e.translation[e.t][t]:e.locale in e.translation&&t in e.translation[e.locale]?e.translation[e.locale][t]:""}function s(e,t){var n,a,r,i=Object.keys(e._toLocale);for(r=0;r<i.length;r+=1)(n=document.getElementById(i[r]))&&""!==(a=d(e,e._toLocale[i[r]]))&&(n.textContent=a);return void 0!==t&&!0===t&&h(e,!0),e}function p(e,t){var n={};function a(){var e,t={},n=decodeURIComponent(document.location.hash.trim()).slice(1).split("/");for(e=0;e<n.length;e+=1)n[e].length>=2&&/^[a-z\-()]$/.test(n[e][0])&&(t[n[e][0]]=n[e].slice(1));return t}function r(e){try{return null!==sessionStorage.getItem(e._id)?JSON.parse(sessionStorage.getItem(e._id)):{}}catch(e){return{}}}return!sessionStorage||"uiStore"in e!=!1&&!0!==e.uiStore||(n="object"==typeof t?function(e,t){var n,a=r(e),i=Object.keys(t);for(n=0;n<i.length;n+=1)a[i[n]]=t[i[n]];try{sessionStorage.setItem(e._id,JSON.stringify(a))}catch(e){}return a}(e,t):r(e)),"uiHash"in e==!0&&!0===e.uiHash&&(n="object"==typeof t?function(e,t){var n,r,i,o=a(),c=Object.keys(t);for(i=0;i<c.length;i+=1)1===c[i].length&&/^[a-z\-()]$/.test(c[i])&&(o[c[i]]=t[c[i]]);for(n=Object.keys(o),r=[],i=0;i<n.length;i+=1)r.push(n[i]+encodeURIComponent(o[n[i]]));return location.hash="#"+r.join("/"),o}(0,t):a()),n}function u(e){var t,n,a,r,c,l,d,u,f,b,g,m,v,O,y,j,k,_,x,w,C,S,N,A,I,L,M;function E(e,t){return e._layer[t].on("add",function(){-1===e.v.indexOf(t.charAt(0))&&(e.v+=t.charAt(0),p(e,{v:e.v}))}),e._layer[t].on("remove",function(){e.v=e.v.replace(t.charAt(0),""),p(e,{v:e.v})}),e}function T(e,t,n,a,r){var i,c,l;if(n in e.dataObject&&Array.isArray(e.dataObject[n])&&e.dataObject[n].length>1&&!0===e[r]){for(c=[],l=0;l<e.dataObject[n].length;l+=1)c.push({value:l,id:e._id+n+l}),e._toLocale[e._id+n+l]="_"+n+l;(i=function(e,t,n,a){var r,i,c,l,d;for(void 0===a&&(a={}),r=o("div",{id:t},a),d=0;d<e.length;d+=1)c=o("label"),i=o("input",{type:"radio",name:t}),"value"in e[d]&&(i.value=e[d].value,void 0!==n&&e[d].value===n&&(i.checked="checked")),c.appendChild(i),l=o("span"),"id"in e[d]&&(l.id=e[d].id),"label"in e[d]&&(l.textContent=e[d].label),c.appendChild(l),r.appendChild(c);return r}(c,e._id+n,e[a],{"border-top":"1px solid #ddd","margin-top":"4px","padding-top":"4px"})).addEventListener("change",function(){e[a]=parseInt(document.querySelector("input[name='"+e._id+n+"']:checked").value,10);var t={};t[a]=e[a],p(e,t),h(e)},!1),t.appendChild(i)}return e}function z(e,t,n,a,r,i,c,l,d){var s,u,f,b;return!0===e[r]&&(b=o("label"),u=e._id+n+"name",b.appendChild(o("div",{id:u},{"border-top":"1px solid #ddd","margin-top":"4px","padding-top":"4px","text-align":"center"})),e._toLocale[u]=n,s=o("div",{},{"text-align":"center"}),(f=o("input",{id:e._id+n,type:"range",min:i,max:c,value:e[a]})).addEventListener("change",function(){var t={};e[a]=parseInt(document.getElementById(e._id+n).value,10),t[a]=e[a],p(e,t),h(e,l)},!1),s.appendChild(f),b.appendChild(s),void 0!==d&&(u=e._id+n+"legend",b.appendChild(o("div",{id:u},{color:"#888","text-align":"center"})),e._toLocale[u]=d),t.appendChild(b)),e}function P(e){return"_control"in e&&delete e.control,s(e)}return e._toLocale={},e._layer={},e=function(e){var t,n,a=["_datasetName","_datasetAttribution"];for(n=0;n<a.length;n+=1)e._toLocale[e._id+a[n]]=a[n],a[n]=e._id+a[n];return t=o("span"),"meta"in e.dataObject&&"url"in e.dataObject.meta&&"string"==typeof e.dataObject.meta.url?t.appendChild(o("a",{href:e.dataObject.meta.url,id:a[0]})):t.appendChild(o("span",{id:a[0]})),t.appendChild(document.createTextNode(" ")),t.appendChild(o("span",{id:a[1]})),e.map.attributionControl.addAttribution(t.outerHTML),e}(e),n=e,b=Object.keys(n.translation).sort(),!0===n.uiLocale&&b.length>1&&((a=n.leaflet.control({position:"topright"})).onAdd=function(){for(r=o("div",{className:"aquius-locale",id:n._id+"locale"},{"background-color":"#fff","border-bottom":"2px solid rgba(0,0,0,0.3)","border-left":"2px solid rgba(0,0,0,0.3)","border-radius":"0 0 0 5px",margin:0,padding:"0 0 1px 1px"}),n.leaflet.DomEvent.disableClickPropagation(r),c=n._id+"langname",r.appendChild(o("label",{id:c,for:n._id+"lang"},{display:"none"})),n._toLocale[c]="language",u=[],f=0;f<b.length;f+=1)l="lang"in n.translation[b[f]]?n.translation[b[f]].lang:b[f],u.push({value:b[f],label:l});return(d=function(e,t){var n,a,r=o("select");for(a=0;a<e.length;a+=1)n=o("option"),"value"in e[a]&&(n.value=e[a].value,e[a].value===t&&(n.selected="selected")),"label"in e[a]&&(n.textContent=e[a].label),"id"in e[a]&&(n.id=e[a].id),r.appendChild(n);return r}(u,n.t)).id=n._id+"lang",d.style["background-color"]="#fff",d.style.border="none",d.style.color="#000",d.style.font='12px/1.5 "Helvetica Neue", Arial, Helvetica, sans-serif',d.addEventListener("change",function(){n.t=document.getElementById(n._id+"lang").value,p(n,{t:n.t}),s(n,!0)},!1),r.appendChild(d),r},a.addTo(n.map)),!0===(g=e=n).uiPanel&&((m=g.leaflet.control({position:"bottomleft"})).onAdd=function(){for(v=o("div",{className:"aquius-panel",id:g._id+"panel"},{"background-color":"rgba(255,255,255,"+g.panelOpacity+")","font-weight":"bold",padding:"0 3px","border-radius":"5px","margin-right":"10px"}),g.leaflet.DomEvent.disableClickPropagation(v),j=i(g,!0),k=0;k<j.length;k+=1)(O=o("span",{},{color:g[j[k]+"Color"],margin:"0 0.1em"})).appendChild(o("span",{id:g._id+j[k]+"value",textContent:"0"},{"font-size":Math.round(150*g.panelScale).toString()+"%",margin:"0 0.1em"})),y=g._id+j[k]+"label",O.appendChild(o("span",{id:y},{"font-size":Math.round(100*g.panelScale).toString()+"%",margin:"0 0.1em","vertical-align":"10%"})),g._toLocale[y]=j[k],v.appendChild(O),v.appendChild(document.createTextNode(" "));return v},m.addTo(g.map)),(t=function(e){var t,n;if("_control"in e)for(t=e._control.getContainer().childNodes,n=0;n<t.length;n+=1)if("SECTION"===t[n].tagName||"FORM"===t[n].tagName)return t[n];return!1}(e=function(e){var t,n,a=i(e).reverse();for(e._control=e.leaflet.control.layers(),n=0;n<a.length;n+=1)e._layer[a[n]]=e.leaflet.layerGroup(),-1!==(e=E(e,a[n])).v.indexOf(a[n].charAt(0))&&e._layer[a[n]].addTo(e.map),t=e._id+a[n]+"name",e._toLocale[t]=a[n],e._control.addOverlay(e._layer[a[n]],o("span",{id:t},{color:e[a[n]+"Color"]}).outerHTML);return e._control.addTo(e.map),e}(e=g)))?("place"in(e=T(e=T(e,t,"network","n","uiNetwork"),t,"service","r","uiService")).dataObject&&e.dataObject.place.length>0&&z(e,t,"connectivity","p","uiConnectivity",0,3,!1,"connectivityRange"),e=z(e,t,"scale","s","uiScale",0,10,!0),x=t,!0===(_=e).uiShare&&Blob&&(N=o("div",{},{"border-top":"1px solid #ddd","margin-top":"4px","padding-top":"4px","text-align":"center"}),""!==_.dataset&&(A=_._id+"embed",(w=o("a",{id:A,download:_._id+"-embed.txt",role:"button"},{cursor:"pointer"})).addEventListener("click",function(){var e,t;w.href=window.URL.createObjectURL(((t=[]).push(o("div",{id:(e=_)._id},{height:"100%"}).outerHTML),t.push(o("script",{src:function(){var e,t=document.getElementsByTagName("script");for(e=0;e<t.length;e+=1)if(-1!==t[e].src.indexOf("aquius"))return t[e].src;return"\x3c!--Script URL--\x3e"}()}).outerHTML),t.push(o("script",{textContent:'window.addEventListener("load",function(){aquius.init("'+e._id+'",'+JSON.stringify(function(e){var t,n={base:[{options:{attribution:"&copy; <a href='https://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors",maxZoom:18},type:"",url:"https://maps.wikimedia.org/osm-intl/{z}/{x}/{y}.png"}],c:-1.43,connectivity:1,dataObject:{},dataset:"",hereColor:"#080",k:54.54,leaflet:{},linkColor:"#f00",linkScale:1,locale:"en-US",m:9,map:{},minWidth:2,minZoom:0,n:0,network:[],networkAdd:!0,nodeColor:"#333",nodeScale:1,p:0,panelOpacity:.7,panelScale:1,placeColor:"#00f",placeOpacity:.5,placeScale:1,v:"hlnp",r:0,s:5,uiConnectivity:!0,uiHash:!1,uiLocale:!0,uiNetwork:!0,uiPanel:!0,uiScale:!0,uiService:!0,uiShare:!0,uiStore:!0,t:"en-US",translation:{},x:10.35,y:50.03,z:4},a={},r=Object.keys(e);for(t=0;t<r.length;t+=1)"_"!==r[t].charAt(0)&&-1===["base","dataObject","leaflet","map","network","translation","uiHash"].indexOf(r[t])&&e[r[t]]!==n[r[t]]&&(a[r[t]]=e[r[t]]);return a}(e))+")});"}).outerHTML),new Blob([t.join("\n")],{type:"text/plain;charset=utf-8"})))},!1),_._toLocale[A]="embed",N.appendChild(w),N.appendChild(document.createTextNode(" | "))),I=i(_),A=_._id+"export",(C=o("a",{id:A,download:_._id+"-export.json",role:"button"},{cursor:"pointer"})).addEventListener("click",function(){for(L={geoJSON:[],network:_.n,range:5e6/Math.pow(2,_.m),service:_.r,x:_.c,y:_.k},_.p>0&&(L.connectivity=2/(Math.pow(10,_.p)/10)*_.connectivity),M=0;M<I.length;M+=1)-1!==_.v.indexOf(I[M].charAt(0))&&L.geoJSON.push(I[M]);"object"==typeof _._here&&"dataObject"in _._here?(S=_._here.dataObject,L.sanitize=!1):(S=_.dataObject,L.sanitize=!0),C.href=window.URL.createObjectURL(new Blob([JSON.stringify(_._call(S,L))],{type:"application/json;charset=utf-8"}))},!1),_._toLocale[A]="export",N.appendChild(C),x.appendChild(N)),P(e=_)):P(e)}function h(e,t){var n,a;void 0===t||!0!==t||"object"!=typeof e._here?(a={_configOptions:e,callback:f,network:e.n,range:5e6/Math.pow(2,e.m),service:e.r,x:e.c,y:e.k},e.p>0&&(a.connectivity=2/(Math.pow(10,e.p)/10)*e.connectivity),"object"==typeof e._here&&"dataObject"in e._here?(n=e._here.dataObject,a.sanitize=!1):(n=e.dataObject,a.sanitize=!0),e._call(n,a)):m(e)}function f(e,t,n){"_configOptions"in n&&(void 0===e?(n._configOptions._here=t,m(n._configOptions)):c(n._configOptions,e))}function b(e,t){var n,a=[];if("undefined"===t||!Array.isArray(t))return e.linkColor;for(n=0;n<t.length;n+=1)"c"in t[n]&&"reference"in e.dataObject&&"color"in e.dataObject.reference&&t[n].c>=0&&t[n].c<e.dataObject.reference.color.length&&-1===a.indexOf(e.dataObject.reference.color[t[n].c])&&a.push(e.dataObject.reference.color[t[n].c]);return 0===a.length?e.linkColor:1===a.length?a[0]:function(e){var t,n,a="#",r=[[],[],[]];for(n=0;n<e.length;n+=1)7===e[n].length&&"#"===e[n][0]&&(r[0].push(parseInt(e[n].slice(1,3),16)),r[1].push(parseInt(e[n].slice(3,5),16)),r[2].push(parseInt(e[n].slice(5,7),16)));for(n=0;n<r.length;n+=1){if(0===r[n].length)return a+e[0];(t=Math.round(r[n].reduce(function(e,t){return e+t},0)/r[n].length))<=16&&(a+="0"),a+=t.toString(16)}return a}(a)}function g(e,t,n,a,r){var i,c,l,d,s,p;function u(e,t,n,a,r){var i,c,l,d,s="[*]";if(void 0!==t&&Array.isArray(t)){for(i=o("div",{},{margin:"0.3em 0"}),a?i.style["font-weight"]="bold":i.style["line-height"]="2em",void 0!==r&&""!==r&&i.appendChild(o("div",{textContent:r},{"line-height":"1.2em",margin:"0"})),d=0;d<t.length;d+=1)"n"in t[d]&&("u"in t[d]&&"reference"in e.dataObject&&"url"in e.dataObject.reference&&t[d].u>=0&&t[d].u<e.dataObject.reference.url.length?(-1!==(l=o("a",{href:e.dataObject.reference.url[t[d].u]})).href.lastIndexOf(s)&&("i"in t[d]?l.href=l.href.replace(s,t[d].i):"n"in t[d]?l.href=l.href.replace(s,t[d].n):l.href=l.href.replace(s,"")),a||(l.style.color="#000",l.style["text-decoration"]="none")):l=o("span"),l.textContent=t[d].n,a||(l.style.padding="0.2em 0.3em",l.style.border="1px solid #000",l.style["white-space"]="nowrap","reference"in e.dataObject&&"color"in e.dataObject.reference&&("c"in t[d]&&t[d].c>=0&&t[d].c<e.dataObject.reference.color.length&&(l.style["background-color"]=e.dataObject.reference.color[t[d].c],l.style["border-color"]=e.dataObject.reference.color[t[d].c]),"t"in t[d]&&t[d].t>=0&&t[d].t<e.dataObject.reference.color.length&&(l.style.color=e.dataObject.reference.color[t[d].t]))),i.appendChild(l),d<t.length-1&&(c=a?", ":" ",i.appendChild(document.createTextNode(c))));n.appendChild(i)}return n}if(l=u(e,r,l=o("div",{},{color:"#000"}),!0),n=n<10&&n%1!=0?(Math.round(10*n)/10).toString():Math.round(n).toString(),l.appendChild(o("div",{textContent:t+": "+n},{margin:"0.3em 0"})),"reference"in e.dataObject&&"product"in e.dataObject.reference&&e.dataObject.reference.product.length>1&&!0===e.uiNetwork){for(c=[],d=[],s=0;s<a.length;s+=1)if("p"in a[s])for(p=0;p<a[s].p.length;p+=1)void 0===d[a[s].p[p]]&&(d[a[s].p[p]]=[]),d[a[s].p[p]].push(a[s]);else c.push(a[s]);for(s=0;s<d.length;s+=1)void 0!==d[s]&&(s<e.dataObject.reference.product.length&&"object"==typeof e.dataObject.reference.product[s]?e.t in e.dataObject.reference.product[s]?d[s].unshift(e.dataObject.reference.product[s][e.t]):e.locale in e.dataObject.reference.product[s]?d[s].unshift(e.dataObject.reference.product[s][e.locale]):(i=Object.keys(e.dataObject.reference.product[s])).length>0?d[s].unshift(e.dataObject.reference.product[s][i[0]]):d[s].unshift(""):c=c.concat(d[s]));for(d.sort(),s=0;s<d.length;s+=1)void 0!==d[s]&&(l=u(e,d[s].slice(1),l,!1,d[s][0]))}else c=a;return c.length>0&&(l=u(e,c,l,!1)),l}function m(e){var t,n,a,r,o,c,l,s,p,u=i(e);for(s=0;s<u.length;s+=1)u[s]in e._layer&&e._layer[u[s]].clearLayers();if(!0===e.uiPanel&&"summary"in e._here)for(n=Object.keys(e._here.summary),s=0;s<n.length;s+=1)if(a=document.getElementById(e._id+n[s]+"value"))try{a.textContent=new Intl.NumberFormat(e.t).format(Math.round(e._here.summary[n[s]]))}catch(t){a.textContent=Math.round(e._here.summary[n[s]]).toString()}if("place"in e._here&&"place"in e.dataObject&&e.dataObject.place.length>0)for(c=Math.exp((e.s-5)/2)*e.placeScale/666,o=d(e,"place"),s=0;s<e._here.place.length;s+=1)if("circle"in e._here.place[s]&&"value"in e._here.place[s]&&e._here.place[s].circle.length>1){if(l=Math.round(e._here.place[s].value).toString()+" "+o,"place"in e._here.place[s]&&Array.isArray(e._here.place[s].place)){for(r=[],p=0;p<e._here.place[s].place.length;p+=1)"object"==typeof e._here.place[s].place[p]&&"n"in e._here.place[s].place[p]&&r.push(e._here.place[s].place[p].n);r.length>0&&(l+=" ("+r.join(", ")+")")}e.leaflet.circleMarker(e.leaflet.latLng([e._here.place[s].circle[1],e._here.place[s].circle[0]]),{fill:!0,fillColor:e.placeColor,fillOpacity:e.placeOpacity,radius:Math.ceil(Math.sqrt(e._here.place[s].value*c)),stroke:!1}).bindTooltip(l).addTo(e._layer.place)}if("link"in e._here)for(c=Math.exp((e.s-5)/2)*e.linkScale*4,o=d(e,"link"),s=0;s<e._here.link.length;s+=1)if("polyline"in e._here.link[s]&&"value"in e._here.link[s]){for(t=[],p=0;p<e._here.link[s].polyline.length;p+=1)e._here.link[s].polyline[p].length>1&&t.push([e._here.link[s].polyline[p][1],e._here.link[s].polyline[p][0]]);e.leaflet.polyline(t,{color:b(e,e._here.link[s].link),weight:Math.ceil(Math.log(1+e._here.link[s].value*(1/c))*c+e.minWidth)}).on("click",function(t){var n=t.target.getPopup(),a=parseInt(n.getContent(),10);Number.isNaN(a)||(n.setContent(g(e,o,e._here.link[a].value,e._here.link[a].link)),n.update())}).bindPopup(s).addTo(e._layer.link)}if("node"in e._here)for(c=Math.exp((e.s-5)/2)*e.nodeScale*2,o=d(e,"link"),s=0;s<e._here.node.length;s+=1)"circle"in e._here.node[s]&&"value"in e._here.node[s]&&e._here.node[s].circle.length>1&&e.leaflet.circleMarker(e.leaflet.latLng([e._here.node[s].circle[1],e._here.node[s].circle[0]]),{color:e.nodeColor,fill:!1,radius:Math.ceil(Math.log(1+e._here.node[s].value*(1/(2*c)))*c+e.minWidth/2),weight:1}).on("click",function(t){var n=t.target.getPopup(),a=parseInt(n.getContent(),10);Number.isNaN(a)||(n.setContent(g(e,o,e._here.node[a].value,e._here.node[a].link,e._here.node[a].node)),n.update())}).bindPopup(s).addTo(e._layer.node);"here"in e._here&&e._here.here.length>0&&"circle"in e._here.here[0]&&"value"in e._here.here[0]&&e._here.here[0].circle.length>1&&e.leaflet.circle(e.leaflet.latLng([e._here.here[0].circle[1],e._here.here[0].circle[0]]),{color:e.hereColor,fill:!1,interactive:!1,radius:e._here.here[0].value,weight:2}).addTo(e._layer.here)}function v(e){if("object"==typeof L&&"version"in L==!1)return c(e,{message:"Leaflet failed to load"});e.leaflet=L,h(e=u(e=function(e){var t;if("setView"in e.map==0||"on"in e.map==0||"getCenter"in e.map==0||"getZoom"in e.map==0||"attributionControl"in e.map==0){for(;document.getElementById(e._id).firstChild;)document.getElementById(e._id).removeChild(document.getElementById(e._id).firstChild);e.map=e.leaflet.map(e._id,{minZoom:e.minZoom,preferCanvas:!0,attributionControl:!1}),e.leaflet.control.attribution({position:"bottomleft"}).addTo(e.map)}for(e.map.attributionControl.addAttribution('<a href="https://timhowgego.github.io/Aquius/">Aquius</a>'),e.map.setView([e.y,e.x],e.z),e.map.on("moveend",function(){var t,n=e.map.getCenter();e.z=e.map.getZoom(),t=Math.ceil(e.z/3),e.x=parseFloat(n.lng.toFixed(t)),e.y=parseFloat(n.lat.toFixed(t)),p(e,{x:e.x,y:e.y,z:e.z})}),e.map.on("click",function(t){var n=Math.ceil(e.z/3),a=t.latlng;e.c=parseFloat(a.lng.toFixed(n)),e.k=parseFloat(a.lat.toFixed(n)),e.m=e.z,p(e,{c:e.c,k:e.k,m:e.m}),h(e)}),t=0;t<e.base.length;t+=1)"url"in e.base[t]&&("options"in e.base[t]==0&&(e.base[t].options={}),"type"in e.base[t]&&"wms"===e.base[t].type?e.leaflet.tileLayer.wms(e.base[t].url,e.base[t].options).addTo(e.map):e.leaflet.tileLayer(e.base[t].url,e.base[t].options).addTo(e.map));return e}(e=function(e){var t,n,a,r,i,o,c,l,d,s,u,h,f={base:[{options:{attribution:"&copy; <a href='https://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors",maxZoom:18},type:"",url:"https://maps.wikimedia.org/osm-intl/{z}/{x}/{y}.png"}],c:-1.43,connectivity:1,dataObject:{},dataset:"",hereColor:"#080",k:54.54,leaflet:{},linkColor:"#f00",linkScale:1,locale:"en-US",m:9,map:{},minWidth:2,minZoom:0,n:0,network:[],networkAdd:!0,nodeColor:"#333",nodeScale:1,p:0,panelOpacity:.7,panelScale:1,placeColor:"#00f",placeOpacity:.5,placeScale:1,v:"hlnp",r:0,s:5,uiConnectivity:!0,uiHash:!1,uiLocale:!0,uiNetwork:!0,uiPanel:!0,uiScale:!0,uiService:!0,uiShare:!0,uiStore:!0,t:"en-US",translation:{},x:10.35,y:50.03,z:4},b=Object.keys(f),g=[];function m(e,t){var n,a,r,i={};for(a=0;a<e.dataObject[t].length;a+=1)if(e.dataObject[t][a].length>1&&"object"==typeof e.dataObject[t][a][1])for(n=Object.keys(e.dataObject[t][a][1]),r=0;r<n.length;r+=1)n[r]in i==0&&(i[n[r]]={}),i[n[r]]["_"+t+a]=e.dataObject[t][a][1][n[r]];return i}for("object"!=typeof e.dataObject&&(e.dataObject={}),c=0;c<b.length;c+=1)"en-US"===f[b[c]]&&g.push(b[c]),b[c]in e!=0&&typeof e[b[c]]==typeof f[b[c]]||("option"in e.dataObject&&b[c]in e.dataObject.option&&typeof e.dataObject.option[b[c]]==typeof f[b[c]]?e[b[c]]=e.dataObject.option[b[c]]:e[b[c]]=f[b[c]]);for(n=p(e),a=Object.keys(n),c=0;c<a.length;c+=1)-1!==b.indexOf(a[c])&&("number"==typeof e[a[c]]?!1===Number.isNaN(parseFloat(n[a[c]]))&&(e[a[c]]=parseFloat(n[a[c]])):"string"==typeof e[a[c]]&&(e[a[c]]=n[a[c]].toString()));e.network.length>0&&("network"in e.dataObject&&Array.isArray(e.dataObject.network)?"networkAdd"in e&&!1===e.networkAdd?e.dataObject.network=e.network:e.dataObject.network=e.dataObject.network.concat(e.network):e.dataObject.network=e.network),e.z<e.minZoom&&(e.z=e.minZoom),e.m<e.minZoom&&(e.m=e.minZoom),r=[],"translation"in e.dataObject&&r.push(e.dataObject.translation),t=[["network","n"],["service","r"]];for(c=0;c<t.length;c+=1)s=e,u=t[c][1],h=t[c][0],s[u]=parseInt(s[u],10),s[u]<0?s[u]=0:h in s.dataObject&&Array.isArray(s.dataObject[h])&&s[u]>=s.dataObject[h].length&&(s[u]=s.dataObject[h].length-1),e=s,t[c][0]in e.dataObject&&Array.isArray(e.dataObject[t[c][0]])&&r.push(m(e,t[c][0]));"meta"in e.dataObject&&("name"in e.dataObject.meta||"attribution"in e.dataObject.meta)&&r.push(function(e){var t,n,a={};if("meta"in e.dataObject&&"name"in e.dataObject.meta&&"object"==typeof e.dataObject.meta.name)for(t=Object.keys(e.dataObject.meta.name),n=0;n<t.length;n+=1)t[n]in a==0&&(a[t[n]]={}),a[t[n]]._datasetName=e.dataObject.meta.name[t[n]].toString();if("meta"in e.dataObject&&"attribution"in e.dataObject.meta&&"object"==typeof e.dataObject.meta.attribution)for(t=Object.keys(e.dataObject.meta.attribution),n=0;n<t.length;n+=1)t[n]in a==0&&(a[t[n]]={}),a[t[n]]._datasetAttribution=e.dataObject.meta.attribution[t[n]].toString();return a}(e)),r.push({"en-US":{lang:"English",connectivity:"Connectivity",connectivityRange:"Any - Frequent",embed:"Embed",export:"Export",here:"Here",language:"Language",link:"Services",network:"Network",node:"Stops",place:"People",scale:"Scale",service:"Period"},"es-ES":{lang:"Español",connectivity:"Conectividad",connectivityRange:"Cualquier - Frecuente",embed:"Insertar",export:"Exportar",here:"Aquí",language:"Idioma",link:"Servicios",network:"Red",node:"Paradas",place:"Personas",scale:"Escala",service:"Período"},"fr-FR":{lang:"Français",connectivity:"Connectivité",connectivityRange:"Tout - Fréquent",embed:"Insérer",export:"Exporter",here:"Ici",language:"Langue",link:"Services",network:"Réseau",node:"Arrêts",place:"Personnes",scale:"Échelle",service:"Période"}});for(c=0;c<r.length;c+=1)for(i=Object.keys(r[c]),l=0;l<i.length;l+=1){i[l]in e.translation==0&&(e.translation[i[l]]={}),o=Object.keys(r[c][i[l]]);for(d=0;d<o.length;d+=1)o[d]in e.translation[i[l]]==0&&(e.translation[i[l]][o[d]]=r[c][i[l]][o[d]])}for(c=0;c<g.length;c+=1)e[g[c]]in e.translation==0&&(e[g[c]]=f[g[c]]);return e}(e))))}if(!r)return!1;for(;r.firstChild;)r.removeChild(r.firstChild);return Object.keys&&[].indexOf&&"object"==typeof JSON?("object"!=typeof t&&(t={}),t._id=e,t._call=this.here,t._here=void 0,c(n=t),"dataObject"in n==0||"object"!=typeof n.dataObject?n.dataObject={}:"dataset"in n&&delete n.dataset,a="leaflet"in n&&"object"==typeof n.leaflet&&"version"in n.leaflet&&!1===Number.isNaN(parseInt(n.leaflet.version.split(".")[0],10))&&parseInt(n.leaflet.version.split(".")[0],10)>=1?[]:["https://unpkg.com/leaflet@1.4.0/dist/leaflet.css","https://unpkg.com/leaflet@1.4.0/dist/leaflet.js"],"undefined"!=typeof Promise?function(e,t){var n,a=[];function r(e){return new Promise(function(t,n){var a;"css"===e.split(".").pop()?((a=document.createElement("link")).rel="stylesheet",a.href=e):(a=document.createElement("script")).src=e,a.onload=t,a.onerror=n,document.head.appendChild(a)})}for(n=0;n<t.length;n+=1)a.push(r(t[n]));"dataset"in e&&"string"==typeof e.dataset&&a.push(fetch(e.dataset)),0===a.length?v(e):Promise.all(a).then(function(t){return"dataset"in e&&"string"==typeof e.dataset?t[a.length-1].json():e.dataObject}).then(function(t){e.dataObject=t,v(e)}).catch(function(t){return c(e,t)})}(n,a):l(n,a),!0):(r.appendChild(document.createTextNode("Browser not supported by Aquius: Try a modern browser")),r.style.height="auto",!1)},here:function(e,t){"use strict";var n,a,r,i={};function o(e){var t,n,a=Object.keys(e).sort();if(0===a.length)return[];if(1===a.length)return[e[a[0]]];for(t=[],n=0;n<a.length;n+=1)t.push(e[a[n]]);return t}function c(e,t,n){var a,r=["connect","serviceNode","serviceLink"];for(a=0;a<r.length;a+=1)r[a]in t&&delete t[r[a]];return void 0===e&&"error"in t&&(e=new Error(t.error)),"callback"in n?(n.callback(e,t,n),!0):t}if(!Object.keys||![].indexOf||"object"!=typeof JSON)return i.error="Unsupported browser",c(n,i,t);if("x"in t&&"number"!=typeof t.x||"y"in t&&"number"!=typeof t.y||"range"in t&&"number"!=typeof t.range)return i.error="Here parameters not numeric",c(n,i,t);"object"!=typeof t&&(t={}),i.dataObject=e,"x"in t&&"y"in t&&"range"in t&&(i.here=[{circle:[t.x,t.y],value:t.range}]),i.summary={link:0,node:0,place:0};try{return(i=function(e){var n,a,r,i,o,c={0:{link:[[0],[0],[0],{}],network:[[0],{"en-US":"Unknown"},{}],node:[0,0,{}],place:[0,0,{}],service:[[0],{"en-US":"Unknown"},{}]}};if("sanitize"in t&&!1===t.sanitize)return e;"object"!=typeof e.dataObject&&(e.dataObject={}),"meta"in e.dataObject==0&&(e.dataObject.meta={}),"schema"in e.dataObject.meta!=0&&e.dataObject.meta.schema in c!=0||(e.dataObject.meta.schema="0"),n=Object.keys(c[e.dataObject.meta.schema]);for(a=0;a<n.length;a+=1)n[a]in e.dataObject&&"object"!=typeof e.dataObject[n[a]]&&delete e.dataObject[n[a]];for(a=0;a<n.length;a+=1){n[a]in e.dataObject!=0&&0!=Array.isArray(e.dataObject[n[a]])&&0!==e.dataObject[n[a]].length||(e.dataObject[n[a]]=[c[e.dataObject.meta.schema][n[a]]]);for(r=0;r<e.dataObject[n[a]].length;r+=1){if(e.dataObject[n[a]][r].length<c[e.dataObject.meta.schema][n[a]].length)for(i=e.dataObject[n[a]][r].length-1;i<c[e.dataObject.meta.schema][n[a]].length;i+=1)e.dataObject[n[a]][r].push(c[e.dataObject.meta.schema][n[a]][i]);for(i=0;i<c[e.dataObject.meta.schema][n[a]].length;i+=1)if(typeof e.dataObject[n[a]][r][i]!=typeof c[e.dataObject.meta.schema][n[a]][i]&&("node"!==n[a]&&"place"!==n[a]||2!==i||"number"!=typeof e.dataObject[n[a]][r][i]?"link"!==n[a]||"number"!=typeof e.dataObject[n[a]][r][i]||0!==i&&1!==i?e.dataObject[n[a]][r][i]=c[e.dataObject.meta.schema][n[a]][i]:e.dataObject[n[a]][r][i]=[e.dataObject[n[a]][r][i]]:e.dataObject[n[a]][r][i]={p:e.dataObject[n[a]][r][i]}),Array.isArray(e.dataObject[n[a]][r][i]))for(o=0;o<e.dataObject[n[a]][r][i].length;o+=1)typeof e.dataObject[n[a]][r][i][o]!=typeof c[e.dataObject.meta.schema][n[a]][i][0]&&(e.dataObject[n[a]][r][i][o]=c[e.dataObject.meta.schema][n[a]][i][0])}}return e}(i)).dataObject.place.length>0&&(i.connect={}),i=function(e){function t(e,t){var n,a=t.length-1,r=[];for(n=0;n<e.length;n+=1)e[n]<=a&&e[n]>=0&&r.push([t[e[n]][0],t[e[n]][1]]);return r}return e=function(e,n){var a,r,i,c,l,d=Object.keys(n.od);for(e.link=[],c=0;c<d.length;c+=1){for(i=[n.od[d[c]].pop()];n.od[d[c]].length>0;)for(r=n.od[d[c]].pop(),l=0;l<i.length;l+=1){if(r[0]===i[l][0]){i[l].unshift(r[1]);break}if(r[1]===i[l][0]){i[l].unshift(r[0]);break}if(r[0]===i[l][i.length-1]){i[l].push(r[1]);break}if(r[1]===i[l][i.length-1]){i[l].push(r[0]);break}if(l===i.length-1){i.push(r);break}}for(l=0;l<i.length;l+=1)a={polyline:t(i[l],e.dataObject.node),value:n.data[d[c]].service},"reference"in n.data[d[c]]&&(a.link=o(n.data[d[c]].reference)),e.link.push(a)}return e}(e,function(e){var t,n,a,r,i,o,c=Object.keys(e),l={od:{},data:{}};for(i=0;i<c.length;i+=1)for(a=c[i]-0,t=Object.keys(e[a]),o=0;o<t.length;o+=1)n=t[o]-0,r=e[a][n].service.toString(),"reference"in e[a][n]&&(r+=":"+Object.keys(e[a][n].reference).join(":")),r in l.od==0&&(l.od[r]=[],l.data[r]=e[a][n]),l.od[r].push([a,n]);return l}(e.serviceLink))}(i=function(e,t){var n,a,r,i,o,c,l;function d(e,t){var n;if(!("product"in e))return!0;if(1===t.length){if(t[0]in e.product)return!0}else for(n=0;n<t.length;n+=1)if(t[n]in e.product)return!0;return!1}function s(e,t,n){var a;for(a=0;a<t.length;a+=1)if(t[a]in e.here){if("s"in n==0&&"setdown"in n==0)return!0;if("s"in n&&Array.isArray(n.s)&&-1===n.s.indexOf(t[a]))return!0;if("setdown"in n&&Array.isArray(n.setdown)&&-1===n.setdown.indexOf(t[a]))return!0}return!1}function p(e,t,n){var a;if(1===n.length&&("service"in t==0||0 in t.service))return e.level=n[0],e;for(e.level=0,a=0;a<n.length;a+=1)("service"in t==0||a in t.service)&&(e.level+=n[a]);return e}function u(e,t,n,a){var r;if("circular"in a&&(a.c=a.circular),n.length>1&&"c"in a&&(a.c||1===a.c)&&(e.circular=n.length-1),"direction"in a&&(a.d=a.direction),"d"in a&&(a.d||1===a.d)){for(e.direction=1,r=0;r<n.length;r+=1)if(n[r]in t.here){"circular"in e?(e.route=n.slice(0,-1),e.route=e.route.slice(r).concat(e.route.slice(0,r)),e.route.push(e.route[0])):e.route=n.slice(r);break}}else e.route=n;return"route"in e==0&&(e.route=[]),e}function h(e,t,n){var a;if("pickup"in n&&(n.u=n.pickup),"u"in n&&Array.isArray(n.u)&&n.u.length>0)for(e.pickupIndex={},a=0;a<n.u.length;a+=1)e.pickupIndex[n.u[a]]="";if("setdown"in n&&(n.s=n.setdown),"s"in n&&Array.isArray(n.s)&&n.s.length>0)for(e.setdownIndex={},a=0;a<n.s.length;a+=1)e.setdownIndex[n.s[a]]="";return e}function f(e,t,n,a){var r;if("split"in a&&(a.t=a.split),"t"in a&&Array.isArray(a.t)&&a.t.length>0){for(e.splitsIndex={},r=0;r<a.t.length;r+=1)e.splitsIndex[a.t[r]]="";for(e.splits=2,r=0;r<n.length;r+=1)if(n[r]in e.splitsIndex==0&&n[r]in t.here){e.splits=1;break}}return e}function b(e,t,n){var a;if("reference"in t&&(t.r=t.reference),"r"in t&&Array.isArray(t.r)&&t.r.length>0)for(e.reference=t.r,a=0;a<e.reference.length;a+=1)e.reference[a].p=n;return e}function g(e,t){var n;if(!Array.isArray(t)||0===t.length)return e;for(n=0;n<t.length;n+=1)"i"in t[n]?t[n].i in e==0&&(e[t[n].i]=t[n]):"n"in t[n]?t[n].n in e==0&&(e[t[n].n]=t[n]):"c"in t[n]&&t[n].c in e==0&&(e[t[n].c]=t[n]);return e}function m(e,t,n){var a,r,i,o,c,l,d,s,p=!1,u=!1,h=0,f=!0,b={},m=-1,v=0;function O(e,t,n,a){if("block"in t){if("block"in e==0&&(e.block={}),t.block in e.block==0&&(e.block[t.block]={}),n in e.block[t.block])return e;e.block[t.block][n]=""}return void 0===e.serviceNode[n]?e.serviceNode[n]={reference:{},service:a}:e.serviceNode[n].service+=a,"reference"in t&&(e.serviceNode[n].reference=g(e.serviceNode[n].reference,t.reference)),e}function y(e,t,n,a,r){var i,o,c;if(n<a?(o=a,i=n):(o=n,i=a),"block"in t){if("block"in e==0&&(e.block={}),t.block in e.block==0&&(e.block[t.block]={}),(c=o.toString()+":"+i.toString())in e.block[t.block])return e;e.block[t.block][c]=""}return void 0===e.serviceLink[o]&&(e.serviceLink[o]=[]),void 0===e.serviceLink[o][i]?e.serviceLink[o][i]={reference:{},service:r}:e.serviceLink[o][i].service+=r,"reference"in t&&(e.serviceLink[o][i].reference=g(e.serviceLink[o][i].reference,t.reference)),e}if("pickupIndex"in t&&t.route[t.route.length-1]in t.pickupIndex){for(s=t.route.length-1;s>=0;s--)if(t.route[s]in t.pickupIndex==0){i=s;break}}else i=t.route.length-1;"block"in t&&"block"in e&&t.block in e.block&&(f=!1);for(s=0;s<=i;s+=1)d=0,o=t.route[s],a="connect"in e&&("splits"in t==0||2===t.splits||o in t.splitsIndex),!1===p&&o in n.here&&(p=!0),o in n.here?(u&&("pickupIndex"in t==0||o in t.pickupIndex==0)||("setdownIndex"in t==0||o in t.setdownIndex==0)&&s!==i)&&(d="direction"in t==0&&(0===s&&t.route[s+1]in n.here==0||s===i&&t.route[s-1]in n.here==0)&&"circular"in t==0?t.level/2:t.level):"direction"in t!=0||(!p||"pickupIndex"in t!=0&&o in t.pickupIndex!=0)&&(!1!==p||"setdownIndex"in t!=0&&o in t.setdownIndex!=0)?!p||"pickupIndex"in t!=0&&o in t.pickupIndex!=0||(d=t.level):d=t.level/2,d>0&&("splits"in t==0||2===t.splits||o in t.splitsIndex)&&("circular"in t==0||s<i)&&(e=O(e,t,o,d)),f&&d>h&&(h=d),!1!==u||"setdownIndex"in t!=0&&o in t.setdownIndex!=0||!("direction"in t==0||o in n.here)||(u=!0),-1!==m&&v>0&&("splits"in t==0||2===t.splits||o in t.splitsIndex||t.route[m]in t.splitsIndex)&&(l="direction"in t==0&&t.route[m]in n.here?d:v,e=y(e,t,t.route[m],o,l)),d>0&&(v=d),m=s,a&&d>0&&(c=-1,"p"in e.dataObject.node[o][2]?c=e.dataObject.node[o][2].p:"place"in e.dataObject.node[o][2]&&(c=e.dataObject.node[o][2].place),c>=0&&(c in b==0||d>b[c])&&(b[c]=d));if("splits"in t!=0&&2!==t.splits||(e.summary.link+=h),a)for(r=Object.keys(b),s=0;s<r.length;s+=1)r[s]in e.connect?e.connect[r[s]]+=b[r[s]]:e.connect[r[s]]=b[r[s]];return e}for(e.serviceLink=[],e.serviceNode=[],n=function(e,t){var n,a,r,i,o,c,l,d,s,p={};if("network"in t&&"number"==typeof t.network&&t.network>=0&&t.network<e.dataObject.network.length)for(p.product={},n=0;n<e.dataObject.network[t.network][0].length;n+=1)p.product[e.dataObject.network[t.network][0][n]]=e.dataObject.network[t.network][0][n];for(p.here={},n=0;n<e.dataObject.node.length;n+=1)e.dataObject.node[n].length>1&&("range"in t==0||"x"in t==0||"y"in t==0||t.range>=(a=t.y,r=t.x,i=e.dataObject.node[n][1],o=e.dataObject.node[n][0],c=Math.PI/180,l=Math.sin((i-a)*c/2),d=Math.sin((o-r)*c/2),s=l*l+Math.cos(a*c)*Math.cos(i*c)*d*d,2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s))*6371e3))&&("place"in t==0||!Array.isArray(t.place)||"p"in e.dataObject.node[n][2]==0&&"place"in e.dataObject.node[n][2]==0||"p"in e.dataObject.node[n][2]&&-1!==t.place.indexOf(e.dataObject.node[n][2].p)||"place"in e.dataObject.node[n][2]&&-1!==t.place.indexOf(e.dataObject.node[n][2].place))&&(p.here[n]=n);if("service"in t&&"number"==typeof t.service&&t.service>=0&&t.service<e.dataObject.service.length)for(p.service={},n=0;n<e.dataObject.service[t.service][0].length;n+=1)p.service[e.dataObject.service[t.service][0][n]]=e.dataObject.service[t.service][0][n];return p}(e,t),r=0;r<e.dataObject.link.length;r+=1)!d(n,e.dataObject.link[r][0])||(c=n,"h"in(l=e.dataObject.link[r][3])&&"product"in c&&l.h in c.product||"shared"in l&&"product"in c&&l.shared in c.product)||!s(n,e.dataObject.link[r][2],e.dataObject.link[r][3])||(a=p(a={},n,e.dataObject.link[r][1])).level>0&&(a=b(a=f(a=h(a=u(a,n,e.dataObject.link[r][2],e.dataObject.link[r][3]),0,e.dataObject.link[r][3]),n,e.dataObject.link[r][2],e.dataObject.link[r][3]),e.dataObject.link[r][3],e.dataObject.link[r][0]),i=a,"block"in(o=e.dataObject.link[r][3])&&(o.b=o.block),"b"in o&&(i.block=o.b),e=m(e,a=i,n));return"block"in e&&delete e.block,e}(i,t)),r=t,a=function(e,t){var n,a,r,i;if(e.place=[],"connect"in e)for(a=Object.keys(e.connect),i=0;i<a.length;i+=1)a[i]<e.dataObject.place.length&&(r=0,"p"in e.dataObject.place[a[i]][2]?r=e.dataObject.place[a[i]][2].p:"population"in e.dataObject.place[a[i]][2]&&(r=e.dataObject.place[a[i]][2].population),Number.isNaN(r)||("connectivity"in t&&t.connectivity>0&&(r*=1-1/(e.connect[a[i]]*t.connectivity)),(r=Math.round(r))>0&&(e.summary.place+=r,n={circle:[e.dataObject.place[a[i]][0],e.dataObject.place[a[i]][1]],value:r},"r"in e.dataObject.place[a[i]][2]?n.place=e.dataObject.place[a[i]][2].r:"reference"in e.dataObject.place[a[i]][2]&&(n.place=e.dataObject.place[a[i]][2].reference),e.place.push(n))));return e}(a=function(e){var t,n,a,r=e.dataObject.node.length-1;for(e.node=[],a=0;a<e.serviceNode.length;a+=1)void 0!==e.serviceNode[a]&&a<=r&&(e.summary.node+=1,n={circle:[(t=e.dataObject.node[a])[0],t[1]],value:e.serviceNode[a].service},"reference"in e.serviceNode[a]&&(n.link=o(e.serviceNode[a].reference)),"reference"in t[2]&&(t[2].r=t[2].reference),"r"in t[2]&&t[2].r.length>0&&(n.node=t[2].r),e.node.push(n));return e}(a=i),r),i="geoJSON"in r!=0&&Array.isArray(r.geoJSON)?function(e,t){var n,a,r,i,o,c={type:"FeatureCollection",features:[]};for(r=0;r<t.length;r+=1)if(t[r]in e)for(i=0;i<e[t[r]].length;i+=1)if("value"in e[t[r]][i]&&("circle"in e[t[r]][i]||"polyline"in e[t[r]][i])){if("circle"in e[t[r]][i])n={type:"Point",coordinates:e[t[r]][i].circle};else for(n={type:"LineString",coordinates:[]},o=0;o<e[t[r]][i].polyline.length;o+=1)n.coordinates.push(e[t[r]][i].polyline[o]);a={type:t[r],value:e[t[r]][i].value},"link"in e[t[r]][i]&&(a.link=e[t[r]][i].link),"node"in e[t[r]][i]&&(a.node=e[t[r]][i].node),"place"in e[t[r]][i]&&(a.place=e[t[r]][i].place),c.features.push({type:"Feature",geometry:n,properties:a})}return c}(a,r.geoJSON):a,c(n,i,t)}catch(e){return c(n=e,i,t)}}};