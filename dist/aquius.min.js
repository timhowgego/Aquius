var aquius=aquius||{init:function(e,t){"use strict";var n=this.here,r="en-US",a={"en-US":{lang:"English",embed:"Embed",export:"Export",here:"Here",language:"Language",link:"Services",network:"Network",node:"Stops",place:"People",scale:"Scale",service:"Period"},"es-ES":{lang:"Espa√±ol",embed:"Insertar",export:"Exportar",here:"Aqu√≠",language:"Idioma",link:"Servicios",network:"Red",node:"Paradas",place:"Personas",scale:"Escala",service:"Per√≠odo"}},i={base:[{options:{attribution:"&copy; <a href='https://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors",maxZoom:18},type:"",url:"http://{s}.tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png"}],c:-1.43,dataObject:{},dataset:"",hereColor:"#080",k:54.54,leaflet:{},linkColor:"#f00",linkScale:1,locale:r,m:9,map:{},n:0,network:[],networkAdd:!0,nodeColor:"#000",nodeScale:1,panelOpacity:.7,panelScale:1,placeColor:"#00f",placeOpacity:.5,placeScale:1,v:"hlnp",r:0,s:5,uiHash:!1,uiLocale:!0,uiNetwork:!0,uiPanel:!0,uiScale:!0,uiService:!0,uiShare:!0,uiStore:!0,t:r,translation:{},x:10.35,y:50.03,z:4},o=["https://unpkg.com/leaflet@1.3.4/dist/leaflet.css","https://unpkg.com/leaflet@1.3.4/dist/leaflet.js"],l=["place","link","node","here"],c=["link","place","node"];function d(e,t,n){var r=document.getElementById(e);function a(e,t,n){var r=document.createElement("div");r.textContent=t,r.style["text-align"]="center",void 0!==n&&n>0&&(r.style["font-size"]=parseInt(100*n,10)+"%"),e.appendChild(r)}for(;r.firstChild;)r.removeChild(r.firstChild);return void 0===n?(a(r,"üåç",10),!0):(a(r,"üö´",10),"message"in n&&a(r,"( "+n.message+" )"),!1)}function s(e,t,n){var r={};function a(){var e,t={},n=decodeURIComponent(document.location.hash.trim()).slice(1).split("/");for(e=0;e<n.length;e+=1)n[e].length>=2&&/^[a-z\-()]$/.test(n[e][0])&&(t[n[e][0]]=n[e].slice(1));return t}function i(e){try{return null!==sessionStorage.getItem(e)?JSON.parse(sessionStorage.getItem(e)):{}}catch(e){return{}}}return!sessionStorage||"uiStore"in t!=!1&&!0!==t.uiStore||(r="object"==typeof n?function(e,t,n){var r,a=i(e),o=Object.keys(n);for(r=0;r<o.length;r+=1)a[o[r]]=n[o[r]];try{sessionStorage.setItem(e,JSON.stringify(a))}catch(e){}return a}(e,0,n):i(e)),"uiHash"in t==!0&&!0===t.uiHash&&(r="object"==typeof n?function(e,t){var n,r,i,o=a(),l=Object.keys(t);for(i=0;i<l.length;i+=1)1===l[i].length&&/^[a-z\-()]$/.test(l[i])&&(o[l[i]]=t[l[i]]);for(n=Object.keys(o),r=[],i=0;i<n.length;i+=1)r.push(n[i]+encodeURIComponent(o[n[i]]));return location.hash="#"+r.join("/"),o}(0,n):a()),r}function p(e,t){return e.t in e.translation&&t in e.translation[e.t]?e.translation[e.t][t]:e.locale in e.translation&&t in e.translation[e.locale]?e.translation[e.locale][t]:""}function h(e,t,n){var r,a,i=document.createElement(e);if(void 0!==t)for(r=Object.keys(t),a=0;a<r.length;a+=1)i[r[a]]=t[r[a]];if(void 0!==n)for(r=Object.keys(n),a=0;a<r.length;a+=1)i.style[r[a]]=n[r[a]];return i}function u(e,t){var r,a,o,d,u,f,m,k,b,v,y,O,j=!1,x={};function C(t,n,r){var a,i,o=Object.keys(n);for(i=0;i<o.length;i+=1)document.getElementById(o[i])&&""!==(a=p(t,n[o[i]]))&&(document.getElementById(o[i]).textContent=a);void 0!==r&&!0===r&&(t=g(e,t,!0))}function N(t,n){return t._layer[n].on("add",function(){-1===t.v.indexOf(n.charAt(0))&&(t.v+=n.charAt(0),s(e,t,{v:t.v}))}),t._layer[n].on("remove",function(){t.v=t.v.replace(n.charAt(0),""),s(e,t,{v:t.v})}),t}function S(t,n,r,a,i){var o,l,c;if(r in n.dataObject&&Array.isArray(n.dataObject[r])&&n.dataObject[r].length>1&&!0===n[i]){for(l=[],c=0;c<n.dataObject[r].length;c+=1)l.push({value:c,id:e+r+c}),x[e+r+c]="_"+r+c;(o=function(e,t,n){var r,a,i,o=h("div",{id:t});for(i=0;i<e.length;i+=1)r=h("label"),a=h("input",{type:"radio",name:t}),"value"in e[i]&&(a.value=e[i].value,e[i].value===n&&(a.checked="checked")),r.appendChild(a),a=h("span"),"id"in e[i]&&(a.id=e[i].id),"label"in e[i]&&(a.textContent=e[i].label),r.appendChild(a),o.appendChild(r);return o}(l,e+r,n[a])).addEventListener("change",function(){n[a]=parseInt(document.querySelector("input[name='"+e+r+"']:checked").value,10);var t={};t[a]=n[a],s(e,n,t),n=g(e,n)},!!j&&{passive:!0}),t.appendChild(o)}}try{y=Object.defineProperty({},"passive",{get:function(){return j=!0,!0}}),window.addEventListener("test",null,y),window.removeEventListener("test",null,y)}catch(e){}for(r=["_datasetName","_datasetAttribution"],O=0;O<r.length;O+=1)x[e+r[O]]=r[O],r[O]=e+r[O];o=h("span"),"meta"in t.dataObject&&"url"in t.dataObject.meta&&"string"==typeof t.dataObject.meta.url?o.appendChild(h("a",{href:t.dataObject.meta.url,id:r[0]})):o.appendChild(h("span",{id:r[0]})),o.appendChild(document.createTextNode(" ")),o.appendChild(h("span",{id:r[1]})),t.map.attributionControl.addAttribution(o.outerHTML),!0===t.uiLocale&&(r=Object.keys(t.translation)).length>1&&((f=t.leaflet.control({position:"topright"})).onAdd=function(){for(d=h("div",{className:"aquius-locale",id:e+"locale"},{"background-color":"#fff","border-bottom":"2px solid rgba(0,0,0,0.3)","border-left":"2px solid rgba(0,0,0,0.3)","border-radius":"0 0 0 5px",margin:0,padding:"0 0 1px 1px"}),t.leaflet.DomEvent.disableClickPropagation(d),o=h("label",{id:e+"langname",for:e+"lang"},{display:"none"}),x[e+"langname"]="language",d.appendChild(o),a=[],O=0;O<r.length;O+=1)a.push({value:r[O],label:"lang"in t.translation[r[O]]?t.translation[r[O]].lang:r[O]});return(o=function(e,t,n){var r,a,i=h("select",{id:t},{"background-color":"#fff",color:"#000",font:'12px/1.5 "Helvetica Neue", Arial, Helvetica, sans-serif'});for(a=0;a<e.length;a+=1)r=h("option"),"value"in e[a]&&(r.value=e[a].value,e[a].value===n&&(r.selected="selected")),"label"in e[a]&&(r.textContent=e[a].label),"id"in e[a]&&(r.id=e[a].id),i.appendChild(r);return i}(a,e+"lang",t.t)).style.border="none",o.addEventListener("change",function(){t.t=document.getElementById(e+"lang").value,s(e,t,{t:t.t}),C(t,x,!0)},!!j&&{passive:!0}),d.appendChild(o),d},f.addTo(t.map)),!0===t.uiPanel&&((f=t.leaflet.control({position:"bottomleft"})).onAdd=function(){for(d=h("div",{className:"aquius-panel",id:e+"panel"},{"background-color":"rgba(255,255,255,"+t.panelOpacity+")","font-weight":"bold",padding:"0 3px","border-radius":"5px"}),t.leaflet.DomEvent.disableClickPropagation(d),O=0;O<c.length;O+=1)u=h("span",{},{color:t[c[O]+"Color"],margin:"0 0.1em"}),o=h("span",{id:e+c[O]+"value",textContent:"0"},{"font-size":Math.round(200*t.panelScale).toString()+"%",margin:"0 0.1em"}),u.appendChild(o),o=h("span",{id:e+c[O]+"label"},{"font-size":Math.round(100*t.panelScale).toString()+"%",margin:"0 0.1em","vertical-align":"20%"}),x[o.id]=c[O],u.appendChild(o),d.appendChild(u),d.appendChild(document.createTextNode(" "));return d},f.addTo(t.map)),t._layer={},a=l.reverse(),f=t.leaflet.control.layers();for(O=0;O<a.length;O+=1)t._layer[a[O]]=t.leaflet.layerGroup(),-1!==(t=N(t,a[O])).v.indexOf(a[O].charAt(0))&&t._layer[a[O]].addTo(t.map),o=h("span",{id:e+a[O]+"name"},{color:t[a[O]+"Color"]}),x[o.id]=a[O],f.addOverlay(t._layer[a[O]],o.outerHTML);return f.addTo(t.map),(m=function(e){var t,n=!1,r=e.getContainer().childNodes;for(t=0;t<r.length;t+=1)if("FORM"===r[t].tagName){n=r[t];break}return n}(f))?(S(m,t,"network","n","uiNetwork"),S(m,t,"service","r","uiService"),!0===t.uiScale&&(d=h("label"),u=h("div",{id:e+"scalename"},{"text-align":"center"}),x[u.id]="scale",d.appendChild(u),u=h("div",{},{"text-align":"center"}),(o=h("input",{id:e+"scale",type:"range",min:0,max:10,value:t.s})).addEventListener("change",function(){t.s=parseInt(document.getElementById(e+"scale").value,10),s(e,t,{s:t.s}),t=g(e,t,!0)},!!j&&{passive:!0}),u.appendChild(o),d.appendChild(u),m.appendChild(d)),!0===t.uiShare&&Blob&&(d=h("div",{},{"text-align":"center"}),""!==t.dataset&&((k=h("a",{id:e+"embed",download:e+".txt",role:"button"},{cursor:"pointer"})).addEventListener("click",function(){k.href=window.URL.createObjectURL(function(e,t){var n,r=[],a="\x3c!--Script URL--\x3e",o=document.getElementsByTagName("script"),l={},c=Object.keys(t),d=["dataObject","leaflet","map","translation","uiHash"];for(n=0;n<o.length;n+=1)if(-1!==o[n].src.indexOf("aquius")){a=o[n].src;break}for(n=0;n<c.length;n+=1)"_"!==c[n].charAt(0)&&-1===d.indexOf(c[n])&&t[c[n]]!==i[c[n]]&&(l[c[n]]=t[c[n]]);return r.push(h("div",{id:e},{height:"100%"}).outerHTML),r.push(h("script",{src:a}).outerHTML),r.push(h("script",{textContent:'window.addEventListener("load",function(){aquius.init("'+e+'",'+JSON.stringify(l)+")});"}).outerHTML),new Blob([r.join("\n")],{type:"text/plain;charset=utf-8"})}(e,t))},!!j&&{passive:!0}),x[k.id]="embed",d.appendChild(k),d.appendChild(document.createTextNode(" | "))),(b=h("a",{id:e+"export",download:e+".json",role:"button"},{cursor:"pointer"})).addEventListener("click",function(){for(v=[],O=0;O<l.length;O+=1)-1!==t.v.indexOf(l[O].charAt(0))&&v.push(l[O]);b.href=window.URL.createObjectURL(new Blob([JSON.stringify(n(t.dataObject,t.c,t.k,5e6/Math.pow(2,t.m),{filter:t.n,geoJSON:v,sanitize:!1,service:t.r}))],{type:"application/json;charset=utf-8"}))},!!j&&{passive:!0}),x[b.id]="export",d.appendChild(b),m.appendChild(d)),C(t,x),t):(C(t,x),t)}function f(e,t){if("object"!=typeof L||"version"in L==!1)return d(e,0,{message:"Leaflet failed to load"});t.leaflet=L,t=g(e,t=u(e,t=function(e,t){var n;if("setView"in t.map==0||"on"in t.map==0||"getCenter"in t.map==0||"getZoom"in t.map==0||"attributionControl"in t.map==0){for(;document.getElementById(e).firstChild;)document.getElementById(e).removeChild(document.getElementById(e).firstChild);t.map=t.leaflet.map(e,{preferCanvas:!0})}for(t.map.attributionControl.addAttribution('<a href="https://timhowgego.github.io/Aquius/">Aquius</a>'),t.map.setView([t.y,t.x],t.z),t.map.on("moveend",function(){var n,r=t.map.getCenter();t.z=t.map.getZoom(),n=Math.ceil(t.z/3),t.x=parseFloat(r.lng.toFixed(n)),t.y=parseFloat(r.lat.toFixed(n)),s(e,t,{x:t.x,y:t.y,z:t.z})}),t.map.on("click",function(n){var r=Math.ceil(t.z/3),a=n.latlng;t.c=parseFloat(a.lng.toFixed(r)),t.k=parseFloat(a.lat.toFixed(r)),t.m=t.z,s(e,t,{c:t.c,k:t.k,m:t.m}),t=g(e,t)}),n=0;n<t.base.length;n+=1)"url"in t.base[n]&&("options"in t.base[n]==0&&(t.base[n].options={}),"type"in t.base[n]&&"wms"===t.base[n].type?t.leaflet.tileLayer.wms(t.base[n].url,t.base[n].options).addTo(t.map):t.leaflet.tileLayer(t.base[n].url,t.base[n].options).addTo(t.map));return t}(e,t=function(e,t){function n(e,t,n){return e[t]=parseInt(e[t],10),e[t]<0?e[t]=0:n in e.dataObject&&Array.isArray(e.dataObject[n])&&e[t]>=e.dataObject[n].length&&(e[t]=e.dataObject[n].length-1),e}var o,d,p,h,u,f,g,m,k=Object.keys(i),b=[];for("object"!=typeof t.dataObject&&(t.dataObject={}),f=0;f<k.length;f+=1)i[k[f]]===r&&b.push(k[f]),k[f]in t!=0&&typeof t[k[f]]==typeof i[k[f]]||("option"in t.dataObject&&k[f]in t.dataObject.option&&typeof t.dataObject.option[k[f]]==typeof i[k[f]]?t[k[f]]=t.dataObject.option[k[f]]:t[k[f]]=i[k[f]]);for(o=s(e,t),d=Object.keys(o),f=0;f<d.length;f+=1)-1!==k.indexOf(d[f])&&("number"==typeof t[d[f]]?!1===Number.isNaN(parseFloat(o[d[f]]))&&(t[d[f]]=parseFloat(o[d[f]])):"string"==typeof t[d[f]]&&(t[d[f]]=o[d[f]].toString()));t.network.length>0&&("network"in t.dataObject&&Array.isArray(t.dataObject.network)?"networkAdd"in t&&!1===t.networkAdd?t.dataObject.network=t.network:t.dataObject.network=t.dataObject.network.concat(t.network):t.dataObject.network=t.network),p=[],"translation"in(t=n(t=n(t,"n","network"),"r","service")).dataObject&&p.push(t.dataObject.translation),"network"in t.dataObject&&Array.isArray(t.dataObject.network)&&p.push(function(e){var t,n,r,a={};for(n=0;n<e.dataObject.network.length;n+=1)if(e.dataObject.network[n].length>1&&"object"==typeof e.dataObject.network[n][1])for(t=Object.keys(e.dataObject.network[n][1]),r=0;r<t.length;r+=1)t[r]in a==0&&(a[t[r]]={}),a[t[r]]["_network"+n]=e.dataObject.network[n][1][t[r]];return a}(t)),"meta"in t.dataObject&&("name"in t.dataObject.meta||"attribution"in t.dataObject.meta)&&p.push(function(e){var t,n,r={};if("meta"in e.dataObject&&"name"in e.dataObject.meta&&"object"==typeof e.dataObject.meta.name)for(t=Object.keys(e.dataObject.meta.name),n=0;n<t.length;n+=1)t[n]in r==0&&(r[t[n]]={}),r[t[n]]._datasetName=e.dataObject.meta.name[t[n]].toString();if("meta"in e.dataObject&&"attribution"in e.dataObject.meta&&"object"==typeof e.dataObject.meta.attribution)for(t=Object.keys(e.dataObject.meta.attribution),n=0;n<t.length;n+=1)t[n]in r==0&&(r[t[n]]={}),r[t[n]]._datasetAttribution=e.dataObject.meta.attribution[t[n]].toString();return r}(t)),p.push(a);for(f=0;f<p.length;f+=1)for(h=Object.keys(p[f]),g=0;g<h.length;g+=1){h[g]in t.translation==0&&(t.translation[h[g]]={}),u=Object.keys(p[f][h[g]]);for(m=0;m<u.length;m+=1)u[m]in t.translation[h[g]]==0&&(t.translation[h[g]][u[m]]=p[f][h[g]][u[m]])}for(f=0;f<b.length;f+=1)t[b[f]]in t.translation==0&&(t[b[f]]=i[b[f]]);return"place"in t.dataObject!=0&&0!==t.dataObject.place.length||(l.splice(l.indexOf("place"),1),c.splice(c.indexOf("place"),1)),t}(e,t))),!1,!0)}function g(e,t,r,a){var i,o,c,d,s,u,f,g;function m(e,t,n,r){var a=h("div",{},{color:"#000"});function i(e,t,n){var r,a,i;if("undefined"!==e&&Array.isArray(e)){for(r=h("div",{},{margin:"0.3em 0"}),n?r.style["font-weight"]="bold":r.style["line-height"]="2.3em",i=0;i<e.length;i+=1)"n"in e[i]&&((a="u"in e[i]?n?h("a",{href:e[i].u}):h("a",{href:e[i].u},{color:"#000","text-decoration":"none"}):h("span")).textContent=e[i].n,!1===n&&(a.style.border="1px solid #000",a.style.padding="0.3em 0.5em","c"in e[i]&&(a.style["background-color"]="#"+e[i].c),"t"in e[i]&&(a.style.color="#"+e[i].t,a.style["border-color"]="#"+e[i].t)),r.appendChild(a),i<e.length-1&&(n?r.appendChild(document.createTextNode("|")):r.appendChild(document.createTextNode(" "))));t.appendChild(r)}return t}return(a=i(r,a,!0)).appendChild(h("div",{textContent:e+": "+Math.round(t).toString()},{margin:"0.3em 0"})),a=i(n,a,!1)}function k(e,t){var n,r=[];if("undefined"===t||!Array.isArray(t))return e.linkColor;for(n=0;n<t.length;n+=1)"c"in t[n]&&-1===r.indexOf(t[n].c)&&r.push(t[n].c);return 0===r.length?e.linkColor:1===r.length?"#"+r[0]:function(e,t){var n,r,a="#",i=[[],[],[]];for(r=0;r<e.length;r+=1)6===e[r].length&&(i[0].push(parseInt(e[r].slice(0,2),16)),i[1].push(parseInt(e[r].slice(2,4),16)),i[2].push(parseInt(e[r].slice(4,6),16)));for(r=0;r<i.length;r+=1){if(0===i[r].length)return t;(n=Math.round(i[r].reduce(function(e,t){return e+t},0)/i[r].length))<=16&&(a+="0"),a+=n.toString(16)}return a}(r,"#"+r[0])}for(f=0;f<l.length;f+=1)l[f]in t._layer&&t._layer[l[f]].clearLayers();if(void 0!==r&&!0===r&&"_here"in t!=!1||((s={filter:t.n,service:t.r}).sanitize=void 0!==a&&!0===a,t._here=n(t.dataObject,t.c,t.k,5e6/Math.pow(2,t.m),s)),"dataObject"in t._here&&(t.dataObject=t._here.dataObject),!0===t.uiPanel&&"summary"in t._here)for(c=Object.keys(t._here.summary),f=0;f<c.length;f+=1)if(i=e+c[f]+"value",document.getElementById(i))try{document.getElementById(i).textContent=new Intl.NumberFormat(t.t).format(Math.round(t._here.summary[c[f]]))}catch(e){document.getElementById(i).textContent=Math.round(t._here.summary[c[f]]).toString()}if("place"in t._here&&"place"in t.dataObject&&t.dataObject.place.length>0)for(u=Math.exp((t.s-5)/2)*t.placeScale/666,d=p(t,"place"),f=0;f<t._here.place.length;f+=1)"circle"in t._here.place[f]&&"value"in t._here.place[f]&&t._here.place[f].circle.length>1&&t.leaflet.circleMarker(t.leaflet.latLng([t._here.place[f].circle[1],t._here.place[f].circle[0]]),{fill:!0,fillColor:t.placeColor,fillOpacity:t.placeOpacity,radius:Math.ceil(Math.sqrt(t._here.place[f].value*u)),stroke:!1}).bindTooltip(Math.round(t._here.place[f].value).toString()+" "+d).addTo(t._layer.place);if("link"in t._here)for(u=Math.exp((t.s-5)/2)*t.linkScale*4,d=p(t,"link"),f=0;f<t._here.link.length;f+=1)if("polyline"in t._here.link[f]&&"value"in t._here.link[f]){for(o=[],g=0;g<t._here.link[f].polyline.length;g+=1)t._here.link[f].polyline[g].length>1&&o.push([t._here.link[f].polyline[g][1],t._here.link[f].polyline[g][0]]);t.leaflet.polyline(o,{color:k(t,t._here.link[f].link),weight:Math.ceil(Math.log(1+t._here.link[f].value*(1/u))*u)}).on("click",function(e){var n=e.target.getPopup(),r=parseInt(n.getContent(),10);Number.isNaN(r)||(n.setContent(m(d,t._here.link[r].value,t._here.link[r].link)),n.update())}).bindPopup(f).addTo(t._layer.link)}if("node"in t._here)for(u=Math.exp((t.s-5)/2)*t.nodeScale*2,d=p(t,"link"),f=0;f<t._here.node.length;f+=1)"circle"in t._here.node[f]&&"value"in t._here.node[f]&&t._here.node[f].circle.length>1&&t.leaflet.circleMarker(t.leaflet.latLng([t._here.node[f].circle[1],t._here.node[f].circle[0]]),{color:t.nodeColor,fill:!1,radius:Math.ceil(Math.log(1+t._here.node[f].value*(1/(2*u)))*u),weight:1}).on("click",function(e){var n=e.target.getPopup(),r=parseInt(n.getContent(),10);Number.isNaN(r)||(n.setContent(m(d,t._here.node[r].value,t._here.node[r].link,t._here.node[r].node)),n.update())}).bindPopup(f).addTo(t._layer.node);return"here"in t._here&&t._here.here.length>0&&"circle"in t._here.here[0]&&"value"in t._here.here[0]&&t._here.here[0].circle.length>1&&t.leaflet.circle(t.leaflet.latLng([t._here.here[0].circle[1],t._here.here[0].circle[0]]),{color:t.hereColor,fill:!1,interactive:!1,radius:t._here.here[0].value,weight:2}).addTo(t._layer.here),t}return!!document.getElementById(e)&&(Object.keys&&[].indexOf&&"object"==typeof JSON?(d(e),"object"!=typeof t&&(t={}),"dataObject"in t==!1||"object"!=typeof t.dataObject?t.dataObject={meta:{schema:"0",name:{"en-US":"Empty Dataset"}}}:"dataset"in t&&delete t.dataset,"leaflet"in t&&"object"==typeof t.leaflet&&"version"in t.leaflet&&!1===Number.isNaN(parseInt(t.leaflet.version.split(".")[0],10))&&parseInt(t.leaflet.version.split(".")[0],10)>=1&&(o=[]),void("undefined"!=typeof Promise?function(e,t,n){var r,a=[];function i(e){return new Promise(function(t,n){var r;"css"===e.split(".").pop()?((r=document.createElement("link")).rel="stylesheet",r.href=e):(r=document.createElement("script")).src=e,r.onload=t,r.onerror=n,document.head.appendChild(r)})}for(r=0;r<n.length;r+=1)a.push(i(n[r]));"dataset"in t&&"string"==typeof t.dataset&&a.push(fetch(t.dataset)),0===a.length?f(e,t):Promise.all(a).then(function(e){return"dataset"in t&&"string"==typeof t.dataset?e[a.length-1].json():t.dataObject}).then(function(n){t.dataObject=n,f(e,t)}).catch(function(t){return d(e,0,t)})}(e,t,o):function(e,t,n){var r,a,i,o,l;function c(t,n){var r;"css"===t.split(".").pop()?((r=document.createElement("link")).rel="stylesheet",r.href=t):((r=document.createElement("script")).type="text/javascript",r.src=t),r.onreadystatechange=n,r.onload=n,r.onerror=function(){return d(e,0,{message:"Could not load "+t})},document.head.appendChild(r)}if(a=function(){var n,r,a;"dataset"in t&&"string"==typeof t.dataset?(n=t.dataset,r=function(n){return t.dataObject=n,f(e,t)},(a=new XMLHttpRequest).onreadystatechange=function(){if(4===a.readyState){if(200!==a.status)return d(e,0,{message:a.status+": Could not load "+n});var t=JSON.parse(a.responseText);r&&r(t)}},a.open("GET",n),a.send()):f(e,t)},0===n.length)a();else for(i=0,o=function(){r=arguments,(i+=1)>=n.length&&a.call(this,r)},l=0;l<n.length&&!(l>=n.length);l+=1)c(n[l],o)}(e,t,o))):(document.getElementById(e).appendChild(document.createTextNode("Browser not supported: Try a modern browser")),document.getElementById(e).style.height="auto",!1))},here:function(e,t,n,r,a){"use strict";var i;if(!Object.keys||![].indexOf||"object"!=typeof JSON)return{error:"Unsupported browser"};if("number"!=typeof t||"number"!=typeof n||"number"!=typeof r)return{error:"Here parameters not numeric"};"object"!=typeof a&&(a={}),i={hereNodes:[],here:[{circle:[t,n],value:r}],summary:{link:0,node:0,place:0}},"sanitize"in a!=!1&&!1===a.sanitize||(e=function(e){var t,n,r,a,i,o={0:{link:[[0],[0],[0],{}],network:[[0],{"en-US":"Unknown"}],node:[0,0,{}],place:[0,0,{}],service:[[0],{"en-US":"Unknown"}]}};"object"!=typeof e&&(e={}),"meta"in e==0&&(e.meta={}),"schema"in e.meta!=0&&e.meta.schema in o!=0||(e.meta.schema="0"),t=Object.keys(o[e.meta.schema]);for(n=0;n<t.length;n+=1)t[n]in e&&"object"!=typeof e[t[n]]&&delete e[t[n]];for(n=0;n<t.length;n+=1){t[n]in e!=0&&0!=Array.isArray(e[t[n]])&&0!==e[t[n]].length||(e[t[n]]=[o[e.meta.schema][t[n]]]);for(r=0;r<e[t[n]].length;r+=1){if(e[t[n]][r].length<o[e.meta.schema][t[n]].length)for(a=e[t[n]][r].length-1;a<o[e.meta.schema][t[n]].length;a+=1)e[t[n]][r].push(o[e.meta.schema][t[n]][a]);for(a=0;a<o[e.meta.schema][t[n]].length;a+=1)if(typeof e[t[n]][r][a]!=typeof o[e.meta.schema][t[n]][a]&&("node"!==t[n]&&"place"!==t[n]||2!==a||"number"!=typeof e[t[n]][r][a]?"link"!==t[n]||"number"!=typeof e[t[n]][r][a]||0!==a&&1!==a?e[t[n]][r][a]=o[e.meta.schema][t[n]][a]:e[t[n]][r][a]=[e[t[n]][r][a]]:e[t[n]][r][a]={p:e[t[n]][r][a]}),Array.isArray(e[t[n]][r][a]))for(i=0;i<e[t[n]][r][a].length;i+=1)typeof e[t[n]][r][a][i]!=typeof o[e.meta.schema][t[n]][a][0]&&(e[t[n]][r][a][i]=o[e.meta.schema][t[n]][a][0])}}return e}(e),i.dataObject=e);try{return function(e,t,n){var r,a,i,o,l,c,d,s,p,h={};function u(e,t){var n,r=t.length-1,a=[];for(n=0;n<e.length;n+=1)e[n]<=r&&e[n]>=0&&a.push([t[e[n]][0],t[e[n]][1]]);return a}function f(e){var t,n,r={},a=[];for(n=0;n<e.length;n+=1)"n"in e[n]?r[e[n].n.toString()]=e[n]:"c"in e[n]&&(r[e[n].c.toString()]=e[n]);for(t=Object.keys(r).sort(),n=0;n<t.length;n+=1)a.push(r[t[n]]);return a}for(h.summary=e.summary,h.here=e.here,h.link=[],d=0;d<e.path.length;d+=1)a={polyline:u(e.path[d][1],t.node),value:e.path[d][0].service},"reference"in e.path[d][0]&&e.path[d][0].reference.length>0&&(a.link=f(e.path[d][0].reference)),h.link.push(a);for(h.node=[],i=t.node.length-1,o=[],d=0;d<e.serviceNode.length;d+=1)void 0!==e.serviceNode[d]&&d<=i&&(h.summary.node+=1,a={circle:[t.node[d][0],t.node[d][1]],value:e.serviceNode[d].service},"reference"in e.serviceNode[d]&&e.serviceNode[d].reference.length>0&&(a.link=f(e.serviceNode[d].reference)),"reference"in t.node[d][2]&&t.node[d][2].reference.length>0?a.node=f(t.node[d][2].reference):"r"in t.node[d][2]&&t.node[d][2].r.length>0&&(a.node=f(t.node[d][2].r)),h.node.push(a),"place"in t.node[d][2]&&-1===o.indexOf(t.node[d][2].place)?o.push(t.node[d][2].place):"p"in t.node[d][2]&&-1===o.indexOf(t.node[d][2].p)&&o.push(t.node[d][2].p));for(h.place=[],i=t.place.length-1,d=0;d<o.length;d+=1)o[d]<=i&&o[d]>=0&&(c=0,"population"in t.place[o[d]][2]?c=t.place[o[d]][2].population:"p"in t.place[o[d]][2]&&(c=t.place[o[d]][2].p),c>0&&(h.summary.place+=c,h.place.push({circle:[t.place[o[d]][0],t.place[o[d]][1]],value:c})));if("geoJSON"in n!=0&&Array.isArray(n.geoJSON)){for(r={type:"FeatureCollection",features:[]},d=0;d<n.geoJSON.length;d+=1)if(n.geoJSON[d]in h)for(s=0;s<h[n.geoJSON[d]].length;s+=1)if("value"in h[n.geoJSON[d]][s]&&("circle"in h[n.geoJSON[d]][s]||"polyline"in h[n.geoJSON[d]][s])){if("circle"in h[n.geoJSON[d]][s])a={type:"Point",coordinates:h[n.geoJSON[d]][s].circle};else for(a={type:"LineString",coordinates:[]},p=0;p<h[n.geoJSON[d]][s].polyline.length;p+=1)a.coordinates.push(h[n.geoJSON[d]][s].polyline[p]);l={type:n.geoJSON[d],value:h[n.geoJSON[d]][s].value},"link"in h[n.geoJSON[d]][s]&&(l.link=h[n.geoJSON[d]][s].link),"node"in h[n.geoJSON[d]][s]&&(l.node=h[n.geoJSON[d]][s].node),r.features.push({type:"Feature",geometry:a,properties:l})}return r}return h}(i=function(e){var t,n,r,a,i,o,l,c,d,s,p={},h={},u=Object.keys(e.serviceLink);for(c=0;c<u.length;c+=1)for(a=u[c]-0,t=Object.keys(e.serviceLink[a]),d=0;d<t.length;d+=1){if(n=t[d]-0,o=[e.serviceLink[a][n].service.toString()],"reference"in e.serviceLink[a][n])for(s=0;s<e.serviceLink[a][n].reference.length;s+=1)"n"in e.serviceLink[a][n].reference[s]?o.push(e.serviceLink[a][n].reference[s].n.toString()):"c"in e.serviceLink[a][n].reference[s]&&o.push(e.serviceLink[a][n].reference[s].c.toString());(o=o.join(":"))in p==0&&(p[o]=[],h[o]=e.serviceLink[a][n]),p[o].push([a,n])}for(e.path=[],i=Object.keys(p),c=0;c<i.length;c+=1){for(l=[p[i[c]].pop()];p[i[c]].length>0;)for(r=p[i[c]].pop(),d=0;d<l.length;d+=1){if(r[0]===l[d][0]){l[d].unshift(r[1]);break}if(r[1]===l[d][0]){l[d].unshift(r[0]);break}if(r[0]===l[d][l.length-1]){l[d].push(r[1]);break}if(r[1]===l[d][l.length-1]){l[d].push(r[0]);break}if(d===l.length-1){l.push(r);break}}for(d=0;d<l.length;d+=1)e.path.push([h[i[c]],l[d]])}return e}(i=function(e,t,n){var r,a,i,o,l,c,d,s,p,h,u,f,g,m,k,b,v;e.serviceLink=[],e.serviceNode=[],l="filter"in n&&"number"==typeof n.filter&&n.filter>=0&&n.filter<t.network.length?t.network[n.filter][0]:[],m="service"in n&&"number"==typeof n.service&&n.service>=0&&n.service<t.service.length?t.service[n.service][0]:[];for(k=0;k<t.link.length;k+=1)if((0===l.length||l.filter(function(e){return-1!==t.link[k][0].indexOf(e)}).length>0)&&("shared"in t.link[k][3]==0||-1===l.indexOf(t.link[k][3].shared)||"h"in t.link[k][3]==0||-1===l.indexOf(t.link[k][3].h))&&("setdown"in t.link[k][3]==0||e.hereNodes.filter(function(e){return-1===t.link[k][3].setdown.indexOf(e)}).length>0||"s"in t.link[k][3]==0||e.hereNodes.filter(function(e){return-1===t.link[k][3].s.indexOf(e)}).length>0)&&t.link[k][2].filter(function(t){return-1!==e.hereNodes.indexOf(t)}).length>0){for(h=0,b=0;b<t.link[k][1].length;b+=1)-1===m.indexOf(b)&&0!==m.length||(h+=t.link[k][1][b]);if(h>0){if(c=[],d=[],s=null,p=null,f=null,g=[],"reference"in t.link[k][3]&&Array.isArray(t.link[k][3].reference)?c=t.link[k][3].reference:"r"in t.link[k][3]&&Array.isArray(t.link[k][3].r)&&(c=t.link[k][3].r),"split"in t.link[k][3]&&Array.isArray(t.link[k][3].split)||"t"in t.link[k][3]&&Array.isArray(t.link[k][3].t)?(g="split"in t.link[k][3]?t.link[k][3].split:t.link[k][3].t,t.link[k][2].filter(function(e){return-1===g.indexOf(e)}).filter(function(t){return-1!==e.hereNodes.indexOf(t)}).length>0?f=1:(f=2,e.summary.link+=h)):e.summary.link+=h,("circular"in t.link[k][3]&&(!0===t.link[k][3].circular||1===t.link[k][3].circular)||"c"in t.link[k][3]&&(!0===t.link[k][3].c||1===t.link[k][3].c))&&(s=t.link[k][2].length-1),"direction"in t.link[k][3]&&(!0===t.link[k][3].direction||1===t.link[k][3].direction)||"d"in t.link[k][3]&&(!0===t.link[k][3].d||1===t.link[k][3].d)){for(p=1,b=0;b<t.link[k][2].length;b+=1)if(-1!==e.hereNodes.indexOf(t.link[k][2][b])){null!==s?(d=(d=t.link[k][2].slice(0,-1)).slice(b).concat(d.slice(0,b))).push(d[0]):d=t.link[k][2].slice(b);break}}else d=t.link[k][2];if("pickup"in t.link[k][3]||"u"in t.link[k][3]){i="pickup"in t.link[k][3]?t.link[k][3].pickup:t.link[k][3].u;for(b=0;b<i.length;b+=1)-1===e.hereNodes.indexOf(i[b])&&-1!==(o=d.indexOf(i[b]))&&d.splice(o,1)}for(b=0;b<d.length;b+=1){if((1!==f||-1!==g.indexOf(d[b]))&&s!==b&&(u=1===p||-1!==e.hereNodes.indexOf(d[b])?h:h/2,void 0===e.serviceNode[d[b]]?e.serviceNode[d[b]]={reference:[],service:u}:e.serviceNode[d[b]].service+=u,c.length>0))for(v=0;v<c.length;v+=1)e.serviceNode[d[b]].reference.push(c[v]);if(d.length-1>b&&(1!==f||-1!==g.indexOf(d[b])||-1!==g.indexOf(d[b+1]))&&(u=1===p||-1!==e.hereNodes.indexOf(d[b])&&-1!==e.hereNodes.indexOf(d[b+1])?h:h/2,d[b]<d[b+1]?(a=d[b+1],r=d[b]):(a=d[b],r=d[b+1]),void 0===e.serviceLink[a]&&(e.serviceLink[a]=[]),void 0===e.serviceLink[a][r]?e.serviceLink[a][r]={reference:[],service:u}:e.serviceLink[a][r].service+=u,c.length>0))for(v=0;v<c.length;v+=1)e.serviceLink[a][r].reference.push(c[v])}}}return e}(i=function(e,t,n,r,a){var i,o,l,c,d,s,p,h,u;for(i=0;i<t.node.length;i+=1)t.node[i].length>1&&a>=(o=r,l=n,c=t.node[i][1],d=t.node[i][0],s=Math.PI/180,p=Math.sin((c-o)*s/2),h=Math.sin((d-l)*s/2),u=p*p+Math.cos(o*s)*Math.cos(c*s)*h*h,2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u))*6371e3)&&e.hereNodes.push(i);return e}(i,e,t,n,r),e,a)),e,a)}catch(e){return{error:e}}}};