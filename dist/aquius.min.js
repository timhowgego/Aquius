var aquius=aquius||{init:function(e,t){"use strict";var n=this.here,a="en-US",r={"en-US":{lang:"English",embed:"Embed",export:"Export",here:"Here",language:"Language",link:"Services",network:"Network",node:"Stops",place:"People",scale:"Scale"},"es-ES":{lang:"Espa√±ol",embed:"Insertar",export:"Exportar",here:"Aqu√≠",language:"Idioma",link:"Servicios",network:"Red",node:"Paradas",place:"Personas",scale:"Escala"}},i={base:[{options:{attribution:"&copy; <a href='https://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors",maxZoom:18},type:"",url:"http://{s}.tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png"}],c:-1.43,dataObject:{},dataset:"",hereColor:"#080",k:54.54,leaflet:{},linkColor:"#f00",linkScale:1,locale:a,m:9,map:{},n:0,network:[],nodeColor:"#000",nodeScale:1,panelScale:1,placeColor:"#00f",placeOpacity:.5,placeScale:1,v:"lph",s:5,uiHash:!1,uiLocale:!0,uiNetwork:!0,uiPanel:!0,uiScale:!0,uiShare:!0,uiStore:!0,t:a,translation:{},x:10.35,y:50.03,z:4},o=["https://unpkg.com/leaflet@1.3.4/dist/leaflet.css","https://unpkg.com/leaflet@1.3.4/dist/leaflet.js"],l=["place","link","node","here"],c=["link","place","node"];function s(e,t,n){var a=document.getElementById(e);function r(e,t,n){var a=document.createElement("div");a.textContent=t,a.style["text-align"]="center",void 0!==n&&n>0&&(a.style["font-size"]=parseInt(100*n,10)+"%"),e.appendChild(a)}for(;a.firstChild;)a.removeChild(a.firstChild);return void 0===n?(r(a,"üåç",10),!0):(r(a,"üö´",10),"message"in n&&r(a,"( "+n.message+" )"),!1)}function d(e,t,n){var a={};function r(){var e,t={},n=decodeURIComponent(document.location.hash.trim()).slice(1).split("/");for(e=0;e<n.length;e+=1)n[e].length>=2&&/^[a-z\-()]$/.test(n[e][0])&&(t[n[e][0]]=n[e].slice(1));return t}function i(e){try{return null!==sessionStorage.getItem(e)?JSON.parse(sessionStorage.getItem(e)):{}}catch(e){return{}}}return!sessionStorage||"uiStore"in t!=!1&&!0!==t.uiStore||(a="object"==typeof n?function(e,t,n){var a,r=i(e),o=Object.keys(n);for(a=0;a<o.length;a+=1)r[o[a]]=n[o[a]];try{sessionStorage.setItem(e,JSON.stringify(r))}catch(e){}return r}(e,0,n):i(e)),"uiHash"in t==!0&&!0===t.uiHash&&(a="object"==typeof n?function(e,t){var n,a,i,o=r(),l=Object.keys(t);for(i=0;i<l.length;i+=1)1===l[i].length&&/^[a-z\-()]$/.test(l[i])&&(o[l[i]]=t[l[i]]);for(n=Object.keys(o),a=[],i=0;i<n.length;i+=1)a.push(n[i]+encodeURIComponent(o[n[i]]));return location.hash="#"+a.join("/"),o}(0,n):r()),a}function p(e,t){var a,r,o,s,p,h,f,m,g,b,y,v,k=!1,O={};function j(t,n,a){var r,i=Object.keys(n);for(r=0;r<i.length;r+=1)document.getElementById(i[r])&&(t.t in t.translation&&n[i[r]]in t.translation[t.t]?document.getElementById(i[r]).textContent=t.translation[t.t][n[i[r]]]:t.locale in t.translation&&n[i[r]]in t.translation[t.locale]?document.getElementById(i[r]).textContent=t.translation[t.locale][n[i[r]]]:document.getElementById(i[r]).textContent=n[i[r]]);void 0!==a&&!0===a&&(t=u(e,t,!0))}function x(t,n){return t._layer[n].on("add",function(){-1===t.v.indexOf(n.charAt(0))&&(t.v+=n.charAt(0),d(e,t,{v:t.v}))}),t._layer[n].on("remove",function(){t.v=t.v.replace(n.charAt(0),""),d(e,t,{v:t.v})}),t}function w(e,t,n){var a,r,i=document.createElement(e);if(void 0!==t)for(a=Object.keys(t),r=0;r<a.length;r+=1)i[a[r]]=t[a[r]];if(void 0!==n)for(a=Object.keys(n),r=0;r<a.length;r+=1)i.style[a[r]]=n[a[r]];return i}try{y=Object.defineProperty({},"passive",{get:function(){return k=!0,!0}}),window.addEventListener("test",null,y),window.removeEventListener("test",null,y)}catch(e){}for(a=["_datasetName","_datasetAttribution"],v=0;v<a.length;v+=1)O[e+a[v]]=a[v],a[v]=e+a[v];o=w("span"),"meta"in t.dataObject&&"url"in t.dataObject.meta&&"string"==typeof t.dataObject.meta.url?o.appendChild(w("a",{href:t.dataObject.meta.url,id:a[0]})):o.appendChild(w("span",{id:a[0]})),o.appendChild(document.createTextNode(" ")),o.appendChild(w("span",{id:a[1]})),t.map.attributionControl.addAttribution(o.outerHTML),!0===t.uiLocale&&(a=Object.keys(t.translation)).length>1&&((h=t.leaflet.control({position:"topright"})).onAdd=function(){for(s=w("div",{className:"aquius-locale",id:e+"locale"},{"background-color":"#fff","border-bottom":"2px solid rgba(0,0,0,0.3)","border-left":"2px solid rgba(0,0,0,0.3)","border-radius":"0 0 0 5px",margin:0,padding:"0 0 1px 1px"}),t.leaflet.DomEvent.disableClickPropagation(s),o=w("label",{id:e+"langname",for:e+"lang"},{display:"none"}),O[e+"langname"]="language",s.appendChild(o),r=[],v=0;v<a.length;v+=1)r.push({value:a[v],label:"lang"in t.translation[a[v]]?t.translation[a[v]].lang:a[v]});return(o=function(e,t,n){var a,r,i=w("select",{id:t},{"background-color":"#fff",color:"#000",font:'12px/1.5 "Helvetica Neue", Arial, Helvetica, sans-serif'});for(r=0;r<e.length;r+=1)a=w("option"),"value"in e[r]&&(a.value=e[r].value,e[r].value===n&&(a.selected="selected")),"label"in e[r]&&(a.textContent=e[r].label),"id"in e[r]&&(a.id=e[r].id),i.appendChild(a);return i}(r,e+"lang",t.t)).style.border="none",o.addEventListener("change",function(){t.t=document.getElementById(e+"lang").value,d(e,t,{t:t.t}),j(t,O,!0)},!!k&&{passive:!0}),s.appendChild(o),s},h.addTo(t.map)),!0===t.uiPanel&&((h=t.leaflet.control({position:"bottomleft"})).onAdd=function(){for(s=w("div",{className:"aquius-panel",id:e+"panel"},{"background-color":"rgba(255,255,255,0.7)","font-weight":"bold",padding:"0 3px","border-radius":"5px"}),t.leaflet.DomEvent.disableClickPropagation(s),v=0;v<c.length;v+=1)p=w("span",{},{color:t[c[v]+"Color"],margin:"0 0.1em"}),o=w("span",{id:e+c[v]+"value",textContent:"0"},{"font-size":Math.round(200*t.panelScale).toString()+"%",margin:"0 0.1em"}),p.appendChild(o),o=w("span",{id:e+c[v]+"label"},{"font-size":Math.round(100*t.panelScale).toString()+"%",margin:"0 0.1em","vertical-align":"20%"}),O[o.id]=c[v],p.appendChild(o),s.appendChild(p),s.appendChild(document.createTextNode(" "));return s},h.addTo(t.map)),t._layer={},r=l.reverse(),h=t.leaflet.control.layers();for(v=0;v<r.length;v+=1)t._layer[r[v]]=t.leaflet.layerGroup(),-1!==(t=x(t,r[v])).v.indexOf(r[v].charAt(0))&&t._layer[r[v]].addTo(t.map),o=w("span",{id:e+r[v]+"name"},{color:t[r[v]+"Color"]}),O[o.id]=r[v],h.addOverlay(t._layer[r[v]],o.outerHTML);if(h.addTo(t.map),!(f=function(e){var t,n=!1,a=e.getContainer().childNodes;for(t=0;t<a.length;t+=1)if("FORM"===a[t].tagName){n=a[t];break}return n}(h)))return j(t,O),t;if("network"in t.dataObject&&Array.isArray(t.dataObject.network)&&t.dataObject.network.length>1){for(r=[],v=0;v<t.dataObject.network.length;v+=1)r.push({value:v,id:e+"network"+v}),O[e+"network"+v]="_network"+v;(o=function(e,t,n){var a,r,i,o=w("div",{id:t});for(i=0;i<e.length;i+=1)a=w("label"),r=w("input",{type:"radio",name:t}),"value"in e[i]&&(r.value=e[i].value,e[i].value===n&&(r.checked="checked")),a.appendChild(r),r=w("span"),"id"in e[i]&&(r.id=e[i].id),"label"in e[i]&&(r.textContent=e[i].label),a.appendChild(r),o.appendChild(a);return o}(r,e+"network",t.n)).addEventListener("change",function(){t.n=parseInt(document.querySelector("input[name='"+e+"network']:checked").value,10),d(e,t,{n:t.n}),t=u(e,t)},!!k&&{passive:!0}),f.appendChild(o)}return!0===t.uiScale&&(s=w("label"),p=w("div",{id:e+"scalename"},{"text-align":"center"}),O[p.id]="scale",s.appendChild(p),(p=w("input",{id:e+"scale",type:"range",min:0,max:10,value:t.s})).addEventListener("change",function(){t.s=parseInt(document.getElementById(e+"scale").value,10),d(e,t,{s:t.s}),t=u(e,t,!0)},!!k&&{passive:!0}),s.appendChild(p),f.appendChild(s)),!0===t.uiShare&&Blob&&(s=w("div",{},{"text-align":"center"}),""!==t.dataset&&((m=w("a",{id:e+"embed",download:e+".txt",role:"button"},{cursor:"pointer"})).addEventListener("click",function(){m.href=window.URL.createObjectURL(function(e,t){var n,a=[],r="\x3c!--Script URL--\x3e",o=document.getElementsByTagName("script"),l={},c=Object.keys(t),s=["dataObject","leaflet","map","translation","uiHash"];for(n=0;n<o.length;n+=1)if(-1!==o[n].src.indexOf("aquius")){r=o[n].src;break}for(n=0;n<c.length;n+=1)"_"!==c[n].charAt(0)&&-1===s.indexOf(c[n])&&t[c[n]]!==i[c[n]]&&(l[c[n]]=t[c[n]]);return a.push(w("div",{id:e},{height:"100%"}).outerHTML),a.push(w("script",{src:r}).outerHTML),a.push(w("script",{textContent:'window.addEventListener("load",function(){aquius.init("'+e+'",'+JSON.stringify(l)+")});"}).outerHTML),new Blob([a.join("\n")],{type:"text/plain;charset=utf-8"})}(e,t))},!!k&&{passive:!0}),O[m.id]="embed",s.appendChild(m),s.appendChild(document.createTextNode(" | "))),(g=w("a",{id:e+"export",download:e+".json",role:"button"},{cursor:"pointer"})).addEventListener("click",function(){for(b=[],v=0;v<l.length;v+=1)-1!==t.v.indexOf(l[v].charAt(0))&&b.push(l[v]);g.href=window.URL.createObjectURL(new Blob([JSON.stringify(n(t.dataObject,t.c,t.k,5e6/Math.pow(2,t.m),{filter:t.n,geoJSON:b,sanitize:!1}))],{type:"application/json;charset=utf-8"}))},!!k&&{passive:!0}),O[g.id]="export",s.appendChild(g),f.appendChild(s)),j(t,O),t}function h(e,t){if("object"!=typeof L||"version"in L==!1)return s(e,0,{message:"Leaflet failed to load"});t.leaflet=L,t=u(e,t=p(e,t=function(e,t){var n;if("setView"in t.map==0||"on"in t.map==0||"getCenter"in t.map==0||"getZoom"in t.map==0||"attributionControl"in t.map==0){for(;document.getElementById(e).firstChild;)document.getElementById(e).removeChild(document.getElementById(e).firstChild);t.map=t.leaflet.map(e,{preferCanvas:!0})}for(t.map.attributionControl.addAttribution('<a href="https://timhowgego.github.io/Aquius/">Aquius</a>'),t.map.setView([t.y,t.x],t.z),t.map.on("moveend",function(){var n,a=t.map.getCenter();t.z=t.map.getZoom(),n=Math.ceil(t.z/3),t.x=parseFloat(a.lng.toFixed(n)),t.y=parseFloat(a.lat.toFixed(n)),d(e,t,{x:t.x,y:t.y,z:t.z})}),t.map.on("click",function(n){var a=Math.ceil(t.z/3),r=n.latlng;t.c=parseFloat(r.lng.toFixed(a)),t.k=parseFloat(r.lat.toFixed(a)),t.m=t.z,d(e,t,{c:t.c,k:t.k,m:t.m}),t=u(e,t)}),n=0;n<t.base.length;n+=1)"url"in t.base[n]&&("options"in t.base[n]==0&&(t.base[n].options={}),"type"in t.base[n]&&"wms"===t.base[n].type?t.leaflet.tileLayer.wms(t.base[n].url,t.base[n].options).addTo(t.map):t.leaflet.tileLayer(t.base[n].url,t.base[n].options).addTo(t.map));return t}(e,t=function(e,t){var n,o,l,c,s,p,h,u,f=Object.keys(i),m=[];for("object"!=typeof t.dataObject&&(t.dataObject={}),p=0;p<f.length;p+=1)i[f[p]]===a&&m.push(f[p]),f[p]in t!=0&&typeof t[f[p]]==typeof i[f[p]]||("option"in t.dataObject&&f[p]in t.dataObject.option&&typeof t.dataObject.option[f[p]]==typeof i[f[p]]?t[f[p]]=t.dataObject.option[f[p]]:t[f[p]]=i[f[p]]);for(n=d(e,t),o=Object.keys(n),p=0;p<o.length;p+=1)-1!==f.indexOf(o[p])&&("number"==typeof t[o[p]]?!1===Number.isNaN(parseFloat(n[o[p]]))&&(t[o[p]]=parseFloat(n[o[p]])):"string"==typeof t[o[p]]&&(t[o[p]]=n[o[p]].toString()));t.network.length>0&&("network"in t.dataObject&&Array.isArray(t.dataObject.network)?t.dataObject.network=t.dataObject.network.concat(t.network):t.dataObject.network=t.network),t.n=parseInt(t.n,10),t.n<0?t.n=0:"network"in t.dataObject&&Array.isArray(t.dataObject.network)&&t.n>=t.dataObject.network.length&&(t.n=t.dataObject.network.length-1),l=[],"translation"in t.dataObject&&l.push(t.dataObject.translation),"network"in t.dataObject&&Array.isArray(t.dataObject.network)&&l.push(function(e){var t,n,a,r={};for(n=0;n<e.dataObject.network.length;n+=1)if(e.dataObject.network[n].length>1&&"object"==typeof e.dataObject.network[n][1])for(t=Object.keys(e.dataObject.network[n][1]),a=0;a<t.length;a+=1)t[a]in r==0&&(r[t[a]]={}),r[t[a]]["_network"+n]=e.dataObject.network[n][1][t[a]];return r}(t)),"meta"in t.dataObject&&("name"in t.dataObject.meta||"attribution"in t.dataObject.meta)&&l.push(function(e){var t,n,a={};if("meta"in e.dataObject&&"name"in e.dataObject.meta&&"object"==typeof e.dataObject.meta.name)for(t=Object.keys(e.dataObject.meta.name),n=0;n<t.length;n+=1)t[n]in a==0&&(a[t[n]]={}),a[t[n]]._datasetName=e.dataObject.meta.name[t[n]].toString();if("meta"in e.dataObject&&"attribution"in e.dataObject.meta&&"object"==typeof e.dataObject.meta.attribution)for(t=Object.keys(e.dataObject.meta.attribution),n=0;n<t.length;n+=1)t[n]in a==0&&(a[t[n]]={}),a[t[n]]._datasetAttribution=e.dataObject.meta.attribution[t[n]].toString();return a}(t)),l.push(r);for(p=0;p<l.length;p+=1)for(c=Object.keys(l[p]),h=0;h<c.length;h+=1){c[h]in t.translation==0&&(t.translation[c[h]]={}),s=Object.keys(l[p][c[h]]);for(u=0;u<s.length;u+=1)s[u]in t.translation[c[h]]==0&&(t.translation[c[h]][s[u]]=l[p][c[h]][s[u]])}for(p=0;p<m.length;p+=1)t[m[p]]in t.translation==0&&(t[m[p]]=i[m[p]]);return t}(e,t))),!1,!0)}function u(e,t,a,r){var i,o,c,s,d,p,h;for(p=0;p<l.length;p+=1)l[p]in t._layer&&t._layer[l[p]].clearLayers();if(void 0!==a&&!0===a&&"_here"in t!=!1||((s={filter:t.n}).sanitize=void 0!==r&&!0===r,t._here=n(t.dataObject,t.c,t.k,5e6/Math.pow(2,t.m),s)),"dataObject"in t._here&&(t.dataObject=t._here.dataObject),!0===t.uiPanel&&"summary"in t._here)for(c=Object.keys(t._here.summary),p=0;p<c.length;p+=1)if(i=e+c[p]+"value",document.getElementById(i))try{document.getElementById(i).textContent=new Intl.NumberFormat(t.t).format(t._here.summary[c[p]])}catch(e){document.getElementById(i).textContent=t._here.summary[c[p]].toString()}if("place"in t._here)for(d=Math.exp((t.s-5)/2)*t.placeScale/666,p=0;p<t._here.place.length;p+=1)"circle"in t._here.place[p]&&"value"in t._here.place[p]&&t._here.place[p].circle.length>1&&t.leaflet.circleMarker(t.leaflet.latLng([t._here.place[p].circle[1],t._here.place[p].circle[0]]),{fill:!0,fillColor:t.placeColor,fillOpacity:t.placeOpacity,radius:Math.ceil(Math.sqrt(t._here.place[p].value*d)),stroke:!1}).bindTooltip(t._here.place[p].value.toString()).addTo(t._layer.place);if("link"in t._here)for(d=Math.exp((t.s-5)/2)*t.linkScale*4,p=0;p<t._here.link.length;p+=1)if("polyline"in t._here.link[p]&&"value"in t._here.link[p]){for(o=[],h=0;h<t._here.link[p].polyline.length;h+=1)t._here.link[p].polyline[h].length>1&&o.push([t._here.link[p].polyline[h][1],t._here.link[p].polyline[h][0]]);t.leaflet.polyline(o,{color:t.linkColor,weight:Math.ceil(Math.log(1+t._here.link[p].value*(1/d))*d)}).bindTooltip(t._here.link[p].value.toString()).addTo(t._layer.link)}if("node"in t._here)for(d=Math.exp((t.s-5)/2)*t.nodeScale*2,p=0;p<t._here.node.length;p+=1)"circle"in t._here.node[p]&&"value"in t._here.node[p]&&t._here.node[p].circle.length>1&&t.leaflet.circleMarker(t.leaflet.latLng([t._here.node[p].circle[1],t._here.node[p].circle[0]]),{color:t.nodeColor,fill:!1,radius:Math.ceil(Math.log(1+t._here.node[p].value*(1/(2*d)))*d),weight:1}).bindTooltip(t._here.node[p].value.toString()).addTo(t._layer.node);return"here"in t._here&&t._here.here.length>0&&"circle"in t._here.here[0]&&"value"in t._here.here[0]&&t._here.here[0].circle.length>1&&t.leaflet.circle(t.leaflet.latLng([t._here.here[0].circle[1],t._here.here[0].circle[0]]),{color:t.hereColor,fill:!1,interactive:!1,radius:t._here.here[0].value,weight:2}).addTo(t._layer.here),t}return!!document.getElementById(e)&&(Object.keys&&[].indexOf&&"object"==typeof JSON?(s(e),"object"!=typeof t&&(t={}),"dataObject"in t!=!1&&"object"==typeof t.dataObject||(t.dataObject={meta:{schema:"0",name:{"en-US":"Empty Dataset"}}}),"leaflet"in t&&"object"==typeof t.leaflet&&"version"in t.leaflet&&!1===Number.isNaN(parseInt(t.leaflet.version.split(".")[0],10))&&parseInt(t.leaflet.version.split(".")[0],10)>=1&&(o=[]),void("undefined"!=typeof Promise?function(e,t,n){var a,r=[];function i(e){return new Promise(function(t,n){var a;"css"===e.split(".").pop()?((a=document.createElement("link")).rel="stylesheet",a.href=e):(a=document.createElement("script")).src=e,a.onload=t,a.onerror=n,document.head.appendChild(a)})}for(a=0;a<n.length;a+=1)r.push(i(n[a]));"dataset"in t&&"string"==typeof t.dataset&&r.push(fetch(t.dataset)),0===r.length?h(e,t):Promise.all(r).then(function(e){return"dataset"in t&&"string"==typeof t.dataset?e[r.length-1].json():t.dataObject}).then(function(n){t.dataObject=n,h(e,t)}).catch(function(t){return s(e,0,t)})}(e,t,o):function(e,t,n){var a,r,i,o,l;function c(t,n){var a;"css"===t.split(".").pop()?((a=document.createElement("link")).rel="stylesheet",a.href=t):((a=document.createElement("script")).type="text/javascript",a.src=t),a.onreadystatechange=n,a.onload=n,a.onerror=function(){return s(e,0,{message:"Could not load "+t})},document.head.appendChild(a)}if(r=function(){var n,a,r;"dataset"in t&&"string"==typeof t.dataset?(n=t.dataset,a=function(n){return t.dataObject=n,h(e,t)},(r=new XMLHttpRequest).onreadystatechange=function(){if(4===r.readyState){if(200!==r.status)return s(e,0,{message:r.status+": Could not load "+n});var t=JSON.parse(r.responseText);a&&a(t)}},r.open("GET",n),r.send()):h(e,t)},0===n.length)r();else for(i=0,o=function(){a=arguments,(i+=1)>=n.length&&r.call(this,a)},l=0;l<n.length&&!(l>=n.length);l+=1)c(n[l],o)}(e,t,o))):(document.getElementById(e).appendChild(document.createTextNode("Browser not supported: Try a modern browser")),document.getElementById(e).style.height="auto",!1))},here:function(e,t,n,a,r){"use strict";var i;if(!Object.keys||![].indexOf||"object"!=typeof JSON)return{error:"Unsupported browser"};if("number"!=typeof(t||n||a))return{error:"Here parameters not numeric"};"object"!=typeof r&&(r={}),i={hereNodes:[],here:[{circle:[t,n],value:a}],serviceIndex:{},serviceLink:[],serviceNode:[],serviceOD:{},summary:{link:0,node:0,place:0}},"sanitize"in r!=!1&&!1===r.sanitize||(e=function(e){var t,n,a,r,i,o={0:{link:[0,0,[0],{}],network:[[0],{"en-US":"Unknown"}],node:[0,0,0],place:[0,0,0]}};"object"!=typeof e&&(e={}),"meta"in e==0&&(e.meta={}),"schema"in e.meta!=0&&e.meta.schema in o!=0||(e.meta.schema="0"),t=Object.keys(o[e.meta.schema]);for(n=0;n<t.length;n+=1)t[n]in e&&"object"!=typeof e[t[n]]&&delete e[t[n]];for(n=0;n<t.length;n+=1){t[n]in e!=0&&0!=Array.isArray(e[t[n]])&&0!==e[t[n]].length||(e[t[n]]=[o[e.meta.schema][t[n]]]);for(a=0;a<e[t[n]].length;a+=1){if(e[t[n]][a].length<o[e.meta.schema][t[n]].length)for(r=e[t[n]][a].length-1;r<o[e.meta.schema][t[n]].length;r+=1)e[t[n]][a].push(o[e.meta.schema][t[n]][r]);for(r=0;r<o[e.meta.schema][t[n]].length;r+=1)if(typeof e[t[n]][a][r]!=typeof o[e.meta.schema][t[n]][r]&&(e[t[n]][a][r]=o[e.meta.schema][t[n]][r]),Array.isArray(e[t[n]][a][r]))for(i=0;i<e[t[n]][a][r].length;i+=1)typeof e[t[n]][a][r][i]!=typeof o[e.meta.schema][t[n]][r][0]&&(e[t[n]][a][r][i]=o[e.meta.schema][t[n]][r][0])}}return e}(e),i.dataObject=e);try{return function(e,t,n){var a,r,i,o,l,c,s,d,p,h,u,f,m,g={};function b(e,t){var n,a=t.length-1,r=[];for(n=0;n<e.length;n+=1)e[n]<=a&&r.push([t[e[n]][0],t[e[n]][1]]);return r}for(g.summary=e.summary,g.here=e.here,g.link=[],l=Object.keys(e.serviceOD);l.length>0;){for(h=l.shift(),d=[e.serviceOD[h][1],e.serviceOD[h][0]],p=e.serviceOD[h][2],a=0;a<1&&(o=p+"-"+d[d.length-1])in e.serviceIndex&&e.serviceIndex[o].length>0;)d.push(e.serviceOD[e.serviceIndex[o].pop()][1]);g.link.push({polyline:b(d,t.node),value:p})}for(g.node=[],c=t.node.length-1,s=[],u=0;u<e.serviceNode.length;u+=1)void 0!==e.serviceNode[u]&&u<=c&&(g.summary.node+=1,g.node.push({circle:[t.node[u][0],t.node[u][1]],value:e.serviceNode[u]}),-1===s.indexOf(t.node[u][2])&&s.push(t.node[u][2]));for(g.place=[],c=t.place.length-1,u=0;u<s.length;u+=1)u<=c&&(g.summary.place+=t.place[s[u]][2],g.place.push({circle:[t.place[s[u]][0],t.place[s[u]][1]],value:t.place[s[u]][2]}));if("geoJSON"in n!=0&&Array.isArray(n.geoJSON)){for(r={type:"FeatureCollection",features:[]},u=0;u<n.geoJSON.length;u+=1)if(n.geoJSON[u]in g)for(f=0;f<g[n.geoJSON[u]].length;f+=1)if("value"in g[n.geoJSON[u]][f]&&("circle"in g[n.geoJSON[u]][f]||"polyline"in g[n.geoJSON[u]][f])){if("circle"in g[n.geoJSON[u]][f])i={type:"Point",coordinates:g[n.geoJSON[u]][f].circle};else for(i={type:"LineString",coordinates:[]},m=0;m<g[n.geoJSON[u]][f].polyline.length;m+=1)i.coordinates.push(g[n.geoJSON[u]][f].polyline[m]);r.features.push({type:"Feature",geometry:i,properties:{type:n.geoJSON[u],value:g[n.geoJSON[u]][f].value}})}return r}return g}(i=function(e){var t,n,a,r,i,o,l=Object.keys(e.serviceLink);for(i=0;i<l.length;i+=1)for(r=l[i]-0,t=Object.keys(e.serviceLink[r]),o=0;o<t.length;o+=1)t[o]+"-"+l[i]in e.serviceOD==0&&(n=t[o]-0,e.serviceOD[l[i]+"-"+t[o]]=[r,n,e.serviceLink[r][n]],(a=e.serviceLink[r][n]+"-"+l[i])in e.serviceIndex?e.serviceIndex[a].push(l[i]+"-"+t[o]):e.serviceIndex[a]=[l[i]+"-"+t[o]]);return e}(i=function(e,t,n){var a,r,i,o,l,c,s,d;i="filter"in n&&"number"==typeof n.filter&&n.filter>=0&&n.filter<t.network.length?t.network[n.filter][0]:[];for(c=0;c<t.link.length;c+=1)if((0===i.length||-1!==i.indexOf(t.link[c][0]))&&("shared"in t.link[c][3]==0||-1===i.indexOf(t.link[c][3].shared))&&t.link[c][2].filter(function(t){return-1!==e.hereNodes.indexOf(t)}).length>0){if(a={},o=[],"split"in t.link[c][3]&&Array.isArray(t.link[c][3].split)?t.link[c][2].filter(function(e){return-1===t.link[c][3].split.indexOf(e)}).filter(function(t){return-1!==e.hereNodes.indexOf(t)}).length>0?a.split=1:(a.split=2,e.summary.link+=t.link[c][1]):e.summary.link+=t.link[c][1],"circular"in t.link[c][3]&&!0===t.link[c][3].circular&&(a.circular=t.link[c][2].length-1),"direction"in t.link[c][3]&&!0===t.link[c][3].direction){for(a.direction=1,s=0;s<t.link[c][2].length;s+=1)if(-1!==e.hereNodes.indexOf(t.link[c][2][s])){"circular"in a?(o=(o=t.link[c][2].slice(0,-1)).slice(s).concat(o.slice(0,s))).push(o[0]):o=t.link[c][2].slice(s);break}}else o=t.link[c][2];for(s=0;s<o.length;s+=1)if("split"in a!=0&&1===a.split&&-1===t.link[c][3].split.indexOf(o[s])||"circular"in a!=0&&a.circular===s||(l="direction"in a||-1!==e.hereNodes.indexOf(o[s])?t.link[c][1]:t.link[c][1]/2,void 0!==e.serviceNode[o[s]]?e.serviceNode[o[s]]=e.serviceNode[o[s]]+l:e.serviceNode[o[s]]=l),o.length-1>s&&("split"in a==0||1!==a.split||-1!==t.link[c][3].split.indexOf(o[s])||-1!==t.link[c][3].split.indexOf(o[s+1]))){l="direction"in a||-1!==e.hereNodes.indexOf(o[s])&&-1!==e.hereNodes.indexOf(o[s+1])?t.link[c][1]:t.link[c][1]/2,r=[[o[s],o[s+1]],[o[s+1],o[s]]];for(d=0;d<r.length;d+=1)void 0===e.serviceLink[r[d][0]]&&(e.serviceLink[r[d][0]]=[]),void 0===e.serviceLink[r[d][0]][r[d][1]]?e.serviceLink[r[d][0]][r[d][1]]=l:e.serviceLink[r[d][0]][r[d][1]]+=l}}return e}(i=function(e,t,n,a,r){var i,o,l,c,s,d,p,h,u;for(i=0;i<t.node.length;i+=1)t.node[i].length>1&&r>=(o=a,l=n,c=t.node[i][1],s=t.node[i][0],d=Math.PI/180,p=Math.sin((c-o)*d/2),h=Math.sin((s-l)*d/2),u=p*p+Math.cos(o*d)*Math.cos(c*d)*h*h,2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u))*6371e3)&&e.hereNodes.push(i);return e}(i,e,t,n,a),e,r)),e,r)}catch(e){return{error:e}}}};