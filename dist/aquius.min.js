var aquius=aquius||{init:function(e,t){"use strict";var n,a,r=document.getElementById(e);function i(e,t){function n(e,t){var n,a=[];for(n=0;n<t.length;n+=1)("here"===t[n]||t[n]in e.dataObject&&e.dataObject[t[n]].length>0)&&a.push(t[n]);return a}return n(e,"boolean"==typeof t&&!0===t?["link","place","node"]:["place","link","node","here"])}function o(e,t,n){var a,r,i,o=document.createElement(e);if(void 0!==t)for(a=Object.keys(t),i=0;i<a.length;i+=1)o[a[i]]=t[a[i]];if(void 0!==n)for(r=Object.keys(n),i=0;i<r.length;i+=1)o.style[r[i]]=n[r[i]];return o}function l(e,t){for(var n,a=document.getElementById(e._id),r=o("div",{},{margin:"0 auto","max-width":"800px","text-align":"center"});a.firstChild;)a.removeChild(a.firstChild);return"map"in e&&"function"==typeof e.map.remove&&(e.map.remove(),a.className=""),n=void 0!==t?"🚫":"🌍",r.appendChild(o("div",{textContent:n},{"font-size":"1000%"})),void 0!==t&&r.appendChild(o("p",{textContent:t.toString()})),a.appendChild(r),void 0===t}function c(e,t){var n,a,r,i,o;function c(t,n){var a;"css"===t.split(".").pop()?((a=document.createElement("link")).rel="stylesheet",a.href=t):((a=document.createElement("script")).type="text/javascript",a.src=t),a.onreadystatechange=n,a.onload=n,a.onerror=function(){return l(e,{message:"Could not load "+t})},document.head.appendChild(a)}if(a=function(){var t,n,a;"dataset"in e&&"string"==typeof e.dataset?(t=e.dataset,n=function(t){return e.dataObject=t,v(e)},(a=new XMLHttpRequest).onreadystatechange=function(){if(4===a.readyState){if(200!==a.status)return l(e,{message:a.status+": Could not load "+t});var r=JSON.parse(a.responseText);n&&n(r)}},a.open("GET",t),a.send()):v(e)},0===t.length)a();else for(r=0,i=function(){n=arguments,(r+=1)>=t.length&&a.call(this,n)},o=0;o<t.length&&!(o>=t.length);o+=1)c(t[o],i)}function d(e,t){return e.t in e.translation&&t in e.translation[e.t]?e.translation[e.t][t]:e.locale in e.translation&&t in e.translation[e.locale]?e.translation[e.locale][t]:""}function s(e,t){var n,a,r,i=Object.keys(e._toLocale);for(r=0;r<i.length;r+=1)(n=document.getElementById(i[r]))&&""!==(a=d(e,e._toLocale[i[r]]))&&(n.textContent=a);return void 0!==t&&!0===t&&h(e,!0),e}function u(e,t){var n={};function a(){var e,t={},n=decodeURIComponent(document.location.hash.trim()).slice(1).split("/");for(e=0;e<n.length;e+=1)n[e].length>=2&&/^[a-z\-()]$/.test(n[e][0])&&(t[n[e][0]]=n[e].slice(1));return t}function r(e){try{return null!==sessionStorage.getItem(e._id)?JSON.parse(sessionStorage.getItem(e._id)):{}}catch(e){return{}}}return!sessionStorage||"uiStore"in e!=!1&&!0!==e.uiStore||(n="object"==typeof t?function(e,t){var n,a=r(e),i=Object.keys(t);for(n=0;n<i.length;n+=1)a[i[n]]=t[i[n]];try{sessionStorage.setItem(e._id,JSON.stringify(a))}catch(e){}return a}(e,t):r(e)),"uiHash"in e==!0&&!0===e.uiHash&&(n="object"==typeof t?function(e,t){var n,r,i,o=a(),l=Object.keys(t);for(i=0;i<l.length;i+=1)1===l[i].length&&/^[a-z\-()]$/.test(l[i])&&(o[l[i]]=t[l[i]]);for(n=Object.keys(o),r=[],i=0;i<n.length;i+=1)r.push(n[i]+encodeURIComponent(o[n[i]]));return location.hash="#"+r.join("/"),o}(0,t):a()),n}function p(e){var t,n,a,r,l,c,d,p,f,b,g,m,v,y,O,j,k,_,C,w,x,S,N,L,A,M,I,E,T,z,P,U,q;function H(e,t){return e._layer[t].on("add",function(){-1===e.v.indexOf(t.charAt(0))&&(e.v+=t.charAt(0),u(e,{v:e.v}))}),e._layer[t].on("remove",function(){e.v=e.v.replace(t.charAt(0),""),u(e,{v:e.v})}),e}function B(e,t,n,a,r){var i,l,c;if(n in e.dataObject&&Array.isArray(e.dataObject[n])&&e.dataObject[n].length>1&&!0===e[r]){for(l=[],c=0;c<e.dataObject[n].length;c+=1)l.push({value:c,id:e._id+n+c}),e._toLocale[e._id+n+c]="_"+n+c;(i=function(e,t,n){var a,r,i,l,c=o("div",{id:t});for(l=0;l<e.length;l+=1)r=o("label"),a=o("input",{type:"radio",name:t}),"value"in e[l]&&(a.value=e[l].value,void 0!==n&&e[l].value===n&&(a.checked="checked")),r.appendChild(a),i=o("span"),"id"in e[l]&&(i.id=e[l].id),"label"in e[l]&&(i.textContent=e[l].label),r.appendChild(i),c.appendChild(r);return c}(l,e._id+n,e[a])).addEventListener("change",function(){e[a]=parseInt(document.querySelector("input[name='"+e._id+n+"']:checked").value,10);var t={};t[a]=e[a],u(e,t),h(e)},!1),t.appendChild(i)}return e}function F(e){return"_control"in e&&delete e.control,s(e)}return e._toLocale={},e._layer={},e=function(e){var t,n,a=["_datasetName","_datasetAttribution"];for(n=0;n<a.length;n+=1)e._toLocale[e._id+a[n]]=a[n],a[n]=e._id+a[n];return t=o("span"),"meta"in e.dataObject&&"url"in e.dataObject.meta&&"string"==typeof e.dataObject.meta.url?t.appendChild(o("a",{href:e.dataObject.meta.url,id:a[0]})):t.appendChild(o("span",{id:a[0]})),t.appendChild(document.createTextNode(" ")),t.appendChild(o("span",{id:a[1]})),e.map.attributionControl.addAttribution(t.outerHTML),e}(e),n=e,b=Object.keys(n.translation),!0===n.uiLocale&&b.length>1&&((a=n.leaflet.control({position:"topright"})).onAdd=function(){for(r=o("div",{className:"aquius-locale",id:n._id+"locale"},{"background-color":"#fff","border-bottom":"2px solid rgba(0,0,0,0.3)","border-left":"2px solid rgba(0,0,0,0.3)","border-radius":"0 0 0 5px",margin:0,padding:"0 0 1px 1px"}),n.leaflet.DomEvent.disableClickPropagation(r),l=n._id+"langname",r.appendChild(o("label",{id:l,for:n._id+"lang"},{display:"none"})),n._toLocale[l]="language",p=[],f=0;f<b.length;f+=1)c="lang"in n.translation[b[f]]?n.translation[b[f]].lang:b[f],p.push({value:b[f],label:c});return(d=function(e,t){var n,a,r=o("select");for(a=0;a<e.length;a+=1)n=o("option"),"value"in e[a]&&(n.value=e[a].value,e[a].value===t&&(n.selected="selected")),"label"in e[a]&&(n.textContent=e[a].label),"id"in e[a]&&(n.id=e[a].id),r.appendChild(n);return r}(p,n.t)).id=n._id+"lang",d.style["background-color"]="#fff",d.style.border="none",d.style.color="#000",d.style.font='12px/1.5 "Helvetica Neue", Arial, Helvetica, sans-serif',d.addEventListener("change",function(){n.t=document.getElementById(n._id+"lang").value,u(n,{t:n.t}),s(n,!0)},!1),r.appendChild(d),r},a.addTo(n.map)),!0===(g=e=n).uiPanel&&((m=g.leaflet.control({position:"bottomleft"})).onAdd=function(){for(v=o("div",{className:"aquius-panel",id:g._id+"panel"},{"background-color":"rgba(255,255,255,"+g.panelOpacity+")","font-weight":"bold",padding:"0 3px","border-radius":"5px"}),g.leaflet.DomEvent.disableClickPropagation(v),j=i(g,!0),k=0;k<j.length;k+=1)(y=o("span",{},{color:g[j[k]+"Color"],margin:"0 0.1em"})).appendChild(o("span",{id:g._id+j[k]+"value",textContent:"0"},{"font-size":Math.round(200*g.panelScale).toString()+"%",margin:"0 0.1em"})),O=g._id+j[k]+"label",y.appendChild(o("span",{id:O},{"font-size":Math.round(100*g.panelScale).toString()+"%",margin:"0 0.1em","vertical-align":"20%"})),g._toLocale[O]=j[k],v.appendChild(y),v.appendChild(document.createTextNode(" "));return v},m.addTo(g.map)),(t=function(e){var t,n;if("_control"in e)for(t=e._control.getContainer().childNodes,n=0;n<t.length;n+=1)if("FORM"===t[n].tagName)return t[n];return!1}(e=function(e){var t,n,a=i(e).reverse();for(e._control=e.leaflet.control.layers(),n=0;n<a.length;n+=1)e._layer[a[n]]=e.leaflet.layerGroup(),-1!==(e=H(e,a[n])).v.indexOf(a[n].charAt(0))&&e._layer[a[n]].addTo(e.map),t=e._id+a[n]+"name",e._toLocale[t]=a[n],e._control.addOverlay(e._layer[a[n]],o("span",{id:t},{color:e[a[n]+"Color"]}).outerHTML);return e._control.addTo(e.map),e}(e=g)))?(e=B(e=B(e,t,"network","n","uiNetwork"),t,"service","r","uiService"),C=t,!0===(_=e).uiScale&&(N=o("label"),x=_._id+"scalename",N.appendChild(o("div",{id:x},{"text-align":"center"})),_._toLocale[x]="scale",w=o("div",{},{"text-align":"center"}),(S=o("input",{id:_._id+"scale",type:"range",min:0,max:10,value:_.s})).addEventListener("change",function(){_.s=parseInt(document.getElementById(_._id+"scale").value,10),u(_,{s:_.s}),h(_,!0)},!1),w.appendChild(S),N.appendChild(w),C.appendChild(N)),A=t,!0===(L=e=_).uiShare&&Blob&&(T=o("div",{},{"text-align":"center"}),""!==L.dataset&&(z=L._id+"embed",(M=o("a",{id:z,download:L._id+"-embed.txt",role:"button"},{cursor:"pointer"})).addEventListener("click",function(){var e,t;M.href=window.URL.createObjectURL(((t=[]).push(o("div",{id:(e=L)._id},{height:"100%"}).outerHTML),t.push(o("script",{src:function(){var e,t=document.getElementsByTagName("script");for(e=0;e<t.length;e+=1)if(-1!==t[e].src.indexOf("aquius"))return t[e].src;return"\x3c!--Script URL--\x3e"}()}).outerHTML),t.push(o("script",{textContent:'window.addEventListener("load",function(){aquius.init("'+e._id+'",'+JSON.stringify(function(e){var t,n={base:[{options:{attribution:"&copy; <a href='https://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors",maxZoom:18},type:"",url:"http://{s}.tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png"}],c:-1.43,dataObject:{},dataset:"",hereColor:"#080",k:54.54,leaflet:{},linkColor:"#f00",linkScale:1,locale:"en-US",m:9,map:{},minWidth:2,minZoom:0,n:0,network:[],networkAdd:!0,nodeColor:"#000",nodeScale:1,panelOpacity:.7,panelScale:1,placeColor:"#00f",placeOpacity:.5,placeScale:1,v:"hlnp",r:0,s:5,uiHash:!1,uiLocale:!0,uiNetwork:!0,uiPanel:!0,uiScale:!0,uiService:!0,uiShare:!0,uiStore:!0,t:"en-US",translation:{},x:10.35,y:50.03,z:4},a={},r=Object.keys(e);for(t=0;t<r.length;t+=1)"_"!==r[t].charAt(0)&&-1===["base","dataObject","leaflet","map","network","translation","uiHash"].indexOf(r[t])&&e[r[t]]!==n[r[t]]&&(a[r[t]]=e[r[t]]);return a}(e))+")});"}).outerHTML),new Blob([t.join("\n")],{type:"text/plain;charset=utf-8"})))},!1),L._toLocale[z]="embed",T.appendChild(M),T.appendChild(document.createTextNode(" | "))),P=i(L),z=L._id+"export",(I=o("a",{id:z,download:L._id+"-export.json",role:"button"},{cursor:"pointer"})).addEventListener("click",function(){for(U={filter:L.n,geoJSON:[],service:L.r},q=0;q<P.length;q+=1)-1!==L.v.indexOf(P[q].charAt(0))&&U.geoJSON.push(P[q]);"object"==typeof L._here&&"dataObject"in L._here?(E=L._here.dataObject,U.sanitize=!1):(E=L.dataObject,U.sanitize=!0),I.href=window.URL.createObjectURL(new Blob([JSON.stringify(L._call(E,L.c,L.k,5e6/Math.pow(2,L.m),U))],{type:"application/json;charset=utf-8"}))},!1),L._toLocale[z]="export",T.appendChild(I),A.appendChild(T)),F(e=L)):F(e)}function h(e,t){var n,a;void 0===t||!0!==t||"object"!=typeof e._here?(a={_configOptions:e,callback:f,filter:e.n,service:e.r},"object"==typeof e._here&&"dataObject"in e._here?(n=e._here.dataObject,a.sanitize=!1):(n=e.dataObject,a.sanitize=!0),e._call(n,e.c,e.k,5e6/Math.pow(2,e.m),a)):m(e)}function f(e,t,n){"_configOptions"in n&&(void 0===e?(n._configOptions._here=t,m(n._configOptions)):l(n._configOptions,e))}function b(e,t){var n,a=[];if("undefined"===t||!Array.isArray(t))return e.linkColor;for(n=0;n<t.length;n+=1)"c"in t[n]&&-1===a.indexOf(t[n].c)&&a.push(t[n].c);return 0===a.length?e.linkColor:1===a.length?"#"+a[0]:function(e){var t,n,a="#",r=[[],[],[]];for(n=0;n<e.length;n+=1)6===e[n].length&&(r[0].push(parseInt(e[n].slice(0,2),16)),r[1].push(parseInt(e[n].slice(2,4),16)),r[2].push(parseInt(e[n].slice(4,6),16)));for(n=0;n<r.length;n+=1){if(0===r[n].length)return a+e[0];(t=Math.round(r[n].reduce(function(e,t){return e+t},0)/r[n].length))<=16&&(a+="0"),a+=t.toString(16)}return a}(a)}function g(e,t,n,a){var r;function i(e,t,n){var a,r,i,l;if(void 0!==e&&Array.isArray(e)){for(a=o("div",{},{margin:"0.3em 0"}),n?a.style["font-weight"]="bold":a.style["line-height"]="2.3em",l=0;l<e.length;l+=1)"n"in e[l]&&("u"in e[l]?(i=o("a",{href:e[l].u}),n||(i.style.color="#000",i.style["text-decoration"]="none")):i=o("span"),i.textContent=e[l].n,n||(i.style.border="1px solid #000",i.style.padding="0.3em 0.5em",i.style["white-space"]="nowrap","c"in e[l]&&(i.style["background-color"]="#"+e[l].c),"t"in e[l]&&(i.style.color="#"+e[l].t,i.style["border-color"]="#"+e[l].t)),a.appendChild(i),l<e.length-1&&(r=n?"|":" ",a.appendChild(document.createTextNode(r))));t.appendChild(a)}return t}return r=i(a,r=o("div",{},{color:"#000"}),!0),t=t<10&&t%1!=0?(Math.round(10*t)/10).toString():Math.round(t).toString(),r.appendChild(o("div",{textContent:e+": "+t},{margin:"0.3em 0"})),r=i(n,r,!1)}function m(e){var t,n,a,r,o,l,c,s=i(e);for(l=0;l<s.length;l+=1)s[l]in e._layer&&e._layer[s[l]].clearLayers();if(!0===e.uiPanel&&"summary"in e._here)for(n=Object.keys(e._here.summary),l=0;l<n.length;l+=1)if(a=document.getElementById(e._id+n[l]+"value"))try{a.textContent=new Intl.NumberFormat(e.t).format(Math.round(e._here.summary[n[l]]))}catch(t){a.textContent=Math.round(e._here.summary[n[l]]).toString()}if("place"in e._here&&"place"in e.dataObject&&e.dataObject.place.length>0)for(o=Math.exp((e.s-5)/2)*e.placeScale/666,r=d(e,"place"),l=0;l<e._here.place.length;l+=1)"circle"in e._here.place[l]&&"value"in e._here.place[l]&&e._here.place[l].circle.length>1&&e.leaflet.circleMarker(e.leaflet.latLng([e._here.place[l].circle[1],e._here.place[l].circle[0]]),{fill:!0,fillColor:e.placeColor,fillOpacity:e.placeOpacity,radius:Math.ceil(Math.sqrt(e._here.place[l].value*o)),stroke:!1}).bindTooltip(Math.round(e._here.place[l].value).toString()+" "+r).addTo(e._layer.place);if("link"in e._here)for(o=Math.exp((e.s-5)/2)*e.linkScale*4,r=d(e,"link"),l=0;l<e._here.link.length;l+=1)if("polyline"in e._here.link[l]&&"value"in e._here.link[l]){for(t=[],c=0;c<e._here.link[l].polyline.length;c+=1)e._here.link[l].polyline[c].length>1&&t.push([e._here.link[l].polyline[c][1],e._here.link[l].polyline[c][0]]);e.leaflet.polyline(t,{color:b(e,e._here.link[l].link),weight:Math.ceil(Math.log(1+e._here.link[l].value*(1/o))*o+e.minWidth)}).on("click",function(t){var n=t.target.getPopup(),a=parseInt(n.getContent(),10);Number.isNaN(a)||(n.setContent(g(r,e._here.link[a].value,e._here.link[a].link)),n.update())}).bindPopup(l).addTo(e._layer.link)}if("node"in e._here)for(o=Math.exp((e.s-5)/2)*e.nodeScale*2,r=d(e,"link"),l=0;l<e._here.node.length;l+=1)"circle"in e._here.node[l]&&"value"in e._here.node[l]&&e._here.node[l].circle.length>1&&e.leaflet.circleMarker(e.leaflet.latLng([e._here.node[l].circle[1],e._here.node[l].circle[0]]),{color:e.nodeColor,fill:!1,radius:Math.ceil(Math.log(1+e._here.node[l].value*(1/(2*o)))*o+e.minWidth/2),weight:1}).on("click",function(t){var n=t.target.getPopup(),a=parseInt(n.getContent(),10);Number.isNaN(a)||(n.setContent(g(r,e._here.node[a].value,e._here.node[a].link,e._here.node[a].node)),n.update())}).bindPopup(l).addTo(e._layer.node);"here"in e._here&&e._here.here.length>0&&"circle"in e._here.here[0]&&"value"in e._here.here[0]&&e._here.here[0].circle.length>1&&e.leaflet.circle(e.leaflet.latLng([e._here.here[0].circle[1],e._here.here[0].circle[0]]),{color:e.hereColor,fill:!1,interactive:!1,radius:e._here.here[0].value,weight:2}).addTo(e._layer.here)}function v(e){if("object"==typeof L&&"version"in L==!1)return l(e,{message:"Leaflet failed to load"});e.leaflet=L,h(e=p(e=function(e){var t;if("setView"in e.map==0||"on"in e.map==0||"getCenter"in e.map==0||"getZoom"in e.map==0||"attributionControl"in e.map==0){for(;document.getElementById(e._id).firstChild;)document.getElementById(e._id).removeChild(document.getElementById(e._id).firstChild);e.map=e.leaflet.map(e._id,{minZoom:e.minZoom,preferCanvas:!0})}for(e.map.attributionControl.addAttribution('<a href="https://timhowgego.github.io/Aquius/">Aquius</a>'),e.map.setView([e.y,e.x],e.z),e.map.on("moveend",function(){var t,n=e.map.getCenter();e.z=e.map.getZoom(),t=Math.ceil(e.z/3),e.x=parseFloat(n.lng.toFixed(t)),e.y=parseFloat(n.lat.toFixed(t)),u(e,{x:e.x,y:e.y,z:e.z})}),e.map.on("click",function(t){var n=Math.ceil(e.z/3),a=t.latlng;e.c=parseFloat(a.lng.toFixed(n)),e.k=parseFloat(a.lat.toFixed(n)),e.m=e.z,u(e,{c:e.c,k:e.k,m:e.m}),h(e)}),t=0;t<e.base.length;t+=1)"url"in e.base[t]&&("options"in e.base[t]==0&&(e.base[t].options={}),"type"in e.base[t]&&"wms"===e.base[t].type?e.leaflet.tileLayer.wms(e.base[t].url,e.base[t].options).addTo(e.map):e.leaflet.tileLayer(e.base[t].url,e.base[t].options).addTo(e.map));return e}(e=function(e){var t,n,a,r,i,o,l,c,d={base:[{options:{attribution:"&copy; <a href='https://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors",maxZoom:18},type:"",url:"http://{s}.tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png"}],c:-1.43,dataObject:{},dataset:"",hereColor:"#080",k:54.54,leaflet:{},linkColor:"#f00",linkScale:1,locale:"en-US",m:9,map:{},minWidth:2,minZoom:0,n:0,network:[],networkAdd:!0,nodeColor:"#000",nodeScale:1,panelOpacity:.7,panelScale:1,placeColor:"#00f",placeOpacity:.5,placeScale:1,v:"hlnp",r:0,s:5,uiHash:!1,uiLocale:!0,uiNetwork:!0,uiPanel:!0,uiScale:!0,uiService:!0,uiShare:!0,uiStore:!0,t:"en-US",translation:{},x:10.35,y:50.03,z:4},s=Object.keys(d),p=[];function h(e,t,n){return e[t]=parseInt(e[t],10),e[t]<0?e[t]=0:n in e.dataObject&&Array.isArray(e.dataObject[n])&&e[t]>=e.dataObject[n].length&&(e[t]=e.dataObject[n].length-1),e}for("object"!=typeof e.dataObject&&(e.dataObject={}),o=0;o<s.length;o+=1)"en-US"===d[s[o]]&&p.push(s[o]),s[o]in e!=0&&typeof e[s[o]]==typeof d[s[o]]||("option"in e.dataObject&&s[o]in e.dataObject.option&&typeof e.dataObject.option[s[o]]==typeof d[s[o]]?e[s[o]]=e.dataObject.option[s[o]]:e[s[o]]=d[s[o]]);for(t=u(e),n=Object.keys(t),o=0;o<n.length;o+=1)-1!==s.indexOf(n[o])&&("number"==typeof e[n[o]]?!1===Number.isNaN(parseFloat(t[n[o]]))&&(e[n[o]]=parseFloat(t[n[o]])):"string"==typeof e[n[o]]&&(e[n[o]]=t[n[o]].toString()));e.network.length>0&&("network"in e.dataObject&&Array.isArray(e.dataObject.network)?"networkAdd"in e&&!1===e.networkAdd?e.dataObject.network=e.network:e.dataObject.network=e.dataObject.network.concat(e.network):e.dataObject.network=e.network),(e=h(e=h(e,"n","network"),"r","service")).z<e.minZoom&&(e.z=e.minZoom),e.m<e.minZoom&&(e.m=e.minZoom),a=[],"translation"in e.dataObject&&a.push(e.dataObject.translation),"network"in e.dataObject&&Array.isArray(e.dataObject.network)&&a.push(function(e){var t,n,a,r={};for(n=0;n<e.dataObject.network.length;n+=1)if(e.dataObject.network[n].length>1&&"object"==typeof e.dataObject.network[n][1])for(t=Object.keys(e.dataObject.network[n][1]),a=0;a<t.length;a+=1)t[a]in r==0&&(r[t[a]]={}),r[t[a]]["_network"+n]=e.dataObject.network[n][1][t[a]];return r}(e)),"meta"in e.dataObject&&("name"in e.dataObject.meta||"attribution"in e.dataObject.meta)&&a.push(function(e){var t,n,a={};if("meta"in e.dataObject&&"name"in e.dataObject.meta&&"object"==typeof e.dataObject.meta.name)for(t=Object.keys(e.dataObject.meta.name),n=0;n<t.length;n+=1)t[n]in a==0&&(a[t[n]]={}),a[t[n]]._datasetName=e.dataObject.meta.name[t[n]].toString();if("meta"in e.dataObject&&"attribution"in e.dataObject.meta&&"object"==typeof e.dataObject.meta.attribution)for(t=Object.keys(e.dataObject.meta.attribution),n=0;n<t.length;n+=1)t[n]in a==0&&(a[t[n]]={}),a[t[n]]._datasetAttribution=e.dataObject.meta.attribution[t[n]].toString();return a}(e)),a.push({"en-US":{lang:"English",embed:"Embed",export:"Export",here:"Here",language:"Language",link:"Services",network:"Network",node:"Stops",place:"People",scale:"Scale",service:"Period"},"es-ES":{lang:"Español",embed:"Insertar",export:"Exportar",here:"Aquí",language:"Idioma",link:"Servicios",network:"Red",node:"Paradas",place:"Personas",scale:"Escala",service:"Período"}});for(o=0;o<a.length;o+=1)for(r=Object.keys(a[o]),l=0;l<r.length;l+=1){r[l]in e.translation==0&&(e.translation[r[l]]={}),i=Object.keys(a[o][r[l]]);for(c=0;c<i.length;c+=1)i[c]in e.translation[r[l]]==0&&(e.translation[r[l]][i[c]]=a[o][r[l]][i[c]])}for(o=0;o<p.length;o+=1)e[p[o]]in e.translation==0&&(e[p[o]]=d[p[o]]);return e}(e))))}if(!r)return!1;for(;r.firstChild;)r.removeChild(r.firstChild);return Object.keys&&[].indexOf&&"object"==typeof JSON?("object"!=typeof t&&(t={}),t._id=e,t._call=this.here,t._here=void 0,l(n=t),"dataObject"in n==0||"object"!=typeof n.dataObject?n.dataObject={}:"dataset"in n&&delete n.dataset,a="leaflet"in n&&"object"==typeof n.leaflet&&"version"in n.leaflet&&!1===Number.isNaN(parseInt(n.leaflet.version.split(".")[0],10))&&parseInt(n.leaflet.version.split(".")[0],10)>=1?[]:["https://unpkg.com/leaflet@1.3.4/dist/leaflet.css","https://unpkg.com/leaflet@1.3.4/dist/leaflet.js"],"undefined"!=typeof Promise?function(e,t){var n,a=[];function r(e){return new Promise(function(t,n){var a;"css"===e.split(".").pop()?((a=document.createElement("link")).rel="stylesheet",a.href=e):(a=document.createElement("script")).src=e,a.onload=t,a.onerror=n,document.head.appendChild(a)})}for(n=0;n<t.length;n+=1)a.push(r(t[n]));"dataset"in e&&"string"==typeof e.dataset&&a.push(fetch(e.dataset)),0===a.length?v(e):Promise.all(a).then(function(t){return"dataset"in e&&"string"==typeof e.dataset?t[a.length-1].json():e.dataObject}).then(function(t){e.dataObject=t,v(e)}).catch(function(t){return l(e,t)})}(n,a):c(n,a),!0):(r.appendChild(document.createTextNode("Browser not supported by Aquius: Try a modern browser")),r.style.height="auto",!1)},here:function(e,t,n,a,r){"use strict";var i,o,l,c={};function d(e){var t,n,a=Object.keys(e).sort();if(0===a.length)return[];if(1===a.length)return[e[a[0]]];for(t=[],n=0;n<a.length;n+=1)t.push(e[a[n]]);return t}function s(e,t,n){return void 0===e&&"error"in t&&(e=new Error(t.error)),"callback"in n?(n.callback(e,t,n),!0):t}if(!Object.keys||![].indexOf||"object"!=typeof JSON)return c.error="Unsupported browser",s(i,c,r);if("number"!=typeof t||"number"!=typeof n||"number"!=typeof a)return c.error="Here parameters not numeric",s(i,c,r);"object"!=typeof r&&(r={}),c.dataObject=e,c.here=[{circle:[t,n],value:a}],c.summary={link:0,node:0,place:0};try{return c=function(e){function t(e,t){var n,a=t.length-1,r=[];for(n=0;n<e.length;n+=1)e[n]<=a&&e[n]>=0&&r.push([t[e[n]][0],t[e[n]][1]]);return r}return delete(e=function(e,n){var a,r,i,o,l,c=Object.keys(n.od);for(e.link=[],o=0;o<c.length;o+=1){for(i=[n.od[c[o]].pop()];n.od[c[o]].length>0;)for(r=n.od[c[o]].pop(),l=0;l<i.length;l+=1){if(r[0]===i[l][0]){i[l].unshift(r[1]);break}if(r[1]===i[l][0]){i[l].unshift(r[0]);break}if(r[0]===i[l][i.length-1]){i[l].push(r[1]);break}if(r[1]===i[l][i.length-1]){i[l].push(r[0]);break}if(l===i.length-1){i.push(r);break}}for(l=0;l<i.length;l+=1)a={polyline:t(i[l],e.dataObject.node),value:n.data[c[o]].service},"reference"in n.data[c[o]]&&(a.link=d(n.data[c[o]].reference)),e.link.push(a)}return e}(e,function(e){var t,n,a,r,i,o,l=Object.keys(e),c={od:{},data:{}};for(i=0;i<l.length;i+=1)for(a=l[i]-0,t=Object.keys(e[a]),o=0;o<t.length;o+=1)n=t[o]-0,r=e[a][n].service.toString(),"reference"in e[a][n]&&(r+=":"+Object.keys(e[a][n].reference).join(":")),r in c.od==0&&(c.od[r]=[],c.data[r]=e[a][n]),c.od[r].push([a,n]);return c}(e.serviceLink))).serviceLink,e}(c=function(e,t,n,a,r){var i,o,l,c,d,s,u;function p(e,t){var n;if(!("product"in e))return!0;if(1===t.length){if(t[0]in e.product)return!0}else for(n=0;n<t.length;n+=1)if(t[n]in e.product)return!0;return!1}function h(e,t,n){var a;for(a=0;a<t.length;a+=1)if(t[a]in e.here){if("s"in n==0&&"setdown"in n==0)return!0;if("s"in n&&Array.isArray(n.s)&&-1===n.s.indexOf(t[a]))return!0;if("setdown"in n&&Array.isArray(n.setdown)&&-1===n.setdown.indexOf(t[a]))return!0}return!1}function f(e,t,n){var a;if(1===n.length&&("service"in t==0||0 in t.service))return e.level=n[0],e;for(e.level=0,a=0;a<n.length;a+=1)("service"in t==0||a in t.service)&&(e.level+=n[a]);return e}function b(e,t,n,a){var r;if("circular"in a&&(a.c=a.circular),n.length>1&&"c"in a&&(a.c||1===a.c)&&(e.circular=n.length-1),"direction"in a&&(a.d=a.direction),"d"in a&&(a.d||1===a.d)){for(e.direction=1,r=0;r<n.length;r+=1)if(n[r]in t.here){"circular"in e?(e.route=n.slice(0,-1),e.route=e.route.slice(r).concat(e.route.slice(0,r)),e.route.push(e.route[0])):e.route=n.slice(r);break}}else e.route=n;return"route"in e==0&&(e.route=[]),e}function g(e,t,n){var a,r;if("pickup"in n&&(n.u=n.pickup),"u"in n&&Array.isArray(n.u)&&n.u.length>0)for(r=0;r<n.u.length;r+=1)n.u[r]in t.here==0&&-1!==(a=e.route.indexOf(n.u[r]))&&e.route.splice(a,1);return e}function m(e,t,n,a){var r;if("split"in a&&(a.t=a.split),"t"in a&&Array.isArray(a.t)&&a.t.length>0){for(e.splitsIndex={},r=0;r<a.t.length;r+=1)e.splitsIndex[a.t[r]]=a.t[r];for(e.splits=2,r=0;r<n.length;r+=1)if(n[r]in e.splitsIndex==0&&n[r]in t.here){e.splits=1;break}}return e}function v(e,t){var n;if(!Array.isArray(t)||0===t.length)return e;for(n=0;n<t.length;n+=1)"n"in t[n]?t[n].n in e==0&&(e[t[n].n]=t[n]):"c"in t[n]&&t[n].c in e==0&&(e[t[n].c]=t[n]);return e}function y(e,t,n){var a,r,i,o;for(o=0;o<t.route.length;o+=1)!("splits"in t==0||1!==t.splits||t.route[o]in t.splitsIndex)||"circular"in t!=0&&t.circular===o||(i="direction"in t||t.route[o]in n.here?t.level:t.level/2,void 0===e.serviceNode[t.route[o]]?e.serviceNode[t.route[o]]={reference:{},service:i}:e.serviceNode[t.route[o]].service+=i,"reference"in t&&(e.serviceNode[t.route[o]].reference=v(e.serviceNode[t.route[o]].reference,t.reference))),t.route.length-1>o&&("splits"in t==0||1!==t.splits||t.route[o]in t.splitsIndex||t.route[o+1]in t.splitsIndex)&&(i="direction"in t||t.route[o]in n.here&&t.route[o+1]in n.here?t.level:t.level/2,t.route[o]<t.route[o+1]?(r=t.route[o+1],a=t.route[o]):(r=t.route[o],a=t.route[o+1]),void 0===e.serviceLink[r]&&(e.serviceLink[r]=[]),void 0===e.serviceLink[r][a]?e.serviceLink[r][a]={reference:{},service:i}:e.serviceLink[r][a].service+=i,"reference"in t&&(e.serviceLink[r][a].reference=v(e.serviceLink[r][a].reference,t.reference)));return e}for(e.serviceLink=[],e.serviceNode=[],i=function(e,t,n,a,r){var i,o,l,c,d,s,u,p,h,f={};if("filter"in r&&"number"==typeof r.filter&&r.filter>=0&&r.filter<e.dataObject.network.length)for(f.product={},i=0;i<e.dataObject.network[r.filter][0].length;i+=1)f.product[e.dataObject.network[r.filter][0][i]]=e.dataObject.network[r.filter][0][i];for(f.here={},i=0;i<e.dataObject.node.length;i+=1)e.dataObject.node[i].length>1&&a>=(o=n,l=t,c=e.dataObject.node[i][1],d=e.dataObject.node[i][0],s=Math.PI/180,u=Math.sin((c-o)*s/2),p=Math.sin((d-l)*s/2),h=u*u+Math.cos(o*s)*Math.cos(c*s)*p*p,2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h))*6371e3)&&(f.here[i]=i);if("service"in r&&"number"==typeof r.service&&r.service>=0&&r.service<e.dataObject.service.length)for(f.service={},i=0;i<e.dataObject.service[r.service][0].length;i+=1)f.service[e.dataObject.service[r.service][0][i]]=e.dataObject.service[r.service][0][i];return f}(e,t,n,a,r),l=0;l<e.dataObject.link.length;l+=1)!p(i,e.dataObject.link[l][0])||(s=i,"h"in(u=e.dataObject.link[l][3])&&u.h in s.product||"shared"in u&&u.shared in s.product)||!h(i,e.dataObject.link[l][2],e.dataObject.link[l][3])||(o=f(o={},i,e.dataObject.link[l][1])).level>0&&(o=m(o=g(o=b(o,i,e.dataObject.link[l][2],e.dataObject.link[l][3]),i,e.dataObject.link[l][3]),i,e.dataObject.link[l][2],e.dataObject.link[l][3]),c=o,"reference"in(d=e.dataObject.link[l][3])&&(d.r=d.reference),"r"in d&&Array.isArray(d.r)&&d.r.length>0&&(c.reference=d.r),"splits"in(o=c)!=0&&1===o.splits||(e.summary.link+=o.level),e=y(e,o,i));return e}(c=function(e){var t,n,a,i,o,l={0:{link:[[0],[0],[0],{}],network:[[0],{"en-US":"Unknown"},{}],node:[0,0,{}],place:[0,0,{}],service:[[0],{"en-US":"Unknown"},{}]}};if("sanitize"in r&&!1===r.sanitize)return e;"object"!=typeof e.dataObject&&(e.dataObject={}),"meta"in e.dataObject==0&&(e.dataObject.meta={}),"schema"in e.dataObject.meta!=0&&e.dataObject.meta.schema in l!=0||(e.dataObject.meta.schema="0"),t=Object.keys(l[e.dataObject.meta.schema]);for(n=0;n<t.length;n+=1)t[n]in e.dataObject&&"object"!=typeof e.dataObject[t[n]]&&delete e.dataObject[t[n]];for(n=0;n<t.length;n+=1){t[n]in e.dataObject!=0&&0!=Array.isArray(e.dataObject[t[n]])&&0!==e.dataObject[t[n]].length||(e.dataObject[t[n]]=[l[e.dataObject.meta.schema][t[n]]]);for(a=0;a<e.dataObject[t[n]].length;a+=1){if(e.dataObject[t[n]][a].length<l[e.dataObject.meta.schema][t[n]].length)for(i=e.dataObject[t[n]][a].length-1;i<l[e.dataObject.meta.schema][t[n]].length;i+=1)e.dataObject[t[n]][a].push(l[e.dataObject.meta.schema][t[n]][i]);for(i=0;i<l[e.dataObject.meta.schema][t[n]].length;i+=1)if(typeof e.dataObject[t[n]][a][i]!=typeof l[e.dataObject.meta.schema][t[n]][i]&&("node"!==t[n]&&"place"!==t[n]||2!==i||"number"!=typeof e.dataObject[t[n]][a][i]?"link"!==t[n]||"number"!=typeof e.dataObject[t[n]][a][i]||0!==i&&1!==i?e.dataObject[t[n]][a][i]=l[e.dataObject.meta.schema][t[n]][i]:e.dataObject[t[n]][a][i]=[e.dataObject[t[n]][a][i]]:e.dataObject[t[n]][a][i]={p:e.dataObject[t[n]][a][i]}),Array.isArray(e.dataObject[t[n]][a][i]))for(o=0;o<e.dataObject[t[n]][a][i].length;o+=1)typeof e.dataObject[t[n]][a][i][o]!=typeof l[e.dataObject.meta.schema][t[n]][i][0]&&(e.dataObject[t[n]][a][i][o]=l[e.dataObject.meta.schema][t[n]][i][0])}}return e}(c),t,n,a,r)),l=r,o=function(e){var t,n,a,r,i=e.dataObject.node.length-1,o=e.dataObject.place.length-1,l={};for(e.node=[],e.place=[],r=0;r<e.serviceNode.length;r+=1)void 0!==e.serviceNode[r]&&r<=i&&(e.summary.node+=1,n={circle:[(t=e.dataObject.node[r])[0],t[1]],value:e.serviceNode[r].service},"reference"in e.serviceNode[r]&&(n.link=d(e.serviceNode[r].reference)),"reference"in t[2]&&(t[2].r=t[2].reference),"r"in t[2]&&t[2].r.length>0&&(n.node=t[2].r),e.node.push(n),"place"in t[2]&&(t[2].p=t[2].place),"p"in t[2]&&t[2].p in l==0&&(l[t[2].p]=t[2].p,t[2].p<=o&&t[2].p>=0&&(a=0,"p"in e.dataObject.place[t[2].p][2]?a=e.dataObject.place[t[2].p][2].p:"population"in e.dataObject.place[t[2].p][2]&&(a=e.dataObject.place[t[2].p][2].population),a>0&&(e.summary.place+=a,e.place.push({circle:[e.dataObject.place[t[2].p][0],e.dataObject.place[t[2].p][1]],value:a})))));return delete e.serviceNode,e}(o=c),c="geoJSON"in l!=0&&Array.isArray(l.geoJSON)?function(e,t){var n,a,r,i,o,l={type:"FeatureCollection",features:[]};for(r=0;r<t.length;r+=1)if(t[r]in e)for(i=0;i<e[t[r]].length;i+=1)if("value"in e[t[r]][i]&&("circle"in e[t[r]][i]||"polyline"in e[t[r]][i])){if("circle"in e[t[r]][i])n={type:"Point",coordinates:e[t[r]][i].circle};else for(n={type:"LineString",coordinates:[]},o=0;o<e[t[r]][i].polyline.length;o+=1)n.coordinates.push(e[t[r]][i].polyline[o]);a={type:t[r],value:e[t[r]][i].value},"link"in e[t[r]][i]&&(a.link=e[t[r]][i].link),"node"in e[t[r]][i]&&(a.node=e[t[r]][i].node),l.features.push({type:"Feature",geometry:n,properties:a})}return l}(o,l.geoJSON):o,s(i,c,r)}catch(e){return s(i=e,c,r)}}};