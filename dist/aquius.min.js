var aquius=aquius||{init:function(e,t){"use strict";var n,r,a=document.getElementById(e);function i(e,t){function n(e,t){var n,r=[];for(n=0;n<t.length;n+=1)("here"===t[n]||t[n]in e.dataObject&&e.dataObject[t[n]].length>0)&&r.push(t[n]);return r}return n(e,"boolean"==typeof t&&!0===t?["link","place","node"]:["place","link","node","here"])}function o(e,t,n){var r,a,i,o=document.createElement(e);if(void 0!==t)for(r=Object.keys(t),i=0;i<r.length;i+=1)o[r[i]]=t[r[i]];if(void 0!==n)for(a=Object.keys(n),i=0;i<a.length;i+=1)o.style[a[i]]=n[a[i]];return o}function l(e,t){for(var n,r=document.getElementById(e._id),a=o("div",{},{margin:"0 auto","max-width":"800px","text-align":"center"});r.firstChild;)r.removeChild(r.firstChild);return"map"in e&&"function"==typeof e.map.remove&&(e.map.remove(),r.className=""),n=void 0!==t?"🚫":"🌍",a.appendChild(o("div",{textContent:n},{"font-size":"1000%"})),void 0!==t&&a.appendChild(o("p",{textContent:t.toString()})),r.appendChild(a),void 0===t}function c(e,t){var n,r,a,i,o;function c(t,n){var r;"css"===t.split(".").pop()?((r=document.createElement("link")).rel="stylesheet",r.href=t):((r=document.createElement("script")).type="text/javascript",r.src=t),r.onreadystatechange=n,r.onload=n,r.onerror=function(){return l(e,{message:"Could not load "+t})},document.head.appendChild(r)}if(r=function(){var t,n,r;"dataset"in e&&"string"==typeof e.dataset?(t=e.dataset,n=function(t){return e.dataObject=t,O(e)},(r=new XMLHttpRequest).onreadystatechange=function(){if(4===r.readyState){if(200!==r.status)return l(e,{message:r.status+": Could not load "+t});var a=JSON.parse(r.responseText);n&&n(a)}},r.open("GET",t),r.send()):O(e)},0===t.length)r();else for(a=0,i=function(){n=arguments,(a+=1)>=t.length&&r.call(this,n)},o=0;o<t.length&&!(o>=t.length);o+=1)c(t[o],i)}function d(e,t){return e.t in e.translation&&t in e.translation[e.t]?e.translation[e.t][t]:e.locale in e.translation&&t in e.translation[e.locale]?e.translation[e.locale][t]:""}function s(e,t){var n,r,a,i=Object.keys(e._toLocale);for(a=0;a<i.length;a+=1)(n=document.getElementById(i[a]))&&""!==(r=d(e,e._toLocale[i[a]]))&&(n.textContent=r);return void 0!==t&&!0===t&&h(e,!0),e}function p(e,t){var n={};function r(){var e,t={},n=decodeURIComponent(document.location.hash.trim()).slice(1).split("/");for(e=0;e<n.length;e+=1)n[e].length>=2&&/^[a-z\-()]$/.test(n[e][0])&&(t[n[e][0]]=n[e].slice(1));return t}function a(e){try{return null!==sessionStorage.getItem(e._id)?JSON.parse(sessionStorage.getItem(e._id)):{}}catch(e){return{}}}return!sessionStorage||"uiStore"in e!=!1&&!0!==e.uiStore||(n="object"==typeof t?function(e,t){var n,r=a(e),i=Object.keys(t);for(n=0;n<i.length;n+=1)r[i[n]]=t[i[n]];try{sessionStorage.setItem(e._id,JSON.stringify(r))}catch(e){}return r}(e,t):a(e)),"uiHash"in e==!0&&!0===e.uiHash&&(n="object"==typeof t?function(e,t){var n,a,i,o=r(),l=Object.keys(t);for(i=0;i<l.length;i+=1)1===l[i].length&&/^[a-z\-()]$/.test(l[i])&&(o[l[i]]=t[l[i]]);for(n=Object.keys(o),a=[],i=0;i<n.length;i+=1)a.push(n[i]+encodeURIComponent(o[n[i]]));return location.hash="#"+a.join("/"),o}(0,t):r()),n}function u(e){var t,n,r,a,l,c,d,u,f,b,g,m,O,v,j,y,k,_,x,C,w,S,N,L,A,M,I,E,T,z,P,U,q;function H(e,t){return e._layer[t].on("add",function(){-1===e.v.indexOf(t.charAt(0))&&(e.v+=t.charAt(0),p(e,{v:e.v}))}),e._layer[t].on("remove",function(){e.v=e.v.replace(t.charAt(0),""),p(e,{v:e.v})}),e}function B(e,t,n,r,a){var i,l,c;if(n in e.dataObject&&Array.isArray(e.dataObject[n])&&e.dataObject[n].length>1&&!0===e[a]){for(l=[],c=0;c<e.dataObject[n].length;c+=1)l.push({value:c,id:e._id+n+c}),e._toLocale[e._id+n+c]="_"+n+c;(i=function(e,t,n,r){var a,i,l,c,d;for(void 0===r&&(r={}),a=o("div",{id:t},r),d=0;d<e.length;d+=1)l=o("label"),i=o("input",{type:"radio",name:t}),"value"in e[d]&&(i.value=e[d].value,void 0!==n&&e[d].value===n&&(i.checked="checked")),l.appendChild(i),c=o("span"),"id"in e[d]&&(c.id=e[d].id),"label"in e[d]&&(c.textContent=e[d].label),l.appendChild(c),a.appendChild(l);return a}(l,e._id+n,e[r],{"border-top":"1px solid #ddd","margin-top":"4px","padding-top":"4px"})).addEventListener("change",function(){e[r]=parseInt(document.querySelector("input[name='"+e._id+n+"']:checked").value,10);var t={};t[r]=e[r],p(e,t),h(e)},!1),t.appendChild(i)}return e}function F(e){return"_control"in e&&delete e.control,s(e)}return e._toLocale={},e._layer={},e=function(e){var t,n,r=["_datasetName","_datasetAttribution"];for(n=0;n<r.length;n+=1)e._toLocale[e._id+r[n]]=r[n],r[n]=e._id+r[n];return t=o("span"),"meta"in e.dataObject&&"url"in e.dataObject.meta&&"string"==typeof e.dataObject.meta.url?t.appendChild(o("a",{href:e.dataObject.meta.url,id:r[0]})):t.appendChild(o("span",{id:r[0]})),t.appendChild(document.createTextNode(" ")),t.appendChild(o("span",{id:r[1]})),e.map.attributionControl.addAttribution(t.outerHTML),e}(e),n=e,b=Object.keys(n.translation),!0===n.uiLocale&&b.length>1&&((r=n.leaflet.control({position:"topright"})).onAdd=function(){for(a=o("div",{className:"aquius-locale",id:n._id+"locale"},{"background-color":"#fff","border-bottom":"2px solid rgba(0,0,0,0.3)","border-left":"2px solid rgba(0,0,0,0.3)","border-radius":"0 0 0 5px",margin:0,padding:"0 0 1px 1px"}),n.leaflet.DomEvent.disableClickPropagation(a),l=n._id+"langname",a.appendChild(o("label",{id:l,for:n._id+"lang"},{display:"none"})),n._toLocale[l]="language",u=[],f=0;f<b.length;f+=1)c="lang"in n.translation[b[f]]?n.translation[b[f]].lang:b[f],u.push({value:b[f],label:c});return(d=function(e,t){var n,r,a=o("select");for(r=0;r<e.length;r+=1)n=o("option"),"value"in e[r]&&(n.value=e[r].value,e[r].value===t&&(n.selected="selected")),"label"in e[r]&&(n.textContent=e[r].label),"id"in e[r]&&(n.id=e[r].id),a.appendChild(n);return a}(u,n.t)).id=n._id+"lang",d.style["background-color"]="#fff",d.style.border="none",d.style.color="#000",d.style.font='12px/1.5 "Helvetica Neue", Arial, Helvetica, sans-serif',d.addEventListener("change",function(){n.t=document.getElementById(n._id+"lang").value,p(n,{t:n.t}),s(n,!0)},!1),a.appendChild(d),a},r.addTo(n.map)),!0===(g=e=n).uiPanel&&((m=g.leaflet.control({position:"bottomleft"})).onAdd=function(){for(O=o("div",{className:"aquius-panel",id:g._id+"panel"},{"background-color":"rgba(255,255,255,"+g.panelOpacity+")","font-weight":"bold",padding:"0 3px","border-radius":"5px"}),g.leaflet.DomEvent.disableClickPropagation(O),y=i(g,!0),k=0;k<y.length;k+=1)(v=o("span",{},{color:g[y[k]+"Color"],margin:"0 0.1em"})).appendChild(o("span",{id:g._id+y[k]+"value",textContent:"0"},{"font-size":Math.round(200*g.panelScale).toString()+"%",margin:"0 0.1em"})),j=g._id+y[k]+"label",v.appendChild(o("span",{id:j},{"font-size":Math.round(100*g.panelScale).toString()+"%",margin:"0 0.1em","vertical-align":"20%"})),g._toLocale[j]=y[k],O.appendChild(v),O.appendChild(document.createTextNode(" "));return O},m.addTo(g.map)),(t=function(e){var t,n;if("_control"in e)for(t=e._control.getContainer().childNodes,n=0;n<t.length;n+=1)if("FORM"===t[n].tagName)return t[n];return!1}(e=function(e){var t,n,r=i(e).reverse();for(e._control=e.leaflet.control.layers(),n=0;n<r.length;n+=1)e._layer[r[n]]=e.leaflet.layerGroup(),-1!==(e=H(e,r[n])).v.indexOf(r[n].charAt(0))&&e._layer[r[n]].addTo(e.map),t=e._id+r[n]+"name",e._toLocale[t]=r[n],e._control.addOverlay(e._layer[r[n]],o("span",{id:t},{color:e[r[n]+"Color"]}).outerHTML);return e._control.addTo(e.map),e}(e=g)))?(e=B(e=B(e,t,"network","n","uiNetwork"),t,"service","r","uiService"),x=t,!0===(_=e).uiScale&&(N=o("label"),w=_._id+"scalename",N.appendChild(o("div",{id:w},{"border-top":"1px solid #ddd","margin-top":"4px","padding-top":"4px","text-align":"center"})),_._toLocale[w]="scale",C=o("div",{},{"text-align":"center"}),(S=o("input",{id:_._id+"scale",type:"range",min:0,max:10,value:_.s})).addEventListener("change",function(){_.s=parseInt(document.getElementById(_._id+"scale").value,10),p(_,{s:_.s}),h(_,!0)},!1),C.appendChild(S),N.appendChild(C),x.appendChild(N)),A=t,!0===(L=e=_).uiShare&&Blob&&(T=o("div",{},{"border-top":"1px solid #ddd","margin-top":"4px","padding-top":"4px","text-align":"center"}),""!==L.dataset&&(z=L._id+"embed",(M=o("a",{id:z,download:L._id+"-embed.txt",role:"button"},{cursor:"pointer"})).addEventListener("click",function(){var e,t;M.href=window.URL.createObjectURL(((t=[]).push(o("div",{id:(e=L)._id},{height:"100%"}).outerHTML),t.push(o("script",{src:function(){var e,t=document.getElementsByTagName("script");for(e=0;e<t.length;e+=1)if(-1!==t[e].src.indexOf("aquius"))return t[e].src;return"\x3c!--Script URL--\x3e"}()}).outerHTML),t.push(o("script",{textContent:'window.addEventListener("load",function(){aquius.init("'+e._id+'",'+JSON.stringify(function(e){var t,n={base:[{options:{attribution:"&copy; <a href='https://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors",maxZoom:18},type:"",url:"http://{s}.tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png"}],c:-1.43,dataObject:{},dataset:"",hereColor:"#080",k:54.54,leaflet:{},linkColor:"#f00",linkScale:1,locale:"en-US",m:9,map:{},minWidth:2,minZoom:0,n:0,network:[],networkAdd:!0,nodeColor:"#000",nodeScale:1,panelOpacity:.7,panelScale:1,placeColor:"#00f",placeOpacity:.5,placeScale:1,v:"hlnp",r:0,s:5,uiHash:!1,uiLocale:!0,uiNetwork:!0,uiPanel:!0,uiScale:!0,uiService:!0,uiShare:!0,uiStore:!0,t:"en-US",translation:{},x:10.35,y:50.03,z:4},r={},a=Object.keys(e);for(t=0;t<a.length;t+=1)"_"!==a[t].charAt(0)&&-1===["base","dataObject","leaflet","map","network","translation","uiHash"].indexOf(a[t])&&e[a[t]]!==n[a[t]]&&(r[a[t]]=e[a[t]]);return r}(e))+")});"}).outerHTML),new Blob([t.join("\n")],{type:"text/plain;charset=utf-8"})))},!1),L._toLocale[z]="embed",T.appendChild(M),T.appendChild(document.createTextNode(" | "))),P=i(L),z=L._id+"export",(I=o("a",{id:z,download:L._id+"-export.json",role:"button"},{cursor:"pointer"})).addEventListener("click",function(){for(U={geoJSON:[],network:L.n,range:5e6/Math.pow(2,L.m),service:L.r,x:L.c,y:L.k},q=0;q<P.length;q+=1)-1!==L.v.indexOf(P[q].charAt(0))&&U.geoJSON.push(P[q]);"object"==typeof L._here&&"dataObject"in L._here?(E=L._here.dataObject,U.sanitize=!1):(E=L.dataObject,U.sanitize=!0),I.href=window.URL.createObjectURL(new Blob([JSON.stringify(L._call(E,U))],{type:"application/json;charset=utf-8"}))},!1),L._toLocale[z]="export",T.appendChild(I),A.appendChild(T)),F(e=L)):F(e)}function h(e,t){var n,r;void 0===t||!0!==t||"object"!=typeof e._here?(r={_configOptions:e,callback:f,network:e.n,range:5e6/Math.pow(2,e.m),service:e.r,x:e.c,y:e.k},"object"==typeof e._here&&"dataObject"in e._here?(n=e._here.dataObject,r.sanitize=!1):(n=e.dataObject,r.sanitize=!0),e._call(n,r)):m(e)}function f(e,t,n){"_configOptions"in n&&(void 0===e?(n._configOptions._here=t,m(n._configOptions)):l(n._configOptions,e))}function b(e,t){var n,r=[];if("undefined"===t||!Array.isArray(t))return e.linkColor;for(n=0;n<t.length;n+=1)"c"in t[n]&&"reference"in e.dataObject&&"color"in e.dataObject.reference&&t[n].c>=0&&t[n].c<e.dataObject.reference.color.length&&-1===r.indexOf(e.dataObject.reference.color[t[n].c])&&r.push(e.dataObject.reference.color[t[n].c]);return 0===r.length?e.linkColor:1===r.length?r[0]:function(e){var t,n,r="#",a=[[],[],[]];for(n=0;n<e.length;n+=1)7===e[n].length&&"#"===e[n][0]&&(a[0].push(parseInt(e[n].slice(1,3),16)),a[1].push(parseInt(e[n].slice(3,5),16)),a[2].push(parseInt(e[n].slice(5,7),16)));for(n=0;n<a.length;n+=1){if(0===a[n].length)return r+e[0];(t=Math.round(a[n].reduce(function(e,t){return e+t},0)/a[n].length))<=16&&(r+="0"),r+=t.toString(16)}return r}(r)}function g(e,t,n,r,a){var i,l,c,d,s,p;function u(e,t,n,r,a){var i,l,c,d,s="[*]";if(void 0!==t&&Array.isArray(t)){for(i=o("div",{},{margin:"0.3em 0"}),r?i.style["font-weight"]="bold":i.style["line-height"]="2em",void 0!==a&&""!==a&&i.appendChild(o("div",{textContent:a},{"line-height":"1.2em",margin:"0"})),d=0;d<t.length;d+=1)"n"in t[d]&&("u"in t[d]&&"reference"in e.dataObject&&"url"in e.dataObject.reference&&t[d].u>=0&&t[d].u<e.dataObject.reference.url.length?(-1!==(c=o("a",{href:e.dataObject.reference.url[t[d].u]})).href.lastIndexOf(s)&&("i"in t[d]?c.href=c.href.replace(s,t[d].i):"n"in t[d]?c.href=c.href.replace(s,t[d].n):c.href=c.href.replace(s,"")),r||(c.style.color="#000",c.style["text-decoration"]="none")):c=o("span"),c.textContent=t[d].n,r||(c.style.padding="0.2em 0.3em",c.style.border="1px solid #000",c.style["white-space"]="nowrap","reference"in e.dataObject&&"color"in e.dataObject.reference&&("c"in t[d]&&t[d].c>=0&&t[d].c<e.dataObject.reference.color.length&&(c.style["background-color"]=e.dataObject.reference.color[t[d].c],c.style["border-color"]=e.dataObject.reference.color[t[d].c]),"t"in t[d]&&t[d].t>=0&&t[d].t<e.dataObject.reference.color.length&&(c.style.color=e.dataObject.reference.color[t[d].t]))),i.appendChild(c),d<t.length-1&&(l=r?"|":" ",i.appendChild(document.createTextNode(l))));n.appendChild(i)}return n}if(c=u(e,a,c=o("div",{},{color:"#000"}),!0),n=n<10&&n%1!=0?(Math.round(10*n)/10).toString():Math.round(n).toString(),c.appendChild(o("div",{textContent:t+": "+n},{margin:"0.3em 0"})),"reference"in e.dataObject&&"product"in e.dataObject.reference&&e.dataObject.reference.product.length>1&&!0===e.uiNetwork){for(l=[],d=[],s=0;s<r.length;s+=1)if("p"in r[s])for(p=0;p<r[s].p.length;p+=1)void 0===d[r[s].p[p]]&&(d[r[s].p[p]]=[]),d[r[s].p[p]].push(r[s]);else l.push(r[s]);for(s=0;s<d.length;s+=1)void 0!==d[s]&&(s<e.dataObject.reference.product.length?e.t in e.dataObject.reference.product[s]?d[s].unshift(e.dataObject.reference.product[s][e.t]):e.locale in e.dataObject.reference.product[s]?d[s].unshift(e.dataObject.reference.product[s][e.locale]):(i=Object.keys(e.dataObject.reference.product[s])).length>0?d[s].unshift(e.dataObject.reference.product[s][i[0]]):d[s].unshift(""):l=l.concat(d[s]));for(d.sort(),s=0;s<d.length;s+=1)void 0!==d[s]&&(c=u(e,d[s].slice(1),c,!1,d[s][0]))}else l=r;return l.length>0&&(c=u(e,l,c,!1)),c}function m(e){var t,n,r,a,o,l,c,s=i(e);for(l=0;l<s.length;l+=1)s[l]in e._layer&&e._layer[s[l]].clearLayers();if(!0===e.uiPanel&&"summary"in e._here)for(n=Object.keys(e._here.summary),l=0;l<n.length;l+=1)if(r=document.getElementById(e._id+n[l]+"value"))try{r.textContent=new Intl.NumberFormat(e.t).format(Math.round(e._here.summary[n[l]]))}catch(t){r.textContent=Math.round(e._here.summary[n[l]]).toString()}if("place"in e._here&&"place"in e.dataObject&&e.dataObject.place.length>0)for(o=Math.exp((e.s-5)/2)*e.placeScale/666,a=d(e,"place"),l=0;l<e._here.place.length;l+=1)"circle"in e._here.place[l]&&"value"in e._here.place[l]&&e._here.place[l].circle.length>1&&e.leaflet.circleMarker(e.leaflet.latLng([e._here.place[l].circle[1],e._here.place[l].circle[0]]),{fill:!0,fillColor:e.placeColor,fillOpacity:e.placeOpacity,radius:Math.ceil(Math.sqrt(e._here.place[l].value*o)),stroke:!1}).bindTooltip(Math.round(e._here.place[l].value).toString()+" "+a).addTo(e._layer.place);if("link"in e._here)for(o=Math.exp((e.s-5)/2)*e.linkScale*4,a=d(e,"link"),l=0;l<e._here.link.length;l+=1)if("polyline"in e._here.link[l]&&"value"in e._here.link[l]){for(t=[],c=0;c<e._here.link[l].polyline.length;c+=1)e._here.link[l].polyline[c].length>1&&t.push([e._here.link[l].polyline[c][1],e._here.link[l].polyline[c][0]]);e.leaflet.polyline(t,{color:b(e,e._here.link[l].link),weight:Math.ceil(Math.log(1+e._here.link[l].value*(1/o))*o+e.minWidth)}).on("click",function(t){var n=t.target.getPopup(),r=parseInt(n.getContent(),10);Number.isNaN(r)||(n.setContent(g(e,a,e._here.link[r].value,e._here.link[r].link)),n.update())}).bindPopup(l).addTo(e._layer.link)}if("node"in e._here)for(o=Math.exp((e.s-5)/2)*e.nodeScale*2,a=d(e,"link"),l=0;l<e._here.node.length;l+=1)"circle"in e._here.node[l]&&"value"in e._here.node[l]&&e._here.node[l].circle.length>1&&e.leaflet.circleMarker(e.leaflet.latLng([e._here.node[l].circle[1],e._here.node[l].circle[0]]),{color:e.nodeColor,fill:!1,radius:Math.ceil(Math.log(1+e._here.node[l].value*(1/(2*o)))*o+e.minWidth/2),weight:1}).on("click",function(t){var n=t.target.getPopup(),r=parseInt(n.getContent(),10);Number.isNaN(r)||(n.setContent(g(e,a,e._here.node[r].value,e._here.node[r].link,e._here.node[r].node)),n.update())}).bindPopup(l).addTo(e._layer.node);"here"in e._here&&e._here.here.length>0&&"circle"in e._here.here[0]&&"value"in e._here.here[0]&&e._here.here[0].circle.length>1&&e.leaflet.circle(e.leaflet.latLng([e._here.here[0].circle[1],e._here.here[0].circle[0]]),{color:e.hereColor,fill:!1,interactive:!1,radius:e._here.here[0].value,weight:2}).addTo(e._layer.here)}function O(e){if("object"==typeof L&&"version"in L==!1)return l(e,{message:"Leaflet failed to load"});e.leaflet=L,h(e=u(e=function(e){var t;if("setView"in e.map==0||"on"in e.map==0||"getCenter"in e.map==0||"getZoom"in e.map==0||"attributionControl"in e.map==0){for(;document.getElementById(e._id).firstChild;)document.getElementById(e._id).removeChild(document.getElementById(e._id).firstChild);e.map=e.leaflet.map(e._id,{minZoom:e.minZoom,preferCanvas:!0})}for(e.map.attributionControl.addAttribution('<a href="https://timhowgego.github.io/Aquius/">Aquius</a>'),e.map.setView([e.y,e.x],e.z),e.map.on("moveend",function(){var t,n=e.map.getCenter();e.z=e.map.getZoom(),t=Math.ceil(e.z/3),e.x=parseFloat(n.lng.toFixed(t)),e.y=parseFloat(n.lat.toFixed(t)),p(e,{x:e.x,y:e.y,z:e.z})}),e.map.on("click",function(t){var n=Math.ceil(e.z/3),r=t.latlng;e.c=parseFloat(r.lng.toFixed(n)),e.k=parseFloat(r.lat.toFixed(n)),e.m=e.z,p(e,{c:e.c,k:e.k,m:e.m}),h(e)}),t=0;t<e.base.length;t+=1)"url"in e.base[t]&&("options"in e.base[t]==0&&(e.base[t].options={}),"type"in e.base[t]&&"wms"===e.base[t].type?e.leaflet.tileLayer.wms(e.base[t].url,e.base[t].options).addTo(e.map):e.leaflet.tileLayer(e.base[t].url,e.base[t].options).addTo(e.map));return e}(e=function(e){var t,n,r,a,i,o,l,c,d,s,u,h,f={base:[{options:{attribution:"&copy; <a href='https://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors",maxZoom:18},type:"",url:"http://{s}.tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png"}],c:-1.43,dataObject:{},dataset:"",hereColor:"#080",k:54.54,leaflet:{},linkColor:"#f00",linkScale:1,locale:"en-US",m:9,map:{},minWidth:2,minZoom:0,n:0,network:[],networkAdd:!0,nodeColor:"#000",nodeScale:1,panelOpacity:.7,panelScale:1,placeColor:"#00f",placeOpacity:.5,placeScale:1,v:"hlnp",r:0,s:5,uiHash:!1,uiLocale:!0,uiNetwork:!0,uiPanel:!0,uiScale:!0,uiService:!0,uiShare:!0,uiStore:!0,t:"en-US",translation:{},x:10.35,y:50.03,z:4},b=Object.keys(f),g=[];function m(e,t){var n,r,a,i={};for(r=0;r<e.dataObject[t].length;r+=1)if(e.dataObject[t][r].length>1&&"object"==typeof e.dataObject[t][r][1])for(n=Object.keys(e.dataObject[t][r][1]),a=0;a<n.length;a+=1)n[a]in i==0&&(i[n[a]]={}),i[n[a]]["_"+t+r]=e.dataObject[t][r][1][n[a]];return i}for("object"!=typeof e.dataObject&&(e.dataObject={}),l=0;l<b.length;l+=1)"en-US"===f[b[l]]&&g.push(b[l]),b[l]in e!=0&&typeof e[b[l]]==typeof f[b[l]]||("option"in e.dataObject&&b[l]in e.dataObject.option&&typeof e.dataObject.option[b[l]]==typeof f[b[l]]?e[b[l]]=e.dataObject.option[b[l]]:e[b[l]]=f[b[l]]);for(n=p(e),r=Object.keys(n),l=0;l<r.length;l+=1)-1!==b.indexOf(r[l])&&("number"==typeof e[r[l]]?!1===Number.isNaN(parseFloat(n[r[l]]))&&(e[r[l]]=parseFloat(n[r[l]])):"string"==typeof e[r[l]]&&(e[r[l]]=n[r[l]].toString()));e.network.length>0&&("network"in e.dataObject&&Array.isArray(e.dataObject.network)?"networkAdd"in e&&!1===e.networkAdd?e.dataObject.network=e.network:e.dataObject.network=e.dataObject.network.concat(e.network):e.dataObject.network=e.network),e.z<e.minZoom&&(e.z=e.minZoom),e.m<e.minZoom&&(e.m=e.minZoom),a=[],"translation"in e.dataObject&&a.push(e.dataObject.translation),t=[["network","n"],["service","r"]];for(l=0;l<t.length;l+=1)s=e,u=t[l][1],h=t[l][0],s[u]=parseInt(s[u],10),s[u]<0?s[u]=0:h in s.dataObject&&Array.isArray(s.dataObject[h])&&s[u]>=s.dataObject[h].length&&(s[u]=s.dataObject[h].length-1),e=s,t[l][0]in e.dataObject&&Array.isArray(e.dataObject[t[l][0]])&&a.push(m(e,t[l][0]));"meta"in e.dataObject&&("name"in e.dataObject.meta||"attribution"in e.dataObject.meta)&&a.push(function(e){var t,n,r={};if("meta"in e.dataObject&&"name"in e.dataObject.meta&&"object"==typeof e.dataObject.meta.name)for(t=Object.keys(e.dataObject.meta.name),n=0;n<t.length;n+=1)t[n]in r==0&&(r[t[n]]={}),r[t[n]]._datasetName=e.dataObject.meta.name[t[n]].toString();if("meta"in e.dataObject&&"attribution"in e.dataObject.meta&&"object"==typeof e.dataObject.meta.attribution)for(t=Object.keys(e.dataObject.meta.attribution),n=0;n<t.length;n+=1)t[n]in r==0&&(r[t[n]]={}),r[t[n]]._datasetAttribution=e.dataObject.meta.attribution[t[n]].toString();return r}(e)),a.push({"en-US":{lang:"English",embed:"Embed",export:"Export",here:"Here",language:"Language",link:"Services",network:"Network",node:"Stops",place:"People",scale:"Scale",service:"Period"},"es-ES":{lang:"Español",embed:"Insertar",export:"Exportar",here:"Aquí",language:"Idioma",link:"Servicios",network:"Red",node:"Paradas",place:"Personas",scale:"Escala",service:"Período"}});for(l=0;l<a.length;l+=1)for(i=Object.keys(a[l]),c=0;c<i.length;c+=1){i[c]in e.translation==0&&(e.translation[i[c]]={}),o=Object.keys(a[l][i[c]]);for(d=0;d<o.length;d+=1)o[d]in e.translation[i[c]]==0&&(e.translation[i[c]][o[d]]=a[l][i[c]][o[d]])}for(l=0;l<g.length;l+=1)e[g[l]]in e.translation==0&&(e[g[l]]=f[g[l]]);return e}(e))))}if(!a)return!1;for(;a.firstChild;)a.removeChild(a.firstChild);return Object.keys&&[].indexOf&&"object"==typeof JSON?("object"!=typeof t&&(t={}),t._id=e,t._call=this.here,t._here=void 0,l(n=t),"dataObject"in n==0||"object"!=typeof n.dataObject?n.dataObject={}:"dataset"in n&&delete n.dataset,r="leaflet"in n&&"object"==typeof n.leaflet&&"version"in n.leaflet&&!1===Number.isNaN(parseInt(n.leaflet.version.split(".")[0],10))&&parseInt(n.leaflet.version.split(".")[0],10)>=1?[]:["https://unpkg.com/leaflet@1.3.4/dist/leaflet.css","https://unpkg.com/leaflet@1.3.4/dist/leaflet.js"],"undefined"!=typeof Promise?function(e,t){var n,r=[];function a(e){return new Promise(function(t,n){var r;"css"===e.split(".").pop()?((r=document.createElement("link")).rel="stylesheet",r.href=e):(r=document.createElement("script")).src=e,r.onload=t,r.onerror=n,document.head.appendChild(r)})}for(n=0;n<t.length;n+=1)r.push(a(t[n]));"dataset"in e&&"string"==typeof e.dataset&&r.push(fetch(e.dataset)),0===r.length?O(e):Promise.all(r).then(function(t){return"dataset"in e&&"string"==typeof e.dataset?t[r.length-1].json():e.dataObject}).then(function(t){e.dataObject=t,O(e)}).catch(function(t){return l(e,t)})}(n,r):c(n,r),!0):(a.appendChild(document.createTextNode("Browser not supported by Aquius: Try a modern browser")),a.style.height="auto",!1)},here:function(e,t){"use strict";var n,r,a,i={};function o(e){var t,n,r=Object.keys(e).sort();if(0===r.length)return[];if(1===r.length)return[e[r[0]]];for(t=[],n=0;n<r.length;n+=1)t.push(e[r[n]]);return t}function l(e,t,n){return void 0===e&&"error"in t&&(e=new Error(t.error)),"callback"in n?(n.callback(e,t,n),!0):t}if(!Object.keys||![].indexOf||"object"!=typeof JSON)return i.error="Unsupported browser",l(n,i,t);if("x"in t&&"number"!=typeof t.x||"y"in t&&"number"!=typeof t.y||"range"in t&&"number"!=typeof t.range)return i.error="Here parameters not numeric",l(n,i,t);"object"!=typeof t&&(t={}),i.dataObject=e,"x"in t&&"y"in t&&"range"in t&&(i.here=[{circle:[t.x,t.y],value:t.range}]),i.summary={link:0,node:0,place:0};try{return i=function(e){function t(e,t){var n,r=t.length-1,a=[];for(n=0;n<e.length;n+=1)e[n]<=r&&e[n]>=0&&a.push([t[e[n]][0],t[e[n]][1]]);return a}return delete(e=function(e,n){var r,a,i,l,c,d=Object.keys(n.od);for(e.link=[],l=0;l<d.length;l+=1){for(i=[n.od[d[l]].pop()];n.od[d[l]].length>0;)for(a=n.od[d[l]].pop(),c=0;c<i.length;c+=1){if(a[0]===i[c][0]){i[c].unshift(a[1]);break}if(a[1]===i[c][0]){i[c].unshift(a[0]);break}if(a[0]===i[c][i.length-1]){i[c].push(a[1]);break}if(a[1]===i[c][i.length-1]){i[c].push(a[0]);break}if(c===i.length-1){i.push(a);break}}for(c=0;c<i.length;c+=1)r={polyline:t(i[c],e.dataObject.node),value:n.data[d[l]].service},"reference"in n.data[d[l]]&&(r.link=o(n.data[d[l]].reference)),e.link.push(r)}return e}(e,function(e){var t,n,r,a,i,o,l=Object.keys(e),c={od:{},data:{}};for(i=0;i<l.length;i+=1)for(r=l[i]-0,t=Object.keys(e[r]),o=0;o<t.length;o+=1)n=t[o]-0,a=e[r][n].service.toString(),"reference"in e[r][n]&&(a+=":"+Object.keys(e[r][n].reference).join(":")),a in c.od==0&&(c.od[a]=[],c.data[a]=e[r][n]),c.od[a].push([r,n]);return c}(e.serviceLink))).serviceLink,e}(i=function(e,t){var n,r,a,i,o;function l(e,t){var n;if(!("product"in e))return!0;if(1===t.length){if(t[0]in e.product)return!0}else for(n=0;n<t.length;n+=1)if(t[n]in e.product)return!0;return!1}function c(e,t,n){var r;for(r=0;r<t.length;r+=1)if(t[r]in e.here){if("s"in n==0&&"setdown"in n==0)return!0;if("s"in n&&Array.isArray(n.s)&&-1===n.s.indexOf(t[r]))return!0;if("setdown"in n&&Array.isArray(n.setdown)&&-1===n.setdown.indexOf(t[r]))return!0}return!1}function d(e,t,n){var r;if(1===n.length&&("service"in t==0||0 in t.service))return e.level=n[0],e;for(e.level=0,r=0;r<n.length;r+=1)("service"in t==0||r in t.service)&&(e.level+=n[r]);return e}function s(e,t,n,r){var a;if("circular"in r&&(r.c=r.circular),n.length>1&&"c"in r&&(r.c||1===r.c)&&(e.circular=n.length-1),"direction"in r&&(r.d=r.direction),"d"in r&&(r.d||1===r.d)){for(e.direction=1,a=0;a<n.length;a+=1)if(n[a]in t.here){"circular"in e?(e.route=n.slice(0,-1),e.route=e.route.slice(a).concat(e.route.slice(0,a)),e.route.push(e.route[0])):e.route=n.slice(a);break}}else e.route=n;return"route"in e==0&&(e.route=[]),e}function p(e,t,n){var r,a;if("pickup"in n&&(n.u=n.pickup),"u"in n&&Array.isArray(n.u)&&n.u.length>0)for(a=0;a<n.u.length;a+=1)n.u[a]in t.here==0&&-1!==(r=e.route.indexOf(n.u[a]))&&e.route.splice(r,1);return e}function u(e,t,n,r){var a;if("split"in r&&(r.t=r.split),"t"in r&&Array.isArray(r.t)&&r.t.length>0){for(e.splitsIndex={},a=0;a<r.t.length;a+=1)e.splitsIndex[r.t[a]]=r.t[a];for(e.splits=2,a=0;a<n.length;a+=1)if(n[a]in e.splitsIndex==0&&n[a]in t.here){e.splits=1;break}}return e}function h(e,t,n){var r;if("reference"in t&&(t.r=t.reference),"r"in t&&Array.isArray(t.r)&&t.r.length>0)for(e.reference=t.r,r=0;r<e.reference.length;r+=1)e.reference[r].p=n;return e}function f(e,t){var n;if(!Array.isArray(t)||0===t.length)return e;for(n=0;n<t.length;n+=1)"i"in t[n]?t[n].i in e==0&&(e[t[n].i]=t[n]):"n"in t[n]?t[n].n in e==0&&(e[t[n].n]=t[n]):"c"in t[n]&&t[n].c in e==0&&(e[t[n].c]=t[n]);return e}function b(e,t,n){var r,a,i,o;for(o=0;o<t.route.length;o+=1)!("splits"in t==0||1!==t.splits||t.route[o]in t.splitsIndex)||"circular"in t!=0&&t.circular===o||(i="direction"in t||t.route[o]in n.here?t.level:t.level/2,void 0===e.serviceNode[t.route[o]]?e.serviceNode[t.route[o]]={reference:{},service:i}:e.serviceNode[t.route[o]].service+=i,"reference"in t&&(e.serviceNode[t.route[o]].reference=f(e.serviceNode[t.route[o]].reference,t.reference))),t.route.length-1>o&&("splits"in t==0||1!==t.splits||t.route[o]in t.splitsIndex||t.route[o+1]in t.splitsIndex)&&(i="direction"in t||t.route[o]in n.here&&t.route[o+1]in n.here?t.level:t.level/2,t.route[o]<t.route[o+1]?(a=t.route[o+1],r=t.route[o]):(a=t.route[o],r=t.route[o+1]),void 0===e.serviceLink[a]&&(e.serviceLink[a]=[]),void 0===e.serviceLink[a][r]?e.serviceLink[a][r]={reference:{},service:i}:e.serviceLink[a][r].service+=i,"reference"in t&&(e.serviceLink[a][r].reference=f(e.serviceLink[a][r].reference,t.reference)));return e}for(e.serviceLink=[],e.serviceNode=[],n=function(e,t){var n,r,a,i,o,l,c,d,s,p={};if("network"in t&&"number"==typeof t.network&&t.network>=0&&t.network<e.dataObject.network.length)for(p.product={},n=0;n<e.dataObject.network[t.network][0].length;n+=1)p.product[e.dataObject.network[t.network][0][n]]=e.dataObject.network[t.network][0][n];for(p.here={},n=0;n<e.dataObject.node.length;n+=1)e.dataObject.node[n].length>1&&("range"in t==0||"x"in t==0||"y"in t==0||t.range>=(r=t.y,a=t.x,i=e.dataObject.node[n][1],o=e.dataObject.node[n][0],l=Math.PI/180,c=Math.sin((i-r)*l/2),d=Math.sin((o-a)*l/2),s=c*c+Math.cos(r*l)*Math.cos(i*l)*d*d,2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s))*6371e3))&&(p.here[n]=n);if("service"in t&&"number"==typeof t.service&&t.service>=0&&t.service<e.dataObject.service.length)for(p.service={},n=0;n<e.dataObject.service[t.service][0].length;n+=1)p.service[e.dataObject.service[t.service][0][n]]=e.dataObject.service[t.service][0][n];return p}(e,t),a=0;a<e.dataObject.link.length;a+=1)!l(n,e.dataObject.link[a][0])||(i=n,"h"in(o=e.dataObject.link[a][3])&&o.h in i.product||"shared"in o&&o.shared in i.product)||!c(n,e.dataObject.link[a][2],e.dataObject.link[a][3])||(r=d(r={},n,e.dataObject.link[a][1])).level>0&&("splits"in(r=h(r=u(r=p(r=s(r,n,e.dataObject.link[a][2],e.dataObject.link[a][3]),n,e.dataObject.link[a][3]),n,e.dataObject.link[a][2],e.dataObject.link[a][3]),e.dataObject.link[a][3],e.dataObject.link[a][0]))!=0&&1===r.splits||(e.summary.link+=r.level),e=b(e,r,n));return e}(i=function(e){var n,r,a,i,o,l={0:{link:[[0],[0],[0],{}],network:[[0],{"en-US":"Unknown"},{}],node:[0,0,{}],place:[0,0,{}],service:[[0],{"en-US":"Unknown"},{}]}};if("sanitize"in t&&!1===t.sanitize)return e;"object"!=typeof e.dataObject&&(e.dataObject={}),"meta"in e.dataObject==0&&(e.dataObject.meta={}),"schema"in e.dataObject.meta!=0&&e.dataObject.meta.schema in l!=0||(e.dataObject.meta.schema="0"),n=Object.keys(l[e.dataObject.meta.schema]);for(r=0;r<n.length;r+=1)n[r]in e.dataObject&&"object"!=typeof e.dataObject[n[r]]&&delete e.dataObject[n[r]];for(r=0;r<n.length;r+=1){n[r]in e.dataObject!=0&&0!=Array.isArray(e.dataObject[n[r]])&&0!==e.dataObject[n[r]].length||(e.dataObject[n[r]]=[l[e.dataObject.meta.schema][n[r]]]);for(a=0;a<e.dataObject[n[r]].length;a+=1){if(e.dataObject[n[r]][a].length<l[e.dataObject.meta.schema][n[r]].length)for(i=e.dataObject[n[r]][a].length-1;i<l[e.dataObject.meta.schema][n[r]].length;i+=1)e.dataObject[n[r]][a].push(l[e.dataObject.meta.schema][n[r]][i]);for(i=0;i<l[e.dataObject.meta.schema][n[r]].length;i+=1)if(typeof e.dataObject[n[r]][a][i]!=typeof l[e.dataObject.meta.schema][n[r]][i]&&("node"!==n[r]&&"place"!==n[r]||2!==i||"number"!=typeof e.dataObject[n[r]][a][i]?"link"!==n[r]||"number"!=typeof e.dataObject[n[r]][a][i]||0!==i&&1!==i?e.dataObject[n[r]][a][i]=l[e.dataObject.meta.schema][n[r]][i]:e.dataObject[n[r]][a][i]=[e.dataObject[n[r]][a][i]]:e.dataObject[n[r]][a][i]={p:e.dataObject[n[r]][a][i]}),Array.isArray(e.dataObject[n[r]][a][i]))for(o=0;o<e.dataObject[n[r]][a][i].length;o+=1)typeof e.dataObject[n[r]][a][i][o]!=typeof l[e.dataObject.meta.schema][n[r]][i][0]&&(e.dataObject[n[r]][a][i][o]=l[e.dataObject.meta.schema][n[r]][i][0])}}return e}(i),t)),a=t,r=function(e){var t,n,r,a,i=e.dataObject.node.length-1,l=e.dataObject.place.length-1,c={};for(e.node=[],e.place=[],a=0;a<e.serviceNode.length;a+=1)void 0!==e.serviceNode[a]&&a<=i&&(e.summary.node+=1,n={circle:[(t=e.dataObject.node[a])[0],t[1]],value:e.serviceNode[a].service},"reference"in e.serviceNode[a]&&(n.link=o(e.serviceNode[a].reference)),"reference"in t[2]&&(t[2].r=t[2].reference),"r"in t[2]&&t[2].r.length>0&&(n.node=t[2].r),e.node.push(n),"place"in t[2]&&(t[2].p=t[2].place),"p"in t[2]&&t[2].p in c==0&&(c[t[2].p]=t[2].p,t[2].p<=l&&t[2].p>=0&&(r=0,"p"in e.dataObject.place[t[2].p][2]?r=e.dataObject.place[t[2].p][2].p:"population"in e.dataObject.place[t[2].p][2]&&(r=e.dataObject.place[t[2].p][2].population),r>0&&(e.summary.place+=r,e.place.push({circle:[e.dataObject.place[t[2].p][0],e.dataObject.place[t[2].p][1]],value:r})))));return delete e.serviceNode,e}(r=i),i="geoJSON"in a!=0&&Array.isArray(a.geoJSON)?function(e,t){var n,r,a,i,o,l={type:"FeatureCollection",features:[]};for(a=0;a<t.length;a+=1)if(t[a]in e)for(i=0;i<e[t[a]].length;i+=1)if("value"in e[t[a]][i]&&("circle"in e[t[a]][i]||"polyline"in e[t[a]][i])){if("circle"in e[t[a]][i])n={type:"Point",coordinates:e[t[a]][i].circle};else for(n={type:"LineString",coordinates:[]},o=0;o<e[t[a]][i].polyline.length;o+=1)n.coordinates.push(e[t[a]][i].polyline[o]);r={type:t[a],value:e[t[a]][i].value},"link"in e[t[a]][i]&&(r.link=e[t[a]][i].link),"node"in e[t[a]][i]&&(r.node=e[t[a]][i].node),l.features.push({type:"Feature",geometry:n,properties:r})}return l}(r,a.geoJSON):r,l(n,i,t)}catch(e){return l(n=e,i,t)}}};