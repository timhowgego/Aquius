var mergeAquius=mergeAquius||{init:function(e){"use strict";function i(e,i,n){var t,r,o,u=document.createElement(e);if(void 0!==i)for(t=Object.keys(i),o=0;o<t.length;o+=1)u[t[o]]=i[t[o]];if(void 0!==n)for(r=Object.keys(n),o=0;o<r.length;o+=1)u.style[r[o]]=n[r[o]];return u}function n(e,n,r){var o,u,c=r._vars,a=document.getElementById(c.configId+"ImportFiles"),s=document.getElementById(c.configId+"Output"),l=document.getElementById(c.configId+"Progress");if(void 0!==e)return t(e,c),!1;if(!s||!l)return!1;for(;s.firstChild;)s.removeChild(s.firstChild);for(;l.firstChild;)l.removeChild(l.firstChild);for(null!==a&&(a.disabled=!1),s.className="",o=["aquius","config"],u=0;u<o.length;u+=1)o[u]in n&&Object.keys(n[o[u]]).length>0&&l.appendChild(i("a",{className:c.configId+"Download",href:window.URL.createObjectURL(new Blob([JSON.stringify(n[o[u]])],{type:"application/json;charset=utf-8"})),download:o[u]+".json",textContent:"Save "+o[u]+".json",role:"button"}));"undefined"!=typeof aquius&&"aquius"in n&&(s.appendChild(i("div",{id:c.configId+"Map"},{height:document.documentElement.clientHeight/2+"px"})),aquius.init(c.configId+"Map",{dataObject:n.aquius,uiStore:!1}))}function t(e,n){var t,r=document.getElementById(n.configId+"ImportFiles"),o=document.getElementById(n.configId+"Output"),u=document.getElementById(n.configId+"Progress");if(void 0!==e&&null!==o){for(;o.firstChild;)o.removeChild(o.firstChild);if(o.className=n.configId+"OutputError",t="message"in e?e.message:JSON.stringify(e),o.appendChild(i("p",{textContent:"Error: "+t})),null!==u){for(;u.firstChild;)u.removeChild(u.firstChild);u.textContent="Failed"}null!==r&&(r.disabled=!1)}}return function(e,n,t){var r,o,u,c=document.getElementById(e.configId);if(!c)return!1;for(;c.firstChild;)c.removeChild(c.firstChild);return Object.keys&&[].indexOf&&"object"==typeof JSON&&window.File&&window.FileReader&&window.Blob?(document.head.appendChild(i("script",{src:"https://timhowgego.github.io/Aquius/dist/aquius.min.js",type:"text/javascript"})),o=i("form",{className:e.configId+"Input"}),u=i("label",{textContent:t}),(r=i("input",{id:e.configId+"ImportFiles",multiple:"multiple",name:e.configId+"ImportFiles[]",type:"file"})).addEventListener("change",function(){n(e)},!1),u.appendChild(r),o.appendChild(u),o.appendChild(i("span",{id:e.configId+"Progress"})),c.appendChild(o),c.appendChild(i("div",{id:e.configId+"Output"})),!0):(c.appendChild(document.createTextNode("Browser not supported: Try a modern browser")),!1)}({configId:e,merge:this.merge},function(e){var i,r=[],o=document.getElementById(e.configId+"ImportFiles"),u={_vars:e,callback:n},c=0,a=document.getElementById(e.configId+"Progress"),s=0;function l(i,n){var o,a,l;try{"object"==typeof(a=JSON.parse(n))&&("config.json"===i.toLowerCase()?u.config=a:"meta"in a&&"schema"in a.meta&&"link"in a&&"node"in a?r.push([i,a]):"config"in u==0&&(u.config=a))}catch(i){i instanceof SyntaxError==0&&t(i,e)}if((c+=1)===s){for(r.sort(),o=[],l=0;l<r.length;l+=1)o.push(r[l][1]);e.merge(o,u)}}if(null!==o&&o.files.length>0){if(o.disabled=!0,null!==a){for(;a.firstChild;)a.removeChild(a.firstChild);a.textContent="Working..."}!function(n){var r;for(s=n.length,r=0;r<s;r+=1)(i=new FileReader).onerror=function(n,r){t(new Error("Could not read "+r.name),e),i.abort()},i.onload=function(i){return function(){try{l(i.name,this.result)}catch(i){t(i,e)}}}(n[r]),i.readAsText(n[r])}(o.files)}},"Aquius files and optional config to process:")},merge:function(e,i){"use strict";var n,t,r,o={_:{},aquius:{},config:{}};function u(e,i,n){var t,r=Object.keys(i);for(t=0;t<r.length;t+=1)r[t]in e?e[r[t]]!==i[r[t]]&&void 0!==n&&!0===n&&"string"==typeof e[r[t]]&&"string"==typeof i[r[t]]&&(e[r[t]]+=" | "+i[r[t]]):e[r[t]]=i[r[t]];return e}function c(e,i){var n,t;for(n=["attribution","description","name","url"],t=0;t<n.length;t+=1)("meta"in e.aquius==!1||n[t]in e.aquius.meta==!1)&&"meta"in i&&"object"==typeof i.meta&&n[t]in i.meta&&("meta"in e.aquius==!1&&(e.aquius.meta={}),e.aquius.meta[n[t]]=i.meta[n[t]]);return e}function a(e,i){var n,t;if("option"in i&&"object"==typeof i.option&&(n=Object.keys(i.option)).length>0){"option"in e.aquius==!1&&(e.aquius.option={});for(t=0;t<n.length;t+=1)n[t]in e.aquius.option==!1&&(e.aquius.option[n[t]]=i.option[n[t]])}return e}function s(e,i){var n,t;if("translation"in i&&"object"==typeof i.translation&&(n=Object.keys(i.translation)).length>0){"translation"in e.aquius==!1&&(e.aquius.translation={});for(t=0;t<n.length;t+=1)n[t]in e.aquius.translation?e.aquius.translation[n[t]]=u(e.aquius.translation[n[t]],i.translation[n[t]]):e.aquius.translation[n[t]]=i.translation[n[t]]}return e}function l(e,i){var n,t;if("service"in i&&Array.isArray(i.service)&&i.service.length>0){"service"in e.aquius==!1&&(e.aquius.service=[]);for(t=0;t<i.service.length;t+=1)Array.isArray(i.service[t])&&i.service[t].length>=2&&Array.isArray(i.service[t][0])&&"object"==typeof i.service[t][1]&&((n=i.service[t][0].join(":"))in e._.serviceLookup?(e.aquius.service[e._.serviceLookup[n]][1]=u(e.aquius.service[e._.serviceLookup[n]][1],i.service[t][1],!0),i.service[t].length>2&&"object"==typeof i.service[t][2]&&(e.aquius.service[e._.serviceLookup[n]].length>2?e.aquius.service[e._.serviceLookup[n]][2]=u(e.aquius.service[e._.serviceLookup[n]][2],i.service[t][2]):e.aquius.service[e._.serviceLookup[n]][2]=i.service[t][2])):(e.aquius.service.push(i.service[t]),e._.serviceLookup[n]=e.aquius.service.length-1))}return e}function f(e,i,n){var t,r,o,u;if("link"in i&&Array.isArray(i.link)&&i.link.length>0){"link"in e.aquius==!1&&(e.aquius.link=[]);for(u=0;u<i.link.length;u+=1)i.link[u].length>3&&Array.isArray(i.link[u][0])&&Array.isArray(i.link[u][1])&&Array.isArray(i.link[u][2])&&"object"==typeof i.link[u][3]&&(e=(o=y(e=(t=p(e=(r=d(e,i,i.link[u][0],n)).out,i,i.link[u][2],n)).out,i,i.link[u][3],n)).out).aquius.link.push([r.product,i.link[u][1],t.node,o.property])}return e}function d(e,i,n,t){var r;for(r=0;r<n.length;r+=1)t in e._.productSwitch==!1&&(e._.productSwitch[t]={}),n[r]in e._.productSwitch[t]==!1&&(e=_(e,i,t,n[r])),n[r]=e._.productSwitch[t][n[r]];return{out:e,product:n}}function p(e,i,n,t){var r,o,u=[];for(o=0;o<n.length;o+=1)t in e._.nodeSwitch!=!1&&n[o]in e._.nodeSwitch[t]!=!1||(e=h(e,i,n[o],t)),t in e._.nodeSwitch&&n[o]in e._.nodeSwitch[t]&&(r=e._.nodeSwitch[t][n[o]],0!==u.length&&u[u.length-1]===r||u.push(r));return{out:e,node:u}}function h(e,i,n,t){var r,o,u,c,a,s,l,f,d;function p(e,i){var n,t,r,o=Object.keys(e);for(t=0;t<i.length;t+=1){for(n=!0,r=0;r<o.length;r+=1)if(o[r]in i[t]==!1||i[t][o[r]]!==e[o[r]]){n=!1;break}if(!0===n)return!0}return!1}if("node"in i&&Array.isArray(i.node)&&void 0!==i.node[n]&&i.node[n].length>=3&&"number"==typeof i.node[n][0]&&"number"==typeof i.node[n][1]&&"object"==typeof i.node[n][2]){(o=[s=g(e,i.node[n][0]),l=g(e,i.node[n][1])].join(":"))in e._.nodeLookup?r=e._.nodeLookup[o]:("node"in e.aquius==!1&&(e.aquius.node=[]),e.aquius.node.push([s,l,{}]),r=e.aquius.node.length-1,e._.nodeLookup[o]=r),t in e._.nodeSwitch==!1&&(e._.nodeSwitch[t]={}),e._.nodeSwitch[t][n]=r,a=i.node[n][2],u=Object.keys(a);for(f=0;f<u.length;f+=1)switch(u[f]){case"r":case"reference":if(Array.isArray(a[u[f]])&&a[u[f]].length>0){u[f]in e.aquius.node[r][2]==!1&&(e.aquius.node[r][2][u[f]]=[]);for(d=0;d<a[u[f]].length;d+=1)"object"==typeof a[u[f]][d]&&"u"in a[u[f]][d]&&(t in e._.urlSwitch!=!1&&a[u[f]][d].u in e._.urlSwitch[t]!=!1||(e=q(e,i,a[u[f]][d].u,t,"url")),t in e._.urlSwitch&&a[u[f]][d].u in e._.urlSwitch[t]&&(a[u[f]][d].u=e._.urlSwitch[t][a[u[f]][d].u])),p(a[u[f]][d],e.aquius.node[r][2][u[f]])||e.aquius.node[r][2][u[f]].push(a[u[f]][d])}break;case"p":case"place":if(u[f]in e.aquius.node[r][2]){if("place"in i&&Array.isArray(i.place)&&void 0!==i.place[a[u[f]]]&&Array.isArray(i.place[c])&&i.place[a[u[f]]].length>=3&&"object"==typeof i.place[a[u[f]]][2])for(c=Object.keys(i.place[a[u[f]]][2]),d=0;d<c.length;d+=1)c[d]in e.aquius.place[e.aquius.node[r][2][u[f]]]==!1&&(e.aquius.place[e.aquius.node[r][2][u[f]]][c[d]]=i.place[a[u[f]]][2][c[d]])}else t in e._.placeSwitch!=!1&&a[u[f]]in e._.placeSwitch[t]!=!1||(e=k(e,i,a[u[f]],t)),t in e._.placeSwitch&&a[u[f]]in e._.placeSwitch[t]&&(e.aquius.node[r][2][u[f]]=e._.placeSwitch[t][a[u[f]]]);break;default:u[f]in e.aquius.node[r][2]==!1&&(e.aquius.node[r][2][u[f]]=a[u[f]])}}return e}function g(e,i){var n=Math.pow(10,e.config.coordinatePrecision);return Math.round(parseFloat(i)*n)/n}function k(e,i,n,t){var r,o,u,c,a,s;if("place"in i&&Array.isArray(i.place)&&void 0!==i.place[n]&&i.place[n].length>=3&&"number"==typeof i.place[n][0]&&"number"==typeof i.place[n][1]&&"object"==typeof i.place[n][2]){(o=[c=g(e,i.place[n][0]),a=g(e,i.place[n][1])].join(":"))in e._.placeLookup?r=e._.placeLookup[o]:("place"in e.aquius==!1&&(e.aquius.place=[]),e.aquius.place.push([c,a,{}]),r=e.aquius.place.length-1,e._.placeLookup[o]=r),t in e._.placeSwitch==!1&&(e._.placeSwitch[t]={}),e._.placeSwitch[t][n]=r,u=Object.keys(i.place[n][2]);for(s=0;s<u.length;s+=1)u[s]in e.aquius.place[r][2]==!1&&(e.aquius.place[r][2][u[s]]=i.place[n][2][u[s]])}return e}function q(e,i,n,t,r){var o;return"reference"in i&&"object"==typeof i.reference&&r in i.reference&&Array.isArray(i.reference[r])&&void 0!==i.reference[r][n]&&("reference"in e.aquius==!1&&(e.aquius.reference={}),r in e.aquius.reference==!1&&(e.aquius.reference[r]=[]),-1===(o=e.aquius.reference[r].indexOf(i.reference[r][n]))&&(e.aquius.reference[r].push(i.reference[r][n]),o=e.aquius.reference[r].length-1),t in e._[r+"Switch"]==!1&&(e._[r+"Switch"][t]={}),e._[r+"Switch"][t][n]=o),e}function y(e,i,n,t){var r,o,u,c,a,s,l,f,d;for(r=["b","block"],l=0;l<r.length;l+=1)r[l]in n&&(t in e._.blockSwitch==!1&&(e._.blockSwitch[t]={}),n[r[l]]in e._.blockSwitch[t]==0&&(e._.blockSwitch[t][n[r[l]]]=e._.blockNext,e._.blockNext+=1),n[r[l]]=e._.blockSwitch[t][n[r[l]]]);for(r=["h","shared"],l=0;l<r.length;l+=1)if(r[l]in n&&Array.isArray(n[r[l]]))for(f=0;f<n[r[l]].length;f+=1)t in e._.productSwitch==!1&&(e._.productSwitch[t]={}),void 0!==n[r[l]][f]&&null!==n[r[l]][f]||(n[r[l]][f]=0),n[r[l]][f]in e._.productSwitch[t]==!1&&(e=_(e,i,t,n[r[l]][f])),n[r[l]][f]=e._.productSwitch[t][n[r[l]][f]];for(r=["pickup","s","setdown","split","t","u"],l=0;l<r.length;l+=1)if(r[l]in n&&Array.isArray(n[r[l]])){for(u=[],f=0;f<n[r[l]].length;f+=1)t in e._.nodeSwitch!=!1&&n[r[l]][f]in e._.nodeSwitch[t]!=!1||(e=h(e,i,n[r[l]][f],t)),t in e._.nodeSwitch&&n[r[l]][f]in e._.nodeSwitch[t]&&(o=e._.nodeSwitch[t][n[r[l]][f]],-1===n[r[l]].indexOf(o)&&u.push(o));u.length>0?n[r[l]]=u:delete n[r[l]]}for(r=["r","reference"],l=0;l<r.length;l+=1)if(r[l]in n&&Array.isArray(n[r[l]]))for(a=["c","t","u"],f=0;f<n[r[l]].length;f+=1)for(c=n[r[l]][f],d=0;d<a.length;d+=1)a[d]in c&&(s="u"===a[d]?"url":"color",t in e._[s+"Switch"]!=!1&&c[a[d]]in e._[s+"Switch"][t]!=!1||(e=q(e,i,c[a[d]],t,s)),t in e._[s+"Switch"]&&c[a[d]]in e._[s+"Switch"][t]?n[r[l]][f][a[d]]=e._[s+"Switch"][t][c[a[d]]]:delete n[r[l]][f][a[d]]);return{out:e,property:n}}function w(e,i,n){var t,r,o,u,c;function a(e,i){var n;function t(e,i){var n,t=Object.keys(e);for(n=0;n<t.length;n+=1){if(t[n]in i==!1)return!1;if(e[t[n]]!==i[t[n]])return!1}return!0}for(n=0;n<e.length;n+=1)if(t(e[n][1],i[1])&&(e[n].length<3||i.length<3||t(e[n][2],i[2])))return n;return-1}if("network"in i&&Array.isArray(i.network)&&i.network.length>0){"network"in e.aquius==!1&&(e.aquius.network=[]);for(u=0;u<i.network.length;u+=1)if(Array.isArray(i.network[u])&&i.network[u].length>2&&Array.isArray(i.network[u][0])&&"object"==typeof i.network[u][1]&&"object"==typeof i.network[u][2])if(-1!==(t=a(e.aquius.network,i.network[u])))for(c=0;c<i.network[u][0].length;c+=1)n in e._.productSwitch&&i.network[u][0][c]in e._.productSwitch[n]&&(o=e._.productSwitch[n][i.network[u][0][c]],-1===e.aquius.network[t][0].indexOf(o)&&e.aquius.network[t][0].push(o));else{for(r=[[],i.network[u][1],i.network[u][2]],c=0;c<i.network[u][0].length;c+=1)n in e._.productSwitch&&i.network[u][0][c]in e._.productSwitch[n]&&r[0].push(e._.productSwitch[n][i.network[u][0][c]]);e.aquius.network.push(r)}}return e}function _(e,i,n,t){var r,o,u,c,a=!0,s={};if("reference"in e.aquius==!1&&(e.aquius.reference={}),"product"in e.aquius.reference==!1&&(e.aquius.reference.product=[]),"reference"in i&&"object"==typeof i.reference&&"product"in i.reference&&Array.isArray(i.reference.product)&&t>=0&&t<i.reference.product.length&&"object"==typeof i.reference.product[t])for(s=i.reference.product[t],r=Object.keys(i.reference.product[t]),u=0;u<e.aquius.reference.product.length;u+=1){for(o=!0,c=0;c<r.length;c+=1)if(r[c]in e.aquius.reference.product[u]==!1||i.reference.product[t][r[c]]!==e.aquius.reference.product[u][r[c]]){o=!1;break}if(o){e._.productSwitch[n][t]=u,a=!1;break}}return a&&(e._.productSwitch[n][t]=e._.productNext,e.aquius.reference.product[e._.productNext]=s,e._.productNext+=1),e}return o=function(e,i){var n;for(e.aquius.meta=e.config.meta,e.aquius.meta.schema="0",Object.keys(e.config.option).length>0&&(e.aquius.option=e.config.option),Object.keys(e.config.translation).length>0&&(e.aquius.translation=e.config.translation),e._.blockNext=0,e._.blockSwitch={},e._.colorSwitch={},e._.nodeLookup={},e._.nodeSwitch={},e._.placeLookup={},e._.placeSwitch={},e._.productNext=0,e._.productSwitch={},e._.serviceLookup={},e._.urlSwitch={},n=0;n<i.length;n+=1)"object"==typeof i[n]&&(e=f(e=l(e=s(e=a(e=c(e,i[n]),i[n]),i[n]),i[n]),i[n],n));for(n=0;n<i.length;n+=1)"object"==typeof i[n]&&(e=w(e,i[n],n));return e.aquius.link.sort(function(e,i){return i[1].reduce(function(e,i){return e+i},0)-e[1].reduce(function(e,i){return e+i},0)}),e=function(e){var i,n,t,r,o,u,c={};for(o=0;o<e.aquius.link.length;o+=1){r=e.aquius.link[o][2],"u"in e.aquius.link[o][3]&&(r=r.concat(e.aquius.link[o][3].u)),"s"in e.aquius.link[o][3]&&(r=r.concat(e.aquius.link[o][3].s)),"t"in e.aquius.link[o][3]&&(r=r.concat(e.aquius.link[o][3].t));for(u=0;u<r.length;u+=1)r[u]in c==0?c[r[u]]=1:c[r[u]]+=1}for(r=[],i=Object.keys(c),o=0;o<i.length;o+=1)r.push([i[o],c[i[o]]]);for(r.sort(function(e,i){return e[1]-i[1]}),r.reverse(),n=[],t={},o=0;o<r.length;o+=1)n.push(e.aquius.node[r[o][0]]),t[r[o][0]]=o;for(e.aquius.node=n,o=0;o<e.aquius.link.length;o+=1){for(u=0;u<e.aquius.link[o][2].length;u+=1)e.aquius.link[o][2][u]=t[e.aquius.link[o][2][u]];if("u"in e.aquius.link[o][3])for(u=0;u<e.aquius.link[o][3].u.length;u+=1)e.aquius.link[o][3].u[u]=t[e.aquius.link[o][3].u[u]];if("s"in e.aquius.link[o][3])for(u=0;u<e.aquius.link[o][3].s.length;u+=1)e.aquius.link[o][3].s[u]=t[e.aquius.link[o][3].s[u]];if("t"in e.aquius.link[o][3])for(u=0;u<e.aquius.link[o][3].t.length;u+=1)e.aquius.link[o][3].t[u]=t[e.aquius.link[o][3].t[u]]}return e}(e)}(o=function(e,i){var n,t={coordinatePrecision:5,meta:{},option:{},translation:{}},r=Object.keys(t);for("object"!=typeof i&&(i={}),n=0;n<r.length;n+=1)"config"in i&&r[n]in i.config&&typeof i.config[r[n]]==typeof t[r[n]]?e.config[r[n]]=i.config[r[n]]:e.config[r[n]]=t[r[n]];return e}(o,i),e),t=i,delete(n=o)._,"object"==typeof t&&"callback"in t?("error"in n&&(r=new Error(n.error.join(". "))),t.callback(r,n,t),!0):n}};