var aquiusPlace=aquiusPlace||{init:function(e){"use strict";function t(e,t,n){var i,a,l,d=document.createElement(e);if(void 0!==t)for(i=Object.keys(t),l=0;l<i.length;l+=1)d[i[l]]=t[i[l]];if(void 0!==n)for(a=Object.keys(n),l=0;l<a.length;l+=1)d.style[a[l]]=n[a[l]];return d}function n(e,n){var i,a=document.getElementById(n.configId+"ImportFiles"),l=document.getElementById(n.configId+"Criteria"),d=document.getElementById(n.configId+"Output"),o=document.getElementById(n.configId+"Progress");if(void 0!==e&&null!==d){for(;d.firstChild;)d.removeChild(d.firstChild);if(d.className=n.configId+"OutputError",i="message"in e?e.message:JSON.stringify(e),d.appendChild(t("p",{textContent:"Error: "+i})),null!==o){for(;o.firstChild;)o.removeChild(o.firstChild);o.textContent="Failed"}if(null!==l)for(;l.firstChild;)l.removeChild(l.firstChild);null!==a&&(a.disabled=!1)}}function i(e,n){var i,a,l=t("select");for(a=0;a<e.length;a+=1)i=t("option"),"value"in e[a]&&(i.value=e[a].value,e[a].value===n&&(i.selected="selected")),"label"in e[a]&&(i.textContent=e[a].label),"id"in e[a]&&(i.id=e[a].id),l.appendChild(i);return l}return function(e,n,i,a){var l,d,o,r=document.getElementById(e.configId);if(!r)return!1;for(;r.firstChild;)r.removeChild(r.firstChild);return Object.keys&&[].indexOf&&"object"==typeof JSON&&window.File&&window.FileReader&&window.Blob?(document.head.appendChild(t("script",{src:"https://timhowgego.github.io/Aquius/dist/aquius.min.js",type:"text/javascript"})),d=t("form",{className:e.configId+"Input"}),o=t("label",{textContent:i}),l=t("input",{id:e.configId+"ImportFiles",name:e.configId+"ImportFiles[]",type:"file"}),void 0!==a&&!0!==a||(l.multiple="multiple"),l.addEventListener("change",function(){n(e)},!1),o.appendChild(l),d.appendChild(o),d.appendChild(t("span",{id:e.configId+"Criteria"})),d.appendChild(t("span",{id:e.configId+"Progress"})),r.appendChild(d),r.appendChild(t("div",{id:e.configId+"Output"})),!0):(r.appendChild(document.createTextNode("Browser not supported: Try a modern browser")),!1)}({configId:e,locale:"en-US"},function(e){var a,l,d,o=document.getElementById(e.configId+"ImportFiles");o.files.length>0&&(l=o.files[0],(a=new FileReader).onerror=function(t,i){n(new Error("Could not read "+i.name),e),a.abort()},a.onload=(d=l,function(){try{!function(a,l){var d,o,r,c,s,u,f,p=document.getElementById(e.configId+"Criteria"),h=document.getElementById(e.configId+"Output"),m=document.getElementById(e.configId+"Progress");try{if(e.dataObject=JSON.parse(l),"object"!=typeof e.dataObject||"meta"in e.dataObject==0||"object"!=typeof e.dataObject.meta||"schema"in e.dataObject.meta==0||"0"!==e.dataObject.meta.schema)n(new Error(a+" not a valid Aquius dataset"),e);else if("place"in e.dataObject!=0&&Array.isArray(e.dataObject.place)&&0!==e.dataObject.place.length){if(null!==m)for(;m.firstChild;)m.removeChild(m.firstChild);if(null!==h){for(;h.firstChild;)h.removeChild(h.firstChild);h.className=""}if(null!==p){for(;p.firstChild;)p.removeChild(p.firstChild);for(d=["network","service"],u=0;u<d.length;u+=1)if(d[u]in e.dataObject&&Array.isArray(e.dataObject[d[u]])&&e.dataObject[d[u]].length>1){for(r=[],s=null,f=0;f<e.dataObject[d[u]].length;f+=1)(c={}).value=f,null===s&&(s=f),e.dataObject[d[u]][f].length>1&&"object"==typeof e.dataObject[d[u]][f][1]&&(e.locale in e.dataObject[d[u]][f][1]?c.label=e.dataObject[d[u]][f][1][e.locale]:Object.keys(e.dataObject[d[u]][f][1]).length>0&&(c.label=e.dataObject[d[u]][f][1][0])),r.push(c);(o=i(r,s)).id=e.configId+d[u],p.appendChild(o)}(o=i(r=[{value:0,label:"All connectivity"},{value:2,label:"Long distance"},{value:.2,label:"Local/interurban"},{value:.02,label:"Frequent/city"}],s=0)).id=e.configId+"connectivity",p.appendChild(o),(o=t("button",{id:e.configId+"process",textContent:"Analyse "+e.dataObject.place.length+" places",type:"button"})).addEventListener("click",function(){!function(e){var i,a,l,d,o,r,c,s=[],u=[],f=e.dataObject.place.length,p=0,h=document.getElementById(e.configId+"ImportFiles"),m=document.getElementById(e.configId+"process"),g=document.getElementById(e.configId+"Progress");for(null!==h&&(h.disabled=!0),null!==m&&(m.disabled=!0),l={callback:function(a,l,o){var r,b,v,y,C=e.dataObject.place[o.place[0]];function I(e,t){var n,i,a=[];if(void 0!==e&&Array.isArray(e)){for(i=0;i<e.length;i+=1)"object"==typeof e[i]&&"n"in e[i]&&""!==(n=e[i].n.replace('"',"'").trim())&&a.push(n);return'"'+a.join(", ")+'"'}return void 0!==t?t:'""'}if(void 0!==a&&(p=f+1,n(a,e)),C.length>2&&(r="r"in C[2]?I(C[2].r):"reference"in C[2]?I(C[2].reference):'""',"summary"in l&&(b=0,"object"==typeof C[2]&&("p"in C[2]?b=C[2].p:"population"in C[2]&&(b=C[2].population)),s.push([r,C[0],C[1],l.summary.link,l.summary.node,l.summary.place,b])),"node"in l))for(y=0;y<l.node.length;y+=1)"node"in l.node[y]&&"value"in l.node[y]&&(v=I(l.node[y].node),r!==v&&u.push([r,v,l.node[y].value]));if((p+=1)===f){if(null!==g)for(;g.firstChild;)g.removeChild(g.firstChild);for(d=[{data:s,file:"place.csv",head:["name","x","y","services","places","connectivity","population"]},{data:u,file:"service.csv",head:["from","to","services"]}],i=[],y=0;y<d.length;y+=1)for(i.push({data:[],file:d[y].file}),i[i.length-1].data.push(d[y].head.join(",")+"\n"),c=0;c<d[y].data.length;c+=1)i[i.length-1].data.push(d[y].data[c].join(",")+"\n");for(y=0;y<i.length;y+=1)g.appendChild(t("a",{className:e.configId+"Download",href:window.URL.createObjectURL(new Blob(i[y].data,{type:"text/csv;charset=utf-8"})),download:i[y].file,textContent:"Save "+i[y].file,role:"button"}));null!==h&&(h.disabled=!1),null!==m&&(m.disabled=!1)}},sanitize:!1},a=["network","service","connectivity"],r=0;r<a.length;r+=1)null!==(o=document.getElementById(e.configId+a[r]))&&(l[a[r]]=parseFloat(o.value,10));for(r=0;r<e.dataObject.place.length;r+=1)l.place=[r],aquius.here(e.dataObject,l)}(e)},!1),p.appendChild(o)}}else n(new Error(a+" contains no place data"),e)}catch(t){n(t,e)}}(d.name,this.result)}catch(t){n(t,e)}}),a.readAsText(l))},"Aquius dataset:",!1)}};