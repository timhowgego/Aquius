var geojsonToAquius=geojsonToAquius||{init:function(e){"use strict";function r(e,r,o){var t,n,i,a=document.createElement(e);if(void 0!==r)for(t=Object.keys(r),i=0;i<t.length;i+=1)a[t[i]]=r[t[i]];if(void 0!==o)for(n=Object.keys(o),i=0;i<n.length;i+=1)a.style[n[i]]=o[n[i]];return a}function o(e,o,n){var i,a,u=n._vars,s=document.getElementById(u.configId+"ImportFiles"),f=document.getElementById(u.configId+"Output"),p=document.getElementById(u.configId+"Progress");if(void 0!==e)return t(e,u),!1;if(!f||!p)return!1;for(;f.firstChild;)f.removeChild(f.firstChild);for(;p.firstChild;)p.removeChild(p.firstChild);for(null!==s&&(s.disabled=!1),f.className="",i=["aquius","config"],a=0;a<i.length;a+=1)i[a]in o&&Object.keys(o[i[a]]).length>0&&p.appendChild(r("a",{className:u.configId+"Download",href:window.URL.createObjectURL(new Blob([JSON.stringify(o[i[a]])],{type:"application/json;charset=utf-8"})),download:i[a]+".json",textContent:"Save "+i[a]+".json",role:"button"}));"undefined"!=typeof aquius&&"aquius"in o&&(f.appendChild(r("div",{id:u.configId+"Map"},{height:document.documentElement.clientHeight/2+"px"})),aquius.init(u.configId+"Map",{dataObject:o.aquius,uiStore:!1}))}function t(e,o){var t,n=document.getElementById(o.configId+"ImportFiles"),i=document.getElementById(o.configId+"Output"),a=document.getElementById(o.configId+"Progress");if(void 0!==e&&null!==i){for(;i.firstChild;)i.removeChild(i.firstChild);if(i.className=o.configId+"OutputError",t="message"in e?e.message:JSON.stringify(e),i.appendChild(r("p",{textContent:"Error: "+t})),null!==a){for(;a.firstChild;)a.removeChild(a.firstChild);a.textContent="Failed"}null!==n&&(n.disabled=!1)}}return function(e,o,t){var n,i,a,u=document.getElementById(e.configId);if(!u)return!1;for(;u.firstChild;)u.removeChild(u.firstChild);return Object.keys&&[].indexOf&&"object"==typeof JSON&&window.File&&window.FileReader&&window.Blob?(document.head.appendChild(r("script",{src:"https://timhowgego.github.io/Aquius/dist/aquius.min.js",type:"text/javascript"})),i=r("form",{className:e.configId+"Input"}),a=r("label",{textContent:t}),(n=r("input",{id:e.configId+"ImportFiles",multiple:"multiple",name:e.configId+"ImportFiles[]",type:"file"})).addEventListener("change",function(){o(e)},!1),a.appendChild(n),i.appendChild(a),i.appendChild(r("span",{id:e.configId+"Progress"})),u.appendChild(i),u.appendChild(r("div",{id:e.configId+"Output"})),!0):(u.appendChild(document.createTextNode("Browser not supported: Try a modern browser")),!1)}({configId:e,cartograph:this.cartograph},function(e){var r,n=[],i=document.getElementById(e.configId+"ImportFiles"),a={_vars:e,callback:o},u=0,s=document.getElementById(e.configId+"Progress"),f=0;function p(r,o){var i;try{"object"==typeof(i=JSON.parse(o))&&("config.json"===r.toLowerCase()?a.config=i:"type"in i&&"FeatureCollection"===i.type&&"features"in i&&Array.isArray(i.features)?n.push(i):"config"in a==0&&(a.config=i))}catch(r){r instanceof SyntaxError==0&&t(r,e)}(u+=1)===f&&e.cartograph(n,a)}if(null!==i&&i.files.length>0){if(i.disabled=!0,null!==s){for(;s.firstChild;)s.removeChild(s.firstChild);s.textContent="Working..."}!function(o){var n;for(f=o.length,n=0;n<f;n+=1)(r=new FileReader).onerror=function(o,n){t(new Error("Could not read "+n.name),e),r.abort()},r.onload=function(r){return function(){try{p(r.name,this.result)}catch(r){t(r,e)}}}(o[n]),r.readAsText(o[n])}(i.files)}},"GeoJSON files and optional config to process:")},cartograph:function(e,r){"use strict";var o,t,n,i={_:{},aquius:{},config:{}};function a(e,r){var o=Math.pow(10,e.config.coordinatePrecision);return r=parseFloat(r),Number.isNaN(r)?0:Math.round(r*o)/o}function u(e,r,o){var t,n,i,u;function s(e,r){var o,t;if(Array.isArray(e))for(o=0;o<e.length;o+=1)if(Array.isArray(e[o]))for(t=0;t<e[o].length;t+=1)Array.isArray(e[o][t])&&2===e[o][t].length&&("maxX"in r==!1?(r.maxX=e[o][t][0],r.minX=e[o][t][0],r.maxY=e[o][t][1],r.minY=e[o][t][1]):(e[o][t][0]>r.maxX?r.maxX=e[o][t][0]:e[o][t][0]<r.minX&&(r.minX=e[o][t][0]),e[o][t][1]>r.maxY?r.maxY=e[o][t][1]:e[o][t][1]<r.minY&&(r.minY=e[o][t][1])));return r}if(-1!==(n=function(e,r,o){var t,n;function i(e,r,o){var t,n,i,a,u,s,f,p;if(Array.isArray(o))for(s=0;s<o.length;s+=1)if(Array.isArray(o[s])){for(t=!1,f=0,p=o[s].length-1;f<o[s].length;p=f++)n=o[s][f][0],a=o[s][f][1],i=o[s][p][0],a>r!=(u=o[s][p][1])>r&&e<(i-n)*(r-a)/(u-a)+n&&(t=!t);if(t)return!0}return!1}if(-1!==e._.placeLast)for(n=0;n<e._.place[e._.placeLast][0].length;n+=1)if(i(r,o,e._.place[e._.placeLast][0][n]))return e._.placeLast;for(t=0;t<e._.place.length;t+=1)if(t!==e._.placeLast&&Array.isArray(e._.place[t][0]))for(n=0;n<e._.place[t][0].length;n+=1)if(i(r,o,e._.place[t][0][n]))return t;return-1}(e,r,o))&&n in e._.placeLookup==!1){for(t={},u=0;u<e._.place[n][0].length;u+=1)t=s(e._.place[n][0][u],t);"maxX"in t&&("place"in e.aquius==!1&&(e.aquius.place=[]),e.aquius.place.push([a(e,(t.maxX+t.minX)/2),a(e,(t.maxY+t.minY)/2),e._.place[n][1]]),e._.placeLookup[n]=e.aquius.place.length-1,e._.placeLast=n)}return i=[r,o].join(":"),0===e._.place.length||-1!==n||!1===e.configinGeojson?(-1!==n&&(e._.node[i][2].p=e._.placeLookup[n]),"node"in e.aquius==!1&&(e.aquius.node=[]),i in e._.node?e.aquius.node.push(e._.node[i]):e.aquius.node.push([r,o,{}]),e._.nodeLookup[i]=e.aquius.node.length-1):e._.nodeIgnore[i]="",e}return i._.place=[],i._.placeLast=-1,i._.placeLookup={},i._.node={},i._.nodeLookup={},i._.nodeIgnore={},Array.isArray(e)||(e=[e]),i=function(e,r){var o,t,n,i,s,f,p,c,l,g,d,y,h,m;function q(e){var r,o,t=[],n=e.toString().split(",");for(o=0;o<n.length;o+=1)r=parseFloat(n[o]),Number.isNaN(r)&&(r=0),t.push(r);return t}for(d=0;d<r.length;d+=1)if("object"==typeof r[d]&&"features"in r[d]&&Array.isArray(r[d].features))for(y=0;y<r[d].features.length;y+=1)if("object"==typeof r[d].features[y]&&"geometry"in r[d].features[y]&&"object"==typeof r[d].features[y].geometry&&"type"in r[d].features[y].geometry&&("MultiLineString"===r[d].features[y].geometry.type||"LineString"===r[d].features[y].geometry.type)&&"coordinates"in r[d].features[y].geometry){for(p=[],t="LineString"===r[d].features[y].geometry.type?[r[d].features[y].geometry.coordinates]:r[d].features[y].geometry.coordinates,h=0;h<t.length;h+=1)if(Array.isArray(t[h]))for(m=0;m<t[h].length;m+=1)Array.isArray(t[h][m])&&2===t[h][m].length&&((i=[l=a(e,t[h][m][0]),g=a(e,t[h][m][1])].join(":"))in e._.nodeLookup?0!==p.length&&e._.nodeLookup[i]===p[p.length-1]||p.push(e._.nodeLookup[i]):i in e._.nodeIgnore==0&&i in(e=u(e,l,g))._.nodeLookup&&(0===p.length||e._.nodeLookup[i]!==p[p.length-1])&&p.push(e._.nodeLookup[i]));if(p.length>1){if(s=[],c={},"properties"in r[d].features[y]&&"object"==typeof r[d].features[y].properties){for(f=[["circularProperty","c"],["directionProperty","d"]],h=0;h<f.length;h+=1)e.config[f[h][0]]in r[d].features[y].properties&&1==r[d].features[y].properties[e.config[f[h][0]]]&&(c[f[h][1]]=1);for(f=[["blockProperty","b"],["sharedProperty","h"]],h=0;h<f.length;h+=1)e.config[f[h][0]]in r[d].features[y].properties&&(o=parseInt(r[d].features[y].properties[e.config[f[h][0]]],10),Number.isNaN(o)||(c[f[h][1]]=o));e.config.linkNameProperty in r[d].features[y].properties&&null!==r[d].features[y].properties[e.config.linkNameProperty]&&""!==(o=r[d].features[y].properties[e.config.linkNameProperty].trim())&&("r"in c==0&&(c.r=[{}]),c.r[0].n=o),f=[["colorProperty","c"],["textColorProperty","t"]];for(h=0;h<f.length;h+=1)e.config[f[h][0]]in r[d].features[y].properties&&null!==r[d].features[y].properties[e.config[f[h][0]]]&&6===(o=r[d].features[y].properties[e.config[f[h][0]]].trim()).length&&("reference"in e.aquius==0&&(e.aquius.reference={}),"color"in e.aquius.reference==0&&(e.aquius.reference.color=[]),o="#"+o,-1===(n=e.aquius.reference.color.indexOf(o))&&(e.aquius.reference.color.push(o),n=e.aquius.reference.color.length-1),"r"in c==0&&(c.r=[{}]),c.r[0][f[h][1]]=n);e.config.linkUrlProperty in r[d].features[y].properties&&null!==r[d].features[y].properties[e.config.linkUrlProperty]&&""!==(o=r[d].features[y].properties[e.config.linkUrlProperty].trim())&&("reference"in e.aquius==0&&(e.aquius.reference={}),"url"in e.aquius.reference==0&&(e.aquius.reference.url=[]),-1===(n=e.aquius.reference.url.indexOf(o))&&(e.aquius.reference.url.push(o),n=e.aquius.reference.url.length-1),"r"in c==0&&(c.r=[{}]),c.r[0].u=n),e.config.productProperty in r[d].features[y].properties?s.push(q(r[d].features[y].properties[e.config.productProperty])):s.push([0]),e.config.serviceProperty in r[d].features[y].properties&&null!==r[d].features[y].properties[e.config.serviceProperty]&&""!==r[d].features[y].properties[e.config.serviceProperty]?s.push(q(r[d].features[y].properties[e.config.serviceProperty])):s.push([1])}else s.push([0]),s.push([1]);s.push(p),s.push(c),"link"in e.aquius==0&&(e.aquius.link=[]),e.aquius.link.push(s)}}return"node"in e.aquius&&e.aquius.node.length>0&&("option"in e.aquius==0&&(e.aquius.option={}),"c"in e.config.option!=0&&"k"in e.config.option!=0||(e.config.option.c=e.aquius.node[0][0],e.config.option.k=e.aquius.node[0][1],e.config.option.m=12,e.aquius.option.c=e.config.option.c,e.aquius.option.k=e.config.option.k,e.aquius.option.m=e.config.option.m),"x"in e.config.option!=0&&"y"in e.config.option!=0||(e.config.option.x=e.aquius.node[0][0],e.config.option.y=e.aquius.node[0][1],e.config.option.z=10,e.aquius.option.x=e.config.option.x,e.aquius.option.y=e.config.option.y,e.aquius.option.z=e.config.option.z)),e}(i=function(e,r){var o,t,n,i,u,s,f,p,c,l;function g(e,r){var o,t,n,i=Object.keys(e);for(t=0;t<r.length;t+=1){for(o=!0,n=0;n<i.length;n+=1)if(i[n]in r[t]==0||r[t][i[n]]!==e[i[n]]){o=!1;break}if(!0===o)return!0}return!1}for(p=0;p<r.length;p+=1)if("object"==typeof r[p]&&"features"in r[p]&&Array.isArray(r[p].features))for(c=0;c<r[p].features.length;c+=1)if("object"==typeof r[p].features[c]&&"geometry"in r[p].features[c]&&"object"==typeof r[p].features[c].geometry&&"type"in r[p].features[c].geometry&&"Point"===r[p].features[c].geometry.type&&"coordinates"in r[p].features[c].geometry&&Array.isArray(r[p].features[c].geometry.coordinates)&&2===r[p].features[c].geometry.coordinates.length&&((n=[s=a(e,r[p].features[c].geometry.coordinates[0]),f=a(e,r[p].features[c].geometry.coordinates[1])].join(":"))in e._.node==0&&(e._.node[n]=[s,f,{}]),"properties"in r[p].features[c]&&"object"==typeof r[p].features[c].properties)){for(u=[],i=["nodeNameProperty","nodeCodeProperty"],l=0;l<i.length;l+=1)e.config[i[l]]in r[p].features[c].properties&&null!==r[p].features[c].properties[e.config[i[l]]]&&""!==(o=r[p].features[c].properties[e.config[i[l]]].trim())&&u.push({n:o});if(u.length>0&&e.config.nodeUrlProperty in r[p].features[c].properties&&null!==r[p].features[c].properties[e.config.nodeUrlProperty]&&""!==(o=r[p].features[c].properties[e.config.nodeUrlProperty].trim())&&("reference"in e.aquius==0&&(e.aquius.reference={}),"url"in e.aquius.reference==0&&(e.aquius.reference.url=[]),-1===(t=e.aquius.reference.url.indexOf(o))&&(e.aquius.reference.url.push(o),t=e.aquius.reference.url.length-1),u[0].u=t),u.length>0)if("r"in e._.node[n][2])for(l=0;l<u.length;l+=1)!1===g(u[l],e._.node[n][2].r)&&e._.node[n][2].r.push(u);else e._.node[n][2].r=u}return e}(i=function(e,r){var o,t,n,i,a=0;for(n=0;n<r.length;n+=1)if("object"==typeof r[n]&&"features"in r[n]&&Array.isArray(r[n].features))for(i=0;i<r[n].features.length;i+=1)"object"==typeof r[n].features[i]&&"geometry"in r[n].features[i]&&"object"==typeof r[n].features[i].geometry&&"type"in r[n].features[i].geometry&&("MultiPolygon"===r[n].features[i].geometry.type||"Polygon"===r[n].features[i].geometry.type)&&"coordinates"in r[n].features[i].geometry&&Array.isArray(r[n].features[i].geometry.coordinates)&&(o="Polygon"===r[n].features[i].geometry.type?[[r[n].features[i].geometry.coordinates],{}]:[r[n].features[i].geometry.coordinates,{}],"properties"in r[n].features[i]&&"object"==typeof r[n].features[i].properties&&e.config.populationProperty in r[n].features[i].properties&&null!==r[n].features[i].properties[e.config.populationProperty]&&(t=parseFloat(r[n].features[i].properties[e.config.populationProperty]),Number.isNaN(t)||(o[1].p=t,t>a&&(a=t))),e._.place.push(o));return a>0&&"placeScale"in e.config.option==0&&(e.config.option.placeScale=Math.round(1/(a/2e6)*1e5)/1e5,"option"in e.aquius==0&&(e.aquius.option={}),e.aquius.option.placeScale=e.config.option.placeScale),e}(i=function(e){var r,o;for(e.aquius.meta=e.config.meta,e.aquius.meta.schema="0",r=["option","translation"],o=0;o<r.length;o+=1)Object.keys(e.config[r[o]]).length>0&&(e.aquius[r[o]]=e.config[r[o]]);for(r=["network","service"],o=0;o<r.length;o+=1)e.aquius[r[o]]=e.config[r[o]];return e.config.product.length>0&&(e.aquius.reference={},e.aquius.reference.product=e.config.product),e}(i=function(e,r){var o,t={blockProperty:"block",circularProperty:"circular",colorProperty:"color",coordinatePrecision:5,directionProperty:"direction",inGeojson:!0,linkNameProperty:"name",linkUrlProperty:"url",meta:{},network:[],nodeCodeProperty:"code",nodeNameProperty:"name",nodeUrlProperty:"url",option:{},populationProperty:"population",product:[],productProperty:"product",service:[],serviceProperty:"service",sharedProperty:"shared",textColorProperty:"text",translation:{}},n=Object.keys(t);for("object"!=typeof r&&(r={}),o=0;o<n.length;o+=1)"config"in r&&n[o]in r.config&&typeof r.config[n[o]]==typeof t[n[o]]?e.config[n[o]]=r.config[n[o]]:e.config[n[o]]=t[n[o]];return e}(i,r)),e),e),e),t=r,delete(o=i)._,"object"==typeof t&&"callback"in t?("error"in o&&(n=new Error(o.error.join(". "))),t.callback(n,o,t),!0):o}};